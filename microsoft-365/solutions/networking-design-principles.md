---
title: (クラウドへの) ネットワーク — 1 つのアーキテクトの視点
description: 最も一般的な落とし穴を回避して、クラウド接続用にネットワークを最適化する方法について説明します。
ms.author: bcarter
author: brendacarter
manager: bcarter
ms.audience: ITPro
ms.topic: article
ms.prod: microsoft-365-enterprise
localization_priority: Normal
ms.collection:
- M365-identity-device-management
- M365-security-compliance
ms.custom: ''
f1.keywords: NOCSH
ms.openlocfilehash: 175903949b639740ad00b29013d5748b99bdb2de
ms.sourcegitcommit: ddfb4f3e34deb733e8625e845e4dfd1fcc066ceb
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 01/06/2021
ms.locfileid: "49771849"
---
# <a name="networking-up-to-the-cloudone-architects-viewpoint"></a>(クラウドへの) ネットワーク — 1 つのアーキテクトの視点

この記事では、Microsoft のセキュリティ & コンプライアンス アーキテクトである [Ed Fisher](https://www.linkedin.com/in/edfisher/)が、最も一般的な落とし穴を回避してクラウド接続用にネットワークを最適化する方法について説明します。 

## <a name="about-the-author"></a>筆者について

![Ed Fisher の写真](../media/solutions-architecture-center/ed-fisher-networking.jpg) 

現在、私は、セキュリティとコンプライアンスに重点を置き、南東地域の&です。 過去 10 年間、Office 365 に移行したお客様と一緒に作業してきました。 私は、数百万人のユーザーが世界中に分散し、その間に多数のユーザーを持つ政府機関や企業に対して、小さなショップで作業を行いました。その間に多数のユーザーがいて、その大部分は数万人のユーザーを持ち、世界中のさまざまな場所に複数の場所を持ち、セキュリティのレベルが高く、コンプライアンス要件が多数必要です。 何百もの企業や何百万人ものユーザーが安全かつ安全にクラウドに移行する方法を支援しました。

過去 25 年間の背景にはセキュリティ、インフラストラクチャ、ネットワーク エンジニアリングが含まれます。また、Microsoft に参加する前に、以前の雇用主の 2 人を Office 365 に移動してきましたが、私はテーブルに十分な時間を与えて、そのことを思い出してください。 同じ顧客は 2 人もいなされていませんが、ほとんどの顧客は同じニーズを持っていますが、SaaS や PaaS プラットフォームなどの標準化されたサービスを使用する場合、最適なアプローチは同じになる傾向があります。

## <a name="its-not-the-networkits-how-youre-misusing-it"></a>ネットワークではなく、ユーザーがネットワークを使用している (誤った) 方法です。

何回発生しても、クリエイティブなセキュリティ チームやネットワーク チームがMicrosoft クラウド サービスに接続する必要があるという考え方に取り組もうとしたことに気がつきました。 セキュリティ ポリシー、コンプライアンス標準、またはユーザーが使用を主張するより良い方法が常にいくつかあります。その方法は、ユーザーが達成しようとしているものや、その方法の方が良く、より簡単で、費用効果が高く、パフォーマンスの高い方法に関する会話に参加する必要が生じずに行います。

この種のことが私にエスカレートされた場合、私は通常、チャレンジに取り入れて、その方法と理由を順を見て、必要な場所にアクセスします。 しかし、私が完全に簡潔に言っている場合は、彼らに自分の言い分を伝えたいだけだと共有し、最後に失望した場合にはうまくいかないと言ったと言い返す必要があります。 I may want to do that sometimes, but I *don't*. 私が行うのは、この投稿に含めるすべての内容を説明する方法です。 役割に関係なく、組織が Microsoft クラウド サービスを使用する場合は、次の点が役立つ可能性があります。

## <a name="guiding-principles"></a>ガイドの原則

最初に、ここで行っていることに関する一次規則から始めしましょう。 実際のセキュリティを維持しながら、最小の複雑さおよび最大のパフォーマンスを確保するために、クラウド サービスに安全に接続する方法について説明します。 以下のいずれの方法も、お客様や自分の顧客が、すべてにお気に入りのプロキシ サーバーを使用できない場合でも、それに対抗する必要があります。

- **できるからといって**、Jurassic Park 映画 『Dr. Ian Malcolm』を言い換えるべきとは言えなすのです。はい、はい。しかし、セキュリティ チームは、必要な場合に考えるのをやめなかったかどうかに非常に先入感を持っています。"
- **セキュリティは複雑さを** 意味するのではありません。費用の節約、デバイスのルーティング、またはボタンのクリックが多いからといって、セキュリティが強化されるという意味ではありません。
- **Office 365** はインターネットを通してアクセスされます。ただし、これは 365 がインターネットOfficeとは異なっています。 これは、Microsoft によって管理され、ユーザーによって管理される SaaS サービスです。 インターネットでアクセスする Web サイトとは異なり、実際には背後を見て、ポリシーとコンプライアンス基準を満たすために必要なコントロールを適用できます。ただし、目標を満たしながら、別の方法で行う必要がある場合があります。
- **悪** い、ローカライズされたスポットは良い: すべてのユーザーのすべてのインターネット トラフィックを常に中央の場所に戻したいと考える人は誰でもいます。そのため、通常、すべてのユーザーが監視してポリシーを適用できますが、多くの場合、すべての場所でインターネット アクセスをプロビジョニングするよりも安価な場合や、その方法に過大な理由があります。 しかし、これらの場所はまさにそのとおりです。トラフィックがトラフィックを通るポイント。 ユーザーが何も問題を起こさなかったり、Cat ビデオをストリーミングしたりして、ユーザーが何も問題を起こさなかったりしますが、ミッション クリティカルなビジネス アプリケーションのトラフィックを同じ方法で扱うのはやめしてください。
- **DNS** が満足できない場合は、何も満足できません。最適に設計されたネットワークは、世界の他の地域のサーバーへの要求を再帰するか、ISP の DNS サーバーや DNS 解決情報をキャッシュする他のパブリック DNS サーバーを使用することで、低品質な DNS によって低下する可能性があります。
- **以前は** そうだったからといって、それが今の方法で行われる必要があるという意味ではありません。テクノロジは絶えず変化し、Office 365 も例外ではありません。 オンプレミス サービス用に開発および展開されたセキュリティ対策を適用したり、Web サービスを制御したりすると、同じレベルのセキュリティ 保証が提供されるのではなめ、パフォーマンスに大きな悪影響を及ぼす可能性があります。
- **Office 365** は、インターネットを使用してアクセスするために構築されました。簡単に説明します。 ユーザーとエッジの間で何をしたいかに関係なく、トラフィックはネットワークから離れ、ネットワークに接続する前に引き続きインターネット上を移動します。 Azure ExpressRoute を使用して、ネットワークから直接ネットワークに遅延の影響を受け入れたトラフィックをルーティングしている場合でも、インターネット接続は絶対に必要です。 受け入れる。 あまり考え過ぎずに。

## <a name="where-bad-choices-are-often-made"></a>悪い選択が頻繁に行われた場所

セキュリティの名の下で悪い決定が下される場所は多くある一方で、お客様に最もよく遭遇する場所は次のとおりです。 多くのお客様の会話には、これらすべてが同時に関係します。

### <a name="insufficient-resources-at-the-edge"></a>エッジのリソースが不十分

グリーンフィールド環境を展開しているお客様は非常に少なく、ユーザーの作業方法やインターネット出口に関して何年もの経験があります。 顧客がプロキシ サーバーを持っている場合でも、直接アクセスを許可し、単に NAT 送信トラフィックを許可する場合でも、顧客は何年もの間それを行い続けてきました。従来の内部アプリケーションをクラウドに移行する際に、エッジを通じてどれだけ多くのことを開始するかは考慮しません。

帯域幅は常に懸念事項ですが、NAT デバイスには負荷の増加に対処するのに十分な能力が備えれず、リソースを解放するために接続が途中で閉じ始める可能性があります。 Office 365 に接続するクライアント ソフトウェアの多くでは、永続的な接続が必要であり、Office 365 を完全に利用するユーザーは 32 以上の同時接続を持つ場合があります。 NAT デバイスがこれらのデバイスを途中でドロップすると、不要になった接続を使用しようとして、それらのアプリが応答しなくなる可能性があります。 あきらめて新しい接続を確立しようとするときに、ネットワーク ギアにさらに負荷がかっている。

### <a name="localized-breakout"></a>ローカライズされたテキスト

この一覧の他の情報はすべて、ネットワークから離れ、可能な限り迅速にネットワークに接続することです。 ユーザーのトラフィックを中央のエグレス ポイントにバックホールする (特に、そのエグレス ポイントがユーザーの地域とは別の地域にある場合)、不要な待機時間が発生し、クライアント エクスペリエンスとダウンロード速度の両方に影響を与えます。 Microsoft は、すべての主要な ISP で確立されたサービスとピアリングのフロント エンドを備え、世界中にプレゼンス ポイントを持っています。そのため、ユーザーのトラフィックをローカルにルーティングすることで、最小限の待機時間で迅速にネットワークに接続できます。

### <a name="dns-resolution-traffic-should-follow-the-internet-egress-path"></a>DNS 解決トラフィックは、インターネット出口パスに従う必要があります。

もちろん、クライアントがエンドポイントを検索するには、DNS を使用する必要があります。 Microsoft の DNS サーバーは DNS 要求のソースを評価して、要求の送信元に最も近いインターネット用語で返される応答を確認します。 名前解決要求がユーザーのトラフィックと同じパスに送信するように DNS が構成されていることを確認します。ローカルエグレスを提供するが、別の地域のエンドポイントに送信する必要があります。 つまり、リモート データ センターの DNS サーバーに転送するのではなく、ローカル DNS サーバーを "ルートに移動" できます。 また、パブリックおよびプライベート DNS サービスに注意してください。これは、ある世界の一部からの結果をキャッシュし、世界の他の部分からの要求にサービスを提供する可能性があります。

### <a name="to-proxy-or-not-to-proxy-that-is-the-question"></a>プロキシを使用する場合とプロキシしない場合は、それが問題です。

最初に考慮すべき点の 1 つは、ユーザーの接続を 365 にプロキシOfficeです。 これは簡単です。プロキシを使用しない。 Office 365 はインターネット上でアクセスされますが、インターネットではありません。 コア サービスの拡張機能であり、そのようなサービスとして扱う必要があります。 DLP、マルウェア対策、コンテンツ検査など、プロキシに必要な操作は既にサービスで利用できます。TLS で暗号化された接続を解除することなく、大規模に使用できます。 ただし、他の方法では制御できないトラフィックを本当にプロキシする場合は、ガイダンスとトラフィックのカテゴリに [https://aka.ms/pnc](https://aka.ms/pnc) 注意を払います [https://aka.ms/ipaddrs](https://aka.ms/ipaddrs) 。 We have three categories of traffic for Office 365. 最適化と許可は、実際には直接行き、プロキシをバイパスする必要があります。 既定値はプロキシできます。 詳細については、これらのドキュメントを参照してください。読み取り。

プロキシの使用を主張するほとんどのお客様は、実際に何を行っているのかを確認すると、クライアントがプロキシに HTTP CONNECT 要求を行う際に、プロキシはコストの高い追加ルーターになってくることに気付くでしょう。 MAPI や RTC などの使用されているプロトコルは、Web プロキシが理解するプロトコルではないので、TLS の割り込みでも、実際には追加のセキュリティを得る必要がなくなってはいます。 余分 *な* 待機時間が発生しています。 Microsoft 365 トラフィックの最適化、許可、既定のカテゴリなど、詳しくは、このトピックをご [https://aka.ms/pnc](https://aka.ms/pnc) 覧ください。

最後に、プロキシに対する全体的な影響とそれに対応する対応を考慮して、その影響に対処します。 プロキシを介して行う接続が増えるほど、TCP スケール ファクターが減少し、トラフィックをバッファーする必要が生じない可能性があります。 プロキシが過剰に使い過ぎたので、スケール ファクター 0 を使っているお客様を見ていました。 スケール ファクターは指数値であり、8 を使用する必要があるので、スケール ファクター値の各削減はスループットに大きな悪影響を与えます。

TLS 検査は SECURITY を意味します。 しかし、実際にはそうではありません。 プロキシを使用している多くのお客様は、それらを使用してすべてのトラフィックを検査したいと思っています。つまり、TLS は「ブレークアンド検査」を意味します。 HTTPS 経由でアクセスされる Web サイトに対してこれを行う場合 (プライバシーに関する問題にかかわらず)、プロキシは数百ミリ秒の間、10 または 20 の同時ストリームでこれを行う必要があります。 大量のダウンロードやビデオが含まれる場合は、それらの接続の 1 つ以上がはるかに長く続く可能性がありますが、全体として、これらの接続の大部分は非常に迅速に確立、転送、閉じます。 ブレークと検査を行うということは、プロキシが 2 倍の作業を行う必要があるという意味です。 クライアントからプロキシへの接続ごとに、プロキシはエンドポイントへの個別の接続を確立する必要があります。 1 は 2 になり、2 は 4 になり、32 は 64 になります。...私が行く場所を参照してください。 プロキシ ソリューションのサイズは、一般的な Web アプリケーションに対して問題ありませんが、Office 365 へのクライアント接続に対して同じ処理を行う場合、同時に有効な接続の数は、サイズを設定したサイズより桁上の大きさになる場合があります。

### <a name="streaming-isnt-important-except-that-it-is"></a>ストリーミングは重要ではありません(ただし、 

UDP を使用する Office 365 のサービスは、Skype (間もなく廃止される予定) と Microsoft Teams のみです。 Teams は、オーディオ、ビデオ、プレゼンテーション共有などのストリーミング トラフィックに UDP を使用します。 ストリーミング トラフィックは、音声、ビデオ、デッキの発表やデモの実行を含むオンライン会議を行う場合など、ライブです。 これらは UDP を使用します。パケットが破棄された場合、または順序が不同で到着した場合、ユーザーがはほとんど知らないので、ストリームは単に処理を続けることができます。

クライアントからサービスへの送信 UDP トラフィックを許可しない場合、TCP の使用にフォール バックできます。 ただし、TCP パケットが破棄された場合、再送信タイムアウト (RTO) の有効期限が切れ、不足しているパケットを再送信できるまで、すべてが停止します。 パケットが順序が正しく届かない場合、他のパケットが到着するまですべてが停止し、順序に合った再構成が可能になります。 どちらの場合も、オーディオ (最大ヘッドルームを思い出してください?) とビデオ (何かをクリックした場合) で、許容可能な不具合が生じします。あ)、パフォーマンスが低下し、ユーザー エクスペリエンスが低下します。 プロキシについて上記の説明を思い出してください。 Teams クライアントにプロキシの使用を強制する場合は、強制的に TCP を使用します。 これで、パフォーマンスに悪影響が 2 回発生します。

### <a name="split-tunneling-may-seem-scary"></a>スプリット トンネリングが恐ろしいように見える

ただし、そうではなんか違います。 365 へのOffice TLS を使用しています。 TLS 1.2 はしばらくの間提供されています。レガシ クライアントでは引き続き TLS 1.2 が使用され、リスクが生じ、間もなく古いバージョンは無効になります。

サービスにアクセスする前に TLS 接続 (32) を VPN を越える必要がある場合、セキュリティは追加されます。 待機時間が増加し、全体的なスループットが低下します。 一部の VPN ソリューションでは、UDP に TCP 経由のトンネリングを強制的に行う場合も、ストリーミング トラフィックに非常に悪影響を及ぼす可能性があります。 また、TLS 検査を行う場合を限り、上振れや欠点はありません。 従業員のほとんどがリモートである現在、お客様の間で非常に一般的なテーマは、最適化カテゴリ [Office 365](https://docs.microsoft.com/microsoft-365/enterprise/microsoft-365-network-connectivity-principles#new-office-365-endpoint-categories)エンドポイントにアクセスするための分割トンネリングを構成するのではなく、すべてのユーザーが VPN を使用して接続する場合に、帯域幅とパフォーマンスに大きな影響を与えるという点です。

スプリット トンネリングを簡単に行う修正であり、実行する必要があります。 詳細については、VPN スプリット トンネリングを使用Office [365](https://docs.microsoft.com/microsoft-365/enterprise/microsoft-365-vpn-split-tunnel)接続の最適化を確認してください。

## <a name="the-sins-of-the-past"></a>過去の思い出

多くの場合、悪い選択がなされる理由は、(1) サービスのしくみを知らない、(2) クラウドを導入する前に作成された会社のポリシーに従おうとする、(3) 目標を達成する方法が複数あると簡単に確信できないセキュリティ チームの組み合わせです。 上記と以下のリンクが最初のリンクに役立ちます。 2 番目を乗り越えするには、エグゼクティブ スポンサーシップが必要になる場合があります。 セキュリティ ポリシーの方法ではなく、セキュリティ ポリシーの目標に対処すると、3 つ目の方法に役立ちます。 条件付きアクセスからコンテンツのモデレート、DLP から情報保護、エンドポイント検証からゼロデイ脅威まで、妥当なセキュリティ ポリシーは、Office 365 で使用可能なポリシーを使用して、オンプレミスのネットワーク ギア、強制 VPN トンネル、TLS のブレークと検査に依存することなく実現できます。

また、組織がクラウドへの移行を開始する前にサイズ変更および購入されたハードウェアは、新しいトラフィック パターンと負荷を処理するためにスケール アップできない場合もあります。 すべてのトラフィックを単一のエグレス ポイント経由でルーティングし、プロキシする必要がある場合は、ネットワーク機器と帯域幅をアップグレードする準備をします。 両方の使用率を注意深く監視します。ユーザーのオンボード数が多くなると、エクスペリエンスが低下する可能性が低くなります。 ヒントポイントに到達するまで、すべてのユーザーが問題を感じ、問題ありません。

## <a name="exceptions-to-the-rules"></a>ルールの例外

組織でテナントの[](https://docs.microsoft.com/azure/active-directory/manage-apps/tenant-restrictions)制限が必要な場合は、TLS のブレークを含むプロキシを使用し、プロキシを経由するトラフィックを強制的に検査する必要がありますが、すべてのトラフィックを強制的に通過する必要はありません。  これは、すべてまたは何も提案ではないので、プロキシによって変更する必要があるものに注意を払います。

スプリット トンネリングを許可するが、一般的な Web トラフィックにもプロキシを使用する場合は、PAC ファイルで直接行う必要があるもの、および VPN トンネルを通過するトラフィックの興味深いトラフィックを定義する方法を定義します。 サンプル PAC ファイルを提供 [https://aka.ms/ipaddrs](https://aka.ms/ipaddrs) しています。このファイルを使用すると、管理が容易になります。

## <a name="conclusion"></a>まとめ

ほぼすべて The Critical 500 を含む数万の組織は、ミッション クリティカルな機能Office 365 を日常的に使用しています。 セキュリティで保護され、インターネット上で行います。

どのようなセキュリティ目標を達成するかに関係なく、VPN 接続、プロキシ サーバー、TLS のブレークアンド インスキュー、または一元化されたインターネットエグレスを必要としない方法があります。インターネット出口を使用して、ネットワークからユーザーのトラフィックを取得し、可能な限り迅速に弊社にアクセスできます。最高のパフォーマンスを提供します。これは、ネットワークが会社の本社、リモート オフィスかどうかに関係なく、最高のパフォーマンスを提供します。または、自宅で作業しているユーザー。 このガイダンスは、Office 365 サービスがどのように構築され、安全でパフォーマンスの高いユーザー エクスペリエンスを確保できるのかに基づいて行います。

## <a name="further-reading"></a>続きを読む

[Office 365 ネットワーク接続の原則](https://docs.microsoft.com/microsoft-365/enterprise/microsoft-365-network-connectivity-principles)

[Office 365 の URL と IP アドレスの範囲](https://docs.microsoft.com/microsoft-365/enterprise/urls-and-ip-address-ranges)

[Office 365 エンドポイントの管理](https://docs.microsoft.com/microsoft-365/enterprise/managing-office-365-endpoints)

[Office 365 IP アドレスと URL の Web サービス ](https://docs.microsoft.com/microsoft-365/enterprise/microsoft-365-ip-web-service)

[Office 365 のネットワーク接続の評価](https://docs.microsoft.com/microsoft-365/enterprise/assessing-network-connectivity)

[Office 365 のネットワークとパフォーマンスのチューニング](https://docs.microsoft.com/microsoft-365/enterprise/network-planning-and-performance)

[Office 365 ネットワーク接続の評価](https://docs.microsoft.com/microsoft-365/enterprise/assessing-network-connectivity)

[ベースラインとパフォーマンス履歴を使用した、Office 365 のパフォーマンスのチューニング](https://docs.microsoft.com/microsoft-365/enterprise/performance-tuning-using-baselines-and-history)

[Office 365 のパフォーマンスに関するトラブルシューティングの計画](https://docs.microsoft.com/microsoft-365/enterprise/performance-troubleshooting-plan)

[Content Delivery Network](https://docs.microsoft.com/microsoft-365/enterprise/content-delivery-networks)

[Microsoft 365 の接続テスト](https://connectivity.office.com/)

[Microsoft がそのファースト・信頼性の高いグローバルネットワークを構築する方法](https://azure.microsoft.com/blog/how-microsoft-builds-its-fast-and-reliable-global-network/)

[Office 365 ネットワークのしくみ](https://techcommunity.microsoft.com/t5/office-365-networking/bd-p/Office365Networking)

[Office VPN スプリット トンネリングを使用するリモート ユーザー向け 365 の接続](https://docs.microsoft.com/microsoft-365/enterprise/microsoft-365-vpn-split-tunnel)


