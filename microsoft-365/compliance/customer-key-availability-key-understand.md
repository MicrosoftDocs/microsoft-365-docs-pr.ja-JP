---
title: カスタマー キーの可用性キーの詳細
ms.author: krowley
author: kccross
manager: laurawi
ms.date: 02/05/2020
audience: ITPro
ms.topic: article
ms.service: O365-seccomp
localization_priority: Normal
search.appverid:
- MET150
description: 紛失した顧客キーの回復に使用される可用性キーについて学習します。
ms.openlocfilehash: bbad6ace0880c142a497bcac3469c579f13c7881
ms.sourcegitcommit: 27b2b2e5c41934b918cac2c171556c45e36661bf
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/19/2021
ms.locfileid: "50907743"
---
# <a name="learn-about-the-availability-key-for-customer-key"></a><span data-ttu-id="ef1ea-103">カスタマー キーの可用性キーの詳細</span><span class="sxs-lookup"><span data-stu-id="ef1ea-103">Learn about the availability key for Customer Key</span></span>

<span data-ttu-id="ef1ea-104">可用性キーは、データ暗号化ポリシーを作成するときに自動的に生成およびプロビジョニングされるルート キーです。</span><span class="sxs-lookup"><span data-stu-id="ef1ea-104">The availability key is a root key automatically generated and provisioned when you create a data encryption policy.</span></span> <span data-ttu-id="ef1ea-105">Microsoft 365 は可用性キーを保存および保護します。</span><span class="sxs-lookup"><span data-stu-id="ef1ea-105">Microsoft 365 stores and protects the availability key.</span></span> <span data-ttu-id="ef1ea-106">可用性キーは、カスタマー キーを使用してサービスの暗号化を行う 2 つのルート キーと機能的に似た機能を持つ。</span><span class="sxs-lookup"><span data-stu-id="ef1ea-106">The availability key is functionally like the two root keys that you supply for service encryption with Customer Key.</span></span> <span data-ttu-id="ef1ea-107">可用性キーは、キー階層の下位 1 層のキーをラップします。</span><span class="sxs-lookup"><span data-stu-id="ef1ea-107">The availability key wraps the keys one tier lower in the key hierarchy.</span></span> <span data-ttu-id="ef1ea-108">Azure Key Vault で提供および管理するキーとは異なり、可用性キーに直接アクセスすることはできません。</span><span class="sxs-lookup"><span data-stu-id="ef1ea-108">Unlike the keys that you provide and manage in Azure Key Vault, you can't directly access the availability key.</span></span> <span data-ttu-id="ef1ea-109">Microsoft 365 の自動サービスは、可用性キーをプログラムで管理します。</span><span class="sxs-lookup"><span data-stu-id="ef1ea-109">Microsoft 365 automated services manage the availability key programatically.</span></span> <span data-ttu-id="ef1ea-110">これらのサービスは、可用性キーへの直接アクセスを伴う自動操作を開始します。</span><span class="sxs-lookup"><span data-stu-id="ef1ea-110">These services initiate automated operations that never involve direct access to the availability key.</span></span>

<span data-ttu-id="ef1ea-111">可用性キーの主な目的は、管理するルート キーの不当な損失からの回復機能を提供します。</span><span class="sxs-lookup"><span data-stu-id="ef1ea-111">The primary purpose of the availability key is to provide recovery capability from the unanticipated loss of root keys that you manage.</span></span> <span data-ttu-id="ef1ea-112">損失は、不正な処理や悪意のあるアクションの結果である可能性があります。</span><span class="sxs-lookup"><span data-stu-id="ef1ea-112">Loss could be a result of mismanagement or malicious action.</span></span> <span data-ttu-id="ef1ea-113">ルート キーの制御が失われる場合は、Microsoft サポートに問い合わせ、可用性キーを使用した回復プロセスを支援します。</span><span class="sxs-lookup"><span data-stu-id="ef1ea-113">If you lose control of your root keys, contact Microsoft Support and Microsoft will assist you through the process of recovery using the availability key.</span></span> <span data-ttu-id="ef1ea-114">可用性キーを使用して、プロビジョニングする新しいルート キーを使用して新しいデータ暗号化ポリシーに移行します。</span><span class="sxs-lookup"><span data-stu-id="ef1ea-114">You'll use the availability key to migrate to a new Data Encryption Policy with new root keys you provision.</span></span>

<span data-ttu-id="ef1ea-115">可用性キーの記憶域と制御は、3 つの理由で Azure Key Vault キーとは意図的に異なります。</span><span class="sxs-lookup"><span data-stu-id="ef1ea-115">Storage and control of the availability key are deliberately different from Azure Key Vault keys for three reasons:</span></span>

- <span data-ttu-id="ef1ea-116">可用性キーは、両方の Azure Key Vault キーの制御が失われた場合に、回復機能 "break-glass" 機能を提供します。</span><span class="sxs-lookup"><span data-stu-id="ef1ea-116">The availability key provides a recovery, "break-glass" capability if control over both Azure Key Vault keys is lost.</span></span>
- <span data-ttu-id="ef1ea-117">論理コントロールとセキュリティで保護された記憶域の場所を分離すると、詳細な防御が提供され、1 回の攻撃または障害点からすべてのキーとデータが失われるのを防います。</span><span class="sxs-lookup"><span data-stu-id="ef1ea-117">The separation of logical controls and secure storage locations provides defense-in-depth and protects against the loss of all keys, and your data, from a single attack or point of failure.</span></span>
- <span data-ttu-id="ef1ea-118">可用性キーは、Microsoft 365 サービスが一時的なエラーのために Azure Key Vault でホストされているキーに到達できない場合に、高可用性機能を提供します。</span><span class="sxs-lookup"><span data-stu-id="ef1ea-118">The availability key provides a high-availability capability if Microsoft 365 services are unable to reach keys hosted in Azure Key Vault due to transient errors.</span></span> <span data-ttu-id="ef1ea-119">このルールは、Exchange Online および Skype for Business サービス暗号化にのみ適用されます。</span><span class="sxs-lookup"><span data-stu-id="ef1ea-119">This rule only applies to Exchange Online and Skype for Business service encryption.</span></span> <span data-ttu-id="ef1ea-120">SharePoint Online、OneDrive for Business、Teams ファイルは、回復プロセスを開始するように明示的に Microsoft に指示しない限り、可用性キーを使用しない。</span><span class="sxs-lookup"><span data-stu-id="ef1ea-120">SharePoint Online, OneDrive for Business, and Teams files never use the availability key unless you explicitly instruct Microsoft to initiate the recovery process.</span></span>

<span data-ttu-id="ef1ea-121">キー管理にさまざまな保護とプロセスを使用して、データを保護する責任を共有することで、最終的に、すべてのキー (したがってデータ) が完全に失われたり破棄されるリスクが軽減されます。</span><span class="sxs-lookup"><span data-stu-id="ef1ea-121">Sharing the responsibility to protect your data, using a variety of protections and processes for key management, ultimately reduces the risk that all keys (and therefore your data) will be permanently lost or destroyed.</span></span> <span data-ttu-id="ef1ea-122">Microsoft は、サービスを離れる際に可用性キーの無効化または破棄に関する唯一の権限を提供します。</span><span class="sxs-lookup"><span data-stu-id="ef1ea-122">Microsoft provides you with sole authority over the disablement or destruction of the availability key when you leave the service.</span></span> <span data-ttu-id="ef1ea-123">設計上、Microsoft の誰も可用性キーにアクセスできないようになっています。Microsoft 365 のサービス コードからアクセスする必要があります。</span><span class="sxs-lookup"><span data-stu-id="ef1ea-123">By design, no one at Microsoft has access to the availability key: it is only accessible by Microsoft 365 service code.</span></span>

<span data-ttu-id="ef1ea-124">キーを [セキュリティで保護する方法の詳細については、「Microsoft](https://www.microsoft.com/trustcenter/Privacy/govt-requests-for-data) Trust Center」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="ef1ea-124">See the [Microsoft Trust Center](https://www.microsoft.com/trustcenter/Privacy/govt-requests-for-data) for more information about how we secure keys.</span></span>
  
## <a name="availability-key-uses"></a><span data-ttu-id="ef1ea-125">可用性キーの使用</span><span class="sxs-lookup"><span data-stu-id="ef1ea-125">Availability key uses</span></span>

<span data-ttu-id="ef1ea-126">可用性キーは、外部の男性要素または悪意のあるインサイダーがキー コンテナーの制御を盗むシナリオ、または誤った管理によってルート キーが失われるシナリオの回復機能を提供します。</span><span class="sxs-lookup"><span data-stu-id="ef1ea-126">The availability key provides recovery capability for scenarios in which an external malefactor or malicious insider steals control of your key vault, or when inadvertent mismanagement results in loss of root keys.</span></span> <span data-ttu-id="ef1ea-127">この回復機能は、顧客キーと互換性のあるすべての Microsoft 365 サービスに適用されます。</span><span class="sxs-lookup"><span data-stu-id="ef1ea-127">This recovery capability applies to all Microsoft 365 services compatible with Customer Key.</span></span> <span data-ttu-id="ef1ea-128">個々のサービスでは、可用性キーの使い方が異なります。</span><span class="sxs-lookup"><span data-stu-id="ef1ea-128">Individual services use the availability key differently.</span></span> <span data-ttu-id="ef1ea-129">Microsoft 365 では、以下で説明する方法でのみ可用性キーを使用します。</span><span class="sxs-lookup"><span data-stu-id="ef1ea-129">Microsoft 365 only uses the availability key in the ways described below.</span></span>

### <a name="exchange-online-and-skype-for-business-uses"></a><span data-ttu-id="ef1ea-130">Exchange Online と Skype for Business の使用</span><span class="sxs-lookup"><span data-stu-id="ef1ea-130">Exchange Online and Skype for Business uses</span></span>

<span data-ttu-id="ef1ea-131">回復機能に加えて、Exchange Online と Skype for Business は可用性キーを使用して、ルート キーにアクセスするサービスに関連する一時的な、または断続的な運用上の問題の間にデータが利用可能な状態を確保します。</span><span class="sxs-lookup"><span data-stu-id="ef1ea-131">In addition to the recovery capability, Exchange Online and Skype for Business use the availability key to ensure data availability during transient, or intermittent operational issues, related to the service accessing root keys.</span></span> <span data-ttu-id="ef1ea-132">一時的なエラーにより、サービスが Azure Key Vault のカスタマー キーに到達できない場合、サービスは可用性キーを自動的に使用します。</span><span class="sxs-lookup"><span data-stu-id="ef1ea-132">When the service cannot reach either of your Customer Keys in Azure Key Vault due to transient errors, the service automatically uses the availability key.</span></span> <span data-ttu-id="ef1ea-133">サービスは可用性キーに直接行く必要があります。</span><span class="sxs-lookup"><span data-stu-id="ef1ea-133">The service NEVER goes directly to the availability key.</span></span>

<span data-ttu-id="ef1ea-134">Exchange Online および Skype for Business の自動化されたシステムは、一時的なエラー時に可用性キーを使用して、ウイルス対策、電子検出、データ損失防止、メールボックスの移動、データ インデックス作成などの自動化されたバック エンド サービスをサポートすることがあります。</span><span class="sxs-lookup"><span data-stu-id="ef1ea-134">Automated systems in Exchange Online and Skype for Business may use the availability key during transient errors to support automated back-end services such as anti-virus, e-discovery, data loss prevention, mailbox moves, and data indexing.</span></span>

### <a name="sharepoint-online-onedrive-for-business-and-teams-files-uses"></a><span data-ttu-id="ef1ea-135">SharePoint Online、OneDrive for Business、Teams ファイルの使用</span><span class="sxs-lookup"><span data-stu-id="ef1ea-135">SharePoint Online, OneDrive for Business, and Teams files uses</span></span>

<span data-ttu-id="ef1ea-136">SharePoint Online、OneDrive for Business、Teams ファイルの場合、可用性キーは回復機能の外部では使用されません。回復シナリオ中に可用性キーの使用を開始するように明示的に Microsoft に指示する必要があります。</span><span class="sxs-lookup"><span data-stu-id="ef1ea-136">For SharePoint Online, OneDrive for Business, and Teams files, the availability key is NEVER used outside of the recovery capability and customers must explicitly instruct Microsoft to initiate use of the availability key during a recovery scenario.</span></span> <span data-ttu-id="ef1ea-137">自動サービス操作は、Azure Key Vault のカスタマー キーのみに依存します。</span><span class="sxs-lookup"><span data-stu-id="ef1ea-137">Automated service operations solely rely on your Customer Keys in Azure Key vault.</span></span> <span data-ttu-id="ef1ea-138">これらのサービスのキー階層のしくみの詳細については [、「SharePoint Online、OneDrive for Business、Teams](#how-sharepoint-online-onedrive-for-business-and-teams-files-use-the-availability-key)ファイルが可用性キーを使用する方法」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="ef1ea-138">For in-depth information about how the key hierarchy works for these services, see [How SharePoint Online, OneDrive for Business, and Teams files use the availability key](#how-sharepoint-online-onedrive-for-business-and-teams-files-use-the-availability-key).</span></span>

## <a name="availability-key-security"></a><span data-ttu-id="ef1ea-139">可用性キーのセキュリティ</span><span class="sxs-lookup"><span data-stu-id="ef1ea-139">Availability key security</span></span>

<span data-ttu-id="ef1ea-140">Microsoft は、可用性キーをインスタンス化し、それを保護するための広範な措置を講じ、データ保護の責任をユーザーと共有します。</span><span class="sxs-lookup"><span data-stu-id="ef1ea-140">Microsoft shares the responsibility of data protection with you by instantiating the availability key and taking extensive measures to protect it.</span></span> <span data-ttu-id="ef1ea-141">Microsoft は、可用性キーの直接制御を顧客に公開しない。</span><span class="sxs-lookup"><span data-stu-id="ef1ea-141">Microsoft does not expose direct control of the availability key to customers.</span></span> <span data-ttu-id="ef1ea-142">たとえば、Azure Key Vault で所有しているキーのみをロール (回転) できます。</span><span class="sxs-lookup"><span data-stu-id="ef1ea-142">For example, you can only roll (rotate) the keys that you own in Azure Key Vault.</span></span> <span data-ttu-id="ef1ea-143">詳細については、「顧客キーまたは可用性 [キーのロールまたはローテーション」を参照してください](customer-key-availability-key-roll.md)。</span><span class="sxs-lookup"><span data-stu-id="ef1ea-143">For more information, see [Roll or rotate a customer key or an availability key](customer-key-availability-key-roll.md).</span></span>

### <a name="availability-key-secret-stores"></a><span data-ttu-id="ef1ea-144">可用性キーシークレット ストア</span><span class="sxs-lookup"><span data-stu-id="ef1ea-144">Availability key secret stores</span></span>

<span data-ttu-id="ef1ea-145">Microsoft は、アクセス制御された内部シークレット ストア (顧客向け Azure Key Vault など) の可用性キーを保護します。</span><span class="sxs-lookup"><span data-stu-id="ef1ea-145">Microsoft protects availability keys in access-controlled, internal secret stores like the customer-facing Azure Key Vault.</span></span> <span data-ttu-id="ef1ea-146">Microsoft 管理者が内に含まれるシークレットに直接アクセスするのを防ぐため、アクセス制御を実装しています。</span><span class="sxs-lookup"><span data-stu-id="ef1ea-146">We implement access controls to prevent Microsoft administrators from directly accessing the secrets contained within.</span></span> <span data-ttu-id="ef1ea-147">キーのローテーションや削除を含むシークレット ストア操作は、可用性キーへの直接アクセスを必要としない自動コマンドを使用して実行されます。</span><span class="sxs-lookup"><span data-stu-id="ef1ea-147">Secret Store operations, including key rotation and deletion, occur through automated commands that never involve direct access to the availability key.</span></span> <span data-ttu-id="ef1ea-148">シークレット ストア管理操作は特定のエンジニアに限定され、内部ツール Lockbox を介して特権エスカレーションが必要です。</span><span class="sxs-lookup"><span data-stu-id="ef1ea-148">Secret store management operations are limited to specific engineers and require privilege escalation through an internal tool, Lockbox.</span></span> <span data-ttu-id="ef1ea-149">特権のエスカレーションには、付与される前に管理者の承認と正当化が必要です。</span><span class="sxs-lookup"><span data-stu-id="ef1ea-149">Privilege escalation requires manager approval and justification prior to being granted.</span></span> <span data-ttu-id="ef1ea-150">Lockbox は、時間の有効期限が切れ、またはエンジニアがログアウトすると、アクセスが自動アクセス失効によって時間にバインドされます。</span><span class="sxs-lookup"><span data-stu-id="ef1ea-150">Lockbox ensures access is time bound with automatic access revocation upon time expiration or engineer log out.</span></span>

<span data-ttu-id="ef1ea-151">**Exchange Online および Skype for Business** 可用性キーは、Exchange Online Active Directory シークレット ストアに格納されます。</span><span class="sxs-lookup"><span data-stu-id="ef1ea-151">**Exchange Online and Skype for Business** availability keys are stored in an Exchange Online Active Directory secret store.</span></span> <span data-ttu-id="ef1ea-152">可用性キーは、Active Directory ドメイン コントローラー内のテナント固有のコンテナー内に安全に格納されます。</span><span class="sxs-lookup"><span data-stu-id="ef1ea-152">Availability keys are securely stored inside tenant specific containers within the Active Directory Domain Controller.</span></span> <span data-ttu-id="ef1ea-153">このセキュリティで保護された記憶域の場所は、SharePoint Online、OneDrive for Business、Teams ファイル シークレット ストアとは分離されています。</span><span class="sxs-lookup"><span data-stu-id="ef1ea-153">This secure storage location is separate and isolated from the SharePoint Online, OneDrive for Business, and Teams files secret store.</span></span>

<span data-ttu-id="ef1ea-154">**SharePoint Online、OneDrive for Business、Teams** ファイルの可用性キーは、サービス チームが管理する内部シークレット ストアに格納されます。</span><span class="sxs-lookup"><span data-stu-id="ef1ea-154">**SharePoint Online, OneDrive for Business, and Teams files** availability keys are stored in an internal secret store managed by the service team.</span></span> <span data-ttu-id="ef1ea-155">このセキュリティで保護されたシークレット ストレージ サービスには、アプリケーション エンドポイントを備え、SQLデータベースをバック エンドとして持つフロントエンド サーバーがあります。</span><span class="sxs-lookup"><span data-stu-id="ef1ea-155">This secured, secrets storage service has front-end servers with application endpoints and a SQL Database as the back end.</span></span> <span data-ttu-id="ef1ea-156">可用性キーは SQL データベースに格納され、AES-256 と HMAC の組み合わせを使用して保存時の可用性キーを暗号化するシークレット ストア暗号化キーによってラップ (暗号化) されます。</span><span class="sxs-lookup"><span data-stu-id="ef1ea-156">Availability keys are stored in the SQL Database and are wrapped (encrypted) by secret store encryption keys that use a combination of AES-256 and HMAC to encrypt the availability key at rest.</span></span> <span data-ttu-id="ef1ea-157">シークレット ストアの暗号化キーは、同じ SQL データベースの論理的に分離されたコンポーネントに格納され、Microsoft 証明機関 (CA) によって管理される証明書に含まれる RSA-2048 キーでさらに暗号化されます。</span><span class="sxs-lookup"><span data-stu-id="ef1ea-157">The secret store encryption keys are stored in a logically isolated component of the same SQL Database and are further encrypted with RSA-2048 keys contained in certificates managed by the Microsoft certificate authority (CA).</span></span> <span data-ttu-id="ef1ea-158">これらの証明書は、データベースに対して操作を実行するシークレット ストア フロントエンド サーバーに格納されます。</span><span class="sxs-lookup"><span data-stu-id="ef1ea-158">These certificates are stored in the secret store front-end servers that perform operations against the database.</span></span>

### <a name="defense-in-depth"></a><span data-ttu-id="ef1ea-159">詳細な防御</span><span class="sxs-lookup"><span data-stu-id="ef1ea-159">Defense-in-depth</span></span>

<span data-ttu-id="ef1ea-160">Microsoft は、悪意のあるアクターが Microsoft Cloud に保存されている顧客データの機密性、整合性、または可用性に影響を与えるのを防ぐため、詳細な防御戦略を採用しています。</span><span class="sxs-lookup"><span data-stu-id="ef1ea-160">Microsoft employs a defense-in-depth strategy to prevent malicious actors from impacting the confidentiality, integrity, or availability of customer data stored in the Microsoft Cloud.</span></span> <span data-ttu-id="ef1ea-161">包括的なセキュリティ戦略の一環として、シークレット ストアと可用性キーを保護するために、特定の予防および検出コントロールが実装されています。</span><span class="sxs-lookup"><span data-stu-id="ef1ea-161">Specific preventive and detective controls are implemented to protect the secret store and the availability key as part of the overarching security strategy.</span></span>

<span data-ttu-id="ef1ea-162">Microsoft 365 は、可用性キーの誤用を防ぐために構築されています。</span><span class="sxs-lookup"><span data-stu-id="ef1ea-162">Microsoft 365 is built to prevent misuse of the availability key.</span></span> <span data-ttu-id="ef1ea-163">アプリケーション層は、可用性キーを含むキーを使用してデータの暗号化と解読を行う唯一の方法です。</span><span class="sxs-lookup"><span data-stu-id="ef1ea-163">The application layer is the only method through which keys, including the availability key, can be used to encrypt and decrypt data.</span></span> <span data-ttu-id="ef1ea-164">Microsoft 365 サービス コードだけが、暗号化と復号化のアクティビティのためにキー階層を解釈および走査できます。</span><span class="sxs-lookup"><span data-stu-id="ef1ea-164">Only Microsoft 365 service code has the ability to interpret and traverse the key hierarchy for encryption and decryption activities.</span></span> <span data-ttu-id="ef1ea-165">論理的な分離は、顧客キー、可用性キー、その他の階層キー、および顧客データの保存場所の間に存在します。</span><span class="sxs-lookup"><span data-stu-id="ef1ea-165">Logical isolation exists between the storage locations of Customer Keys, availability keys, other hierarchical keys, and customer data.</span></span> <span data-ttu-id="ef1ea-166">この分離により、1 つ以上の場所が侵害された場合にデータが漏洩するリスクが軽減されます。</span><span class="sxs-lookup"><span data-stu-id="ef1ea-166">This isolation mitigates the risk of data exposure in the event one or more locations are compromised.</span></span> <span data-ttu-id="ef1ea-167">階層内の各レイヤーには、格納されているデータとシークレットを保護するために 24 時間 365 日の侵入検出機能が組み込まれています。</span><span class="sxs-lookup"><span data-stu-id="ef1ea-167">Each layer in the hierarchy has built in 24x7 intrusion detection capabilities to protect data and secrets stored.</span></span>

<span data-ttu-id="ef1ea-168">アクセス制御は、可用性キー シークレット ストアを含む内部システムへの不正アクセスを防止するために実装されています。</span><span class="sxs-lookup"><span data-stu-id="ef1ea-168">Access controls are implemented to prevent unauthorized access to internal systems, including availability key secret stores.</span></span> <span data-ttu-id="ef1ea-169">Microsoft のエンジニアは、可用性キー シークレット ストアに直接アクセスできます。</span><span class="sxs-lookup"><span data-stu-id="ef1ea-169">Microsoft engineers don't have direct access to the availability key secret stores.</span></span> <span data-ttu-id="ef1ea-170">アクセス制御の詳細については [、「Microsoft 365 の管理アクセス制御」を参照してください](/Office365/securitycompliance/office-365-administrative-access-controls-overview)。</span><span class="sxs-lookup"><span data-stu-id="ef1ea-170">For additional detail on access controls, review [Administrative Access Controls in Microsoft 365](/Office365/securitycompliance/office-365-administrative-access-controls-overview).</span></span>

<span data-ttu-id="ef1ea-171">技術的な制御により、Microsoft の担当者は高い特権を持つサービス アカウントにログインすることを防止します。それ以外の場合は、攻撃者が Microsoft サービスを偽装するために使用される可能性があります。</span><span class="sxs-lookup"><span data-stu-id="ef1ea-171">Technical controls prevent Microsoft personnel from logging into highly-privileged service accounts, which might otherwise be used by attackers to impersonate Microsoft services.</span></span> <span data-ttu-id="ef1ea-172">たとえば、これらのコントロールは対話型ログオンを防止します。</span><span class="sxs-lookup"><span data-stu-id="ef1ea-172">For example, these controls prevent interactive logon.</span></span>

<span data-ttu-id="ef1ea-173">セキュリティ ログおよび監視制御は、Microsoft サービスとデータに対するリスクを軽減する、もう 1 つの詳細な防御手段です。</span><span class="sxs-lookup"><span data-stu-id="ef1ea-173">Security logging and monitoring controls are another defense-in-depth safeguard implemented that mitigate risk to Microsoft services and your data.</span></span> <span data-ttu-id="ef1ea-174">Microsoft サービス チームは、アラートと監査ログを生成するアクティブな監視ソリューションを展開しました。</span><span class="sxs-lookup"><span data-stu-id="ef1ea-174">Microsoft service teams have deployed active monitoring solutions that generate alerts and audit logs.</span></span> <span data-ttu-id="ef1ea-175">すべてのサービス チームは、ログを集約して処理する中央リポジトリにログをアップロードします。</span><span class="sxs-lookup"><span data-stu-id="ef1ea-175">All service teams upload their logs to a central repository where the logs are aggregated and processed.</span></span> <span data-ttu-id="ef1ea-176">内部ツールはレコードを自動的に調べて、サービスが最適で回復力があり、安全な状態で機能しているのを確認します。</span><span class="sxs-lookup"><span data-stu-id="ef1ea-176">Internal tools automatically examine records to confirm that services are functioning in an optimal, resilient, and secure state.</span></span> <span data-ttu-id="ef1ea-177">異常なアクティビティには、さらに確認のフラグが設定されています。</span><span class="sxs-lookup"><span data-stu-id="ef1ea-177">Unusual activity is flagged for further review.</span></span>

<span data-ttu-id="ef1ea-178">Microsoft セキュリティ ポリシーに違反する可能性を示すログ イベントは、直ちに Microsoft セキュリティ チームの注目を集めています。</span><span class="sxs-lookup"><span data-stu-id="ef1ea-178">Any log event that indicates a potential violation of the Microsoft Security Policy is immediately brought to the attention of Microsoft security teams.</span></span> <span data-ttu-id="ef1ea-179">Microsoft 365 セキュリティは、可用性キー シークレット ストアへのアクセス試行を検出するようにアラートを構成しました。</span><span class="sxs-lookup"><span data-stu-id="ef1ea-179">Microsoft 365 security has configured alerts to detect attempted access to availability key secret stores.</span></span> <span data-ttu-id="ef1ea-180">また、Microsoft の担当者がサービス アカウントへの対話型ログオンを試みる場合もアラートが生成されます。これは、アクセス制御によって禁止および保護されています。</span><span class="sxs-lookup"><span data-stu-id="ef1ea-180">Alerts are also generated if Microsoft personnel attempt interactive logon to service accounts, which is prohibited and protected by access controls.</span></span> <span data-ttu-id="ef1ea-181">また、Microsoft 365 セキュリティは、Microsoft 365 サービスが通常のベースライン操作から逸脱した場合にも検出および通知を行います。</span><span class="sxs-lookup"><span data-stu-id="ef1ea-181">Microsoft 365 security also detects and alerts upon deviations of the Microsoft 365 service from normal baseline operations.</span></span> <span data-ttu-id="ef1ea-182">Microsoft 365 サービスの誤用を試みる Malefactors は、アラートをトリガーし、その結果、Microsoft クラウド環境から犯罪者が立ち退く可能性があります。</span><span class="sxs-lookup"><span data-stu-id="ef1ea-182">Malefactors attempting to misuse Microsoft 365 services would trigger alerts resulting in the offender's eviction from the Microsoft cloud environment.</span></span>

## <a name="use-the-availability-key-to-recover-from-key-loss"></a><span data-ttu-id="ef1ea-183">可用性キーを使用してキー損失から回復する</span><span class="sxs-lookup"><span data-stu-id="ef1ea-183">Use the availability key to recover from key loss</span></span>

<span data-ttu-id="ef1ea-184">顧客キーの制御を失った場合、可用性キーを使用すると、データを回復して再暗号化できます。</span><span class="sxs-lookup"><span data-stu-id="ef1ea-184">If you lose control of your Customer Keys, the availability key provides you the ability to recover and re-encrypt your data.</span></span>

### <a name="recovery-procedure-for-exchange-online-and-skype-for-business"></a><span data-ttu-id="ef1ea-185">Exchange Online と Skype for Business の回復手順</span><span class="sxs-lookup"><span data-stu-id="ef1ea-185">Recovery procedure for Exchange Online and Skype for Business</span></span>

<span data-ttu-id="ef1ea-186">顧客キーの制御を失った場合、可用性キーを使用すると、データを回復し、影響を受ける Microsoft 365 リソースをオンラインに戻す機能が提供されます。</span><span class="sxs-lookup"><span data-stu-id="ef1ea-186">If you lose control of your Customer Keys, the availability key gives you the capability to recover your data and bring your impacted Microsoft 365 resources back online.</span></span> <span data-ttu-id="ef1ea-187">可用性キーは、回復中も引き続きデータを保護します。大きなレベルでは、キー損失から完全に回復するには、新しい DEP を作成し、影響を受け取ったリソースを新しいポリシーに移動する必要があります。</span><span class="sxs-lookup"><span data-stu-id="ef1ea-187">The availability key continues to protect your data while you recover.At a high level, to fully recover from key loss, you'll need to create a new DEP and move impacted resources to the new policy.</span></span>

<span data-ttu-id="ef1ea-188">新しい顧客キーを使用してデータを暗号化するには、Azure Key Vault で新しいキーを作成し、新しい顧客キーを使用して新しい DEP を作成し、キーが失われたり侵害された以前の DEP で現在暗号化されているメールボックスに新しい DEP を割り当てる必要があります。</span><span class="sxs-lookup"><span data-stu-id="ef1ea-188">To encrypt your data with new Customer Keys, create new keys in Azure Key Vault, create a new DEP using the new Customer Keys, then assign the new DEP to the mailboxes currently encrypted with the previous DEP for which the keys were lost or compromised.</span></span>

<span data-ttu-id="ef1ea-189">この再暗号化プロセスには最大 72 時間かかる場合があります。</span><span class="sxs-lookup"><span data-stu-id="ef1ea-189">This re-encryption process can take up to 72 hours.</span></span> <span data-ttu-id="ef1ea-190">これは、DEP を変更する場合の標準の期間です。</span><span class="sxs-lookup"><span data-stu-id="ef1ea-190">This is the standard duration when you change a DEP.</span></span>
  
### <a name="recovery-procedure-for-sharepoint-online-onedrive-for-business-and-teams-files"></a><span data-ttu-id="ef1ea-191">SharePoint Online、OneDrive for Business、Teams ファイルの回復手順</span><span class="sxs-lookup"><span data-stu-id="ef1ea-191">Recovery procedure for SharePoint Online, OneDrive for Business, and Teams files</span></span>

<span data-ttu-id="ef1ea-192">SharePoint Online、OneDrive for Business、Teams ファイルの場合、可用性キーは回復機能以外では使用されません。</span><span class="sxs-lookup"><span data-stu-id="ef1ea-192">For SharePoint Online, OneDrive for Business, and Teams files, the availability key is NEVER used outside of the recovery capability.</span></span> <span data-ttu-id="ef1ea-193">回復シナリオ中に可用性キーの使用を開始するように Microsoft に明示的に指示する必要があります。</span><span class="sxs-lookup"><span data-stu-id="ef1ea-193">You must explicitly instruct Microsoft to initiate use of the availability key during a recovery scenario.</span></span> <span data-ttu-id="ef1ea-194">回復プロセスを開始するには、Microsoft に問い合わせ、可用性キーをアクティブ化します。</span><span class="sxs-lookup"><span data-stu-id="ef1ea-194">To initiate the recovery process, contact Microsoft to activate the availability key.</span></span> <span data-ttu-id="ef1ea-195">アクティブ化されると、可用性キーが自動的に使用され、新しい顧客キーに関連付けられた新しく作成された DEP を使用してデータを暗号化できます。</span><span class="sxs-lookup"><span data-stu-id="ef1ea-195">Once activated, the availability key is automatically used to decrypt your data allowing you to encrypt the data with a newly-created DEP associated to new Customer Keys.</span></span>  

<span data-ttu-id="ef1ea-196">この操作は、組織内のサイトの数に比例します。</span><span class="sxs-lookup"><span data-stu-id="ef1ea-196">This operation is proportional to the number of sites in your organization.</span></span> <span data-ttu-id="ef1ea-197">可用性キーを使用するために Microsoft に電話すると、約 4 時間以内に完全にオンラインになる必要があります。</span><span class="sxs-lookup"><span data-stu-id="ef1ea-197">Once you call Microsoft to use the availability key, you should be fully online within about four hours.</span></span>

## <a name="how-exchange-online-and-skype-for-business-use-the-availability-key"></a><span data-ttu-id="ef1ea-198">Exchange Online と Skype for Business が可用性キーを使用する方法</span><span class="sxs-lookup"><span data-stu-id="ef1ea-198">How Exchange Online and Skype for Business use the availability key</span></span>

<span data-ttu-id="ef1ea-199">顧客キーを使用して DEP を作成すると、Microsoft 365 は、その DEP に関連付けられたデータ暗号化ポリシー キー (DEP キー) を生成します。</span><span class="sxs-lookup"><span data-stu-id="ef1ea-199">When you create a DEP with Customer Key, Microsoft 365 generates a Data Encryption Policy Key (DEP Key) associated with that DEP.</span></span> <span data-ttu-id="ef1ea-200">このサービスは、DEP キーを 3 回暗号化します。各顧客キーで 1 回、可用性キーを使用して 1 回暗号化します。</span><span class="sxs-lookup"><span data-stu-id="ef1ea-200">The service encrypts the DEP Key three times: once with each of the customer keys and once with the availability key.</span></span> <span data-ttu-id="ef1ea-201">暗号化されたバージョンの DEP キーだけが格納され、DEP キーは顧客キーまたは可用性キーでのみ復号化できます。</span><span class="sxs-lookup"><span data-stu-id="ef1ea-201">Only the encrypted versions of the DEP Key are stored, and a DEP Key can only be decrypted with the customer keys or the availability key.</span></span> <span data-ttu-id="ef1ea-202">次に、DEP キーを使用してメールボックス キーを暗号化し、個々のメールボックスを暗号化します。</span><span class="sxs-lookup"><span data-stu-id="ef1ea-202">The DEP Key is then used to encrypt Mailbox Keys, which encrypt individual mailboxes.</span></span>
  
<span data-ttu-id="ef1ea-203">Microsoft 365 は、次のプロセスに従って、顧客がサービスを使用している場合にデータを復号化して提供します。</span><span class="sxs-lookup"><span data-stu-id="ef1ea-203">Microsoft 365 follows this process to decrypt and provide data when customers are using the service:</span></span>
  
1. <span data-ttu-id="ef1ea-204">顧客キーを使用して DEP キーを復号化します。</span><span class="sxs-lookup"><span data-stu-id="ef1ea-204">Decrypt the DEP Key using the Customer Key.</span></span>

2. <span data-ttu-id="ef1ea-205">復号化された DEP キーを使用してメールボックス キーを復号化します。</span><span class="sxs-lookup"><span data-stu-id="ef1ea-205">Use the decrypted DEP Key to decrypt a Mailbox Key.</span></span>

3. <span data-ttu-id="ef1ea-206">復号化されたメールボックス キーを使用してメールボックス自体を復号化し、メールボックス内のデータにアクセスできます。</span><span class="sxs-lookup"><span data-stu-id="ef1ea-206">Use the decrypted Mailbox Key to decrypt the mailbox itself, allowing you to access the data within the mailbox.</span></span>

## <a name="how-sharepoint-online-onedrive-for-business-and-teams-files-use-the-availability-key"></a><span data-ttu-id="ef1ea-207">SharePoint Online、OneDrive for Business、Teams ファイルが可用性キーを使用する方法</span><span class="sxs-lookup"><span data-stu-id="ef1ea-207">How SharePoint Online, OneDrive for Business, and Teams files use the availability key</span></span>

<span data-ttu-id="ef1ea-208">SharePoint Online および OneDrive for Business アーキテクチャとカスタマー キーと可用性キーの実装は、Exchange Online および Skype for Business とは異なります。</span><span class="sxs-lookup"><span data-stu-id="ef1ea-208">The SharePoint Online and OneDrive for Business architecture and implementation for Customer Key and availability key are different from Exchange Online and Skype for Business.</span></span>
  
<span data-ttu-id="ef1ea-209">組織が顧客管理キーに移動すると、Microsoft 365 は組織固有の中間キー (TIK) を作成します。</span><span class="sxs-lookup"><span data-stu-id="ef1ea-209">When an organization moves to customer-managed keys, Microsoft 365 creates an organization-specific intermediate key (TIK).</span></span> <span data-ttu-id="ef1ea-210">Microsoft 365 は TIK を 2 回、顧客キーごとに 1 回暗号化し、TIK の 2 つの暗号化されたバージョンを格納します。</span><span class="sxs-lookup"><span data-stu-id="ef1ea-210">Microsoft 365 encrypts the TIK twice, once with each of the customer keys, and stores the two encrypted versions of the TIK.</span></span> <span data-ttu-id="ef1ea-211">暗号化されたバージョンの TIK だけが格納され、TIK は顧客キーでのみ暗号化解除できます。</span><span class="sxs-lookup"><span data-stu-id="ef1ea-211">Only the encrypted versions of the TIK are stored, and a TIK can only be decrypted with the customer keys.</span></span> <span data-ttu-id="ef1ea-212">次に、TIK を使用してサイト キーを暗号化し、BLOB キー (ファイル チャンク キーとも呼ばれる) を暗号化するために使用されます。</span><span class="sxs-lookup"><span data-stu-id="ef1ea-212">The TIK is then used to encrypt site keys, which are then used to encrypt blob keys (also called file chunk keys).</span></span> <span data-ttu-id="ef1ea-213">ファイル サイズに応じて、サービスはファイルを一意のキーで複数のファイル チャンクに分割する場合があります。</span><span class="sxs-lookup"><span data-stu-id="ef1ea-213">Depending on file size, the service may split a file into multiple file chunks each with a unique key.</span></span> <span data-ttu-id="ef1ea-214">BLOB (ファイル チャンク) 自体は BLOB キーで暗号化され、Microsoft Azure Blob ストレージ サービスに格納されます。</span><span class="sxs-lookup"><span data-stu-id="ef1ea-214">The blobs (file chunks) themselves are encrypted with the blob keys and stored in the Microsoft Azure Blob storage service.</span></span>
  
<span data-ttu-id="ef1ea-215">Microsoft 365 は、次のプロセスに従って、顧客がサービスを使用している場合に顧客ファイルを復号化して提供します。</span><span class="sxs-lookup"><span data-stu-id="ef1ea-215">Microsoft 365 follows this process to decrypt and provide customer files when customers are using the service:</span></span>

1. <span data-ttu-id="ef1ea-216">顧客キーを使用して TIK を復号化します。</span><span class="sxs-lookup"><span data-stu-id="ef1ea-216">Decrypt the TIK using the Customer Key.</span></span>

2. <span data-ttu-id="ef1ea-217">復号化された TIK を使用してサイト キーを復号化します。</span><span class="sxs-lookup"><span data-stu-id="ef1ea-217">Use the decrypted TIK to decrypt a site key.</span></span>

3. <span data-ttu-id="ef1ea-218">暗号化解除されたサイト キーを使用して、BLOB キーを復号化します。</span><span class="sxs-lookup"><span data-stu-id="ef1ea-218">Use the decrypted site key to decrypt a blob key.</span></span>

4. <span data-ttu-id="ef1ea-219">復号化された BLOB キーを使用して、BLOB を復号化します。</span><span class="sxs-lookup"><span data-stu-id="ef1ea-219">Use the decrypted blob key to decrypt the blob.</span></span>

<span data-ttu-id="ef1ea-220">Microsoft 365 は、わずかなオフセットで Azure Key Vault に 2 つの復号化要求を発行して TIK を復号化します。</span><span class="sxs-lookup"><span data-stu-id="ef1ea-220">Microsoft 365 decrypts a TIK by issuing two decryption requests to Azure Key Vault with a slight offset.</span></span> <span data-ttu-id="ef1ea-221">最初に終了すると、結果が表示されます。もう一方の要求はキャンセルされます。</span><span class="sxs-lookup"><span data-stu-id="ef1ea-221">The first one to finish furnishes the result, canceling the other request.</span></span>
  
<span data-ttu-id="ef1ea-222">顧客キーへのアクセスが失われる場合、Microsoft 365 は可用性キーを使用して TIK を暗号化し、これを各顧客キーで暗号化された TIK と共に保存します。</span><span class="sxs-lookup"><span data-stu-id="ef1ea-222">In case you lose access to your customer keys, Microsoft 365 also encrypts the TIK with an availability key and stores this along with the TIKs encrypted with each customer key.</span></span> <span data-ttu-id="ef1ea-223">可用性キーで暗号化された TIK は、悪意のある、または誤ってキーへのアクセスを失った場合に、回復パスを登録するために Microsoft に電話した場合にのみ使用されます。</span><span class="sxs-lookup"><span data-stu-id="ef1ea-223">The TIK encrypted with the availability key is used only when the customer calls Microsoft to enlist the recovery path when they have lost access to their keys, maliciously or accidentally.</span></span>
  
<span data-ttu-id="ef1ea-224">可用性とスケール上の理由から、復号化された TIK は時間制限付きメモリ キャッシュにキャッシュされます。</span><span class="sxs-lookup"><span data-stu-id="ef1ea-224">For availability and scale reasons, decrypted TIKs are cached in a time-limited memory cache.</span></span> <span data-ttu-id="ef1ea-225">TIK キャッシュの有効期限が切れる 2 時間前に、Microsoft 365 は各 TIK の暗号化解除を試みます。</span><span class="sxs-lookup"><span data-stu-id="ef1ea-225">Two hours before a TIK cache is set to expire, Microsoft 365 attempts to decrypt each TIK.</span></span> <span data-ttu-id="ef1ea-226">TIK を復号化すると、キャッシュの有効期間が延長されます。</span><span class="sxs-lookup"><span data-stu-id="ef1ea-226">Decrypting the TIKs extends the lifetime of the cache.</span></span> <span data-ttu-id="ef1ea-227">TIK 復号化が大幅に失敗した場合、Microsoft 365 は、キャッシュの有効期限の前にエンジニアリングに通知するアラートを生成します。</span><span class="sxs-lookup"><span data-stu-id="ef1ea-227">If TIK decryption fails for a significant amount of time, Microsoft 365 generates an alert to notify engineering prior to the cache expiration.</span></span> <span data-ttu-id="ef1ea-228">Microsoft が Microsoft 365 を呼び出した場合にのみ、回復操作が開始されます。この操作では、Microsoft のシークレット ストアに保存されている可用性キーを使用して TIK を復号化し、復号化された TIK キーと顧客が提供する Azure Key Vault キーの新しいセットを使用してテナントを再びオンボーディングします。</span><span class="sxs-lookup"><span data-stu-id="ef1ea-228">Only if the customer calls Microsoft will Microsoft 365 initiate the recovery operation, which involves decrypting the TIK with the availability key stored in Microsoft's secret store and onboarding the tenant again using the decrypted TIK and a new set of customer-supplied Azure Key Vault keys.</span></span>
  
<span data-ttu-id="ef1ea-229">現在、カスタマー キーは、Azure BLOB ストアに格納されている SharePoint Online ファイル データの暗号化と復号化チェーンに関与していますが、SQL データベースに格納されている SharePoint Online リスト アイテムやメタデータには関係しません。</span><span class="sxs-lookup"><span data-stu-id="ef1ea-229">As of today, Customer Key is involved in the encryption and decryption chain of SharePoint Online file data stored in the Azure blob store, but not SharePoint Online list items or metadata stored in the SQL Database.</span></span> <span data-ttu-id="ef1ea-230">Microsoft 365 では、上記のケース以外の Exchange Online、Skype for Business、SharePoint Online、OneDrive for Business、Teams ファイルの可用性キーは使用されません。これはお客様が開始します。</span><span class="sxs-lookup"><span data-stu-id="ef1ea-230">Microsoft 365 does not use the availability key for Exchange Online, Skype for Business, SharePoint Online, OneDrive for Business, and Teams files other than the case described above, which is customer-initiated.</span></span> <span data-ttu-id="ef1ea-231">顧客データへの人間のアクセスは、Customer Lockbox によって保護されます。</span><span class="sxs-lookup"><span data-stu-id="ef1ea-231">Human access to customer data is protected by Customer Lockbox.</span></span>

## <a name="availability-key-triggers"></a><span data-ttu-id="ef1ea-232">可用性キートリガー</span><span class="sxs-lookup"><span data-stu-id="ef1ea-232">Availability key triggers</span></span>

<span data-ttu-id="ef1ea-233">Microsoft 365 は、特定の状況でのみ可用性キーをトリガーします。</span><span class="sxs-lookup"><span data-stu-id="ef1ea-233">Microsoft 365 triggers the availability key only in specific circumstances.</span></span> <span data-ttu-id="ef1ea-234">これらの状況はサービスによって異なります。</span><span class="sxs-lookup"><span data-stu-id="ef1ea-234">These circumstances differ by service.</span></span>

### <a name="triggers-for-exchange-online-and-skype-for-business"></a><span data-ttu-id="ef1ea-235">Exchange Online と Skype for Business のトリガー</span><span class="sxs-lookup"><span data-stu-id="ef1ea-235">Triggers for Exchange Online and Skype for Business</span></span>
  
1. <span data-ttu-id="ef1ea-236">Microsoft 365 は、メールボックスが割り当てられている DEP を読み取り、Azure Key Vault の 2 つの顧客キーの場所を特定します。</span><span class="sxs-lookup"><span data-stu-id="ef1ea-236">Microsoft 365 reads the DEP to which the mailbox is assigned in order to determine the location of the two Customer Keys in Azure Key Vault.</span></span>

2. <span data-ttu-id="ef1ea-237">Microsoft 365 は、DEP から 2 つの顧客キーの 1 つをランダムに選択し、顧客キーを使用して DEP キーのラップを解除する要求を Azure Key Vault に送信します。</span><span class="sxs-lookup"><span data-stu-id="ef1ea-237">Microsoft 365 randomly chooses one of the two Customer Keys from the DEP and sends a request to Azure Key Vault to unwrap the DEP key using the Customer Key.</span></span>

3. <span data-ttu-id="ef1ea-238">顧客キーを使用して DEP キーをラップ解除する要求が失敗した場合、Microsoft 365 は 2 番目の要求を Azure Key Vault に送信します。この場合は、代替 (2 番目) の顧客キーを使用するように指示します。</span><span class="sxs-lookup"><span data-stu-id="ef1ea-238">If the request to unwrap the DEP key using the Customer Key fails, Microsoft 365 sends a second request to Azure Key Vault, this time instructing it to use the alternate (second) Customer Key.</span></span>

4. <span data-ttu-id="ef1ea-239">顧客キーを使用して DEP キーをアンラップする 2 番目の要求が失敗した場合、Microsoft 365 は両方の要求の結果を調べる。</span><span class="sxs-lookup"><span data-stu-id="ef1ea-239">If the second request to unwrap the DEP key using the Customer Key fails, Microsoft 365 examines the results of both requests.</span></span>

    - <span data-ttu-id="ef1ea-240">システムエラーを返す要求が失敗したと判断された場合は、次の処理を行います。</span><span class="sxs-lookup"><span data-stu-id="ef1ea-240">If the examination determines that the requests failed returning a system ERROR:</span></span>

       - <span data-ttu-id="ef1ea-241">Microsoft 365 は、DEP キーを復号化するために可用性キーをトリガーします。</span><span class="sxs-lookup"><span data-stu-id="ef1ea-241">Microsoft 365 triggers the availability key to decrypt the DEP key.</span></span>

       - <span data-ttu-id="ef1ea-242">その後、Microsoft 365 は DEP キーを使用してメールボックス キーを復号化し、ユーザー要求を完了します。</span><span class="sxs-lookup"><span data-stu-id="ef1ea-242">Microsoft 365 then uses the DEP key to decrypt the mailbox key and complete the user request.</span></span> 

       - <span data-ttu-id="ef1ea-243">この場合、一時的なエラーが原因で Azure Key Vault が応答できないか、到達不能になります。</span><span class="sxs-lookup"><span data-stu-id="ef1ea-243">In this case, Azure Key Vault is either unable to respond or unreachable due to a transient ERROR.</span></span>

    - <span data-ttu-id="ef1ea-244">要求が ACCESS DENIED の戻り値に失敗したと判断した場合は、次の処理を行います。</span><span class="sxs-lookup"><span data-stu-id="ef1ea-244">If the examination determines that the requests failed returning ACCESS DENIED:</span></span>

       - <span data-ttu-id="ef1ea-245">つまり、意図的、不注意、または悪意のあるアクションが実行され、顧客キーが使用不能になります (たとえば、サービスを離れる一部としてデータの削除プロセス中)。</span><span class="sxs-lookup"><span data-stu-id="ef1ea-245">This means deliberate, inadvertent, or malicious action has been taken to render the customer keys unavailable (for example, during the data purge process as part of leaving the service).</span></span>

       - <span data-ttu-id="ef1ea-246">この場合、可用性キーはシステムアクションにのみ使用され、ユーザーアクションには使用されません。ユーザー要求は失敗し、ユーザーはエラー メッセージを受け取ります。</span><span class="sxs-lookup"><span data-stu-id="ef1ea-246">In this case, the availability key will be used only for system actions and not for user actions, the user request fails, and the user receives an error message.</span></span>

>[!IMPORTANT]
><span data-ttu-id="ef1ea-247">Microsoft 365 サービス コードには、価値を追加するクラウド サービスを提供するために顧客データを理由にした有効なログイン トークンが常に含まれます。</span><span class="sxs-lookup"><span data-stu-id="ef1ea-247">Microsoft 365 service code always has a valid login token for reasoning over customer data to provide value-adding cloud services.</span></span> <span data-ttu-id="ef1ea-248">したがって、可用性キーが削除されるまでは、Exchange Online および Skype for Business (検索インデックスの作成やメールボックスの移動など) によって開始または内部で開始されるアクションのフォールバックとして使用できます。</span><span class="sxs-lookup"><span data-stu-id="ef1ea-248">Therefore, until the availability key has been deleted, it can be used as a fallback for actions initiated by, or internal to, Exchange Online and Skype for Business such as search index creation or moving mailboxes.</span></span> <span data-ttu-id="ef1ea-249">これは、Azure Key Vault に対する一時的な ERRORS 要求と ACCESS DENIED 要求の両方に適用されます。</span><span class="sxs-lookup"><span data-stu-id="ef1ea-249">This applies to both transient ERRORS and ACCESS DENIED requests to Azure Key Vault.</span></span>

### <a name="triggers-for-sharepoint-online-onedrive-for-business-and-teams-files"></a><span data-ttu-id="ef1ea-250">SharePoint Online、OneDrive for Business、Teams ファイルのトリガー</span><span class="sxs-lookup"><span data-stu-id="ef1ea-250">Triggers for SharePoint Online, OneDrive for Business, and Teams files</span></span>

<span data-ttu-id="ef1ea-251">SharePoint Online、OneDrive for Business、Teams ファイルの場合、可用性キーは回復機能の外部では使用されません。回復シナリオ中に可用性キーの使用を開始するように明示的に Microsoft に指示する必要があります。</span><span class="sxs-lookup"><span data-stu-id="ef1ea-251">For SharePoint Online, OneDrive for Business, and Teams files, the availability key is NEVER used outside of the recovery capability and customers must explicitly instruct Microsoft to initiate use of the availability key during a recovery scenario.</span></span>

## <a name="audit-logs-and-the-availability-key"></a><span data-ttu-id="ef1ea-252">監査ログと可用性キー</span><span class="sxs-lookup"><span data-stu-id="ef1ea-252">Audit logs and the availability key</span></span>

<span data-ttu-id="ef1ea-253">Microsoft 365 の自動システムは、システムを流れるすべてのデータを処理して、ウイルス対策、電子検出、データ損失防止、データ インデックス作成などのクラウド サービスを提供します。</span><span class="sxs-lookup"><span data-stu-id="ef1ea-253">Automated systems in Microsoft 365 process all data as it flows through the system to provide cloud services, for example, anti-virus, e-discovery, data loss prevention, and data indexing.</span></span> <span data-ttu-id="ef1ea-254">Microsoft 365 では、このアクティビティの顧客に表示されるログは生成されません。</span><span class="sxs-lookup"><span data-stu-id="ef1ea-254">Microsoft 365 does not generate customer-visible logs for this activity.</span></span> <span data-ttu-id="ef1ea-255">さらに、Microsoft の担当者は、これらの通常のシステム操作の一部としてデータにアクセスしない。</span><span class="sxs-lookup"><span data-stu-id="ef1ea-255">In addition, Microsoft personnel do not access your data as part of these normal system operations.</span></span>

### <a name="exchange-online-and-skype-for-business-availability-key-logging"></a><span data-ttu-id="ef1ea-256">Exchange Online と Skype for Business 可用性キーログ</span><span class="sxs-lookup"><span data-stu-id="ef1ea-256">Exchange Online and Skype for Business availability key logging</span></span>

<span data-ttu-id="ef1ea-257">Exchange Online と Skype for Business が可用性キーにアクセスしてサービスを提供すると、Microsoft 365 はセキュリティとコンプライアンス センターからアクセスできる顧客に表示されるログを発行します。</span><span class="sxs-lookup"><span data-stu-id="ef1ea-257">When Exchange Online and Skype for Business accesses availability key to provide service, Microsoft 365 publishes customer-visible logs accessible from the Security and Compliance Center.</span></span> <span data-ttu-id="ef1ea-258">可用性キー操作の監査ログ レコードは、サービスが可用性キーを使用する度に生成されます。</span><span class="sxs-lookup"><span data-stu-id="ef1ea-258">An audit log record for the availability key operation is generated each time the service uses the availability key.</span></span> <span data-ttu-id="ef1ea-259">アクティビティの種類が "フォールバック to 可用性キー" の "Customer Key Service Encryption"[](./search-the-audit-log-in-security-and-compliance.md)と呼ばれる新しいレコードの種類を使用すると、管理者は統合監査ログ検索結果をフィルター処理して可用性キー レコードを表示できます。</span><span class="sxs-lookup"><span data-stu-id="ef1ea-259">A new record type called "Customer Key Service Encryption" with activity type "Fallback to Availability Key" allows admins to filter [Unified Audit Log](./search-the-audit-log-in-security-and-compliance.md) search results to view availability key records.</span></span>

<span data-ttu-id="ef1ea-260">ログ レコードには、日付、時刻、アクティビティ、組織 ID、データ暗号化ポリシー ID などの属性が含まれます。</span><span class="sxs-lookup"><span data-stu-id="ef1ea-260">Log records include attributes such as date, time, activity, organization ID, and data encryption policy ID.</span></span> <span data-ttu-id="ef1ea-261">このレコードは統合監査ログの一部として使用できます。[コンプライアンス センター監査ログの検索] タブの [セキュリティ &からアクセスできます。</span><span class="sxs-lookup"><span data-stu-id="ef1ea-261">The record is available as part of Unified Audit Logs and is accessible from the Security & Compliance Center Audit Log Search tab.</span></span>

![可用性キー イベントの監査ログ検索](../media/customerkeyauditlogsearchavailabilitykeyloggingimage.png)

<span data-ttu-id="ef1ea-263">Exchange Online および Skype for Business 可用性キー レコードは、Office 365 管理アクティビティ共通スキーマを使用し、カスタム パラメーター (ポリシー ID、スコープ キーバージョン ID、要求 ID) を追加します。 [](/office/office-365-management-api/office-365-management-activity-api-schema#common-schema)</span><span class="sxs-lookup"><span data-stu-id="ef1ea-263">Exchange Online and Skype for Business availability key records use the Office 365 Management Activity [common schema](/office/office-365-management-api/office-365-management-activity-api-schema#common-schema) with added custom parameters: Policy Id, Scope Key Version Id, and Request Id.</span></span>

![可用性キーのカスタム パラメーター](../media/customerkeyauditlogsearchavailabilitykeyloggingcustomparam.png)

### <a name="sharepoint-online-onedrive-for-business-and-teams-files-availability-key-logging"></a><span data-ttu-id="ef1ea-265">SharePoint Online、OneDrive for Business、Teams ファイルの可用性キーログ</span><span class="sxs-lookup"><span data-stu-id="ef1ea-265">SharePoint Online, OneDrive for Business, and Teams files availability key logging</span></span>

<span data-ttu-id="ef1ea-266">可用性キーのログは、これらのサービスでまだ利用できません。</span><span class="sxs-lookup"><span data-stu-id="ef1ea-266">Availability key logging isn't available yet for these services.</span></span> <span data-ttu-id="ef1ea-267">SharePoint Online、OneDrive for Business、Teams ファイルの場合、可用性キーは、回復の目的で Microsoft から指示された場合にのみアクティブ化されます。</span><span class="sxs-lookup"><span data-stu-id="ef1ea-267">For SharePoint Online, OneDrive for Business, and Teams files, the availability key is only activated by Microsoft, when instructed by you, for recovery purposes.</span></span> <span data-ttu-id="ef1ea-268">その結果、これらのサービスで可用性キーが使用されるすべてのイベントが既にわかっています。</span><span class="sxs-lookup"><span data-stu-id="ef1ea-268">As a result, you already know every event in which the availability key is used for these services.</span></span>

## <a name="availability-key-in-the-customer-key-hierarchy"></a><span data-ttu-id="ef1ea-269">顧客キー階層の可用性キー</span><span class="sxs-lookup"><span data-stu-id="ef1ea-269">Availability key in the Customer Key hierarchy</span></span>
  
<span data-ttu-id="ef1ea-270">Microsoft 365 では、可用性キーを使用して、顧客キー サービスの暗号化用に確立されたキー階層の下位のキー層をラップします。</span><span class="sxs-lookup"><span data-stu-id="ef1ea-270">Microsoft 365 uses the availability key to wrap the tier of keys lower in the key hierarchy established for Customer Key service encryption.</span></span> <span data-ttu-id="ef1ea-271">サービス間には異なるキー階層が存在します。</span><span class="sxs-lookup"><span data-stu-id="ef1ea-271">Different key hierarchies exist between services.</span></span> <span data-ttu-id="ef1ea-272">また、キー アルゴリズムは、利用可能なキーと、該当する各サービスの階層内の他のキーによっても異なります。</span><span class="sxs-lookup"><span data-stu-id="ef1ea-272">Key algorithms also differ between availability keys and other keys in the hierarchy of each applicable service.</span></span> <span data-ttu-id="ef1ea-273">さまざまなサービスで使用される可用性キー アルゴリズムは次のとおりです。</span><span class="sxs-lookup"><span data-stu-id="ef1ea-273">The availability key algorithms used by the different services are as follows:</span></span>

- <span data-ttu-id="ef1ea-274">Exchange Online および Skype for Business 可用性キーは、AES-256 を使用します。</span><span class="sxs-lookup"><span data-stu-id="ef1ea-274">The Exchange Online and Skype for Business availability keys use AES-256.</span></span>

- <span data-ttu-id="ef1ea-275">SharePoint Online、OneDrive for Business、Teams ファイルの可用性キーは、RSA-2048 を使用します。</span><span class="sxs-lookup"><span data-stu-id="ef1ea-275">The SharePoint Online, OneDrive for Business, and Teams files availability keys use RSA-2048.</span></span>

### <a name="encryption-ciphers-used-to-encrypt-keys-for-exchange-online-and-skype-for-business"></a><span data-ttu-id="ef1ea-276">Exchange Online と Skype for Business のキーを暗号化するために使用される暗号化暗号</span><span class="sxs-lookup"><span data-stu-id="ef1ea-276">Encryption ciphers used to encrypt keys for Exchange Online and Skype for Business</span></span>

![Exchange Online カスタマー キーの暗号化暗号](../media/customerkeyencryptionhierarchiesexchangeskype.png)

### <a name="encryption-ciphers-used-to-encrypt-keys-for-sharepoint-online-and-onedrive-for-business"></a><span data-ttu-id="ef1ea-278">SharePoint Online および OneDrive for Business のキーを暗号化するために使用される暗号化暗号</span><span class="sxs-lookup"><span data-stu-id="ef1ea-278">Encryption ciphers used to encrypt keys for SharePoint Online and OneDrive for Business</span></span>

![SharePoint Online カスタマー キーの暗号化暗号](../media/customerkeyencryptionhierarchiessharepointonedriveteamsfiles.png)

## <a name="related-articles"></a><span data-ttu-id="ef1ea-280">関連記事</span><span class="sxs-lookup"><span data-stu-id="ef1ea-280">Related articles</span></span>

- [<span data-ttu-id="ef1ea-281">カスタマー キーによるサービスの暗号化</span><span class="sxs-lookup"><span data-stu-id="ef1ea-281">Service encryption with Customer Key</span></span>](customer-key-overview.md)

- [<span data-ttu-id="ef1ea-282">顧客キーの設定</span><span class="sxs-lookup"><span data-stu-id="ef1ea-282">Set up Customer Key</span></span>](customer-key-set-up.md)

- [<span data-ttu-id="ef1ea-283">顧客キーの管理</span><span class="sxs-lookup"><span data-stu-id="ef1ea-283">Manage Customer Key</span></span>](customer-key-manage.md)

- [<span data-ttu-id="ef1ea-284">カスタマー キーまたは可用性キーをローリングまたはローテーションする</span><span class="sxs-lookup"><span data-stu-id="ef1ea-284">Roll or rotate a Customer Key or an availability key</span></span>](customer-key-availability-key-roll.md)