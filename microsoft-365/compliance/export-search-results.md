---
title: コンテンツ検索の結果をエクスポートする
f1.keywords:
- NOCSH
ms.author: markjjo
author: markjjo
manager: laurawi
audience: Admin
ms.topic: how-to
f1_keywords:
- ms.o365.cc.CustomizeExport
ms.service: O365-seccomp
localization_priority: Normal
ms.collection:
- Strat_O365_IP
- M365-security-compliance
- SPO_Content
search.appverid:
- MOE150
- MED150
- MET150
ms.assetid: ed48d448-3714-4c42-85f5-10f75f6a4278
description: Microsoft 365 コンプライアンス センターのコンテンツ検索の検索結果をローカル コンピューターにエクスポートします。 メールの結果は PST ファイルとしてエクスポートされます。 SharePoint サイトと OneDrive for Business サイトのコンテンツは、ネイティブドキュメントとしてOfficeされます。
ms.custom: seo-marvel-apr2020
ms.openlocfilehash: 12c8755d4ca8b5ff97582b879c07fe103c996ecf
ms.sourcegitcommit: 495b66b77d6dbe6d69e5b06b304089e4e476e568
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 01/12/2021
ms.locfileid: "49799704"
---
# <a name="export-content-search-results"></a>コンテンツ検索の結果をエクスポートする

コンテンツ検索が正常に実行された後、検索結果をローカル コンピューターにエクスポートできます。 電子メールの結果をエクスポートする場合は、PST ファイルとしてコンピューターにダウンロードされます。 SharePoint および OneDrive for Business サイトからコンテンツをエクスポートすると、ネイティブ ドキュメントのコピー Officeエクスポートされます。 エクスポートされた検索結果には、他のドキュメントとレポートが含まれています。
  
コンテンツ検索の結果をエクスポートするには、結果を準備し、ローカル コンピューターにダウンロードする必要があります。
  
## <a name="before-you-export-content-search-results"></a>コンテンツ検索結果をエクスポートする前に

- 検索結果をエクスポートするには、セキュリティ/コンプライアンス センターで Export 管理役割を割り当&があります。 この役割は、組み込みの電子情報開示マネージャーの役割グループに割り当てられます。 既定では、Organization Management 役割グループには割り当てられません。 詳細については、「電子情報開示のアクセス [許可を割り当てる」を参照してください](assign-ediscovery-permissions.md)。

- 検索結果をエクスポートする際に使用するコンピューターは、次のシステム要件を満たす必要があります。
  
  - 32 ビット版または 64 ビット版の Windows 7 以降のバージョン
  
  - Microsoft .NET Framework 4.7
  
- 電子情報開示エクスポート ツール 1 を実行するには、次のサポートされているブラウザーのいずれかを使用する<sup>必要があります</sup>。

  - Microsoft Edge <sup>2</sup>
  
    OR

  - Microsoft Internet Explorer 10 以降のバージョン
  
  > [!NOTE]
  > <sup>1</sup> Microsoft は、サード パーティ製の拡張機能やアドオンを、一部のアプリケーションClickOnce行わない。 サード パーティの拡張機能またはアドオンを使用してサポートされていないブラウザーを使用して検索結果をエクスポートする機能はサポートされていません。<br/>
  > <sup>2</sup> Microsoft Edge に最近変更された結果、既定ClickOnceサポートは有効ではなくなりました。 Edge でサポートを有効にするClickOnceについては [、「Microsoft Edge](configure-edge-to-export-search-results.md)で電子情報開示エクスポート ツールを使用する」を参照してください。
  
- ローカル コンピューターに検索結果をダウンロードすることをお勧めします。 ただし、会社のファイアウォールまたはプロキシ インフラストラクチャが検索結果のダウンロード時に問題を引き起こすことをなくす場合は、ネットワークの外部にある仮想デスクトップに検索結果をダウンロードする方法を検討してください。 これにより、大量のファイルをエクスポートするときに Azure データ接続で発生するタイムアウトが減少する可能性があります。 仮想デスクトップについて詳しくは [、「Windows Virtual Desktop」をご覧ください](https://azure.microsoft.com/services/virtual-desktop)。 

- 検索結果をダウンロードする際のパフォーマンスを向上させるために、結果の大きなセットを返す検索を小さな検索に分割する方法を検討してください。 たとえば、検索クエリで日付範囲を使用すると、より小さい結果セットを返して、より速くダウンロードできます。
  
- 検索結果をエクスポートすると、データは、ローカル コンピューターにダウンロードされる前に、Microsoft が提供する Microsoft クラウドの Azure Storage の場所に一時的に保存されます。 組織が Azure のエンドポイント **\* (.blob.core.windows.net)** に接続できる必要があります (ワイルドカードはエクスポートの一意の識別子を表します)。 検索結果データは、作成から 2 週間後に Azure Storage の場所から削除されます。 
  
- 組織でプロキシ サーバーを使用してインターネットと通信する場合は、検索結果のエクスポートに使用するコンピューターでプロキシ サーバーの設定を定義する必要があります (そのため、プロキシ サーバーによってエクスポート ツールを認証できます)。 これを行うには、使用machine.configの Windows と一致する場所にあるファイルを開きます。 
  
  - **32 ビット:**`%windir%\Microsoft.NET\Framework\[version]\Config\machine.config`
  
  - **64 ビット:**`%windir%\Microsoft.NET\Framework64\[version]\Config\machine.config`
  
    タグとタグの間の  *machine.config*  ファイルに次の行  `<configuration>` を追加  `</configuration>` します。 組織に適切な値を置き換え、次に  `ProxyServer`  `Port` 例を示します  `proxy01.contoso.com:80` 。 
  
    ```xml
    <system.net>
       <defaultProxy enabled="true" useDefaultCredentials="true">
         <proxy proxyaddress="https://ProxyServer :Port " 
                usesystemdefault="False" 
                bypassonlocal="True" 
                autoDetect="False" />
       </defaultProxy>
    </system.net>
    ```

## <a name="step-1-prepare-search-results-for-export"></a>手順 1: エクスポートする検索結果を準備する

最初の手順では、エクスポートする検索結果を準備します。 結果を準備すると、Microsoft クラウド内の Microsoft 提供の Azure Storage の場所にアップロードされます。 メールボックスとサイトのコンテンツは、1 時間あたり最大 2 GB の速度でアップロードされます。
  
1. [https://protection.office.com](https://protection.office.com) に移動します。
  
2. 職場または学校のアカウントを使用してサインインします。
  
3. セキュリティ センターコンプライアンス センターの左側のウィンドウで&検索 **を** \> **クリックします**。
  
4. [コンテンツ **検索] ページ** で、検索を選択します。 
  
5. 詳細ウィンドウの **[結果をコンピューターにエクスポートする]** で、**[エクスポートの開始]** をクリックします。
  
    > [!NOTE]
    > 検索の結果が 7 日よりも前の場合は、検索結果を更新するように求められます。この場合は、エクスポートをキャンセルして、選んだ検索の詳細ウィンドウの **[検索結果の更新]** をクリックして、結果が更新された後で、エクスポートをもう一度開始します。  
  
6. [検索結果 **のエクスポート] ページの** [出力オプション] **で、次** のいずれかのオプションを選択します。
  
    - 形式が認識されていないアイテム、暗号化されているアイテム、その他の理由でインデックスが作成されていないアイテムを除くすべてのアイテム
  
    - 形式が認識されていないアイテム、暗号化されているアイテム、その他の理由でインデックスが作成されていないアイテムを含むすべてのアイテム
  
    - 形式が認識できない、暗号化されている、または他の理由でインデックスが作成されていないアイテムのみ
  
    部分的に [インデックスが作成された](#more-information) アイテムをエクスポートする方法については、「詳細」セクションを参照してください。 部分的にインデックスが作成されたアイテムの詳細については、コンテンツ検索の「 [部分的にインデックスが作成されたアイテム」を参照してください](partially-indexed-items-in-content-search.md)。
  
7. [Exchange **コンテンツをエクスポートする] で**、次のいずれかのオプションを選択します。
  
    - **メールボックスごとに 1 つの PST ファイル:** 検索結果を含むユーザー メールボックスごとに 1 つの PST ファイルをエクスポートします。 ユーザーのアーカイブ メールボックスからの結果は、同じ PST ファイルに含まれます。 このオプションは、ソース メールボックスのメールボックス フォルダー構造を再現します。
  
    - **すべてのメッセージを含む 1 つの PST ファイル:** 検索に含まれるすべてのソース メールボックスからの検索結果を含む単一の PST ファイル *(Exchange.pst* という名前) をエクスポートします。 このオプションは、各メッセージのメールボックス フォルダー構造を再現します。
  
    - **1 つのフォルダー内のすべてのメッセージを含む 1 つの PST ファイル:** すべてのメッセージが単一のトップ レベル フォルダーにある単一の PST ファイルに検索結果をエクスポートします。 このオプションを使用すると、レビュー担当者は、各アイテムの元のメールボックス フォルダー構造を移動することなく、アイテムを時系列順 (送信日順に並べ替える) で確認できます。
  
    - **個々のメッセージ:** .msg 形式を使用して、検索結果を個々の電子メール メッセージとしてエクスポートします。 このオプションを選択すると、電子メールの検索結果がファイル システム内のフォルダーにエクスポートされます。 個々のメッセージのフォルダー パスは、結果を PST ファイルにエクスポートした場合に使用されるパスと同じです。
  
      > [!IMPORTANT]
      > RMS で保護されたメッセージをエクスポートするときに復号化するには、電子メール検索結果を個々のメッセージとしてエクスポートする必要があります。 検索結果を PST ファイルとしてエクスポートする場合、暗号化されたメッセージは暗号化されたままです。 詳細については、この記事 [の「RMS で](#decrypting-rms-protected-email-messages-and-encrypted-file-attachments) 保護された電子メール メッセージと暗号化された添付ファイルの暗号化解除」を参照してください。
  
8. 重複するメッセージ **を除外するには、[** 重複除外を有効にする] チェック ボックスをオンにします。 このオプションは、検索のコンテンツ ソースに Exchange メールボックスまたはパブリック フォルダーが含まれる場合にのみ表示されます。 
  
    このオプションを選択すると、検索されたメールボックスで同じメッセージの複数のコピーが見つかった場合でも、メッセージのコピーは 1 つしかエクスポートされません。 エクスポート結果レポート (Results.csv) には、重複するメッセージのコピーを含むメールボックス (またはパブリック フォルダー) を識別できるよう、重複するメッセージのすべてのコピーの行が含まれます。 重複除外と重複アイテムの識別方法の詳細については、「電子情報開示検索結果での重複除外 [」を参照してください](de-duplication-in-ediscovery-search-results.md)。
  
9. すべてのバージョン **の SharePoint ドキュメントをエクスポートするには、[SharePoint** ドキュメントのバージョンを含める] チェック ボックスをオンにします。 このオプションは、検索のコンテンツ ソースに SharePoint または OneDrive for Business サイトが含まれる場合にのみ表示されます。 
  
10. [ **圧縮 (zip 形式) フォルダー内** のファイルをエクスポートする] チェック ボックスをオンにすると、検索結果が圧縮フォルダーにエクスポートされます。 このオプションは、Exchange アイテムを個別のメッセージとしてエクスポートする場合、および検索結果に SharePoint または OneDrive ドキュメントが含まれる場合にのみ使用できます。 このオプションは、主に、アイテムがエクスポートされる場合の Windows ファイル パス名の 260 文字制限を回避するために使用されます。 詳細セクションの「エクスポートされたアイテムのファイル名 [」を参照](#more-information) してください。 
  
11. **[エクスポートの開始]** をクリックします。 検索結果は、ダウンロードする準備が完了します。つまり、Microsoft クラウドの Azure Storage の場所にアップロードされます。 この処理には数分間かかる場合があります。

エクスポートされた検索結果をダウンロードする手順については、次のセクションを参照してください。
  
## <a name="step-2-download-the-search-results"></a>手順 2:検索結果をダウンロードする

次の手順では、Azure Storage の場所からローカル コンピューターに検索結果をダウンロードします。
  
1. [コンテンツ **検索] ページで** 、[エクスポート] **タブをクリック** します。 
  
   [最新の情報に更新] **をクリック** してエクスポート ジョブの一覧を更新し、作成したエクスポート ジョブが表示される場合があります。 エクスポート ジョブの名前は、対応する検索と同じ名前で、検索 **_Export** に追加されます。
  
2. 手順 1 で作成したエクスポート ジョブを選択します。

3. [エクスポート] キーの下のフライアウト **ページで、[** クリップボードにコピー **] をクリックします**。 このキーは、手順 6 で検索結果をダウンロードするために使用します。
  
4. **[結果のダウンロード]** をクリックします。

5. 電子情報開示エクスポート ツールをインストールするように求めるメッセージが表示されたら **、[** インストール] をクリック **します**。

6. 電子情報開示 **エクスポート ツールで、次** の操作を行います。

   ![電子情報開示エクスポート ツール](../media/eDiscoveryExportTool.png)

   1. 手順 3. でコピーしたエクスポート キーを適切なボックスに貼り付けます。
  
   2. **[参照]** をクリックして、検索結果のファイルをダウンロードする場所を指定します。
  
      > [!NOTE]
      > 大量のディスク アクティビティ (読み取りと書き込み) のために、検索結果をローカル ディスク ドライブにダウンロードする必要があります。マップされたネットワーク ドライブや他のネットワークの場所にはダウンロードしません。 
  
6. **[開始]** をクリックして、検索結果をコンピューターにダウンロードします。
  
    **電子情報開示エクスポート ツール** には、ダウンロードする残りのアイテムの数とサイズの見積もりなど、エクスポート プロセスの状態に関する情報が表示されます。 エクスポートプロセスが完了すると、ダウンロードされた場所にあるファイルにアクセスできます。

## <a name="more-information"></a>詳細

検索結果のエクスポートに関する詳細を次に示します。
  
[エクスポートの制限](#export-limits)
  
[レポートをエクスポートする](#export-reports)
  
[部分的にインデックスが作成されたアイテムのエクスポート](#exporting-partially-indexed-items)

[個々のメッセージまたは PST ファイルのエクスポート](#exporting-individual-messages-or-pst-files)
  
[100,000 を超えるメールボックスからの結果のエクスポート](#exporting-results-from-more-than-100000-mailboxes)

[RMS で保護された電子メール メッセージと暗号化された添付ファイルの暗号化解除](#decrypting-rms-protected-email-messages-and-encrypted-file-attachments)

[エクスポートされたアイテムのファイル名](#filenames-of-exported-items)  
  
[その他](#miscellaneous)
  
### <a name="export-limits"></a>エクスポートの制限

コンテンツ検索結果をエクスポートする際の制限の詳細については、コンテンツ検索の制限の「エクスポートの制限 [」セクションを参照してください](limits-for-content-search.md#export-limits)。

### <a name="export-reports"></a>レポートをエクスポートする
  
- 検索結果をエクスポートすると、検索結果に加えて次のレポートが含まれます。
  
  - **エクスポートの概要** エクスポートの概要を含む Excel ドキュメント。 これには、検索されたコンテンツ ソースの数、検索結果の推定サイズとダウンロードサイズ、エクスポートされたアイテムの推定数とダウンロード数などの情報が含まれます。
  
  - **マニフェスト** 検索結果に含まれる各アイテムに関する情報を含むマニフェスト ファイル (XML 形式)。
  
  - **結果** 検索結果としてダウンロードされる各アイテムに関する情報を含む Excel ドキュメント。 電子メールの場合、結果ログには各メッセージに関する次の情報が含まれます。
  
    - 移行元のメールボックス内のメッセージの場所 (メッセージがプライマリ メールボックスとアーカイブ メールボックスのどちらであるかを含みます)。
  
    - メッセージが送信または受信された日付。

    - メッセージの件名行。

    - メッセージの送信者と受信者。

    - 検索結果のエクスポート時に重複除外オプションを有効にした場合に、メッセージが重複するメッセージかどうか。 重複するメッセージには、メッセージを重複として識別する値が [アイテムに複製] 列に含まれます。 [アイテムに複製 **] 列の値** には、エクスポートされたメッセージのアイテム ID が含まれる。 詳細については、「電子情報開示検索結果 [での重複除外」を参照してください](de-duplication-in-ediscovery-search-results.md)。

      SharePoint サイトおよび OneDrive for Business サイトのドキュメントの場合、結果ログには各ドキュメントに関する次の情報が含まれます。

      - ドキュメントの URL。

      - ドキュメントがあるサイト コレクションの URL。

      - ドキュメントが最後に変更された日付。

      - ドキュメントの名前 (これは、結果のログの [件名] 列にあります)。

  - **インデックスのないアイテム** 検索結果に含まれる部分的にインデックスが作成されたアイテムに関する情報を含む Excel ドキュメント。 検索結果レポートを生成するときに部分的にインデックスが作成されたアイテムを含めなかった場合、このレポートは引き続きダウンロードされますが、空になります。

  - **エラーと警告** エクスポート中に発生したファイルのエラーと警告が含まれています。 個々のエラーまたは警告に固有の情報については、「エラーの詳細」列を参照してください。

  - **スキップされたアイテム** SharePoint サイトと OneDrive for Business サイトから検索結果をエクスポートする場合、通常、エクスポートにはスキップされたアイテム レポート (SkippedItems.csv) が含まれます。 このレポートで引用されているアイテムは、通常、フォルダーやドキュメント セットなど、ダウンロードしないアイテムです。 これらの種類のアイテムをエクスポートしないのは、設計上の問題です。 スキップされた他のアイテムの場合、スキップされたアイテム レポートの [エラーの種類] フィールドと [エラーの詳細] フィールドには、アイテムがスキップされ、他の検索結果と一緒にダウンロードしなかった理由が表示されます。

  - **トレース ログ** エクスポート プロセスに関する詳細なログ情報が含まれているので、エクスポート中の問題を発見するのに役立ちます。
  
    > [!NOTE]
    > これらのドキュメントは、実際の検索結果をエクスポートすることなくエクスポートできます。 「コンテンツ [検索レポートをエクスポートする」を参照してください](export-a-content-search-report.md)。 
  
### <a name="exporting-partially-indexed-items"></a>部分的にインデックスが作成されたアイテムのエクスポート
  
- 検索結果内のすべてのメールボックス アイテムを返すコンテンツ検索からメールボックス アイテムをエクスポートする場合 (検索クエリに含まれるキーワードが存在しないので)、部分的にインデックスが作成されたアイテムは、インデックスのないアイテムを含む PST ファイルにコピーされません。 これは、部分的にインデックスが作成されたアイテムを含むすべてのアイテムが、通常の検索結果に自動的に含まれるためです。 つまり、部分的にインデックスが作成されたアイテムは、他のインデックス付きアイテムを含む PST ファイル (または個々のメッセージ) に含まれます。

    インデックス付きアイテムと部分的にインデックスが作成されたアイテムの両方をエクスポートする場合、またはすべてのアイテムを返すコンテンツ検索からインデックス付きアイテムのみをエクスポートする場合は、同じ数のアイテムがダウンロードされます。 これは、コンテンツ検索の推定検索結果 (セキュリティ & コンプライアンス センターの検索統計に表示される) に、部分的にインデックスが作成されたアイテムの数に対する別個の推定値が含まれる場合でも発生します。 たとえば、すべてのアイテムを含む (検索クエリにキーワードがない) 検索の見積もりでは、1,000 アイテムが見つかり、部分的にインデックスが作成された 200 アイテムも検出されたとします。 この場合、検索はすべてのアイテムを返すので、1,000 アイテムには部分的にインデックスが作成されたアイテムが含まれます。 つまり、検索によって返されるアイテムの総数は 1,000 件で、(予想通り) 1,200 アイテムは返されません。 この検索の結果をエクスポートし、インデックス付きアイテムと部分的にインデックスが作成されたアイテムをエクスポートする (または部分的にインデックスが作成されたアイテムのみをエクスポートする) 場合は、1,000 アイテムがダウンロードされます。 これは、空白の検索クエリを使用してすべてのアイテムを返す場合に、部分的にインデックスが作成されたアイテムが通常の (インデックス付き) 結果に含まれるためです。 この同じ例で、部分的にインデックスが作成されたアイテムのみをエクスポートする場合、200 のインデックスのないアイテムだけがダウンロードされます。

    また、前の例 (インデックス付きアイテムと部分的にインデックスが作成されたアイテムをエクスポートする場合、またはインデックス付きアイテムのみをエクスポートする場合) では、エクスポートされた検索結果に含まれる [エクスポートの概要] レポートには、前述と同じ理由で 1,000 アイテムの見積もりアイテムと 1,000 アイテムが表示されます。 

- 結果をエクスポートする検索が、組織内の特定のコンテンツの場所またはすべてのコンテンツの場所を検索した場合、検索条件に一致するアイテムを含むコンテンツの場所の部分的なアイテムだけがエクスポートされます。 つまり、メールボックスまたはサイトで検索結果が見つからない場合、そのメールボックスまたはサイト内の部分的にインデックスが作成されたアイテムはエクスポートされません。 これは、部分的にインデックスが作成されたアイテムを組織内の多くの場所からエクスポートすると、エクスポート エラーが発生する可能性が高く、検索結果のエクスポートとダウンロードにかかる時間が長引く可能性があるという理由です。

    部分的にインデックスが作成されたアイテムを検索のすべてのコンテンツの場所からエクスポートするには、(検索クエリからキーワードを削除して) すべてのアイテムを返す検索を構成し、検索結果をエクスポートするときに部分的にインデックスが作成されたアイテムのみをエクスポートします。

    ![3 番目のエクスポート オプションを使用して、インデックスのないアイテムのみをエクスポートする](../media/5d7be338-a0e5-425f-8ba5-92769c24bf75.png)
  
- SharePoint または OneDrive for Business サイトから検索結果をエクスポートする場合、インデックスのないアイテムをエクスポートする機能は、選択したエクスポート オプションと、検索されたサイトに検索条件に一致するインデックス付きアイテムが含まれているかどうかによっても異なります。 たとえば、特定の SharePoint サイトまたは OneDrive for Business サイトを検索し、検索結果が見つからない場合、インデックス付きアイテムとインデックスのないアイテムの両方をエクスポートする 2 番目のエクスポート オプションを選択すると、それらのサイトのインデックスのないアイテムはエクスポートされません。 サイトのインデックス付きアイテムが検索条件と一致しない場合、インデックス付きアイテムとインデックスのないアイテムの両方をエクスポートするときに、そのサイトからのすべてのインデックスのないアイテムがエクスポートされます。 次の図は、サイトに検索条件に一致するインデックス付きアイテムがサイトに含まれているかどうかに基づくエクスポート オプションを示しています。

    ![検索条件に一致するインデックス付きアイテムがサイトに含まれているかどうかに基づいてエクスポート オプションを選択する](../media/94f78786-c6bb-42fb-96b3-7ea3998bcd39.png)

    1. 検索条件に一致するインデックス付きアイテムだけがエクスポートされます。 部分的にインデックスが作成されたアイテムはエクスポートされません。

    2. サイトのインデックス付きアイテムが検索条件と一致しない場合、その同じサイトから部分的にインデックスが作成されたアイテムはエクスポートされません。 サイトからインデックスが作成されたアイテムが検索結果に返された場合、そのサイトから部分的にインデックスが作成されたアイテムがエクスポートされます。 つまり、検索条件に一致するアイテムを含むサイトの部分的にインデックスが作成されたアイテムだけがエクスポートされます。

    3. 検索条件に一致するアイテムがサイトに含まれているかどうかに関係なく、検索内のすべてのサイトから部分的にインデックスが作成されたアイテムはすべてエクスポートされます。

    部分的にインデックスが作成されたアイテムをエクスポートする場合は **、[Exchange** コンテンツをエクスポートする] で選択したオプションに関係なく、部分的にインデックスが作成されたメールボックス アイテムが別の PST ファイルにエクスポートされます。

- 部分的にインデックスが作成されたアイテムが検索結果で返された場合 (部分的にインデックスが作成されたアイテムの他のプロパティが検索条件と一致した場合)、部分的にインデックスが作成されたアイテムは通常の検索結果と一緒にエクスポートされます。 したがって、インデックス付きアイテムと部分的にインデックスが作成されたアイテムの両方をエクスポートする場合 (形式が認識されていないアイテム、暗号化されているアイテム、その他の理由でインデックスが作成されていないアイテムを含む) を選択すると、通常の結果でエクスポートされた部分的にインデックスが作成されたアイテムが Results.csv レポートに表示されます。 これらのプロパティは、[インデックスのないアイテム] レポートitems.csvされません。
  
### <a name="exporting-individual-messages-or-pst-files"></a>個々のメッセージまたは PST ファイルのエクスポート
  
- メッセージのファイル パス名が Windows の最大文字制限を超えると、ファイル パス名は切り捨てられて表示されます。 ただし、元のファイル パス名はマニフェストと ResultsLog に表示されます。
  
- 前に説明したように、電子メールの検索結果はファイル システム内のフォルダーにエクスポートされます。 個々のメッセージのフォルダー パスは、ユーザーのメールボックス内のフォルダー パスをレプリケートします。 たとえば、ユーザーの受信トレイ内の "ContosoCase101" メッセージという名前の検索の場合、フォルダー パスに格納されます  `~ContosoCase101\\<date of export\Exchange\user@contoso.com (Primary)\Top of Information Store\Inbox` 。

- If you choose to export email messages in one PST file containing all messages in a single folder, a **Deleted Items** folder and a **Search Folders** folder are included in the top level of the PST folder. これらのフォルダーは空です。

- 前に説明したように、電子メール検索結果を個々のメッセージとしてエクスポートして、RMS で保護されたメッセージをエクスポートするときに復号化する必要があります。 メールの検索結果を PST ファイルとしてエクスポートする場合、暗号化されたメッセージは暗号化されたままです。
  
### <a name="exporting-results-from-more-than-100000-mailboxes"></a>100,000 を超えるメールボックスからの結果のエクスポート

- 前に説明したように、セキュリティ & コンプライアンス センター PowerShell を使用して、100,000 を超えるメールボックスから検索結果をダウンロードする必要があります。 このセクションの次のスクリプトを実行して、これらの検索結果をダウンロードできます。 このスクリプトを使用すると、検索結果が既にエクスポート済み (エクスポート ジョブはコンテンツ検索ツールの [エクスポート] タブに表示されます) が既にエクスポート済みであり、ダウンロードする必要がある場合があります。

   ```powershell
   $export=Get-ComplianceSearchAction SEARCHNAME_Export -IncludeCredential;
   $exportUrl=   [System.Uri]::EscapeDataString(($export.Results.Split(";") | ?{$_ -like '*Container url*'} | %{$_.Split(":",2)} | select -last 1).Trim());
   $exportToken=($export.Results.Split(";") | ?{$_ -like '*SAS Token*'} | %{$_.Split(":",2)} | select -last 1).Trim();
   ."$env:ProgramFiles\Internet Explorer\IEXPLORE.EXE" "https://complianceclientsdf.blob.core.windows.net/v16/Microsoft.Office.Client.Discovery.UnifiedExportTool.application?name=$($export.Name)&source=$exportUrl&zip=allow&trace=1";
   $exportToken | clip;
   ```

  スクリプトでは、結果をエクスポートする検索の名前を指定する必要があります。 たとえば、名前の付いた検索の場合は、 `SearchAllMailboxes` 検索文字列をSEARCHNAME_Exportします `SearchAllMailboxes_Export` 。

  スクリプトに検索の名前を追加した後、スクリプト テキストをコピーし、セキュリティ & コンプライアンス センター [の PowerShell](https://docs.microsoft.com/powershell/exchange/connect-to-scc-powershell)に接続されている Windows PowerShell ウィンドウに貼り付けることができます。 スクリプトを貼り付けると、電子情報開示エクスポート ツールが表示されます (UI を使用して検索結果をダウンロードする場合と同様)。

  ![電子情報開示エクスポート ツール](../media/eDiscoveryExportTool.png)

  エクスポート キー ボックスをクリックし、キーを押してエクスポート キーを貼り付けます (スクリプトはエクスポート キー `CTRL + V` をクリップボードにコピーします)。 [ **参照]** をクリックしてファイルをダウンロードする場所を指定し、ダウンロードを開始します。

  前に説明したように、大量のディスク アクティビティ (読み取りと書き込み) のために、ローカル ディスク ドライブに検索結果をダウンロードすることをお勧めします。 マップされたネットワーク ドライブや他のネットワークの場所に検索結果をダウンロードしない。

### <a name="decrypting-rms-protected-email-messages-and-encrypted-file-attachments"></a>RMS で保護された電子メール メッセージと暗号化された添付ファイルの暗号化解除

コンテンツ検索の結果に含まれる権利で保護された (RMS で保護された) 電子メール メッセージは、エクスポート時に復号化されます。 さらに [、Microsoft](encryption.md) 暗号化テクノロジで暗号化され、検索結果に含まれる電子メール メッセージに添付されたファイルは、エクスポート時にも暗号化解除されます。 この復号化機能は、電子情報開示マネージャー役割グループのメンバーに対して既定で有効になっています。 これは、RMS 復号化管理役割が既定でこの役割グループに割り当てられているためです。 暗号化された電子メール メッセージと添付ファイルをエクスポートする場合は、次の注意が必要です。
  
- 前に説明したように、RMS で保護されたメッセージをエクスポートするときに復号化するには、検索結果を個々のメッセージとしてエクスポートする必要があります。 検索結果を PST ファイルにエクスポートする場合、RMS で保護されたメッセージは暗号化されたままです。

- 復号化されたメッセージは **、ResultsLog レポートで識別** されます。 このレポートには **Decode Status** という名前の列が含まれます。この列の **Decoded** の値は、復号化されたメッセージを識別します。

- 検索結果をエクスポートするときに添付ファイルの暗号化を解除する以外に、検索結果をプレビューするときに復号化されたファイルをプレビューすることもできます。 権限で保護された電子メール メッセージは、エクスポート後にのみ表示できます。

- 現時点では、検索結果をエクスポートする場合の復号化機能には、SharePoint および OneDrive for Business サイトからの暗号化されたコンテンツは含めっていません。 ただし、Microsoft 暗号化テクノロジで暗号化され、SharePoint Online と OneDrive for Business に保存されたドキュメントについては、近日サポートされる予定です。

- 誰かが RMS で保護されたメッセージと暗号化された添付ファイルを復号化する必要がある場合は、(組み込みの電子情報開示マネージャー役割グループをコピーして) カスタム役割グループを作成し、カスタム役割グループから RMS 復号化管理役割を削除する必要があります。 次に、カスタム役割グループのメンバーとしてメッセージの暗号化を解除しないユーザーを追加します。
  
### <a name="filenames-of-exported-items"></a>エクスポートされたアイテムのファイル名
  
- ローカル コンピューターにエクスポートされる電子メール メッセージとサイト ドキュメントの完全パス名には、260 文字の制限があります (オペレーティング システムによって課されます)。 エクスポートされるアイテムの完全なパス名には、アイテムの元の場所と、検索結果のダウンロード先のローカル コンピューター上のフォルダーの場所が含まれます。 たとえば、電子情報開示のエクスポート ツールで検索結果をダウンロードする場合、ダウンロードした電子メール アイテムの完全なパス名は  `C:\Users\Admin\Desktop\SearchResults` 次のようになります  `C:\Users\Admin\Desktop\SearchResults\ContentSearch1\03.15.2017-1242PM\Exchange\sarad@contoso.com (Primary)\Top of Information Store\Inbox\Insider trading investigation.msg` 。

    260 文字の制限を超えると、アイテムの完全パス名が切り捨てられてきます。

  - 完全パス名が 260 文字を超える場合、ファイル名は制限を超えるまで短縮されます。切り捨てられたファイル名 (ファイル拡張子を除く) は 8 文字以下になる点に注意してください。

  - ファイル名を短くした後も完全パス名が長すぎる場合、アイテムは現在の場所から親フォルダーに移動されます。 パス名がまだ長すぎる場合、プロセスは繰り返されます。ファイル名を短くし、必要に応じて親フォルダーに再度移動します。 このプロセスは、完全なパス名が 260 文字以下になるまで繰り返されます。

  - 切り捨てられた完全なパス名が既に存在する場合は、ファイル名の末尾にバージョン番号が追加されます。たとえば、  `statusmessage(2).msg` .

    この問題を軽減するには、短いパス名を持つ場所に検索結果をダウンロードする方法を検討してください。たとえば、名前付きのフォルダーに検索結果をダウンロードすると、エクスポートされたアイテムをフォルダーにダウンロードするよりも、エクスポートされたアイテムのパス名に追加する文字が  `C:\Results` 少なめになります  `C:\Users\Admin\Desktop\Results` 。

- サイト ドキュメントをエクスポートするときに、ドキュメントの元のファイル名が変更される可能性もあります。 これは特に、保留にされた SharePoint または OneDrive for Business サイトから削除されたドキュメントに対して発生します。 保持中のサイトにあるドキュメントが削除されると、削除されたドキュメントは自動的にサイトのアイテム保持ライブラリに移動されます (サイトが保留にされた際に作成されました)。 削除されたドキュメントがアイテム保持ライブラリに移動されると、ランダムに生成された一意の ID がドキュメントの元のファイル名に追加されます。 たとえば、ドキュメントのファイル名が削除され、そのドキュメントが後でアイテム保持ライブラリに移動された場合、アイテム保持ライブラリに移動されたドキュメントのファイル名は次のように  `FY2017Budget.xlsx` 変更されます  `FY2017Budget_DEAF727D-0478-4A7F-87DE-5487F033C81A2000-07-05T10-37-55.xlsx` 。 保持ライブラリ内のドキュメントがコンテンツ検索のクエリと一致し、その検索の結果をエクスポートした場合、エクスポートされたファイルのファイル名は変更されます。この例では、エクスポートされたドキュメントのファイル名は次のようになります  `FY2017Budget_DEAF727D-0478-4A7F-87DE-5487F033C81A2000-07-05T10-37-55.xlsx` 。

    保持中のサイトのドキュメントが変更され (サイト内のドキュメント ライブラリのバージョン管理が有効になっている)、ファイルのコピーが保持ライブラリに自動的に作成されます。 この場合、ランダムに生成された一意の ID も、保持ライブラリにコピーされたドキュメントのファイル名に追加されます。

    保持ライブラリに移動またはコピーされたドキュメントのファイル名は、ファイル名の競合を防ぐためです。 サイトおよび保持ライブラリに保留を設定する方法の詳細については [、「SharePoint Server 2016](https://support.office.com/article/5e400d68-cd51-444a-8fe6-e4df1d20aa95)のイン Place Hold の概要」を参照してください。

### <a name="miscellaneous"></a>その他
  
- 電子情報開示エクスポート ツールを使用して検索結果をダウンロードする場合、次のエラーが表示される可能性があります。これは一時的なエラーであり、通常は Azure Storage の場所で `System.Net.WebException: The remote server returned an error: (412) The condition specified using HTTP conditional header(s) is not met.` 発生します。 この問題を解決するには、 [電子情報開示](#step-2-download-the-search-results)エクスポート ツールを再起動する検索結果のダウンロードを再試行します。

- すべての検索結果とエクスポート レポートが、コンテンツ検索と同じ名前のフォルダーに含まれています。 エクスポートされたメール メッセージは、**Exchange** という名前のフォルダーにあります。 ドキュメントは、**SharePoint** という名前のフォルダーにあります。

- SharePoint および OneDrive for Business サイト上のドキュメントのファイル システム メタデータは、ドキュメントがローカル コンピューターにエクスポートされる際に保持されます。 つまり、作成日や最終更新日などのドキュメントのプロパティは、ドキュメントがエクスポートされる時に変更されません。

- 検索結果に検索クエリに一致する SharePoint のリスト アイテムが含まれる場合、検索クエリと一致するアイテムおよびリスト内の添付ファイルに加えて、リスト内のすべての行がエクスポートされます。 この動作の理由は、検索結果で返されるリスト アイテムのコンテキストを提供するために使用されます。 また、追加のリスト アイテムと添付ファイルによって、エクスポートされたアイテムの数が検索結果の元の推定値と異なる場合があります。
