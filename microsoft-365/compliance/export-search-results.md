---
title: コンテンツ検索の結果をエクスポートする
f1.keywords:
- NOCSH
ms.author: markjjo
author: markjjo
manager: laurawi
audience: Admin
ms.topic: how-to
f1_keywords:
- ms.o365.cc.CustomizeExport
ms.service: O365-seccomp
localization_priority: Normal
ms.collection:
- Strat_O365_IP
- M365-security-compliance
- SPO_Content
search.appverid:
- MOE150
- MED150
- MET150
ms.assetid: ed48d448-3714-4c42-85f5-10f75f6a4278
description: Microsoft 365 コンプライアンスセンターのコンテンツ検索からローカルコンピューターに検索結果をエクスポートします。 電子メールの結果は PST ファイルとしてエクスポートされます。 SharePoint と OneDrive for Business サイトのコンテンツは、ネイティブの Office ドキュメントとしてエクスポートされます。
ms.custom: seo-marvel-apr2020
ms.openlocfilehash: a697f5cf81022bf8d8122d0dd57c07ba8a578f0a
ms.sourcegitcommit: 1beaf89d2faa32f11fe1613be2fa2b31c4bc4a91
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 12/08/2020
ms.locfileid: "49602054"
---
# <a name="export-content-search-results"></a>コンテンツ検索の結果をエクスポートする

コンテンツ検索が正常に実行されたら、検索結果をローカルコンピューターにエクスポートできます。 電子メールの結果をエクスポートする場合は、PST ファイルとしてコンピューターにダウンロードされます。 SharePoint と OneDrive for Business サイトからコンテンツをエクスポートすると、ネイティブな Office ドキュメントのコピーがエクスポートされます。 エクスポートされた検索結果には、他のドキュメントやレポートが含まれています。
  
コンテンツ検索の結果をエクスポートするには、結果を準備してからローカルコンピューターにダウンロードする必要があります。
  
## <a name="before-you-export-content-search-results"></a>コンテンツ検索の結果をエクスポートする前に

- 検索結果をエクスポートするには、セキュリティ & コンプライアンスセンターで、Export 管理役割が割り当てられている必要があります。 この役割は、組み込みの電子情報開示マネージャーの役割グループに割り当てられます。 既定では、Organization Management 役割グループには割り当てられません。 詳細については、「 [電子情報開示のアクセス許可を割り当てる](assign-ediscovery-permissions.md)」を参照してください。

- 検索結果をエクスポートする際に使用するコンピューターは、次のシステム要件を満たす必要があります。
  
  - 32ビットまたは64ビット版の Windows 7 以降のバージョン
  
  - Microsoft .NET Framework 4.7
  
- 電子情報開示エクスポートツール<sup>1</sup>を実行するには、次のサポートされているブラウザーのいずれかを使用する必要があります。

  - Microsoft Edge <sup>2</sup>
  
    OR

  - Microsoft Internet Explorer 10 以降のバージョン
  
  > [!NOTE]
  > <sup>1</sup> Microsoft は、ClickOnce アプリケーション用のサードパーティ製の拡張機能またはアドオンを製造していません。 サポートされていないブラウザーを使用して、サードパーティの内線番号またはアドオンを使用して検索結果をエクスポートすることはできません。<br/>
  > <sup>2</sup> Microsoft Edge に対する最近の変更の結果として、ClickOnce サポートは既定で有効になりません。 エッジで ClickOnce サポートを有効にする方法については、「 [Microsoft Edge で電子情報開示エクスポートツールを使用](configure-edge-to-export-search-results.md)する」を参照してください。
  
- 検索結果をローカルコンピューターにダウンロードすることをお勧めします。 ただし、企業のファイアウォールまたはプロキシインフラストラクチャを検索結果をダウンロードする際に問題が発生しないようにするには、ネットワーク外部の仮想デスクトップに検索結果をダウンロードすることを検討してください。 これにより、大量のファイルをエクスポートするときに、Azure データ接続で発生するタイムアウトを減らすことができます。 仮想デスクトップの詳細については、「 [Windows 仮想デスクトップ](https://azure.microsoft.com/services/virtual-desktop)」を参照してください。 

- 検索結果をダウンロードするときのパフォーマンスを向上させるには、大規模な結果セットを返す検索を小さな検索に分割することを検討してください。 たとえば、検索クエリで日付範囲を使用して、より短時間でダウンロードできる結果セットを返すことができます。
  
- 検索結果をエクスポートすると、データがローカルコンピューターにダウンロードされる前に、microsoft クラウド内の Microsoft 提供の Azure ストレージの場所に一時的に格納されます。 組織が Azure のエンドポイントに接続できることを確認し **\* ます。 blob.core.windows.net** (ワイルドカードは、エクスポートの一意識別子を表します)。 検索結果データは、作成後2週間後に Azure ストレージの場所から削除されます。 
  
- 組織がプロキシサーバーを使用してインターネットと通信する場合は、検索結果のエクスポートに使用するコンピューターでプロキシサーバーの設定を定義する必要があります (エクスポートツールをプロキシサーバーで認証できるようにするため)。 これを行うには、使用している Windows のバージョンと一致する場所で  *machine.config*  ファイルを開きます。 
  
  - **32 ビット:**`%windir%\Microsoft.NET\Framework\[version]\Config\machine.config`
  
  - **64 ビット:**`%windir%\Microsoft.NET\Framework64\[version]\Config\machine.config`
  
    次の行を、タグとタグの間の  *machine.config*  ファイルに追加し  `<configuration>`  `</configuration>` ます。 を使用して  `ProxyServer` 、  `Port` 組織の正しい値をに置き換えてください  `proxy01.contoso.com:80` 。 
  
    ```xml
    <system.net>
       <defaultProxy enabled="true" useDefaultCredentials="true">
         <proxy proxyaddress="https://ProxyServer :Port " 
                usesystemdefault="False" 
                bypassonlocal="True" 
                autoDetect="False" />
       </defaultProxy>
    </system.net>
    ```

## <a name="step-1-prepare-search-results-for-export"></a>手順 1: エクスポートする検索結果を準備する

最初の手順では、エクスポートする検索結果を準備します。 結果を準備すると、microsoft クラウド内の Microsoft 提供の Azure ストレージの場所にアップロードされます。 メールボックスとサイトのコンテンツは、最大で1時間あたり 2 GB にアップロードされます。
  
1. [https://protection.office.com](https://protection.office.com) に移動します。
  
2. 職場または学校のアカウントを使用してサインインします。
  
3. セキュリティ & コンプライアンスセンターの左側のウィンドウで、[ **検索** \> **コンテンツ検索**] をクリックします。
  
4. [ **コンテンツ検索** ] ページで、検索を選択します。 
  
5. 詳細ウィンドウの **[結果をコンピューターにエクスポートする]** で、**[エクスポートの開始]** をクリックします。
  
    > [!NOTE]
    > 検索の結果が 7 日よりも前の場合は、検索結果を更新するように求められます。この場合は、エクスポートをキャンセルして、選んだ検索の詳細ウィンドウの **[検索結果の更新]** をクリックして、結果が更新された後で、エクスポートをもう一度開始します。  
  
6. [ **検索結果のエクスポート** ] ページの [ **出力オプション**] で、次のいずれかのオプションを選択します。
  
    - すべてのアイテム (認識できない形式のアイテムを除く)、暗号化されている、またはその他の理由でインデックスが作成されていないもの
  
    - 他の理由により、認識されない形式のアイテム、暗号化されているアイテム、またはインデックス付けされていないアイテムを含むすべてのアイテム
  
    - 他の理由により、認識されていない形式、またはインデックス付けされていないアイテムのみ
  
    部分的にインデックスが作成されたアイテムがエクスポートされる方法の詳細については、「 [More information](#more-information) 」セクションを参照してください。 部分的にインデックスが作成されたアイテムの詳細については、「 [コンテンツ検索でのインデックスのあるアイテムの一部](partially-indexed-items-in-content-search.md)」を参照してください
  
7. [ **Exchange コンテンツのエクスポート**] で、次のいずれかのオプションを選択します。
  
    - **メールボックスごとに1つの PST ファイル:** 検索結果が含まれているユーザーメールボックスごとに1つの PST ファイルをエクスポートします。 ユーザーのアーカイブメールボックスからの結果はすべて、同じ PST ファイルに含まれています。 このオプションを指定すると、移動元メールボックスからメールボックスフォルダー構造が再現されます。
  
    - **すべてのメッセージを含む1つの PST ファイル:** 検索に含まれるすべてのソースメールボックスからの検索結果を含む1つの PST ファイル *(名前付き*) をエクスポートします。 このオプションを選択すると、各メッセージのメールボックスフォルダーの構造が再現されます。
  
    - **単一のフォルダー内のすべてのメッセージを含む1つの PST ファイル:** すべてのメッセージが1つの最上位のフォルダーに格納されている1つの PST ファイルに検索結果をエクスポートします。 このオプションを使用すると、各アイテムの元のメールボックスフォルダー構造を移動しなくても、レビューアーはアイテムを時系列順 (送信日で並べ替え) で確認できます。
  
    - **個別のメッセージ:** .Msg 形式を使用して、検索結果を個々の電子メールメッセージとしてエクスポートします。 このオプションを選択すると、電子メール検索の結果はファイルシステムのフォルダーにエクスポートされます。 個々のメッセージのフォルダーパスは、その結果を PST ファイルにエクスポートした場合に使用したものと同じです。
  
      > [!IMPORTANT]
      > RMS で保護されたメッセージをエクスポートするときに暗号化を解除するには、電子メール検索結果を個々のメッセージとしてエクスポートする必要があります。 検索結果を PST ファイルとしてエクスポートする場合、暗号化されたメッセージは暗号化されたままになります。 詳細については、この記事の「 [RMS で保護された電子メールメッセージと暗号化された添付ファイルの暗号化を解除](#decrypting-rms-protected-email-messages-and-encrypted-file-attachments) する」を参照してください。
  
8. 重複するメッセージを除外するには、[重複 **除外を有効** にする] チェックボックスをオンにします。 このオプションは、検索のコンテンツソースに Exchange メールボックスまたはパブリックフォルダーが含まれる場合にのみ表示されます。 
  
    このオプションを選択すると、同じメッセージのコピーが検索されたメールボックスに複数存在する場合でも、メッセージのコピーが1つだけエクスポートされます。 [結果のエクスポート] レポート (Results.csv) には、重複したメッセージのコピーを含むメールボックス (またはパブリックフォルダー) を識別できるように、重複するメッセージのコピーごとに1つの行が含まれます。 重複除外と重複するアイテムの識別方法の詳細については、「 [電子情報開示検索結果の重複除外](de-duplication-in-ediscovery-search-results.md)」を参照してください。
  
9. [ **Sharepoint ドキュメントにバージョンを含める** ] チェックボックスをオンにして、sharepoint ドキュメントのすべてのバージョンをエクスポートします。 このオプションは、検索のコンテンツソースに SharePoint または OneDrive for business サイトが含まれている場合にのみ表示されます。 
  
10. [ **圧縮 (zip 形式) フォルダー内のファイルをエクスポート** する] チェックボックスをオンにして、検索結果を圧縮フォルダーにエクスポートします。 このオプションは、Exchange アイテムを個別のメッセージとしてエクスポートすることを選択した場合、検索結果に SharePoint または OneDrive ドキュメントが含まれる場合にのみ使用できます。 このオプションは、アイテムをエクスポートするときに、Windows ファイルパス名の260文字制限を回避するために主に使用されます。 「 [詳細情報](#more-information) 」セクションの「エクスポートされたアイテムのファイル名」を参照してください。 
  
11. **[エクスポートの開始]** をクリックします。 検索結果はダウンロード用に準備されます。つまり、Microsoft クラウド内の Azure ストレージの場所にアップロードされています。 この処理には数分間かかる場合があります。

エクスポートされた検索結果をダウンロードする方法については、次のセクションを参照してください。
  
## <a name="step-2-download-the-search-results"></a>手順 2:検索結果をダウンロードする

次の手順では、Azure のストレージの場所からローカルコンピューターに検索結果をダウンロードします。
  
1. [ **コンテンツ検索** ] ページで、[ **エクスポート** ] タブをクリックします。 
  
   作成したエクスポートジョブが表示されるように、[ **更新** ] をクリックしてエクスポートジョブのリストを更新する必要がある場合があります。 エクスポートジョブの名前は、検索名に **_Export** が追加された対応する検索と同じです。
  
2. 手順1で作成したエクスポートジョブを選択します。

3. [ **エクスポートキー**] の下の [ポップアップ] ページで、[ **クリップボードにコピー**] をクリックします。 検索結果をダウンロードするには、手順6でこのキーを使用します。
  
4. **[結果のダウンロード]** をクリックします。

5. **電子情報開示エクスポートツール** をインストールするように求めるメッセージが表示されたら、[**インストール**] をクリックします。

6. **電子情報開示エクスポートツール** で、次の操作を行います。

   ![電子情報開示エクスポートツール](../media/eDiscoveryExportTool.png)

   1. 手順3でコピーしたエクスポートキーを適切なボックスに貼り付けます。
  
   2. **[参照]** をクリックして、検索結果のファイルをダウンロードする場所を指定します。
  
      > [!NOTE]
      > ディスクアクティビティが大量に (読み取りおよび書き込み) あるため、検索結果をローカルディスクドライブにダウンロードする必要があります。マップされたネットワークドライブまたは他のネットワークの場所にはダウンロードしないでください。 
  
6. **[開始]** をクリックして、検索結果をコンピューターにダウンロードします。
  
    **電子情報開示エクスポート ツール** には、ダウンロードする残りのアイテムの数とサイズの見積もりなど、エクスポート プロセスの状態に関する情報が表示されます。 エクスポートプロセスが完了すると、ダウンロードされた場所にあるファイルにアクセスできます。

## <a name="more-information"></a>詳細情報

検索結果のエクスポートの詳細については、以下を参照してください。
  
[エクスポートの制限](#export-limits)
  
[レポートをエクスポートする](#export-reports)
  
[部分的にインデックスが作成されたアイテムをエクスポートする](#exporting-partially-indexed-items)

[個々のメッセージまたは PST ファイルのエクスポート](#exporting-individual-messages-or-pst-files)
  
[10万を超えるメールボックスからの結果のエクスポート](#exporting-results-from-more-than-100000-mailboxes)

[RMS で保護された電子メールメッセージと暗号化された添付ファイルの暗号化の解除](#decrypting-rms-protected-email-messages-and-encrypted-file-attachments)

[エクスポートされたアイテムのファイル名](#filenames-of-exported-items)  
  
[その他](#miscellaneous)
  
### <a name="export-limits"></a>エクスポートの制限
  
- セキュリティ & コンプライアンスセンターからの検索結果のエクスポートには、次のような制限があります。

  - 1つのコンテンツ検索から最大 2 TB のデータをエクスポートできます。 検索結果が 2 TB より大きい場合は、日付の範囲やその他の種類のフィルターを使用して、検索結果の合計サイズを小さくすることを検討してください。
  
  - 組織は1日に最大 2 TB のデータをエクスポートできます。
  
  - 組織内で最大 10 のエクスポートを同時に実行することができます。

  - 1人のユーザーは、一度に最大で3つのエクスポートを実行できます。
  
  - Office 365 Security & コンプライアンスセンターまたは Microsoft 365 コンプライアンスセンターで電子情報開示エクスポートツールを使用して、最大10万のメールボックスから検索結果をダウンロードすることができます。 10万を超えるメールボックスから検索結果をダウンロードするには、セキュリティ & コンプライアンスセンターの PowerShell を使用する必要があります。 手順については、「 [10万を超えるメールボックスからの結果のエクスポート](#exporting-results-from-more-than-100000-mailboxes)」を参照してください。

  > [!NOTE]
  > コンテンツ検索からのレポートのみをエクスポートすると、同時に実行しているエクスポートの数と、1人のユーザーが実行できるエクスポートの数についてもカウントされます。
  
- 前述したように、メールボックスとサイトの検索結果は、最大速度が1時間あたり 2 GB の Microsoft 提供の Azure ストレージの場所 (「 [手順 1: エクスポート用の検索結果を準備](#step-1-prepare-search-results-for-export)する」を参照) にアップロードされます。
  
- エクスポート可能な PST ファイルの最大サイズは、既定では 10 GB です。 つまり、ユーザーのメールボックスからの検索結果が 10 GB より大きい場合、メールボックスの検索結果は2つ (またはそれ以上) の個別の PST ファイルにエクスポートされます。 すべての検索結果を1つの PST ファイルにエクスポートすることを選択した場合、検索結果の合計サイズが 10 GB より大きい場合は、PST ファイルが追加の PST ファイルに組み込まれます。 この既定のサイズを変更する場合は、検索結果のエクスポートに使用するコンピューターで Windows レジストリを編集できます。 [電子情報開示検索結果をエクスポートする場合は、「PST ファイルのサイズを変更する](change-the-size-of-pst-files-when-exporting-results.md)」を参照してください。
  
    また、特定のメールボックスからの検索結果は、1つのメールボックスのコンテンツが 10 GB を超えていない限り、複数の PST ファイルに分割されることはありません。 単一のフォルダーにあるすべてのメッセージを含む1つの PST ファイルで検索結果をエクスポートすることを選択した場合、検索結果が 10 GB より大きいと、アイテムは日付順に整理されたままになり、送信日に基づいて追加の PST ファイルに保存されます。
  
### <a name="export-reports"></a>レポートをエクスポートする
  
- 検索結果をエクスポートすると、検索結果に加えて次のレポートが含まれます。
  
  - **エクスポートの概要** エクスポートの概要を含む Excel ドキュメント。 これには、検索されたコンテンツソースの数、検索結果の推定サイズとダウンロードサイズ、およびエクスポートされたアイテム数の予想およびダウンロード数などの情報が含まれます。
  
  - **マニフェスト** 検索結果に含まれる各アイテムに関する情報を含むマニフェストファイル (XML 形式)。
  
  - **結果** 検索結果としてダウンロードされる各アイテムに関する情報を含む Excel ドキュメント。 メールの場合、結果ログには、各メッセージに関する次の情報が含まれます。
  
    - 移行元のメールボックス内のメッセージの場所 (メッセージがプライマリ メールボックスとアーカイブ メールボックスのどちらであるかを含みます)。
  
    - メッセージが送信または受信された日付。

    - メッセージの件名行。

    - メッセージの送信者と受信者。

    - 検索結果をエクスポートするときに重複除去オプションを有効にした場合、メッセージが重複メッセージであるかどうか。 重複メッセージは、重複しているとメッセージを識別する [ **重複するアイテム** ] 列に値を持っています。 [ **重複したアイテム** ] 列の値には、エクスポートされたメッセージのアイテム id が含まれています。 詳細については、「 [電子情報開示検索結果の重複除外](de-duplication-in-ediscovery-search-results.md)」を参照してください。

      SharePoint と OneDrive for Business サイトのドキュメントの場合、結果ログには、各ドキュメントに関する以下の情報が含まれています。

      - ドキュメントの URL。

      - ドキュメントがあるサイト コレクションの URL。

      - ドキュメントが最後に変更された日付。

      - ドキュメントの名前 (これは、結果のログの [件名] 列にあります)。

  - **インデックス** のないアイテム検索結果に含まれる、部分的にインデックスが作成されたアイテムに関する情報を含む Excel ドキュメント。 検索結果レポートを生成するときに、部分的にインデックス付けされたアイテムを含めない場合、このレポートは引き続きダウンロードされますが、空になります。

  - **エラーと警告** エクスポート中に発生したファイルのエラーと警告を含みます。 各エラーまたは警告に固有の情報については、[エラーの詳細] 列を参照してください。

  - **スキップ** されたアイテムSharePoint および OneDrive for Business サイトから検索結果をエクスポートすると、通常、スキップされたアイテムのレポート (SkippedItems.csv) がエクスポートに含まれます。 このレポートで言及されているアイテムは、通常、フォルダーやドキュメントセットなど、ダウンロードされないアイテムです。 これらの種類のアイテムをエクスポートすることは、設計によるものではありません。 その他の項目については、スキップされたアイテムレポートの [エラーの種類] および [エラーの詳細] フィールドに、アイテムがスキップされ、他の検索結果と共にダウンロードされなかった理由が表示されます。

  - **トレースログ** エクスポートプロセスに関する詳細なログ情報が含まれており、エクスポート中の問題を明らかにするのに役立ちます。
  
    > [!NOTE]
    > これらのドキュメントは、実際の検索結果をエクスポートせずにエクスポートするだけでかまいません。 「 [コンテンツ検索レポートをエクスポートする」を](export-a-content-search-report.md)参照してください。 
  
### <a name="exporting-partially-indexed-items"></a>部分的にインデックスが作成されたアイテムをエクスポートする
  
- 検索結果のすべてのメールボックスアイテムを返すコンテンツ検索からメールボックスアイテムをエクスポートしている場合 (検索クエリに含まれているキーワードがないため)、部分的にインデックスが作成されたアイテムは、インデックスのないアイテムを含む PST ファイルにコピーされません。 これは、部分的にインデックスが作成されたアイテムを含むすべてのアイテムが自動的に通常の検索結果に含まれるためです。 これは、部分的にインデックスが作成されたアイテムが、他のインデックス付きアイテムを含む PST ファイル (または個別のメッセージ) に含まれることを意味します。

    インデックス付きアイテムと部分インデックスアイテムの両方をエクスポートする場合、またはすべてのアイテムを返すコンテンツ検索からインデックス付きアイテムのみをエクスポートする場合は、同じ数のアイテムがダウンロードされます。 これは、コンテンツ検索 (セキュリティ & コンプライアンスセンターの検索統計に表示されます) の予想される検索結果に、部分的にインデックスが作成されたアイテムの数について別の推定結果が含まれる場合でも発生します。 たとえば、すべてのアイテムを含む検索の推定値 (検索クエリにキーワードがありません) は、1000のアイテムが検出され、200の部分的なインデックスが作成されたアイテムも検出されたことを示しているとします。 この例では、検索によってすべてのアイテムが返されるため、1000アイテムには部分的にインデックス付けされたアイテムが含まれます。 つまり、検索によって返されるアイテムの合計は1000であり、1200アイテムではありません (期待したとおり)。 この検索の結果をエクスポートし、インデックスが作成されたアイテムをエクスポートする (または、部分的にインデックスが付けられたアイテムのみをエクスポートする) 場合、1000のアイテムがダウンロードされます。 これは、空の検索クエリを使用してすべてのアイテムを返す場合に、部分的にインデックスが作成されたアイテムが通常の (インデックス付きの) 結果に含まれるためです。 この同じ例では、部分的にインデックスが付けられたアイテムのみをエクスポートするように選択すると、200のインデックスのないアイテムのみがダウンロードされます。

    また、前の例では、エクスポートされた検索結果に含まれている **エクスポートの概要** レポートには、前に説明したものと同じ理由で、エクスポートされた検索結果には1000アイテムの推定アイテムと1000ダウンロードされたアイテムの一覧が表示されることに注意してください。 

- 結果のエクスポート元の検索で、特定のコンテンツの場所または組織内のすべてのコンテンツの場所を検索した場合は、検索条件に一致するアイテムを含むコンテンツの場所からの部分的なアイテムのみがエクスポートされます。 言い換えると、メールボックスまたはサイトで検索結果が見つからない場合、そのメールボックスまたはサイト内の一部のインデックスアイテムはエクスポートされません。 これは、組織内の多くの場所から、部分的にインデックスが作成されたアイテムをエクスポートすると、エクスポートエラーが発生する可能性が高くなり、検索結果のエクスポートとダウンロードにかかる時間が長くなる可能性があるためです。

    検索用のすべてのコンテンツの場所から、部分的にインデックスが作成されたアイテムをエクスポートするには、検索結果をエクスポートするときに、すべてのアイテムを返すように検索を構成し (検索クエリからすべてのキーワードを削除する)、インデックスが作成されたアイテムのみをエクスポートします。

    ![3番目のエクスポートオプションを使用して、インデックスのないアイテムのみをエクスポートする](../media/5d7be338-a0e5-425f-8ba5-92769c24bf75.png)
  
- SharePoint または OneDrive for Business サイトから検索結果をエクスポートする場合、インデックスが作成されていないアイテムをエクスポートできるかどうかは、選択したエクスポートオプションと検索条件に一致するインデックスアイテムが検索されたサイトであるかどうかによって決まります。 たとえば、特定の SharePoint または OneDrive for Business サイトを検索し、検索結果が見つからない場合は、2番目のエクスポートオプションを選択してインデックス付きアイテムとインデックスなしアイテムの両方をエクスポートすると、これらのサイトのインデックスが作成されていないアイテムはエクスポートされません。 サイトからのインデックス付けされたアイテムが検索条件に一致した場合は、インデックスアイテムとインデックスのないアイテムの両方をエクスポートするときに、そのサイトのすべてのインデックスのないアイテムがエクスポートされます。 次の図では、検索条件に一致するインデックス付きアイテムがサイトに含まれているかどうかに基づいたエクスポートオプションについて説明します。

    ![検索条件に一致するインデックス付きアイテムがサイトに含まれているかどうかに基づいて、[エクスポート] オプションを選択します。](../media/94f78786-c6bb-42fb-96b3-7ea3998bcd39.png)

    1. 検索条件に一致するインデックス付きアイテムのみがエクスポートされます。 部分的にインデックスが作成されたアイテムはエクスポートされません。

    2. サイトからインデックス付けされたアイテムが検索条件に一致しない場合、そのサイトからのインデックスが作成されたアイテムはエクスポートされません。 サイトからインデックス付けされたアイテムが検索結果で返された場合、そのサイトの部分的なインデックスアイテムがエクスポートされます。 つまり、検索条件に一致するアイテムを含むサイトから、部分的にインデックスが作成されたアイテムのみがエクスポートされます。

    3. 検索条件に一致するアイテムがサイトに含まれているかどうかにかかわらず、検索に含まれるすべてのサイトのすべてのインデックスアイテムがエクスポートされます。

    部分的にインデックスが作成されたアイテムをエクスポートすることを選択すると、[ **Exchange コンテンツのエクスポート**] で選択したオプションに関係なく、部分的にインデックスが作成されたメールボックスアイテムが別の PST ファイルにエクスポートされます。

- 部分的にインデックス付けされたアイテムの他のプロパティが検索条件に一致したために、部分的にインデックスが作成されたアイテムが検索結果で返される場合、その部分的なインデックスは、通常の検索結果と共にエクスポートされます。 そのため、インデックス付きのアイテムと部分的にインデックスが作成されたアイテムの両方をエクスポートすることを選択した場合 (すべてのアイテムを選択することによって、 **認識できない形式を持つもの、暗号化されている場合、またはその他の理由 export オプションに対してインデックスが** 作成されなかった場合を含む Results.csv) には、 インデックスなしの items.csv レポートには表示されません。
  
### <a name="exporting-individual-messages-or-pst-files"></a>個々のメッセージまたは PST ファイルのエクスポート
  
- メッセージのファイルパス名が Windows の最大文字数制限を超えている場合、ファイルパス名は切り捨てられます。 ただし、元のファイルパス名は、マニフェストと [記録ログ] に一覧表示されます。
  
- 前述のように、電子メール検索結果はファイルシステム内のフォルダーにエクスポートされます。 個々のメッセージのフォルダーパスは、ユーザーのメールボックス内のフォルダーのパスをレプリケートします。 たとえば、"ContosoCase101" という名前の検索では、ユーザーの受信トレイ内のメッセージはフォルダーのパスに配置さ  `~ContosoCase101\\<date of export\Exchange\user@contoso.com (Primary)\Top of Information Store\Inbox` れます。

- 1つのフォルダー内のすべてのメッセージを含む1つの PST ファイルに電子メールメッセージをエクスポートする場合、[ **削除済みアイテム** ] フォルダーと [ **検索フォルダー** ] フォルダーは pst フォルダーの最上位レベルに含まれます。 これらのフォルダーは空になっています。

- 前述したように、メール検索結果を個別のメッセージとしてエクスポートし、RMS で保護されたメッセージをエクスポートするときに暗号化する必要があります。 電子メールの検索結果を PST ファイルとしてエクスポートする場合、暗号化されたメッセージは暗号化されたままになります。
  
### <a name="exporting-results-from-more-than-100000-mailboxes"></a>10万を超えるメールボックスからの結果のエクスポート

- 前述のとおり、セキュリティ & コンプライアンスセンターの PowerShell を使用して、10万を超えるメールボックスから検索結果をダウンロードする必要があります。 これらの検索結果をダウンロードするには、このセクションで次のスクリプトを実行します。 このスクリプトを使用する場合は、既に検索結果をエクスポートしていることを前提としています (エクスポートジョブは、コンテンツ検索ツールの [ **エクスポート** ] タブに表示されます)。これをダウンロードする必要があります。

   ```powershell
   $export=Get-ComplianceSearchAction SEARCHNAME_Export -IncludeCredential;
   $exportUrl=   [System.Uri]::EscapeDataString(($export.Results.Split(";") | ?{$_ -like '*Container url*'} | %{$_.Split(":",2)} | select -last 1).Trim());
   $exportToken=($export.Results.Split(";") | ?{$_ -like '*SAS Token*'} | %{$_.Split(":",2)} | select -last 1).Trim();
   ."$env:ProgramFiles\Internet Explorer\IEXPLORE.EXE" "https://complianceclientsdf.blob.core.windows.net/v16/Microsoft.Office.Client.Discovery.UnifiedExportTool.application?name=$($export.Name)&source=$exportUrl&zip=allow&trace=1";
   $exportToken | clip;
   ```

  スクリプトでは、結果をエクスポートする検索の名前を指定する必要があります。 たとえば、という名前の検索では、 `SearchAllMailboxes` SEARCHNAME_Export をに置き換え `SearchAllMailboxes_Export` ます。

  スクリプトに検索の名前を追加した後、スクリプトテキストをコピーして、 [セキュリティ & コンプライアンスセンターの powershell に接続され](https://docs.microsoft.com/powershell/exchange/connect-to-scc-powershell)た Windows PowerShell ウィンドウに貼り付けることができます。 スクリプトを貼り付けると、電子情報開示エクスポートツールが表示されます (UI を使用して検索結果をダウンロードする場合と同様)。

  ![電子情報開示エクスポートツール](../media/eDiscoveryExportTool.png)

  [キーのエクスポート] ボックスをクリックし、を押して `CTRL + V` export キーを貼り付けます (スクリプトは、エクスポートキーをクリップボードにコピーします)。 [ **参照** ] をクリックして、ファイルをダウンロードする場所を指定し、ダウンロードを開始します。

  前述したように、ディスクの処理量が多い (読み取りおよび書き込み) ため、検索結果をローカルディスクドライブにダウンロードすることをお勧めします。 マップされたネットワークドライブまたは他のネットワークの場所に検索結果をダウンロードしないでください。

### <a name="decrypting-rms-protected-email-messages-and-encrypted-file-attachments"></a>RMS で保護された電子メールメッセージと暗号化された添付ファイルの暗号化の解除

コンテンツ検索の結果に含まれる権利で保護された (RM で保護された) 電子メールメッセージは、エクスポートすると復号化されます。 また、 [Microsoft 暗号化テクノロジ](encryption.md) を使用して暗号化され、検索結果に含まれている電子メールメッセージに添付されているファイルは、エクスポートされたときにも復号化されます。 この暗号化解除機能は、電子情報開示マネージャーの役割グループのメンバーに対して既定で有効になっています。 これは、RMS の暗号化解除管理役割が既定でこの役割グループに割り当てられるためです。 暗号化された電子メールメッセージと添付ファイルをエクスポートする場合は、次の点に注意してください。
  
- 前述したように、RMS で保護されたメッセージをエクスポートするときに暗号化を解除するには、検索結果を個々のメッセージとしてエクスポートする必要があります。 検索結果を PST ファイルにエクスポートすると、RMS で保護されたメッセージは暗号化されたままになります。

- 復号化されたメッセージは、" **出力ログ** " レポートで識別されます。 このレポートには **デコード状態** という名前の列が含まれており、この列で **デコード** された値は、復号化されたメッセージを識別します。

- 検索結果をエクスポートするときに添付ファイルを復号化するだけでなく、検索結果のプレビュー時に復号化されたファイルをプレビューすることもできます。 権限で保護された電子メールメッセージは、エクスポートした後にのみ表示できます。

- 現時点では、検索結果をエクスポートするときの復号化機能に、SharePoint および OneDrive for business サイトの暗号化されたコンテンツが含まれていません。 ただし、Microsoft 暗号化テクノロジを使用して暗号化され、SharePoint Online と OneDrive for business に保存されたドキュメントについては、サポートが近日中に公開されます。

- 他のユーザーが RMS を保護するメッセージと暗号化された添付ファイルを復号できないようにする必要がある場合は、(組み込みの電子情報開示マネージャーの役割グループをコピーして) カスタムの役割グループを作成してから、そのカスタム役割グループから RMS の解読管理の役割を削除する必要があります。 その後、メッセージの暗号化を解除しないユーザーを、カスタム役割グループのメンバーとして追加します。
  
### <a name="filenames-of-exported-items"></a>エクスポートされたアイテムのファイル名
  
- ローカルコンピューターにエクスポートされた電子メールメッセージとサイトドキュメントの完全パス名には、オペレーティングシステムによって適用される260文字の制限があります。 エクスポートされたアイテムの完全なパス名には、検索結果がダウンロードされるローカルコンピューター上のアイテムの元の場所とフォルダーの場所が含まれます。 たとえば、電子情報開示エクスポートツールで検索結果をダウンロードするように指定すると、ダウンロードした  `C:\Users\Admin\Desktop\SearchResults` 電子メールアイテムの完全パス名はになり  `C:\Users\Admin\Desktop\SearchResults\ContentSearch1\03.15.2017-1242PM\Exchange\sarad@contoso.com (Primary)\Top of Information Store\Inbox\Insider trading investigation.msg` ます。

    260文字の制限を超えている場合は、アイテムの完全なパス名が切り捨てられます。

  - 完全なパス名が260文字より長い場合は、ファイル名が短くなり、制限を超えてしまいます。切り捨てられたファイル名 (ファイル拡張子を除く) は8文字未満にならないことに注意してください。

  - ファイル名を短くしても完全なパス名が長い場合は、アイテムは現在の場所から親フォルダーに移動されます。 パス名が長すぎる場合は、次の処理が繰り返されます。ファイル名を短くし、必要に応じて親フォルダーに再度移動します。 この処理は、完全なパス名が260文字の制限を超えない限り繰り返されます。

  - 省略された完全なパス名が既に存在する場合は、ファイル名の末尾にバージョン番号が追加されます。たとえば、のように  `statusmessage(2).msg` なります。

    この問題を軽減するために、短いパス名の場所に検索結果をダウンロードすることを検討してください。たとえば、という名前のフォルダーに検索結果をダウンロードすると、と  `C:\Results` いう名前のフォルダーにダウンロードするよりも、エクスポートされたアイテムのパス名の文字数が少なくなり  `C:\Users\Admin\Desktop\Results` ます。

- サイトドキュメントをエクスポートする場合も、ドキュメントの元のファイル名が変更される可能性があります。 これは特に、保留になっている SharePoint または OneDrive for Business サイトから削除されたドキュメントに対して発生します。 保留中のサイトに含まれるドキュメントが削除されると、削除されたドキュメントは、サイトの保持保持ライブラリ (サイトが保留状態になっているときに作成されたもの) に自動的に移動します。 削除されたドキュメントを保存保持ライブラリに移動すると、ランダムに生成された一意の ID がドキュメントの元のファイル名に追加されます。 たとえば、ドキュメントのファイル名が後に削除されて、保存保持ライブラリに移動された場合、そのドキュメントのファイル名は、保存保持ライブラリに移動されたときの  `FY2017Budget.xlsx` ように変更され  `FY2017Budget_DEAF727D-0478-4A7F-87DE-5487F033C81A2000-07-05T10-37-55.xlsx` ます。 保持保持ライブラリ内のドキュメントがコンテンツ検索のクエリと一致し、その検索の結果をエクスポートすると、エクスポートされたファイルには変更されたファイル名が含まれます。この例では、エクスポートされたドキュメントのファイル名はになり  `FY2017Budget_DEAF727D-0478-4A7F-87DE-5487F033C81A2000-07-05T10-37-55.xlsx` ます。

    保留中のサイト上のドキュメントが変更されると (サイト内のドキュメントライブラリのバージョン管理が有効になっている場合)、ファイルのコピーが自動的に保持保持ライブラリに作成されます。 この場合は、ランダムに生成された一意の ID が、保持保持ライブラリにコピーされるドキュメントのファイル名にも追加されます。

    保存保持ライブラリに移動またはコピーされたドキュメントのファイル名が競合しないようにする理由は、競合しているファイル名を防ぐためです。 サイトおよび保持保持ライブラリに保持を配置することの詳細については、「 [SharePoint Server 2016 のインプレースホールドの概要](https://support.office.com/article/5e400d68-cd51-444a-8fe6-e4df1d20aa95)」を参照してください。

### <a name="miscellaneous"></a>その他
  
- 電子情報開示エクスポートツールを使用して検索結果をダウンロードする場合、次のエラーが表示されることがあります。 `System.Net.WebException: The remote server returned an error: (412) The condition specified using HTTP conditional header(s) is not met.` これは、通常、Azure ストレージの場所で発生する一時的なエラーです。 この問題を解決するには、 [検索結果のダウンロード](#step-2-download-the-search-results)を再試行します。これにより、電子情報開示エクスポートツールが再起動されます。

- すべての検索結果とエクスポート レポートが、コンテンツ検索と同じ名前のフォルダーに含まれています。 エクスポートされたメール メッセージは、**Exchange** という名前のフォルダーにあります。 ドキュメントは、**SharePoint** という名前のフォルダーにあります。

- SharePoint および OneDrive for Business サイトのドキュメントのファイルシステムメタデータは、ドキュメントをローカルコンピューターにエクスポートするときに維持されます。 つまり、作成日や最終更新日などのドキュメントのプロパティは、ドキュメントがエクスポートされる時に変更されません。

- 検索クエリに一致する SharePoint のリストアイテムが検索結果に含まれている場合は、リスト内のすべての行が、検索クエリとリスト内のすべての添付ファイルに一致するアイテムに加えてエクスポートされます。 この動作は、検索結果で返されるリストアイテムのコンテキストを提供するためのものです。 また、追加のリストアイテムと添付ファイルを使用すると、エクスポートされたアイテムのカウントが検索結果の元の推定値と異なる場合があることにも注意してください。
