---
title: コネクタをセットアップして人事データをインポートする
f1.keywords:
- NOCSH
ms.author: markjjo
author: markjjo
manager: laurawi
ms.date: ''
audience: Admin
ms.topic: how-to
ms.service: O365-seccomp
localization_priority: Normal
search.appverid:
- MET150
ms.collection: M365-security-compliance
description: 管理者は、組織の人事 (HR) システムから Microsoft 365 に従業員データをインポートするデータ コネクタを設定できます。 これにより、インサイダー リスク管理ポリシーの人事データを使用して、組織に内部的な脅威を与える可能性のある特定のユーザーによるアクティビティを検出するのに役立ちます。
ms.openlocfilehash: 756851b848822fa801493b2832368ccb2a1a0b51
ms.sourcegitcommit: 6fc6aaa2b7610e148f41018abd229e3c55b2f3d0
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 12/10/2020
ms.locfileid: "49620243"
---
# <a name="set-up-a-connector-to-import-hr-data"></a>コネクタをセットアップして人事データをインポートする

Microsoft 365 コンプライアンス センターでデータ コネクタを設定して、ユーザーの辞退やユーザーの仕事レベルの変更などのイベントに関連する人事 (HR) データをインポートできます。 その後、人事データはインサイダー[](insider-risk-management.md)リスク管理ソリューションによって使用され、組織内のユーザーによる悪意のあるアクティビティやデータ盗難の可能性を特定するのに役立つリスク インジケーターを生成できます。

インサイダー リスク管理ポリシーがリスク インジケーターの生成に使用できる人事データのコネクタの設定は、HR データを含む CSV ファイルの作成、認証に使用される Azure Active Directory でのアプリの作成、Microsoft 365 コンプライアンス センターでの HR データ コネクタの作成、および CSV ファイル内の HR データを Microsoft クラウドに取り込むスクリプト (スケジュールされたベース) の実行で構成されます。リスク管理ソリューション。

## <a name="before-you-begin"></a>はじめに

- Microsoft 365 にインポートする人事のシナリオとデータを決定します。 これは、作成する必要がある CSV ファイルと HR コネクタの数、および CSV ファイルを生成して構造化する方法を決定するのに役立ちます。 インポートする人事データは、実装するインサイダー リスク管理ポリシーによって決まります。 詳細については、手順 1 を参照してください。

- 組織の人事システムから (および定期的に) データを取得またはエクスポートする方法を決定し、手順 1 で作成した CSV ファイルに追加します。 手順 4 で実行したスクリプトは、CSV ファイル内の HR データを Microsoft クラウドにアップロードします。

- 手順 3 で HR コネクタを作成するユーザーには、Exchange Online の "Mailbox Import Export/メールボックスのインポートエクスポート" 役割が割り当てられている必要があります。 既定では、この役割は Exchange Online のどの役割グループにも割り当てられていません。 "Mailbox Import Export/メールボックスのインポートとエクスポート" 役割は、Exchange Online の "Organization Management/組織の管理" 役割グループに追加できます。 または、新しい役割グループを作成し、Mailbox Import Export 役割を割り当て、適切なユーザーをメンバーとして追加できます。 詳細については、「Exchange Online[で役割](https://docs.microsoft.com/Exchange/permissions-exo/role-groups#create-role-groups)グループ[](https://docs.microsoft.com/Exchange/permissions-exo/role-groups#modify-role-groups)を管理する」の「役割グループの作成」または「役割グループの変更」セクションを参照してください。

- 手順 4 で実行するサンプル スクリプトでは、人事データを Microsoft クラウドにアップロードして、インサイダー リスク管理ソリューションで使用できます。 このサンプル スクリプトは、Microsoft 標準のサポート プログラムまたはサービスではサポートされていません。 サンプル スクリプトは、いかなる種類の保証なしに、IS 形式で提供されます。 さらに、Microsoft は、商品性、特定目的への適合性を含む一切の黙示の保証をいたしかねます。 サンプル スクリプトとドキュメントの使用またはパフォーマンスから生じるリスク全体は、引き続きお持ちです。 サンプル スクリプトおよびドキュメントを使用したこと、または使用できなかったことに伴って生じるいかなる損害 (業務利益の損失、業務の中断、業務情報の損失、金銭上の損失、その他一切の損害) についても、Microsoft、Microsoft に帰属する作者、スクリプトの作成、製造、または納入に関与したその他のすべての人員は、いかなる場合も責めを負わないものとします。

## <a name="step-1-prepare-a-csv-file-with-your-hr-data"></a>手順 1: 人事データを含む CSV ファイルを準備する

最初の手順では、コネクタが Microsoft 365 にインポートする HR データを含む CSV ファイルを作成します。 このデータは、潜在的なリスク インジケーターを生成するためにインサイダー リスク ソリューションによって使用されます。 次の人事シナリオのデータは、Microsoft 365 にインポートできます。

- 従業員の辞退。 組織を去ったユーザーに関する情報。

- ジョブ レベルの変更。 昇格や降格など、ユーザーのジョブ レベルの変更に関する情報。

- パフォーマンス レビュー。 ユーザーのパフォーマンスに関する情報。

- パフォーマンス向上計画。 ユーザーのパフォーマンス向上計画に関する情報。

インポートする人事データの種類は、インサイダー リスク管理ポリシーと、実装する対応するポリシー テンプレートによって異なります。 次の表に、各ポリシー テンプレートに必要な HR データ型を示します。

|  ポリシー テンプレート |  HR データ型 |
|:-----------------------------------------------|:---------------------------------------------------------------------|
| 指定されたユーザーによるデータの盗難                   | 従業員の辞退                                                 |
| 一般的なデータ リーク                              | 該当なし                                                        |
| 優先度の高いユーザーによるデータ漏洩                    | 該当なし                                                        |
| 不満を持つユーザーによるデータ漏洩                 | ジョブ レベルの変更、パフォーマンス レビュー、パフォーマンス向上計画 |
| 一般的なセキュリティ ポリシー違反              | 該当なし                                                        |
| 権限を持つユーザーによるセキュリティ ポリシー違反   | 従業員の辞退                                                 |
| 優先度ユーザーによるセキュリティ ポリシー違反    | 該当なし                                                        |
| 不満を持つユーザーによるセキュリティ ポリシー違反 | ジョブ レベルの変更、パフォーマンス レビュー、パフォーマンス向上計画 |
| メールの不快な言葉                     | 該当なし                                                        |

インサイダー リスク管理用のポリシー テンプレートの詳細については、「インサイダー リスク管理 [ポリシー」を参照してください](insider-risk-management-policies.md#policy-templates)。

人事シナリオごとに、対応する人事データを 1 つ以上の CSV ファイルに指定する必要があります。 インサイダー リスク管理の実装に使用する CSV ファイルの数については、このセクションで後で説明します。

必要な人事データを含む CSV ファイルを作成した後、手順 4 でスクリプトを実行したローカル コンピューターに CSV ファイルを保存します。 また、更新戦略を実装して、スクリプトを実行した場合でも最新の人事データが Microsoft クラウドにアップロードされ、インサイダー リスク管理ソリューションからアクセス可能な状態になじむ最新の情報が CSV ファイルに常に含まれる必要があります。

> [!IMPORTANT]
> 以下のセクションで説明する列名は必須パラメーターではなく、例のみです。 CSV ファイルには任意の列名を使用できます。 ただし、CSV ファイルで使用する列名は、手順 3 で HR コネクタを作成するときにデータ型にマップする必要があります。 また、次のセクションのサンプル CSV ファイルは、NotePad ビューに表示されます。 Microsoft Excel で CSV ファイルを表示および編集する方がはるかに簡単です。

以下のセクションでは、人事シナリオごとに必要な CSV データについて説明します。

### <a name="csv-file-for-employee-resignation-data"></a>従業員の辞退データ用の CSV ファイル

従業員の辞退データ用の CSV ファイルの例を次に示します。

```text
EmailAddress,ResignationDate,LastWorkingDate
sarad@contoso.com,2019-04-23T15:18:02.4675041+05:30,2019-04-29T15:18:02.4675041+05:30
pilarp@contoso.com,2019-04-24T09:15:49Z,2019-04-29T15:18:02.7117540
```

次の表では、従業員の辞退データの CSV ファイル内の各列について説明します。

|  列   |   説明 |
|:------------|:----------------|
|**EmailAddress**| 終了したユーザーの電子メール アドレス (UPN) を指定します。|
| **ResignationDate** | ユーザーの雇用が組織で正式に終了した日付を指定します。 たとえば、ユーザーが組織から離れる通知を行った日付を指定できます。 この日付は、その人の仕事の最終日の日付とは異なる場合があります。 次の日付形式を使用します `yyyy-mm-ddThh:mm:ss.nnnnnn+|-hh:mm` [。ISO 8601 の日付と時刻の形式です](https://www.iso.org/iso-8601-date-and-time-format.html)。|
| **LastWorkingDate** | 終了したユーザーの作業の最終日を指定します。 次の日付形式を使用します `yyyy-mm-ddThh:mm:ss.nnnnnn+|-hh:mm` [。ISO 8601 の日付と時刻の形式です](https://www.iso.org/iso-8601-date-and-time-format.html)。|
|||

### <a name="csv-file-for-job-level-changes-data"></a>ジョブ レベル変更データ用の CSV ファイル

ジョブ レベル変更データ用の CSV ファイルの例を次に示します。

```text
EmailAddress,EffectiveDate,OldLevel,NewLevel
sarad@contoso.com,2019-04-23T15:18:02.4675041+05:30,Level 61 – Sr. Manager,Level 60- Manager
pillar@contoso.com,2019-04-23T15:18:02.4675041+05:30,Level 62 – Director,Level 60- Sr. Manager
```

次の表では、ジョブ レベル変更データの CSV ファイル内の各列について説明します。

|  列 | 説明 |
|:--------- |:------------- |
| **EmailAddress**  | ユーザーの電子メール アドレス (UPN) を指定します。|
| **EffectiveDate** | ユーザーのジョブ レベルが正式に変更された日付を指定します。 次の日付形式を使用します `yyyy-mm-ddThh:mm:ss.nnnnnn+|-hh:mm` [。ISO 8601 の日付と時刻の形式です](https://www.iso.org/iso-8601-date-and-time-format.html)。|
| **注釈**| ジョブ レベルの変更に関して評価者が提供した注釈を指定します。 入力できる文字数は 200 文字です。 このパラメーターは省略可です。 CSV ファイルに含める必要はない。|
| **OldLevel**| 変更前のユーザーのジョブ レベルを指定します。 これは自由形式のパラメーターであり、組織の階層的分類を含む可能性があります。 このパラメーターは省略可です。 CSV ファイルに含める必要はない。|
| **NewLevel**| 変更後のユーザーのジョブ レベルを指定します。 これは自由形式のパラメーターであり、組織の階層的分類を含む可能性があります。 このパラメーターは省略可です。 CSV ファイルに含める必要はない。|
|||

### <a name="csv-file-for-performance-review-data"></a>パフォーマンス レビュー データ用の CSV ファイル

パフォーマンス データ用の CSV ファイルの例を次に示します。

```text
EmailAddress,EffectiveDate,Remarks,Rating
sarad@contoso.com,2019-04-23T15:18:02.4675041+05:30,Met expectations but bad attitude,2-Below expectation
pillar@contoso.com,2019-04-23T15:18:02.4675041+05:30, Multiple conflicts with the team
```

次の表では、パフォーマンス レビュー データの CSV ファイル内の各列について説明します。

|  列 | 説明 |
|:----------|:--------------|
| **EmailAddress**  | ユーザーの電子メール アドレス (UPN) を指定します。|
| **EffectiveDate** | パフォーマンス レビューの結果についてユーザーに正式に通知された日付を指定します。 これは、パフォーマンス レビュー サイクルが終了した日付になります。 次の日付形式を使用します `yyyy-mm-ddThh:mm:ss.nnnnnn+|-hh:mm` [。ISO 8601 の日付と時刻の形式です](https://www.iso.org/iso-8601-date-and-time-format.html)。|
| **注釈**| 評価者がパフォーマンス レビューのためにユーザーに提供した注釈を指定します。 これは、200 文字以内のテキスト パラメーターです。 このパラメーターは省略可です。 CSV ファイルに含める必要はない。|
| **評価**| パフォーマンス レビューに提供される評価を指定します。 これはテキスト パラメーターであり、組織が評価を認識するために使用する自由形式のテキストを含めできます。 たとえば、"3 Met expectations"、"2 Below average" などです。 これは、25 文字の制限を持つテキスト パラメーターです。 このパラメーターは省略可です。 CSV ファイルに含める必要はない。|
|||

### <a name="csv-file-for-performance-improvement-plan-data"></a>パフォーマンス向上計画データ用の CSV ファイル

パフォーマンス向上計画データのデータ用の CSV ファイルの例を次に示します。

```text
EmailAddress,EffectiveDate,ImprovementRemarks,PerformanceRating
sarad@contoso.com,2019-04-23T15:18:02.4675041+05:30,Met expectation but bad attitude,2-Below expectation
pillar@contoso.com,2019-04-23T15:18:02.4675041+05:30, Multiple conflicts with the team
```

次の表では、パフォーマンス レビュー データの CSV ファイル内の各列について説明します。

|  列 |  説明 |
|:----------|:---------------|
| **EmailAddress**  | ユーザーの電子メール アドレス (UPN) を指定します。|
| **EffectiveDate** | パフォーマンス向上計画についてユーザーに正式に通知された日付を指定します。 次の日付形式を使用する必要があります `yyyy-mm-ddThh:mm:ss.nnnnnn+|-hh:mm` [。ISO 8601 の日付と時刻の形式です](https://www.iso.org/iso-8601-date-and-time-format.html)。|
| **注釈**| パフォーマンス向上計画に関して評価者が提供した注釈を指定します。 これは、200 文字以内のテキスト パラメーターです。 このパラメーターは省略可能です。 CSV ファイルに含める必要はない。 |
| **評価**| 業績評価に関連する評価または他の情報を指定します。 パフォーマンス向上計画。 これはテキスト パラメーターであり、評価を認識するために組織が使用する自由形式のテキストを含めできます。 たとえば、"3 Met expectations"、"2 Below average" などです。 これは、25 文字以内のテキスト パラメーターです。 このパラメーターは省略可能です。 CSV ファイルに含める必要はない。|
|||

### <a name="determining-how-many-csv-files-to-use-for-hr-data"></a>人事データに使用する CSV ファイルの数を決定する

手順 3 では、人事データ型ごとに個別のコネクタを作成するか、すべてのデータ型に対して単一のコネクタを作成することを選択できます。 1 つの人事シナリオ (前のセクションで説明した CSV ファイルの例など) のデータを含む個別の CSV ファイルを使用できます。 または、2 つ以上の人事シナリオのデータを含む 1 つの CSV ファイルを使用することもできます。 人事データに使用する CSV ファイルの数を決定する際に役立つガイドラインを次に示します。

- 実装するインサイダー リスク管理ポリシーに複数の人事データ型が必要な場合は、必要なすべてのデータ型を含む 1 つの CSV ファイルを使用してください。

- HR データを生成または収集する方法によって、CSV ファイルの数が決めることもできます。 たとえば、HR コネクタの構成に使用されるさまざまな種類の人事データが組織内の 1 つの人事システムにある場合、データを 1 つの CSV ファイルにエクスポートできる場合があります。 ただし、データが異なる人事システムに分散している場合は、別の CSV ファイルにデータをエクスポートする方が簡単な場合があります。 たとえば、従業員の辞職データは、ジョブ レベルまたは業績評価データとは異なる人事システムに入っている場合があります。 この場合、データを 1 つの CSV ファイルに手動で結合するよりも、個別の CSV ファイルを作成する方が簡単な場合があります。 そのため、人事システムからデータを取得またはエクスポートする方法によって、必要な CSV ファイルの数がどのように決定される場合があります。

- 一般に、作成する必要がある HR コネクタの数は、CSV ファイル内のデータ型によって決まります。 たとえば、インサイダー リスク管理の実装をサポートするために必要なすべてのデータ型が CSV ファイルに含まれている場合、必要な HR コネクタは 1 つのみです。 ただし、それぞれ 1 つのデータ型を含む 2 つの個別の CSV ファイルがある場合は、2 つの HR コネクタを作成する必要があります。 例外として **、HRScenario** 列を CSV ファイルに追加する場合 (次のセクションを参照)、異なる CSV ファイルを処理できる 1 つの HR コネクタを構成できます。

### <a name="configuring-a-single-csv-file-for-multiple-hr-data-types"></a>複数の人事データ型用に 1 つの CSV ファイルを構成する

1 つの CSV ファイルに複数の人事データ型を追加できます。 これは、実装するインサイダー リスク管理ソリューションで複数の人事データ型が必要な場合、またはデータ型が組織内の単一の人事システムにある場合に便利です。 CSV ファイルを少なくすると、作成および管理する HR コネクタを常に少なくすることができます。

複数のデータ型を使用して CSV ファイルを構成するための要件を次に示します。

- ヘッダー行の各データ型と対応する列名に必要な列 (および使用する場合は省略可能) を追加する必要があります。 データ型が列に対応しない場合は、値を空白のままにすることができます。

- 複数の種類の HR データを含む CSV ファイルを使用するには、HR コネクタは CSV ファイル内の行に HR データの種類を含む行を知る必要があります。 これを行うには、CSV ファイルに **HRScenario** 列を追加します。 この列の値は、各行の HR データの種類を示します。 たとえば、4 つの人事シナリオに対応する値は、辞退、ジョブ レベルの変更、パフォーマンス レビュー、および \` \` パフォーマンス向上 \` \` \` \` \` 計画です \` 。

- HRScenario** 列を含む複数の CSV ファイルがある場合は、各ファイルで、特定の HR シナリオを識別する同じ列名と同じ値を使用してください。

次の例は **、HRScenario** 列を含む CSV ファイルを示しています。 HRScenario 列の値は、対応する行のデータの種類を示します。

```text
HRScenario,EmailAddress,ResignationDate,LastWorkingDate,EffectiveDate,Remarks,Rating,OldLevel,NewLevel
Resignation,sarad@contoso.com,2019-04-23T15:18:02.4675041+05:30,2019-04-29T15:18:02.4675041+05:30,,,,
Resignation,pilarp@contoso.com,2019-04-24T09:15:49Z,2019-04-29T15:18:02.7117540,,,,
Job level change,sarad@contoso.com,2019-04-23T15:18:02.4675041+05:30,,,,,Level 61 Sr. Manager, Level 60 Manager
Job level change,pillarp@contoso.com,2019-04-23T15:18:02.4675041+05:30,,,,,Level 62 Director,Level 60 Sr Manager
Performance review,sarad@contoso.com,,,2019-04-23T15:18:02.4675041+05:30,Met expectation but bad attitude,2 Below expectations,,
Performance review,pillarp@contoso.com,,,2019-04-23T15:18:02.4675041+05:30, Multiple conflicts with the team,,
Performance improvement plan,sarad@contoso.com,,,2019-04-23T15:18:02.4675041+05:30,Met expectations but bad attitude,2 Below expectations,,
Performance improvement plan,pillarp@contoso.com,,,2019-04-23T15:18:02.4675041+05:30,Multiple conflicts with the team,,
```

> [!NOTE]
> HR データ型を識別する列には任意の名前を使用できます。これは、CSV ファイル内の列の名前を、手順 3 でコネクタを設定するときに HR データ型を識別する列としてマップします。 コネクタを設定するときに、データ型の列に使用する値もマップします。

### <a name="adding-the-hrscenario-column-to-a-csv-file-that-contains-a-single-data-type"></a>1 つのデータ型を含む CSV ファイルに HRScenario 列を追加する

組織の人事システムと、人事データを CSV ファイルにエクスポートする方法に基づいて、1 つの人事データ型を含む複数の CSV ファイルを作成する必要がある場合があります。 この場合でも、1 つの HR コネクタを作成して、異なる CSV ファイルからデータをインポートできます。 これを行うには、CSV ファイルに HRScenario 列を追加し、HR データ型を指定する必要があります。 その後、CSV ファイルごとにスクリプトを実行できますが、コネクタには同じジョブ ID を使用します。 手順 [4 を参照してください](#step-4-run-the-sample-script-to-upload-your-hr-data)。

## <a name="step-2-create-an-app-in-azure-active-directory"></a>手順 2: Azure Active Directory でアプリを作成する

次の手順では、Azure Active Directory (Azure AD) で新しいアプリを作成して登録します。 アプリは、手順 3 で作成した HR コネクタに対応します。 このアプリを作成すると、Azure ADが実行され、組織にアクセスしようとするときに HR コネクタを認証できます。 このアプリは、人事データを Microsoft クラウドにアップロードするために手順 4 で実行したスクリプトを認証するためにも使用されます。 この Azure アプリの作成時AD、次の情報を保存してください。 これらの値は、手順 3 と手順 4 で使用します。

- Azure ADアプリケーション ID (アプリ ID またはクライアント *ID* とも *呼ばれる*)

- Azure AD アプリケーション シークレット (クライアント シークレットとも *呼ばれる*)

- テナント ID (ディレクトリ *ID とも呼ばれる*)

Azure AD でアプリを作成するための詳しい手順については、「Microsoft ID プラットフォームにアプリケーションを登録する」を [参照してください](https://docs.microsoft.com/azure/active-directory/develop/quickstart-register-app)。

## <a name="step-3-create-the-hr-connector"></a>手順 3: HR コネクタを作成する

次の手順では、Microsoft 365 コンプライアンス センターで HR コネクタを作成します。 手順 4 でスクリプトを実行すると、作成する HR コネクタが CSV ファイルから Microsoft 365 組織に HR データを取り込みます。 コネクタを作成する前に、HR シナリオの一覧と各シナリオに対応する CSV 列名を用意してください。 コネクタを構成する際には、各シナリオに必要なデータを CSV ファイルの実際の列名にマップする必要があります。 または、コネクタを構成するときにサンプル CSV ファイルをアップロードすることもできます。ウィザードを使用すると、列の名前を必要なデータ型にマップできます。

この手順を完了したら、コネクタの作成時に生成されるジョブ ID をコピーしてください。 スクリプトを実行するときにジョブ ID を使用します。

1. 左側の [https://compliance.microsoft.com](https://compliance.microsoft.com/) ナビゲーションの [ **データ コネクタ]** に移動してクリックします。

2. [人事管理 **] の [データ コネクタ]** ページ **で**、[表示] を **クリックします**。

3. **[HR カスタム] ページで**、[コネクタの追加]**をクリックします**。

4. [接続 **のセットアップ] ページで** 、次の操作を行い、[次へ] をクリック **します**。

   1. 手順 2 で作成AD Azure アプリの Azure アプリケーション ID を入力するか、貼り付けます。

   1. HR コネクタの名前を入力します。

5. [人事シナリオ] ページで、データをインポートする 1 つ以上の人事シナリオを選択し、[次へ] をクリック **します**。

6. [ファイル マッピング方法] ページで、次のいずれかのオプションを選択し、[次へ] をクリック **します**。

   - **サンプル ファイルをアップロードします**。 このオプションを選択した場合は、[サンプル **ファイルの** アップロード] をクリックして、手順 1 で準備した CSV ファイルをアップロードします。 このオプションを使用すると、CSV ファイル内の列名をドロップダウン リストからすばやく選択し、以前に選択した HR シナリオのデータ型にマップできます。

   OR

   - **マッピングの詳細を手動で指定します**。 このオプションを選択した場合は、CSV ファイルに列の名前を入力して、以前に選択した人事シナリオのデータ型にマップする必要があります。

7. [ファイル マッピングの詳細] ページで、サンプル CSV ファイルをアップロードしたかどうか、および 1 つの HR シナリオ用にコネクタを構成するか、複数のシナリオに対してコネクタを構成するかに応じて、次のいずれかを実行します。 サンプル ファイルをアップロードした場合は、列名を入力する必要があります。 ドロップダウン リストから選択します。

    - 前の手順で 1 つの人事シナリオを選択した場合は、手順 1 で作成した CSV ファイルの列ヘッダー名 (パラメーターとも呼 *ばれる)* を適切な各ボックスに入力します。 入力する列名では大文字と小文字が区別されませんが、CSV ファイルの列名にスペースが含まれている場合は、スペースを含める必要があります。 前に説明したように、これらのボックスに入力する名前は、CSV ファイルのパラメーター名と一致する必要があります。 たとえば、次のスクリーンショットは、手順 1 に示す従業員の辞退 HR シナリオのサンプル CSV ファイルのパラメーター名を示しています。

    - 上記の手順で複数のデータ型を選択した場合は、CSV ファイル内の HR データ型を識別する識別子列名を入力する必要があります。 識別子の列名を入力した後、この HR データ型を識別する値を入力し、手順 1 で作成した CSV ファイルから選択したデータ型の列ヘッダー名を、選択した各データ型の該当するボックスに入力します。 前に説明したように、これらのボックスに入力する名前は、CSV ファイル内の列名と一致する必要があります。

8. [確認 **] ページ** で設定を確認し、[完了] をクリック **して** コネクタを作成します。

   コネクタが作成されたのを確認するステータス ページが表示されます。 このページには、人事データをアップロードするサンプル スクリプトを実行する次の手順を完了するために必要な 2 つの重要な点が含されています。

   ![ジョブ ID を含むページを確認し、サンプル スクリプト用の github へのリンク](../media/HRConnector_Confirmation.png)

   1. **ジョブ ID。** このジョブ ID は、次の手順でスクリプトを実行するために必要です。 このページまたはコネクタ のフライアウト ページからコピーできます。

   1. **サンプル スクリプトへのリンク。** このリンク **をクリック** して GitHub サイトに移動し、サンプル スクリプトにアクセスします (リンクによって新しいウィンドウが開きます)。 手順 4 でスクリプトをコピーできるよう、このウィンドウを開いた状態に保ちます。 または、スクリプトの実行時に再度アクセスできるよう、コピー先をブックマークしたり、URL をコピーしたりすることもできます。 このリンクは、コネクタのフライアウト ページでも使用できます。

9. **[完了]** をクリックします。

   新しいコネクタが [コネクタ] タブの一覧 **に表示** されます。

10. 作成した HR コネクタをクリックして、コネクタに関するプロパティと他の情報を含むフライアウト ページを表示します。

   ![新しい HR コネクタのフライアウト ページ](../media/HRConnectorWizard7.png)

まだ行っていない場合は **、Azure** アプリ ID とコネクタ ジョブ ID の値 **をコピーできます**。 次の手順でスクリプトを実行するには、これらが必要です。 また、このスクリプトは、フライアウト ページからダウンロードすることもできます (または、次の手順のリンクを使用してダウンロードすることもできます)。

[編集] を **クリック** して、[ファイル マッピング] ページで定義した Azure アプリ ID または列ヘッダー名 **を変更** することもできます。

## <a name="step-4-run-the-sample-script-to-upload-your-hr-data"></a>手順 4: サンプル スクリプトを実行して人事データをアップロードする

HR コネクタを設定する最後の手順は、CSV ファイル (手順 1 で作成した) 内の HR データを Microsoft クラウドにアップロードするサンプル スクリプトを実行することです。 具体的には、スクリプトはデータを HR コネクタにアップロードします。 スクリプトを実行した後、手順 3 で作成した HR コネクタは人事データを Microsoft 365 組織にインポートし、そこで Insider リスク管理ソリューションなどの他のコンプライアンス ツールからアクセスできます。 スクリプトを実行した後、タスクをスケジュールして毎日自動的に実行し、最新の従業員終了データが Microsoft クラウドにアップロードされるのを検討します。 「スクリプト [が自動的に実行されるスケジュールを設定する」を参照してください](#optional-step-6-schedule-the-script-to-run-automatically)。

1. 前の手順で開いたウィンドウに移動し、サンプル スクリプトを使用して GitHub サイトにアクセスします。 または、ブックマークされたサイトを開くか、コピーした URL を使用します。

2. **[Raw] ボタンを** クリックすると、スクリプトがテキスト ビューに表示されます。

3. サンプル スクリプト内のすべての行をコピーし、テキスト ファイルに保存します。

4. 必要に応じて、組織のサンプル スクリプトを変更します。

5. ファイル名のサフィックスを使用Windows PowerShellスクリプト ファイルとしてテキスト ファイルを保存します。 `.ps1` `HRConnector.ps1`

6. ローカル コンピューターでコマンド プロンプトを開き、スクリプトを保存したディレクトリに移動します。

7. 次のコマンドを実行して、CSV ファイル内の HR データを Microsoft クラウドにアップロードします。例えば：

    ```powershell
    .\HRConnector.ps1 -tenantId <tenantId> -appId <appId>  -appSecret <appSecret>  -jobId <jobId>  -csvFilePath '<csvFilePath>'
    ```

   次の表では、このスクリプトで使用するパラメーターと、必要な値について説明します。 前の手順で取得した情報は、これらのパラメーターの値で使用されます。

   | パラメーター | 説明 |
   |:-----|:-----|:-----|
   |`tenantId`|これは、手順 2 で取得した Microsoft 365 組織の ID です。 Azure AD 管理センターの [概要]ブレードで、組織のテナント ID を取得することもできます。 これは、組織を識別するために使用されます。|
   |`appId` |これは、手順 2 で Azure AD作成したアプリの Azure AD ID です。 これは、スクリプトが Microsoft 365 組織にアクセスAD認証のために Azure AD によって使用されます。 | 
   |`appSecret`|これは、手順 2 で Azure AD作成したアプリの Azure AD アプリケーション シークレットです。 これは認証にも使用されます。|
   |`jobId`|これは、手順 3 で作成した HR コネクタのジョブ ID です。 これは、Microsoft クラウドにアップロードされた人事データを HR コネクタに関連付けるのに使用されます。|
   |`csvFilePath`|これは、手順 1 で作成した CSV ファイルのファイル パスです (スクリプトと同じシステムに保存されます)。 ファイル パスにスペースを入れることはできません。それ以外の場合は、単一引用符を使用します。|
   |||

   各パラメーターの実際の値を使用する HR コネクタ スクリプトの構文の例を次に示します。

   ```powershell
    .\HRConnector.ps1 -tenantId d5723623-11cf-4e2e-b5a5-01d1506273g9 -appId 29ee526e-f9a7-4e98-a682-67f41bfd643e -appSecret MNubVGbcQDkGCnn -jobId b8be4a7d-e338-43eb-a69e-c513cd458eba -csvFilePath 'C:\Users\contosoadmin\Desktop\Data\employee_termination_data.csv'
    ```

   アップロードが成功した場合、スクリプトは [成功したアップロード] **メッセージを表示** します。

   > [!NOTE]
   > 実行ポリシーのために上記のコマンドの実行に問題がある場合は、実行ポリシーの[](https://docs.microsoft.com/powershell/module/microsoft.powershell.core/about/about_execution_policies)設定に関するガイダンスについては、「実行ポリシーについて」および[「Set-ExecutionPolicy」](https://docs.microsoft.com/powershell/module/microsoft.powershell.security/set-executionpolicy)を参照してください。

## <a name="step-5-monitor-the-hr-connector"></a>手順 5: HR コネクタを監視する

HR コネクタを作成し、スクリプトを実行して人事データをアップロードした後、Microsoft 365 コンプライアンス センターでコネクタを表示し、状態をアップロードできます。 スクリプトが定期的に自動的に実行されるスケジュールを設定すると、スクリプトが最後に実行された後の現在の状態を表示することもできます。

1. 左側の [https://compliance.microsoft.com](https://compliance.microsoft.com) ナビゲーションの **[データ コネクタ]** に移動してクリックします。

2. [ **コネクタ] タブを** クリックし、HR コネクタを選択して、フライアウト ページを表示します。 このページには、コネクタに関するプロパティと情報が含まれる。

   ![プロパティと状態を含む HR コネクタ のフライアウト ページ](../media/HRConnectorFlyout1.png)

3. [ **進行状況]** で、[ **ログのダウンロード** ] リンクをクリックして、コネクタの状態ログを開く (または保存する) 必要があります。 このログには、スクリプトが実行され、CSV ファイルから Microsoft クラウドにデータがアップロードされるたびに関する情報が含まれます。 

   ![HR コネクタ ログ ファイルには、アップロードされた CSV ファイルの行番号が表示されます。](../media/HRConnectorLogFile.png)

   フィールド `RecordsSaved` は、アップロードされた CSV ファイル内の行数を示します。 たとえば、CSV ファイルに 4 行が含まれる場合、スクリプトが CSV ファイル内のすべての行を正常にアップロードした場合、フィールドの値は `RecordsSaved` 4 になります。

手順 4 でスクリプトを実行していない場合は、スクリプトをダウンロードするリンクが [最後のインポート] の下 **に表示されます**。 スクリプトをダウンロードし、手順に従ってスクリプトを実行できます。

## <a name="optional-step-6-schedule-the-script-to-run-automatically"></a>(省略可能)手順 6: スクリプトが自動的に実行されるスケジュールを設定する

インサイダー リスク管理ソリューションなどのツールで組織の最新の人事データを確実に利用するには、スクリプトを 1 日に 1 回など定期的に自動的に実行するようにスケジュールすることをお勧めします。 また、CSV ファイル内の人事データを同様の (同じではない場合) スケジュールで更新し、組織を離れる従業員に関する最新情報が含まれる必要があります。 目標は、HR コネクタがインサイダー リスク管理ソリューションで使用できるよう、最新の人事データをアップロードすることです。

Windows のタスク スケジューラ アプリを使用して、スクリプトを毎日自動的に実行できます。

1. ローカル コンピューターで、[Windows スタート] ボタンを **クリックし** 、「タスク スケジューラ」 **と入力します**。

2. タスク スケジューラ **アプリをクリック** して開きます。

3. [操作 **] セクションで** 、[タスクの作成] **をクリックします**。

4. [全般 **] タブ** で、スケジュールされたタスクのわかりやすい名前を入力します。たとえば **、HR Connector スクリプトです**。 オプションの説明を追加できます。

5. [ **セキュリティ オプション] で**、次の操作を行います。

   1. コンピューターにログオンしている場合にのみスクリプトを実行するか、ログオン時に実行するかしないかを決定します。

   1. [最高特権で **実行] チェック ボックス** がオンになっていることを確認します。

6. [トリガー **] タブを選択** し、[新規] **をクリック** して、次の操作を行います。

   1. [ **設定]** で [日] **オプションを** 選択し、スクリプトを初めて実行する日時を選択します。 スクリプトは毎日同じ指定時刻に実行されます。

   1. [ **詳細設定] で**、[有効] **チェック ボックス** がオンになっていることを確認します。

   1. [**OK**] をクリックします。

7. [操作 **] タブを** 選択し、[新規] **をクリックして**、次の操作を行います。

   ![HR コネクタ スクリプト用の新しいスケジュールされたタスクを作成するアクション設定](../media/HRConnectorScheduleTask1.png)

   1. [操作 **] ドロップダウン** リストで、[プログラムの開始 **] が** 選択されている必要があります。

   1. [プログラム **/スクリプト**] ボックスで[参照] をクリックし、次の場所に移動して選択すると、パスがボックスに表示されます `C:\Windows\System32\WindowsPowerShell\v1.0\powershell.exe` 。

   1. [引数 **の追加 ] (オプション)** ボックスに、手順 4 で実行したのと同じスクリプト コマンドを貼り付けます。 たとえば、`.\HRConnector.ps1 -tenantId "d5723623-11cf-4e2e-b5a5-01d1506273g9" -appId "c12823b7-b55a-4989-faba-02de41bb97c3" -appSecret "MNubVGbcQDkGCnn"  -jobId "e081f4f4-3831-48d6-7bb3-fcfab1581458" -csvFilePath "C:\Users\contosoadmin\Desktop\Data\employee_termination_data.csv"` のように指定します。

   1. [開始 **位置] (オプション)** ボックスに、手順 4 で実行したスクリプトのフォルダーの場所を貼り付けます。 たとえば、`C:\Users\contosoadmin\Desktop\Scripts` などです。

   1. **[OK] を** クリックして、新しいアクションの設定を保存します。

8. [タスクの **作成] ウィンドウで****、[OK]** をクリックしてスケジュールされたタスクを保存します。 ユーザー アカウントの資格情報の入力を求めるメッセージが表示される場合があります。

   新しいタスクがタスク スケジューラ ライブラリに表示されます。

   ![新しいタスクがタスク スケジューラ ライブラリに表示されます。](../media/HRConnectorTaskSchedulerLibrary.png)

   スクリプトが最後に実行された時刻と、次回実行がスケジュールされた時刻が表示されます。 タスクをダブルクリックして編集できます。

   コンプライアンス センターの対応する HR コネクタのフライアウト ページでスクリプトが最後に実行された時刻を確認することもできます。

## <a name="existing-hr-connectors"></a>既存の HR コネクタ

2020 年 7 月 20 日に、HR コネクタでサポートされる追加のシナリオがリリースされました。 これらは、この記事で前に説明した人事シナリオです。 この日付より前に作成された人事コネクタは、従業員の辞退シナリオのみをサポートします。 2020 年 7 月 20 日より前に HR コネクタを作成した場合は、人事データを Microsoft クラウドに引き続き移行するために、HR コネクタが移行されました。 この機能を維持するために何もする必要はありません。 中断することなくコネクタを使用し続けできます。

追加の人事シナリオを実装する場合は、新しい人事コネクタを作成し、リリースされた追加の人事シナリオ用に構成してください。 また、追加の人事シナリオをサポートするために、データを含む 1 つ以上の新しい CSV ファイルを作成する必要があります。 新しい HR コネクタを作成した後、新しいコネクタのジョブ ID と CSV ファイルを使用してスクリプトを実行し、追加の HR シナリオのデータを使用します。
