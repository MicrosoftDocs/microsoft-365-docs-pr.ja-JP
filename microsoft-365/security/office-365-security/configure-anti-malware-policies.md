---
title: マルウェア対策ポリシーを構成する
f1.keywords:
- NOCSH
ms.author: chrisda
author: chrisda
manager: dansimp
ms.date: ''
audience: ITPro
ms.topic: how-to
localization_priority: Normal
search.appverid:
- MET150
ms.assetid: b0cfc21f-e3c6-41b6-8670-feb2b2e252e5
ms.collection:
- M365-security-compliance
- m365initiative-defender-office365
description: 管理者は、マルウェア対策ポリシー (EOP) の表示、作成、変更、および削除Exchange Online Protectionできます。
ms.custom: seo-marvel-apr2020
ms.technology: mdo
ms.prod: m365-security
ms.openlocfilehash: 29e5599dcf13ecba44390de687fdf1f1701e31bc
ms.sourcegitcommit: a6fb731fdf726d7d9fe4232cf69510013f2b54ce
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 05/27/2021
ms.locfileid: "52683717"
---
# <a name="configure-anti-malware-policies-in-eop"></a>EOP でマルウェア対策ポリシーを構成する

[!INCLUDE [Microsoft 365 Defender rebranding](../includes/microsoft-defender-for-office.md)]

**適用対象**
- [Exchange Online Protection](exchange-online-protection-overview.md)
- [Microsoft Defender for Office 365 プラン 1 およびプラン 2](defender-for-office-365.md)
- [Microsoft 365 Defender](../defender/microsoft-365-defender.md)

Microsoft 365 Exchange Online またはスタンドアロン Exchange Online Protection (EOP) 組織に Exchange Online メールボックスがない組織では、電子メール メッセージは EOP によってマルウェアから自動的に保護されます。 EOP はマルウェア保護設定にマルウェア対策ポリシーを使用します。 詳細については、「マルウェア対策 [保護」を参照してください](anti-malware-protection.md)。

管理者は、組織のニーズを満たす既定のマルウェア対策ポリシーを表示、編集、および構成できます (ただし、削除はされません)。 さらに細分化するために、組織内の特定のユーザー、グループ、またはドメインに適用されるカスタムマルウェア対策ポリシーを作成することもできます。 カスタム ポリシーは既定のポリシーより常に優先されますが、カスタム ポリシーの優先度 (実行順序) を変更できます。

マルウェア対策ポリシーは、Microsoft 365 セキュリティ センターまたは PowerShell (Exchange Online のメールボックスを持つ Microsoft 365 組織の Exchange Online PowerShell、Exchange Online メールボックスのない組織のスタンドアロン EOP PowerShell) で構成できます。

## <a name="what-do-you-need-to-know-before-you-begin"></a>はじめに把握しておくべき情報

- セキュリティ センターを開きます <https://security.microsoft.com/> 。 マルウェア対策ページに直接移動 **するには、 を** 使用します <https://security.microsoft.com/antimalwarev2> 。

- Exchange Online PowerShell へ接続するには、「[Exchange Online PowerShell に接続する](/powershell/exchange/connect-to-exchange-online-powershell)」を参照してください。 スタンドアロンの EOP PowerShell に接続するには、「[Exchange Online Protection PowerShell への接続](/powershell/exchange/connect-to-exchange-online-protection-powershell)」を参照してください。

- この記事の手順を実行する際には、あらかじめ **Exchange Online** でアクセス許可を割り当てる必要があります。
  - マルウェア対策ポリシーを追加、変更、および削除するには、組織の管理またはセキュリティ管理者の役割グループの **メンバーである** 必要があります。
  - マルウェア対策ポリシーへの読み取り専用アクセスでは、グローバル リーダーまたはセキュリティ リーダーの役割グループ **のメンバーである** 必要があります。

  詳細については、「[Exchange Online のアクセス許可](/exchange/permissions-exo/permissions-exo)」を参照してください。

  **注**:

  - Microsoft 365 管理センターで、対応する Azure Active Directory の役割にユーザーを追加すると、ユーザーには、必要なアクセス許可 _および_ Microsoft 365 のその他の機能に必要なアクセス許可が付与されます。 詳細については、「[管理者の役割について](../../admin/add-users/about-admin-roles.md)」を参照してください。
  - [Exchange Online](/Exchange/permissions-exo/permissions-exo#role-groups) の **閲覧専用の組織管理** の役割グループが この機能への読み取り専用アクセス権も付与します。

- マルウェア対策ポリシーの推奨設定については [、「EOP マルウェア対策ポリシー設定」を参照してください](recommended-settings-for-eop-and-office365.md#eop-anti-malware-policy-settings)。

## <a name="use-the-security-center-to-create-anti-malware-policies"></a>セキュリティ センターを使用してマルウェア対策ポリシーを作成する

セキュリティ センターにカスタムマルウェア対策ポリシーを作成すると、両方に同じ名前を使用して、マルウェア フィルター ルールと関連付けられたマルウェア フィルター ポリシーが同時に作成されます。

1. セキュリティ センターで、[メール &**グループ**&ルールの脅威ポリシーのマルウェア対策] に移動し、[作成] アイコン [作成] \>  \>  \>  ![ を ](../../media/m365-cc-sc-create-icon.png) **クリックします**。

2. ポリシー ウィザードが開きます。 [ポリシーに **名前を付け] ページで**、次の設定を構成します。
   - **[名前]**: わかりやすい一意のポリシー名を入力します。
   - **[説明]**: ポリシーについての説明を入力します (オプション)。

   完了したら、**[次へ]** をクリックします。

3. 表示される **[ユーザーとドメイン] ページ** で、ポリシーが適用される内部受信者 (受信者の条件) を特定します。
   - **ユーザー**: 組織内の指定されたメールボックス、メール ユーザー、またはメール連絡先。
   - **グループ**: 指定された配布グループ、メールが有効なセキュリティ グループ、Microsoft 365グループ。
   - **ドメイン**: 組織内の指定された受け入 [れドメイン内のすべての](/exchange/mail-flow-best-practices/manage-accepted-domains/manage-accepted-domains) 受信者。

   適切なボックスをクリックし、値の入力を開始し、結果から目的の値を選択します。 必要な回数だけこの処理を繰り返します。 既存の値を削除するには、[削除] をクリックします。 ![[削除] アイコン](../../media/m365-cc-sc-remove-selection-icon.png) 値の横に表示されます。

   ユーザーまたはグループの場合、ほとんどの識別子 (名前、表示名、エイリアス、電子メール アドレス、アカウント名など) を使用できますが、対応する表示名が結果に表示されます。 ユーザーの場合は、アスタリスク ( \* ) を入力して、使用可能なすべての値を表示します。

   同じ条件内の複数の値は、OR ロジック (たとえば、または) を _\<recipient1\>_ 使用します _\<recipient2\>_ 。 条件が異なる場合は、AND ロジック (たとえば、および _\<recipient1\>_ ) を使用 _\<member of group 1\>_ します。

   - **これらのユーザー、グループ**、およびドメインを除外する : ポリシーが適用される内部受信者に例外を追加するには (recpient 例外)、このオプションを選択し、例外を構成します。 設定と動作は、条件とまったく同じです。

   完了したら、**[次へ]** をクリックします。

4. 表示される **[保護の設定** ] ページで、次の設定を構成します。

   - **共通の添付ファイル フィルターを有効** にする: このオプションを選択すると、指定された添付ファイルを持つメッセージはマルウェアとして扱われます。自動的に検疫されます。 [ファイルの種類のカスタマイズ] を選択すると、既定の **一覧を変更できます**。

   - **マルウェアに対して 0 時間自動削除** を有効にする : このオプションを選択すると、ZAP は既に配信されているマルウェア メッセージを検疫します。 詳細については、「ゼロ時間自動削除[(ZAP)」を参照Exchange Online。](zero-hour-auto-purge.md) 次のいずれかの値を選択します。

   - **メッセージがマルウェアとして検疫された場合、受信者に通知します**。
     - このオプションを選択すると、メッセージは検疫されます。目的の受信者には通知されません。
     - このオプションを選択しない場合、メッセージは検疫されます。 メッセージのコピーが受信者に配信されますが、すべての添付ファイル(検出された添付ファイルだけでなく) は、Malware Alert Text.txtという名前の単一のテキスト **ファイルに置き換Text.txt。**

       置換テキスト ファイルの既定のテキストについては、「マルウェア対策ポリシー [」を参照してください](anti-malware-protection.md#anti-malware-policies)。 代わりにカスタム テキストを使用するには、[受信者へのカスタム通知テキスト **] ボックスにテキストを入力** します。

   - **送信者の通知**: 次のオプションのいずれも選択しない、1 つ、または両方を選択します。
       - **メッセージがマルウェアとして検疫された** 場合に内部送信者に通知する : 内部送信者が組織内にある。
       - **メッセージがマルウェアとして検疫された場合** に外部の送信者に通知する: 外部送信者が組織の外部にいます。

   - **管理者の通知**: 次のオプションを選択しない、1 つ、または両方のオプションを選択します。
       - **内部送信者からの** 未配信メッセージについて管理者に通知する : このオプションを選択した場合は、表示される [管理者の電子メール アドレス] ボックスに通知メール アドレスを入力します。
       - **外部送信者からの** 配信不能メッセージについて管理者に通知する : このオプションを選択した場合は、表示される [管理者の電子メール アドレス] ボックスに通知メール アドレスを入力します。

   - **通知のカスタマイズ**: これらの設定は、送信者または管理者に使用される既定の通知テキストを置き換える設定です。 既定値の詳細については、「マルウェア対策ポリシー [」を参照してください](anti-malware-protection.md#anti-malware-policies)。
       - **カスタマイズした通知** テキストを使用する: このオプションを選択する場合は、[差出人名] ボックスと [差出人アドレス] ボックスを使用して、カスタマイズされた通知メッセージで使用される送信者の名前と電子メール アドレスを指定する必要があります。
       - **内部送信者** からのメッセージの通知をカスタマイズする : 内部送信者からの配信不能メッセージについて送信者または管理者に通知することを選択した場合は、[件名] ボックスと[メッセージ] ボックスを使用して、カスタム通知メッセージの件名とメッセージ本文を指定する必要があります。
       - **外部** 送信者からのメッセージの通知をカスタマイズする : 外部送信者からの配信不能メッセージについて送信者または管理者に通知することを選択した場合は、[件名] ボックスと[メッセージ] ボックスを使用して、カスタム通知メッセージの件名とメッセージ本文を指定する必要があります。

   完了したら、**[次へ]** をクリックします。

5. 表示される **[確認** ] ページで、設定を確認します。 各セクションで **[編集]** を選択して、セクション内の設定を変更できます。

   完了したら、[送信] を **クリックします**。

6. 表示される確認ページで、[完了] を **クリックします**。

## <a name="use-the-security-center-to-view-anti-malware-policies"></a>セキュリティ センターを使用してマルウェア対策ポリシーを表示する

1. セキュリティ センターで、[メール] [グループ&**ルール**&マルウェア対策ポリシー] \>  \>  \> **に移動します**。

   次のプロパティがページに表示されます。

   - **名前**
   - **状態**
   - **[優先度]**

2. ポリシーを選択すると、ポリシー設定がフライアウトに表示されます。

## <a name="use-the-security-center-to-modify-anti-malware-policies"></a>セキュリティ センターを使用してマルウェア対策ポリシーを変更する

1. セキュリティ センターで、[メール] [グループ&**ルール**&マルウェア対策ポリシー] \>  \>  \> **に移動します**。

2. ポリシーの名前をクリックして、一覧からポリシーを選択します。 表示されるポリシーの詳細フライアウトで、各セクションで **[編集** ] を選択して、セクション内の設定を変更します。 設定の詳細については、この記事の「セキュリティ センターを使用してマルウェア [対策](#use-the-security-center-to-create-anti-malware-policies) ポリシーを作成する」セクションを参照してください。  

   **注**: 既定のポリシーの名前を変更できない。

## <a name="use-the-security-center-to-enable-or-disable-anti-malware-policies"></a>セキュリティ センターを使用してマルウェア対策ポリシーを有効または無効にする

既定のマルウェア対策ポリシーを無効にできない。

1. セキュリティ センターで、[メール] [グループ&**ルール**&マルウェア対策ポリシー] \>  \>  \> **に移動します**。

2. ポリシーの名前をクリックして、リストからカスタム ポリシーを選択します。 表示されるポリシー詳細のフライアウトの上部に、次のいずれかの値が表示されます。
   - **ポリシーをオフ** にする: ポリシーを有効にする場合は、[オンにする] ![ アイコン [オンにする] ](../../media/m365-cc-sc-turn-on-off-icon.png) **をクリックします** 。
   - **ポリシーをオン** にする : ポリシーをオフにする場合は、[オフにする] ![ アイコン [オフにする ](../../media/m365-cc-sc-turn-on-off-icon.png) **] をクリックします**。

3. 表示される確認ダイアログで、[有効にする] または [ **オフ** にする] **をクリックします**。

4. ポリシーの **詳細フライ** アウトで [閉じる] をクリックします。

メイン ポリシー ページに戻り、[ **状態]** の値は [オン] または **[オフ]** **になります**。

## <a name="use-the-security-center-to-set-the-priority-of-custom-anti-malware-policies"></a>セキュリティ センターを使用してカスタムマルウェア対策ポリシーの優先度を設定する

既定では、マルウェア対策ポリシーには、作成された順序に基づく優先度が与えられる (新しいポリシーは、以前のポリシーよりも優先度が低くなります)。 優先度番号が小さいほど、ポリシーの優先度が高くなる (0 が最優先) ことを意味し、ポリシーは優先順位に従って処理されます (優先度の高いポリシーは、優先度の低いポリシーよりも先に処理されます)。 2つのポリシーが同じ優先順位を持つことはできません。最初のポリシーが適用されると、ポリシーの処理は停止します。

ポリシーの優先度を変更するには、ポリシーのプロパティで [優先度の引き上げ] または [優先度の下げ]をクリックします (セキュリティ & コンプライアンス センターで優先度番号を直接変更することはできません)。  ポリシーの優先度を変更すると、複数のポリシーがある場合にのみ有効です。

 **注**:

- セキュリティ センターでは、マルウェア対策ポリシーを作成した後にのみ、ポリシーの優先度を変更できます。 PowerShell では、マルウェア フィルター ルールを作成するときに既定の優先度を上書きできます (既存のルールの優先度に影響を与える可能性があります)。
- マルウェア対策ポリシーは、表示順に処理されます (最初のポリシーの **優先度** は 0 です)。 Default という名前の既定のマルウェア対策ポリシーには、優先度の **低い値** が設定され、変更できない。

1. セキュリティ センターで、[メール] [グループ&**ルール**&マルウェア対策ポリシー] \>  \>  \> **に移動します**。

2. ポリシーの名前をクリックして、リストからカスタム ポリシーを選択します。 表示されるポリシー詳細のフライアウトの上部に、現在の優先度の値とカスタム ポリシーの数に基づいて、[優先度の増加] または [優先度の下げ] が表示されます。
   - 優先度の値が **0** のマルウェア対策ポリシーには、[優先度の低下]**オプションしか** 使用できません。 
   - 優先度の値が最も低いマルウェア対策ポリシー (**たとえば、3)** には、[優先度の引き上げ]**オプション** しか使用できません。
   - 3 つ以上のマルウェア対策ポリシーがある場合、優先度の高い値と最も低い優先度の値の間のポリシーには、[優先度の引き上げ] オプションと [優先度の下 **げ]** の両方 **のオプションがあります** 。

3. [優先度 ![ の増加] アイコン ](../../media/m365-cc-sc-increase-icon.png) **[優先度の引** き上げ] または [優先度の下げ] アイコン [優先度を下げ] をクリックして、優先度 ![ ](../../media/m365-cc-sc-decrease-icon.png) の値 **を変更** します。

4. 完了したら、ポリシーの詳細のフライアウト **で** [閉じる] をクリックします。

## <a name="use-the-security-center-to-remove-anti-malware-policies"></a>セキュリティ センターを使用してマルウェア対策ポリシーを削除する

セキュリティ センターを使用してマルウェア対策ポリシーを削除すると、マルウェア フィルター ルールと対応するマルウェア フィルター ポリシーの両方が削除されます。

1. セキュリティ センターで、[メール] [グループ&**ルール**&マルウェア対策ポリシー] \>  \>  \> **に移動します**。

2. ポリシーの名前をクリックして、リストからカスタム ポリシーを選択します。 表示されるポリシーの詳細フライアウトの上部にある [その他のアクション] アイコン [その他のアクション] [ポリシーの削除] ![ ](../../media/m365-cc-sc-more-actions-icon.png)  \> ![ アイコン ](../../media/m365-cc-sc-delete-icon.png) **[ポリシーの削除] をクリックします**。

3. 表示される確認ダイアログで、[はい] を **クリックします**。

## <a name="use-exchange-online-powershell-or-standalone-eop-powershell-to-configure-anti-malware-policies"></a>PowerShell Exchange Onlineスタンドアロン EOP PowerShell を使用してマルウェア対策ポリシーを構成する

### <a name="use-powershell-to-create-anti-malware-policies"></a>PowerShell を使用してマルウェア対策ポリシーを作成する

PowerShell でマルウェア対策ポリシーを作成するには、次の 2 つの手順を実行します。

1. マルウェア フィルター ポリシーを作成する。
2. マルウェア フィルター ルールを作成する (ルールの適用先のマルウェア フィルター ポリシーを指定します)。

 **注**:

- 新しいマルウェア フィルター ルールを作成し、関連付けされていない既存のマルウェア フィルター ポリシーを割り当てできます。 マルウェア フィルター ルールを複数のマルウェア フィルター ポリシーに関連付けできない。
- ポリシーを作成するまで、セキュリティ センターで使用できない PowerShell の新しいマルウェア対策ポリシーで構成できる 2 つの設定があります。
  - 無効として新しいポリシーを作成 _します_ `$false` **(New-MalwareFilterRule コマンドレットで有効** )。
  - New-MalwareFilterRule コマンドレットで _作成中の_ ポリシーの優先度 (優先度 _\<Number\>_ ) **を設定** します。
- PowerShell で作成した新しいマルウェア フィルター ポリシーは、ポリシーをマルウェア フィルター ルールに割り当てるまで、セキュリティ センターに表示されません。

#### <a name="step-1-use-powershell-to-create-a-malware-filter-policy"></a>手順 1: PowerShell を使用してマルウェア フィルター ポリシーを作成する

**注**: クラウドベースのサービスでは _、Action_ パラメーターの値 、およびメッセージ `DeleteMessage` `DeleteAttachmentAndUseDefaultAlert` `DeleteAttachmentAndUseCustomAlert` を削除しません。 代わりに、メッセージは検疫されます。 検疫済みメッセージの取得の詳細については、「EOP で検疫済みメッセージとファイルを管理者として管理する」 [を参照してください](manage-quarantined-messages-and-files.md)。

マルウェア フィルター ポリシーを作成するには、次の構文を使用します。

```PowerShell
New-MalwareFilterPolicy -Name "<PolicyName>" [-Action <DeleteMessage | DeleteAttachmentAndUseDefaultAlert | DeleteAttachmentAndUseCustomAlert>] [-AdminDisplayName "<OptionalComments>"] [-CustomNotifications <$true | $false>] [<Inbound notification options>] [<Outbound notification options>]
```

この例では、次に示す設定で Contoso Malware Filter Policy という新しいマルウェア フィルター ポリシーを作成します。

- 受信者に通知せずにマルウェアを含むメッセージを検疫します _(Action_ パラメーターは使用せず、既定値はです `DeleteMessage` )。
- メッセージでマルウェアが検出された場合は、メッセージ送信者に通知しない _(EnableExternalSenderNotifications_ パラメーターまたは _EnableInternalSenderNotifications_ パラメーターは使用していないので、両方の既定値はです)。 `$false`
- 内部送信者からのメッセージでマルウェアが検出された場合は、管理者 admin@contoso.com に通知する。

```PowerShell
New-MalwareFilterPolicy -Name "Contoso Malware Filter Policy" -EnableInternalSenderAdminNotifications $true -InternalSenderAdminAddress admin@contoso.com
```

構文とパラメーターの詳細については、「[New-MalwareFilterPolicy](/powershell/module/exchange/new-malwarefilterpolicy)」を参照してください。

#### <a name="step-2-use-powershell-to-create-a-malware-filter-rule"></a>手順 2: PowerShell を使用してマルウェア フィルター ルールを作成する

マルウェア フィルター ルールを作成するには、次の構文を使用します。

```PowerShell
New-MalwareFilterRule -Name "<RuleName>" -MalwareFilterPolicy "<PolicyName>" <Recipient filters> [<Recipient filter exceptions>] [-Comments "<OptionalComments>"]
```

この例では、次に示す設定で Contoso Recipients という新しいマルウェア フィルター ルールを作成します。

- Contoso Malware Filter Policy というマルウェア フィルター ポリシーにルールを割り当てる。
- contoso.com ドメイン内の受信者にルールを適用する。

```PowerShell
New-MalwareFilterRule -Name "Contoso Recipients" -MalwareFilterPolicy "Contoso Malware Filter Policy" -RecipientDomainIs contoso.com
```

構文とパラメーターの詳細については、「[New-MalwareFilterRule](/powershell/module/exchange/new-malwarefilterrule)」を参照してください。

### <a name="use-powershell-to-view-malware-filter-policies"></a>PowerShell を使用してマルウェア フィルター ポリシーを表示する

すべてのマルウェア フィルター ポリシーの要約リストを返すには、次のコマンドを実行します。

```PowerShell
Get-MalwareFilterPolicy
```

特定のマルウェア フィルター ポリシーに関する詳細情報を返すには、次の構文を使用します。

```PowerShell
Get-MalwareFilterPolicy -Identity "<PolicyName>" | Format-List [<Specific properties to view>]
```

この例では、Executives というマルウェア フィルター ポリシーにルールのすべてのプロパティの値を戻します。

```PowerShell
Get-MalwareFilterPolicy -Identity "Executives" | Format-List
```

この例では、同じポリシーの指定したプロパティのみを戻します。

```PowerShell
Get-MalwareFilterPolicy -Identity "Executives" | Format-List Action,AdminDisplayName,CustomNotifications,Enable*Notifications
```

構文とパラメーターの詳細については、「[Get-MalwareFilterPolicy](/powershell/module/exchange/get-malwarefilterpolicy)」を参照してください。

### <a name="use-powershell-to-view-malware-filter-rules"></a>PowerShell を使用してマルウェア フィルター ルールを表示する

すべてのマルウェア フィルター ルールの要約リストを返すには、次のコマンドを実行します。

```PowerShell
Get-MalwareFilterRule
```

ルールを有効または無効にしてリストをフィルター処理するには、次のコマンドを実行します。

```PowerShell
Get-HostedContentFilterRule -State Disabled
```

```PowerShell
Get-HostedContentFilterRule -State Enabled
```

特定のマルウェア フィルター ルールの詳細情報を返すには、次の構文を使用します。

```PowerShell
Get-MalwareFilterRule -Identity "<RuleName>" | Format-List [<Specific properties to view>]
```

この例では、Executives というマルウェア フィルター ルールのすべてのプロパティの値を返します。

```PowerShell
Get-MalwareFilterRule -Identity "Executives" | Format-List
```

この例では、同じルールの指定されたプロパティのみを返します。

```PowerShell
Get-MalwareFilterRule -Identity "Executives" | Format-List Name,Priority,State,MalwareFilterPolicy,*Is,*SentTo,*MemberOf
```

構文とパラメーターの詳細については、「[Get-MalwareFilterRule](/powershell/module/exchange/get-malwarefilterrule)」を参照してください。

### <a name="use-powershell-to-modify-malware-filter-policies"></a>PowerShell を使用してマルウェア フィルター ポリシーを変更する

次の項目以外にも、この記事の「手順 [1: PowerShell](#step-1-use-powershell-to-create-a-malware-filter-policy) を使用してマルウェア フィルター ポリシーを作成する」セクションで説明したように、PowerShell でマルウェア フィルター ポリシーを変更する場合と同じ設定を使用できます。

- 指定したポリシーを既定のポリシーに変換する _MakeDefault_ スイッチ (すべてのユーザーに適用され、変更できない最も優先度が低く、削除できません) は、PowerShell でマルウェア フィルター ポリシーを変更した場合にのみ使用できます。
- マルウェア フィルター ポリシーの名前を変更することはできません **(Set-MalwareFilterPolicy** コマンドレットには _Name_ パラメーターはありません)。 セキュリティ センターでマルウェア対策ポリシーの名前を変更すると、マルウェア フィルター ルールの名前が変更 _されます_。

マルウェア フィルター ポリシー

```PowerShell
Set-MalwareFilterPolicy -Identity "<PolicyName>" <Settings>
```

構文とパラメーターの詳細については、「[Set-MalwareFilterPolicy](/powershell/module/exchange/set-malwarefilterpolicy)」を参照してください。

### <a name="use-powershell-to-modify-malware-filter-rules"></a>PowerShell を使用してマルウェア フィルター ルールを変更する

PowerShell でマルウェア フィルター ルールを変更するときに使用できない唯一の設定は、無効なルールを作成できる _Enabled_ パラメーターです。 既存のマルウェア フィルター ルールを有効または無効にするには、次のセクションを参照してください。

それ以外の場合は、PowerShell でマルウェア フィルター ルールを変更するときに追加の設定を使用できません。 この記事の「手順 [2: PowerShell](#step-2-use-powershell-to-create-a-malware-filter-rule) を使用してマルウェア フィルター ルールを作成する」セクションで説明したように、ルールを作成する場合も同じ設定を使用できます。

マルウェア フィルター ルールを変更するには、次の構文を使用します。

```PowerShell
Set-MalwareFilterRule -Identity "<RuleName>" <Settings>
```

構文とパラメーターの詳細については、「[Set-MalwareFilterRule](/powershell/module/exchange/set-malwarefilterrule)」を参照してください。

### <a name="use-powershell-to-enable-or-disable-malware-filter-rules"></a>PowerShell を使用してマルウェア フィルター ルールを有効または無効にする

PowerShell でマルウェア フィルター ルールを有効または無効にすると、マルウェア対策ポリシー (マルウェア フィルター ルールと割り当てられたマルウェア フィルター ポリシー) 全体が有効または無効となります。 既定のマルウェア対策ポリシーを有効または無効にできない (常にすべての受信者に適用されます)。

PowerShell でマルウェア フィルター ルールを有効または無効にするには、次の構文を使用します。

```PowerShell
<Enable-MalwareFilterRule | Disable-MalwareFilterRule> -Identity "<RuleName>"
```

この例では、Marketing Department というマルウェア フィルター ルールを無効化します。

```PowerShell
Disable-MalwareFilterRule -Identity "Marketing Department"
```

この例では、同じルールを有効化します。

```PowerShell
Enable-MalwareFilterRule -Identity "Marketing Department"
```

詳細な構文およびパラメーターの情報については、[Enable-MalwareFilterRule](/powershell/module/exchange/enable-malwarefilterrule) と [Disable-MalwareFilterRule](/powershell/module/exchange/disable-malwarefilterrule).を参照してください。

### <a name="use-powershell-to-set-the-priority-of-malware-filter-rules"></a>PowerShell を使用してマルウェア フィルター ルールの優先度を設定する

ルールに設定できる優先度の最高値値は 0 です。 設定できる最低値はルールの数に依存します。 たとえば、ルールが五つある場合、使用できる優先度の値は 0 から 4 です。 既存の一つのルールの優先度を変更すると、他のルールにも連鎖的な影響が起こりえます。 たとえば、カスタム ルールが 5 つあって (優先度 0 から 4)、1 つのルールの優先度を 2 に変更した場合には、既存の優先度 2 のルールは優先度 3 に変更され、優先度 3 は優先度 4 に変更されます。

PowerShell でマルウェア フィルター ルールの優先度を設定するには、次の構文を使用します。

```PowerShell
Set-MalwareFilterRule -Identity "<RuleName>" -Priority <Number>
```

この例では、Marketing Department というルールの優先度を 2 に設定しています。優先度が 2 以下のすべての既存のルールは、優先度が 1 ずつ下がります (優先度番号が 1 ずつ増加します)。

```PowerShell
Set-MalwareFilterRule -Identity "Marketing Department" -Priority 2
```

**注**:

- 新しいルールを作成するときに優先度を設定するには、代わりに **New-MalwareFilterRule** コマンドレットの Priority パラメーターを使用します。 
- 既定のマルウェア フィルター ポリシーには、対応するマルウェア フィルター ルールが含めず、常に変更できない優先度の値が [最低] **です**。

### <a name="use-powershell-to-remove-malware-filter-policies"></a>PowerShell を使用してマルウェア フィルター ポリシーを削除する

PowerShell を使用してマルウェア フィルター ポリシーを削除すると、対応するマルウェア フィルター ルールは削除されません。

PowerShell でマルウェア フィルター ポリシーを削除するには、次の構文を使用します。

```PowerShell
Remove-MalwareFilterPolicy -Identity "<PolicyName>"
```

この例では、Marketing Department というマルウェア フィルター ポリシーを削除します。

```PowerShell
Remove-MalwareFilterPolicy -Identity "Marketing Department"
```

構文とパラメーターの詳細については、「[Remove-MalwareFilterPolicy](/powershell/module/exchange/remove-malwarefilterpolicy)」を参照してください。

### <a name="use-powershell-to-remove-malware-filter-rules"></a>PowerShell を使用してマルウェア フィルター ルールを削除する

PowerShell を使用してマルウェア フィルター ルールを削除すると、対応するマルウェア フィルター ポリシーは削除されません。

PowerShell でマルウェア フィルター ルールを削除するには、次の構文を使用します。

```PowerShell
Remove-MalwareFilterRule -Identity "<PolicyName>"
```

この例では、Marketing Department という名前のマルウェア フィルター ルールを削除します。

```PowerShell
Remove-MalwareFilterRule -Identity "Marketing Department"
```

構文とパラメーターの詳細については、「[Remove-MalwareFilterRule](/powershell/module/exchange/remove-malwarefilterrule)」を参照してください。

## <a name="how-do-you-know-these-procedures-worked"></a>正常な動作を確認する方法

### <a name="use-the-eicartxt-file-to-verify-your-anti-malware-policy-settings"></a>マルウェア対策EICAR.TXT設定を確認するには、次のファイルを使用します。

> [!IMPORTANT]
> EICAR.TXT ファイルはウイルスでありません。 ヨーロッパコンピューターウイルス対策研究所 (EICAR) は、ウイルス対策のインストールと設定を安全にテストするためにこのファイルを開発しました。

1. ファイルメモ帳開き、次のテキストを空のファイルに貼り付けます。

   ```Text
   X5O!P%@AP[4\PZX54(P^)7CC)7}$EICAR-STANDARD-ANTIVIRUS-TEST-FILE!$H+H*
   ```

   これらは、ファイル内の唯一のテキスト文字である必要があります。 ファイル サイズは 68 バイトである必要があります。

2. ファイルをファイルとして保存EICAR.TXT

   デスクトップのウイルス対策プログラムで、スキャンからEICAR.TXTする必要があります (それ以外の場合は、ファイルが検疫されます)。

3. ファイルを自動的にブロックしないEICAR.TXTを使用して、添付ファイルを含む電子メール メッセージを添付ファイルとして送信します。 マルウェア対策ポリシー設定を使用して、テストする次のシナリオを決定します。
   - 内部メールボックスから内部受信者への電子メール。
   - 内部メールボックスから外部受信者への電子メール。
   - 外部メールボックスから内部受信者への電子メール。

4. メッセージが検疫されたのを確認し、マルウェア対策ポリシー設定に基づいて受信者と送信者の通知結果を確認します。 次に例を示します。

   - 受信者に通知されないか、受信者が既定またはカスタマイズされたテキストを含むマルウェア アラート Text.txtに置き換えられた EICAR.TXT 添付ファイルを含む **元** のメッセージを受信します。
   - 内部または外部の送信者には、既定またはカスタマイズされた通知メッセージが通知されます。
   - 指定した管理者メール アドレスは、内部または外部のメッセージ送信者に対して通知され、既定またはカスタマイズされた通知メッセージが表示されます。

5. テストがEICAR.TXTファイルを削除します (そのため、他のユーザーが不必要に警告を受け付けないので)。
