---
title: セキュリティ/コンプライアンス センター のメッセージ追跡
f1.keywords:
- NOCSH
ms.author: chrisda
author: chrisda
manager: dansimp
audience: ITPro
ms.topic: how-to
ms.service: O365-seccomp
localization_priority: Normal
ms.assetid: 3e64f99d-ac33-4aba-91c5-9cb4ca476803
ms.custom:
- seo-marvel-apr2020
description: 管理者は、セキュリティ & コンプライアンスセンターのメッセージ追跡を使用して、メッセージに何が起こったかを確認できます。
ms.openlocfilehash: 46aa454ff709e9b17c3b18992757a9a4c3a51247
ms.sourcegitcommit: ee39faf3507d0edc9497117b3b2854955c959c6c
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 12/10/2020
ms.locfileid: "49616754"
---
# <a name="message-trace-in-the-security--compliance-center"></a>セキュリティ/コンプライアンス センター のメッセージ追跡

[!INCLUDE [Microsoft 365 Defender rebranding](../includes/microsoft-defender-for-office.md)]


## <a name="message-trace-features"></a>メッセージ追跡機能

セキュリティ & コンプライアンスセンターのメッセージ追跡は、Exchange Online 組織を通過する電子メールメッセージに従います。 メッセージがサービスによって受信、拒否、延期、または配信されたかどうかを判断できます。 メッセージが最終的な状態になる前に、メッセージに行われた処理も表示します。

セキュリティ & コンプライアンスセンターのメッセージ追跡は、Exchange 管理センター (EAC) で使用可能だった元のメッセージ追跡によって改善されています。 メッセージ追跡からの情報を使用して、メッセージへの対処、メールフローの問題のトラブルシューティング、およびポリシーの変更の検証について、ユーザーからの質問に効率よく答えられるようにすることができます。

> [!NOTE]
>
> - メッセージ追跡を行うには、組織の管理、コンプライアンス管理、またはヘルプデスクの役割グループのメンバーである必要があります。 詳細については、「[セキュリティ/コンプライアンス センターのアクセス許可](permissions-in-the-security-and-compliance-center.md)」を参照してください。
>
> - 結果に表示されるメッセージの最大数は、選択したレポートの種類によって異なります (詳細については、「 [レポートの種類を選択](#choose-report-type) する」セクションを参照してください)。 Exchange Online PowerShell またはスタンドアロン EOP PowerShell の [start-historicalsearch](https://docs.microsoft.com/powershell/module/exchange/get-historicalsearch) コマンドレットは、結果のすべてのメッセージを返します。

## <a name="open-message-trace"></a>メッセージ追跡を開く

1. のセキュリティ & コンプライアンスセンター] を開き <https://protection.office.com> ます。

2. [ **メールフロー**] を展開し、[ **メッセージの追跡**] を選択します。

## <a name="message-trace-page"></a>メッセージ追跡ページ

[ **トレースの開始** ] ボタンをクリックすると、新しい既定のトレースを開始できます。 これにより、すべての送信者と受信者について、過去2日間のすべてのメッセージが検索されます。 または、使用可能なクエリカテゴリから、保存されているクエリのいずれかを使用して、それをで実行するか、独自のクエリの開始点として使用することができます。

- **既定のクエリ**: Microsoft 365 で提供される組み込みクエリ。

- **カスタムクエリ**: 今後の使用のために組織内の管理者によって保存されたクエリ。

- **自動保存クエリ**: 最後に実行された最後の10個のクエリ。 このリストにより、中断したところから簡単に選択できます。

また、このページには、提出した要求のダウンロード可能な **レポート** セクションと、ダウンロードが可能な場合にレポート自体も表示されます。

## <a name="options-for-a-new-message-trace"></a>新しいメッセージ追跡のオプション

### <a name="filter-by-senders-and-recipients"></a>送信者と受信者によるフィルター

既定値は **すべて送信者** と **すべての受信者** ですが、次のフィールドを使用して結果をフィルター処理できます。

- **これらのユーザーによって**: このフィールドをクリックして、組織から1人以上の送信者を選択します。 名前の入力を開始することもできます。また、リスト内のアイテムは、検索ページの動作と同じように、入力したものによってフィルター処理されます。

- **ユーザーへ**: このフィールドをクリックして、組織内の1人または複数の受信者を選択します。

> [!NOTE]
>
> - 外部の送信者と受信者の電子メールアドレスを入力することもできます。 ワイルドカードはサポートされてい `*@contoso.com` ますが、同じフィールドで複数のワイルドカードエントリを同時に使用することはできません。
>
> - 複数の送信者または受信者の一覧を、セミコロン () で区切って貼り付けることができ `;` ます。 スペース ( `\s` )、キャリッジリターン () `\r` 、または次の行 ( `\n` )。

### <a name="time-range"></a>時間の範囲

既定値は **2 日** ですが、最大90日までの日付/時刻範囲を指定できます。 日付/時刻範囲を使用する場合は、次の点を考慮してください。

- 既定では、タイムラインを使用して、 **スライダー** ビューで時間範囲を選択します。 表示される日時の設定のみを選択できます。 [Between] 間の値を選択すると、[開始/終了] のバブルが、最も近い表示設定にスナップされます。

  ![セキュリティ & コンプライアンスセンターでの新しいメッセージ追跡のスライダー時間の範囲](../../media/55a9e9c1-f7d5-4047-b217-824e8b976bcb.png)

  ただし、[**開始日**] と [**終了日**] の値 (時刻を含む **) を指定** することもできます。また、日付/時刻範囲の **タイムゾーン** を選択することもできます。 **タイムゾーン** の設定は、クエリの入力とクエリの結果の両方に適用されることに注意してください。

  ![セキュリティ & コンプライアンスセンターでの新しいメッセージ追跡のカスタム時間範囲](../../media/ed4c8d50-9ea5-4694-93f9-ee3ab6660b4f.png)

  10日間以下の場合、結果はすぐに **概要** レポートとして利用できます。 時間の範囲を10日よりも少し長く指定すると、ダウンロード可能な CSV ファイル (拡張された **概要** または **拡張** レポート) としてのみ利用できるため、結果の遅延が発生します。

  さまざまなレポートの種類の詳細については、このトピックの「 [レポートの種類を選択](#choose-report-type) する」セクションを参照してください。

  **注**: 拡張された概要および拡張レポートはアーカイブされたメッセージの追跡データを使用して準備されるため、レポートをダウンロードできるようになるまでに最大で数時間かかる場合があります。 同時にレポート要求を送信した他の管理者の数によっては、キューに入れられた要求の処理が開始されるまでの時間が長くなることもあります。

- **スライダー** ビューでクエリを保存すると、相対時間範囲 (たとえば、今日から3日間) が保存されます。 **ユーザー設定** のビューにクエリを保存すると、絶対日付/時刻範囲 (たとえば、2018-05-06 13:00 ~ 2018-05-08 18:00) が保存されます。

### <a name="more-search-options"></a>その他の検索オプション

#### <a name="delivery-status"></a>配信状態

既定値を **すべて** 選択したままにすることも、次のいずれかの値を選択して結果をフィルター処理することもできます。

- **配信** 済み: メッセージは、意図した宛先に正常に配信されました。

- [**保留中**]: メッセージの配信が試行または再試行されています。

- **拡張**: 配布グループの受信者が、グループの個々のメンバーに配信される前に展開されました。

- **失敗**: メッセージは配信されませんでした。

- **検疫** 済み: メッセージが検疫されました (スパム、バルクメール、またはフィッシングとして)。 詳細については、「EOP での検疫された [電子メールメッセージ](quarantine-email-messages.md)」を参照してください。

- **スパムとしてフィルター処理**: メッセージがスパムとして検出され、拒否またはブロックされました (検疫されていません)。

- **状態の取得:** メッセージは Microsoft 365 によって最近受信されましたが、他の状態データはまだ利用できません。 数分後にもう一度確認してください。

**注**:**スパムとして****保留、** **検疫** 済み、およびフィルター処理される値は、10日未満の検索でのみ使用できます。 また、実績と報告された配信状態の間に 5 ~ 10 分の遅延が発生することもあります。

#### <a name="message-id"></a>メッセージ ID

これは、メッセージヘッダー内の **メッセージ id:** header フィールドに含まれるインターネットメッセージ Id (クライアント ID とも呼ばれます) です。 ユーザーはこの値を指定して、特定のメッセージを調査できます。

この値は、メッセージの有効期間全体にわたって不変です。 Microsoft 365 または Exchange で作成されたメッセージの場合、値は `<GUID@ServerFQDN>` 山かっこ () を含む形式になり \< \> ます。 たとえば、`<d9683b4c-127b-413a-ae2e-fa7dfb32c69d@DM3NAM06BG401.Eop-nam06.prod.protection.outlook.com>` などです。 他のメッセージングシステムでは、異なる構文や値を使用する場合があります。 この値は一意であると想定されていますが、すべての電子メールシステムがこの要件を厳密に従うわけではありません。 **メッセージ ID:** header フィールドが存在しない場合、または外部ソースからの受信メッセージに対して空白の場合は、任意の値が割り当てられます。

**メッセージ ID** を使用して結果をフィルター処理する場合は、山かっこを含む完全な文字列を含める必要があります。

#### <a name="direction"></a>Direction

既定値を **すべて** 選択したままにするか、[ **受信** (組織内の受信者に送信されるメッセージ)] または [ **送信** ] (組織内のユーザーから送信されるメッセージ) を選択して結果をフィルター処理できます。

#### <a name="original-client-ip-address"></a>元のクライアント IP アドレス

クライアント IP アドレスによって結果をフィルターして、大量のスパムまたはマルウェアを送信しているハッキングされたコンピューターを調査できます。 メッセージは複数の送信者から送信されているように見えますが、同じコンピューターがすべてのメッセージを生成している可能性があります。

**注**: クライアント IP アドレス情報は10日間のみ利用可能であり、拡張された **概要** または **拡張** レポート (ダウンロード可能な CSV ファイル) でのみ使用できます。

### <a name="choose-report-type"></a>レポートの種類を選択する

使用可能なレポートの種類は次のとおりです。

- **概要**: 時間範囲が10日未満の場合に使用できます。これには、追加のフィルターオプションは必要ありません。 [ **検索**] をクリックすると、ほぼ瞬時に結果が得られます。 レポートは最大2万結果を返します。

- 拡張された **概要** または **拡張**: これらのレポートはダウンロード可能な CSV ファイルとしてのみ使用でき、時間範囲に関係なく、次のフィルターオプションの1つ以上を必要とします。**これら** のユーザー、**これらのユーザー**、または **メッセージ ID**。 送信者または受信者に対してワイルドカードを使用できます (たとえば、 \* @contoso .com)。 拡張された概要レポートは、最大5万件の結果を返します。 拡張レポートは、最大1000件の結果を返します。

**注**:

- 拡張された概要および拡張レポートは、アーカイブされたメッセージの追跡データを使用して準備されるため、レポートをダウンロードできるようになるまでに最大で数時間かかる場合があります。 同時にレポート要求を送信した他の管理者の数によっては、キュー要求の処理が開始されるまでの時間が長くなることがあります。

- 拡張されたサマリーまたは拡張レポートを任意の日付/時刻範囲で選択できますが、通常、アーカイブデータの過去4時間は、これら2種類のレポートでは利用できません。

[ **次へ**] をクリックすると、選択したフィルターオプション、レポートの一意の (編集可能な) タイトル、およびメッセージの追跡が完了したときに通知を受け取る電子メールアドレス (組織の承認済みドメインのいずれかである必要があります) を一覧表示する要約ページが表示されます。 [ **レポートの準備** ] をクリックして、メッセージの追跡を送信します。 メインの **メッセージ追跡** ページで、[ダウンロード可能な **レポート** ] セクションにレポートの状態を表示できます。

さまざまなレポートの種類で返される情報の詳細については、次のセクションを参照してください。

## <a name="message-trace-results"></a>メッセージの追跡結果

さまざまなレポートの種類は、さまざまなレベルの情報を返します。 次のセクションでは、さまざまなレポートで使用できる情報について説明します。

### <a name="summary-report-output"></a>概要レポートの出力

メッセージ追跡を実行すると、結果が一覧表示され、降順 (最新の日付/時刻) で並べ替えられます。

![セキュリティ & コンプライアンスセンターでのメッセージ追跡に関する概要レポートの結果](../../media/0664bafe-0b03-477b-b571-0b046ac8c977.png)

概要レポートには、次の情報が含まれています。

- **日付**: 構成済みの UTC タイムゾーンを使用して、メッセージがサービスによって受信された日付と時刻。

- **Sender**: 送信者の電子メールアドレス (*エイリアス* @ *ドメイン*)。

- **Recipient**: 受信者または受信者の電子メールアドレス。 複数の受信者に送信されるメッセージの場合、受信者ごとに1つの行があります。 受信者が配布グループ、動的配布グループ、またはメールが有効なセキュリティグループの場合、グループは最初の受信者になり、グループの各メンバーは別の行になります。

- **Subject**: メッセージの **subject:** フィールドの最初の256文字。

- **状態**: これらの値については、「 [配信状態](#delivery-status) 」セクションで説明されています。

既定では、最初の250結果が読み込まれ、すぐに使用できるようになります。 下にスクロールすると、結果の次のバッチが読み込まれるときに若干の一時停止が発生します。 スクロールするのではなく、[ **すべて読み込み** ] をクリックして、最大で1万のすべての結果を読み込むことができます。

列見出しをクリックすると、その列の値の昇順または降順で結果を並べ替えることができます。

[結果の **フィルター** ] をクリックすると、結果を1つまたは複数の列でフィルター処理できます。

1つまたは複数の行を選択した後に結果をエクスポートするには、[**結果のエクスポート**] をクリックし、[**すべての結果** のエクスポート] または [エクスポート **した****結果のエクスポート**] を選択します。

#### <a name="find-related-records-for-this-message"></a>このメッセージの関連レコードを検索する

関連するメッセージレコードは、同じメッセージ ID を共有しているレコードです。 2人のユーザーの間で送信される1つのメッセージで、複数のレコードを生成できることに注意してください。 配布グループの展開、転送、メールフロールール (トランスポートルールとも呼ばれます) などによってメッセージが影響を受けると、レコード数が増加します。

行のチェックボックスをオンにした後は、表示された [関連レコードの **検索**] ボタンをクリックするか、[その **他のオプション**] を選択することによって、メッセージの関連レコードを検索でき ![ ](../../media/1ea52bbf-9d00-48ce-9362-307f7f6fb7fe.png) \> ます。

メッセージ ID の詳細については、このトピックで前述した「メッセージ ID」セクションを参照してください。

#### <a name="message-trace-details"></a>メッセージ追跡の詳細

概要レポートの出力では、次のいずれかの方法を使用して、メッセージの詳細を表示できます。

- 行を選択します (チェックボックス以外の行の任意の場所をクリックします)。

- 行のチェックボックスをオンにして、[ **その** 他のオプション] をクリックし ![ ](../../media/1ea52bbf-9d00-48ce-9362-307f7f6fb7fe.png) \> ます。 **メッセージの詳細を表示** します。

   ![概要レポートメッセージ追跡の行をダブルクリックした後の詳細セキュリティ & コンプライアンスセンターの結果](../../media/e50ee7cd-810a-4c06-8b58-e56ffd7028d1.png)

メッセージ追跡の詳細には、概要レポートに表示されない次の追加情報が含まれています。

- **メッセージイベント**: このセクションには、サービスがメッセージに対して実行するアクションを分類するための分類が含まれています。 次のような **いくつかの興味深いイベント** が発生することがあります。

  - **Receive**: メッセージはサービスによって受信されました。

  - **送信**: メッセージはサービスによって送信されました。

  - **Fail**: メッセージを配信できませんでした。

  - **配信**: メッセージがメールボックスに配信されました。

  - **Expand**: 展開された配布グループにメッセージが送信されました。

  - **転送**: コンテンツ変換、メッセージ受信者の制限、またはエージェントが原因で、受信者が bifurcated メッセージに移動されました。

  - **Defer**: メッセージの配信が延期され、後で再試行される可能性があります。

  - **解決済み**: Active Directory に基づいて、メッセージは新しい受信者アドレスにリダイレクトされました。 このイベントが発生した場合、メッセージ トレースの別の行に、メッセージの最終配信状態と併せて、元の受信者のアドレスが表示されます。

  注:

  - 正常に配信された書き込まメッセージは、メッセージ追跡に複数の **イベント** エントリを生成します。

  - この一覧は、完全には想定されていません。 イベントの詳細については、「 [メッセージ追跡ログのイベントの種類](https://docs.microsoft.com/Exchange/mail-flow/transport-logs/message-tracking#event-types-in-the-message-tracking-log)」を参照してください。 このリンクは、Exchange Server (オンプレミスの Exchange) トピックであることに注意してください。

- **詳細**: このセクションには、次の詳細情報が含まれています。

  - [**メッセージ id**]: この値については、このトピックで前述した「[メッセージ id](#message-id) 」に記載されています。 たとえば、`<d9683b4c-127b-413a-ae2e-fa7dfb32c69d@DM3NAM06BG401.Eop-nam06.prod.protection.outlook.com>` などです。

  - **メッセージ サイズ**   添付ファイルを含むキロバイト (KB) 単位のメッセージのサイズ。

  - **FROM ip**: メッセージを送信したコンピューターの ip アドレス。 Exchange Online から送信された送信メッセージの場合、この値は空白です。

  - **TO IP**: サービスがメッセージを配信しようとした ip アドレスまたはアドレス。 メッセージに複数の受信者が含まれている場合は、それらが表示されます。 Exchange Online に送信された受信メッセージの場合、この値は空白です。

### <a name="enhanced-summary-reports"></a>拡張された概要レポート

利用可能 (完了) 強化された概要レポートについては、最初のメッセージ追跡の「ダウンロード可能な **レポート** 」セクションを参照してください。 レポートでは、次の情報を使用できます。

- **origin_timestamp** <sup>*</sup> : 構成済みの UTC タイムゾーンを使用して、メッセージが最初にサービスによって受信された日付と時刻。

- **sender_address**: 送信者の電子メールアドレス (*エイリアス* @ *ドメイン*)。

- **Recipient_status**: 受信者へのメッセージの配信状態。 メッセージが複数の受信者に送信された場合は、次の形式で、それぞれの受信者と対応する状態が表示されます \<*email address*\> ## \<*status*\> 。 例:

  - **# #Receive, Send** は、メッセージがサービスによって受信され、意図した宛先に送信されたことを意味します。

  - **# #Receive、Fail** は、メッセージがサービスによって受信されたが、意図した宛先への配信に失敗したことを意味します。

  - **# #Receive 配信** とは、メッセージがサービスによって受信され、受信者のメールボックスに配信されたことを意味します。

- **message_subject**: メッセージの **subject** フィールドの最初の256文字。

- **total_bytes**: 添付ファイルを含む、メッセージのサイズ (バイト単位)。

- **message_id**: この値については、このトピックで前述した「 [メッセージ id](#message-id) 」セクションを参照してください。 たとえば、`<d9683b4c-127b-413a-ae2e-fa7dfb32c69d@DM3NAM06BG401.Eop-nam06.prod.protection.outlook.com>` などです。

- **network_message_id**: 分割または配布グループの展開によって作成される可能性がある、メッセージのすべてのコピーで保持される一意のメッセージ id 値。 値の例を次に示し `1341ac7b13fb42ab4d4408cf7f55890f` ます。

- **original_client_ip**: 送信者のクライアントの ip アドレス。

- **方向性**: メッセージが組織に受信 (1) 送信されたかどうか、または組織から送信 (2) されたかどうかを示します。

- **connector_id**: コピー元またはコピー先のコネクタの名前を指定します。 Exchange Online のコネクタの詳細については、「 [Configure mail flow using connector Using Office 365](https://docs.microsoft.com/Exchange/mail-flow-best-practices/use-connectors-to-configure-mail-flow/use-connectors-to-configure-mail-flow)」を参照してください。

- **delivery_priority** <sup>*</sup> : メッセージが **高**、**低**、または **通常** の優先度で送信されたかどうか。

<sup>*</sup> これらのプロパティは、拡張された概要レポートでのみ使用できます。

### <a name="extended-reports"></a>拡張レポート

利用可能 (完了) された拡張レポートは、メッセージ追跡の先頭にあるダウンロード可能な **レポート** セクションから入手できます。 拡張されたサマリーレポートからほぼすべての情報を拡張レポートで利用できます ( **origin_timestamp** と **delivery_priority** は除きます)。 次の追加情報は、拡張レポートでのみ使用できます。

- **client_ip**: メッセージを送信した電子メールサーバーまたはメッセージングクライアントの ip アドレス。

- **client_hostname**: メッセージを送信した電子メールサーバーまたはメッセージングクライアントのホスト名または FQDN。

- **server_ip**: 送信元または送信先サーバーの ip アドレス。

- **server_hostname**: 宛先サーバーのホスト名または FQDN。

- **source_context**: **ソース** フィールドに関連付けられているその他の情報。 例:

  - `Protocol Filter Agent`

  - `3489061114359050000`

- **source**: イベントを担当する Exchange Online コンポーネント。 例:

  - `AGENT`

  - `MAILBOXRULE`

  - `SMTP`

- **event_id**: これらは、「[このメッセージの関連レコードを検索](#find-related-records-for-this-message)する」セクションで説明されている **メッセージイベント** 値に対応しています。

- **internal_message_id**: 現在メッセージを処理している Exchange Online サーバーによって割り当てられたメッセージ識別子。

- **recipient_address**: メッセージの受信者の電子メールアドレス。 複数の電子メール アドレスがある場合は、セミコロン (;) で区切られます。

- **recipient_count**: メッセージ内の受信者の合計数。

- **related_recipient_address**: `EXPAND` `REDIRECT` `RESOLVE` メッセージに関連付けられた他の受信者の電子メールアドレスを表示するために、、およびイベントと共に使用します。

- **参照**: このフィールドには、特定の種類のイベントに関する追加情報が含まれています。 例:

  - **Dsn**: このイベントの後に dsn が生成された場合に、関連付けられている配信状態通知 (dsn、配信不能レポート、NDR、またはバウンスメッセージとも呼ばれる) の **message_id** 値であるレポートリンクが含まれています。 これが DSN メッセージの場合、このフィールドには、DSN が生成された元のメッセージの **message_id** 値が含まれます。

  - **EXPAND**: 関連するメッセージの **related_recipient_address** 値を格納します。

  - **RECEIVE**: 他のプロセス (たとえば、受信トレイルール) によってメッセージが生成された場合に、関連するメッセージの **message_id** 値が含まれている可能性があります。

  - **SEND**: DSN メッセージの **internal_message_id** 値を格納します。

  - **TRANSFER**: fork されているメッセージの **internal_message_id** 値を格納します (たとえば、コンテンツの変換、メッセージ受信者の制限、エージェント)。

  - **MAILBOXRULE**: 受信トレイルールが送信メッセージを生成する原因となった受信メッセージの **internal_message_id** 値を格納します。

    その他の種類のイベントの場合、このフィールドは通常空白です。

- **return_path**: メッセージを送信した **MAIL FROM** コマンドによって指定された返信電子メールアドレス。 このフィールドは空になることはありませんが、null の送信者アドレス値をとして表すことができ `<>` ます。

- **message_info**: メッセージに関する追加情報。 例:

  - メッセージの発信元の日付とイベントの UTC の日時 `DELIVER` `SEND` 。 発信日時は、メッセージが最初に Exchange Online 組織に入った時刻です。 UTC の日時は、ISO 8601 の日付と時刻の形式で表されます。ここで、 `yyyy-mm-ddThh:mm:ss.fffZ` `yyyy` = year、 `mm` = month、 `dd` = day は、 `T` 時間コンポーネントの開始を示し、 `hh` = hour、 `mm` = minute、= second、= 小数点以下の値を示します `ss` `fff` `Z` `Zulu` 。これは、utc を示すもう1つの方法です。

  - 認証エラー。 たとえば、認証エラーが発生したときに使用された認証の値と種類が表示されることがあり `11a` ます。

- **tenant_id**: Exchange Online 組織を表す GUID 値 (例: `39238e87-b5ab-4ef6-a559-af54c6b07b42` )。

- **original_server_ip**: 元のサーバーの ip アドレス。

- **custom_data**: 特定のイベントの種類に関連するデータが含まれています。 詳細については、以下のセクションを参照してください。

#### <a name="custom_data-values"></a>custom_data 値

イベントの **custom_data** フィールド `AGENTINFO` は、メッセージ処理の詳細をログに記録するために、Exchange Online のさまざまなエージェントによって使用されます。 次のセクションでは、いくつかの興味深いエージェントについて説明します。

#### <a name="spam-filter-agent"></a>スパムフィルターエージェント

で始まる **custom_data** 値 `S:SFA` は、スパムフィルターエージェントからのものです。 重要な詳細については、次の表で説明します。

****

|値|説明|
|---|---|
|`SFV=NSPM`|メッセージがスパムではないとしてマークされ、意図された受信者に送信されました。|
|`SFV=SPM`|スパム対策フィルター (コンテンツフィルターとも呼ばれる) によって、メッセージがスパムとしてマークされました。|
|`SFV=BLK`|ブロックする差出人から発信されたメッセージであるため、フィルター処理が省略され、メッセージはブロックされました。|
|`SFV=SKS`|スパム対策フィルターによって処理される前に、メッセージがスパムとしてマークされました。 これには、メッセージを自動的にスパムメールとしてマークし、他のすべてのフィルター処理を省略するトランスポート ルールに一致するメッセージが含まれます。|
|`SCL=<number>`|さまざまな SCL の値とその意味の詳細については、「[Spam Confidence Level](spam-confidence-levels.md)」を参照してください。|
|`PCL=<number>`|メッセージの Phishing Confidence Level (PCL) 値。これらの値は、「[Spam Confidence Level](spam-confidence-levels.md)」に記載されている SCL 値と同様に解釈できます。  |
|`DI=SB`|メッセージの送信者はブロックされました。|
|`DI=SQ`|メッセージは検疫されました。|
|`DI=SD`|メッセージは削除されました。|
|`DI=SJ`|メッセージは受信者の迷惑メール フォルダーに送信されました。|
|`DI=SN`|メッセージは通常の送信用の配信プールを通じて送信されました。|
|`DI=SO`|メッセージがより危険度の高い配信プールを経由してルーティングされました。 詳細については、「[送信メッセージにおける危険度の高い配信プール](high-risk-delivery-pool-for-outbound-messages.md)」を参照してください。|
|`SFS=[a]|SFS=[b]`|これはスパム ルールが一致したことを示します。|
|`IPV=CAL`|このメッセージの IP アドレスは接続フィルターの IP 許可一覧に指定されているため、スパム フィルターの通過を許可されました。|
|`H=<EHLOstring>`|接続メール サーバーの HELO または EHLO 文字列。|
|`PTR=<ReverseDNS>`|送信元の IP アドレスの PTR レコード (逆引き DNS アドレスともいう) です。|
|

次のようなスパムのフィルターが適用されたメッセージの **custom_data** 値の例を次に示します。

`S:SFA=SUM|SFV=SPM|IPV=CAL|SRV=BULK|SFS=470454002|SFS=349001|SCL=9|SCORE=-1|LIST=0|DI=SN|RD=ftmail.inc.com|H=ftmail.inc.com|CIP=98.129.140.74|SFP=1501|ASF=1|CTRY=US|CLTCTRY=|LANG=en|LAT=287|LAT=260|LAT=18;`

#### <a name="malware-filter-agent"></a>マルウェアフィルターエージェント

で始まる **custom_data** 値は、 `S:AMA` マルウェアフィルターエージェントからのものです。 重要な詳細については、次の表で説明します。

****

|値|説明|
|---|---|
|`AMA=SUM|v=1|` または `AMA=EV|v=1`|このメッセージは、マルウェアが含まれていると判断されました。 `SUM` マルウェアが、任意の数のエンジンによって検出された可能性があることを示します。 `EV` 特定のエンジンによってマルウェアが検出されたことを示します。 エンジンでマルウェアが検出された場合は、後続のアクションをトリガーします。|
|`Action=r`|メッセージは置き換えられました。|
|`Action=p`|メッセージはバイパスされました。|
|`Action=d`|メッセージは延期されました。|
|`Action=s`|メッセージは削除されました。|
|`Action=st`|メッセージはバイパスされました。|
|`Action=sy`|メッセージはバイパスされました。|
|`Action=ni`|メッセージは拒否されました。|
|`Action=ne`|メッセージは拒否されました。|
|`Action=b`|メッセージはブロックされました。|
|`Name=<malware>`|検出されたマルウェアの名前。|
|`File=<filename>`|マルウェアを含むファイルの名前。|
|

マルウェアを含むメッセージの **custom_data** 値の例は、次のようになります。

`S:AMA=SUM|v=1|action=b|error=|atch=1;S:AMA=EV|engine=M|v=1|sig=1.155.974.0|name=DOS/Test_File|file=filename;S:AMA=EV|engine=A|v=1|sig=201707282038|name=Test_File|file=filename`

#### <a name="transport-rule-agent"></a>トランスポートルールエージェント

で始まる **custom_data** 値は、 `S:TRA` メールフロールール (トランスポートルールとも呼ばれる) のトランスポートルールエージェントからの値です。 重要な詳細については、次の表で説明します。

****

|値|説明|
|---|---|
|`ETR|ruleId=<guid>`|一致したルールの ID。|
|`St=<datetime>`|ルールの一致が発生した日付と時刻 (UTC)。|
|`Action=<ActionDefinition>`|適用されたアクション。 使用可能なアクションの一覧については、「 [Exchange Online のメールフロールールのアクション](https://docs.microsoft.com/exchange/security-and-compliance/mail-flow-rules/mail-flow-rule-actions)」を参照してください。|
|`Mode=<Mode>`|ルールのモード。 有効な値は次のとおりです。<ul><li>**強制**: ルールのすべてのアクションが適用されます。</li><li>[**ポリシーヒントを使用してテスト** する]:: ポリシーヒントアクションが送信されますが、他の強制アクションは実行されません。</li><li>**ポリシーヒントなしのテスト**: アクションがログファイルに一覧表示されますが、送信者には何も通知されず、強制アクションは実行されません。</li></ul>|
|

メールフロールールの条件に一致するメッセージの **custom_data** 値の例は、次のようになります。

`S:TRA=ETR|ruleId=19a25eb2-3e43-4896-ad9e-47b6c359779d|st=7/17/2017 12:31:25 AM|action=ApplyHtmlDisclaimer|sev=1|mode=Enforce`
