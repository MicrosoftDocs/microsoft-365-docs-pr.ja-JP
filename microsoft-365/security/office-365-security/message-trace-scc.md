---
title: セキュリティ/コンプライアンス センター のメッセージ追跡
f1.keywords:
- NOCSH
ms.author: chrisda
author: chrisda
manager: dansimp
audience: ITPro
ms.topic: how-to
localization_priority: Normal
ms.assetid: 3e64f99d-ac33-4aba-91c5-9cb4ca476803
ms.custom:
- seo-marvel-apr2020
description: 管理者は、セキュリティ/コンプライアンス センターの&トレースを使用して、メッセージに何が起こったかを確認できます。
ms.technology: mdo
ms.prod: m365-security
ms.openlocfilehash: 1ce26f7a6cdad15019e2b40eb6f8746e5723d4f0
ms.sourcegitcommit: 786f90a163d34c02b8451d09aa1efb1e1d5f543c
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 02/18/2021
ms.locfileid: "50290659"
---
# <a name="message-trace-in-the-security--compliance-center"></a>セキュリティ/コンプライアンス センター のメッセージ追跡

[!INCLUDE [Microsoft 365 Defender rebranding](../includes/microsoft-defender-for-office.md)]

**適用対象**
- [Exchange Online Protection](exchange-online-protection-overview.md)
- [Microsoft Defender for Office 365 プラン 1 およびプラン 2](office-365-atp.md)
- [Microsoft 365 Defender](../mtp/microsoft-threat-protection.md)

## <a name="message-trace-features"></a>メッセージ追跡機能

セキュリティ/コンプライアンス センターのメッセージ追跡&、Exchange Online 組織を経由する電子メール メッセージに従います。 メッセージがサービスによって受信、拒否、延期、または配信されたかどうかを確認できます。 メッセージが最終的な状態になる前に、メッセージに行われた処理も表示します。

セキュリティ/コンプライアンス センター&トレースにより、Exchange 管理センター (EAC) で使用できる元のメッセージ追跡が向上します。 メッセージ追跡からの情報を使用して、メッセージに何が起こったかについてのユーザーの質問に効率的に回答し、メール フローの問題をトラブルシューティングし、ポリシーの変更を検証できます。

> [!NOTE]
>
> - メッセージ追跡を行うには、組織の管理、コンプライアンス管理、またはヘルプ デスクの役割グループのメンバーである必要があります。 詳細については、「[セキュリティ/コンプライアンス センターのアクセス許可](permissions-in-the-security-and-compliance-center.md)」を参照してください。
>
> - 結果に表示されるメッセージの最大数は、選択したレポートの種類によって異なります (詳細については、「レポートの種類の選択 [」セクションを](#choose-report-type) 参照してください)。 Exchange Online PowerShell またはスタンドアロンの EOP PowerShell の [Get-HistoricalSearch](https://docs.microsoft.com/powershell/module/exchange/get-historicalsearch) コマンドレットは、結果のすべてのメッセージを返します。

## <a name="open-message-trace"></a>メッセージ追跡を開く

1. セキュリティ/コンプライアンス センター&開きます <https://protection.office.com> 。

2. [メール **フロー] を展開** し、[メッセージの追跡 **] を選択します**。

## <a name="message-trace-page"></a>メッセージ追跡ページ

ここから、[トレースの開始] ボタンをクリックして、新しい既定 **のトレースを開始** できます。 これにより、最近 2 日間のすべての送信者と受信者のすべてのメッセージが検索されます。 または、使用可能なクエリ カテゴリの保存されたクエリのいずれかを使用して、それらを現在の形式で実行するか、独自のクエリの開始点として使用することができます。

- **既定のクエリ**: Microsoft 365 によって提供される組み込みクエリ。

- **カスタム クエリ**: 組織の管理者が将来使用するために保存したクエリ。

- **自動保存されたクエリ**: 最近実行された最後の 10 個のクエリ。 この一覧を使用すると、左側から簡単に選択できます。

また、このページには、提出した要求のダウンロード可能なレポート セクションと、ダウンロード可能なレポートがある場合のレポート自体も含まれる。

## <a name="options-for-a-new-message-trace"></a>新しいメッセージ追跡のオプション

### <a name="filter-by-senders-and-recipients"></a>送信者と受信者によるフィルター処理

既定値は [ **すべての送信者]** および **[すべての** 受信者] ですが、次のフィールドを使用して結果をフィルター処理できます。

- **By these people**: Click in this field to select one or more senders from your organization. また、名前の入力を開始すると、検索ページの動作と同様に、リスト内のアイテムが入力した値でフィルター処理されます。

- **To these people**: Click in this field to select one or more recipients in your organization.

> [!NOTE]
>
> - 外部の送信者と受信者の電子メール アドレスを入力することもできます。 ワイルドカードはサポートされますが (たとえば)、同じフィールドで同時に複数のワイルドカード エントリ `*@contoso.com` を使用することはできません。
>
> - 複数の送信者または受信者の一覧をセミコロン () で区切って貼り付けできます `;` 。 スペース ( `\s` )、キャリッジ リターン ( `\r` )、または次の行 ( `\n` )。

### <a name="time-range"></a>時間範囲

既定値は **2 日ですが**、最大 90 日間の日付/時刻の範囲を指定できます。 日付/時刻の範囲を使用する場合は、次の問題を考慮してください。

- 既定では、スライダー ビューでタイム ラインを **使用して** 時間範囲を選択します。 表示される日または時刻の設定のみを選択できます。 間隔内の値を選択すると、開始/終了バブルが最も近い表示設定にスナップされます。

  ![セキュリティ/コンプライアンス センターの新しいメッセージ トレース&範囲](../../media/55a9e9c1-f7d5-4047-b217-824e8b976bcb.png)

  ただし、カスタム ビューに切り替えて、開始日と終了日の値(時刻を含む) を指定し、日付/時刻範囲のタイム ゾーンを選択することもできます。  タイム ゾーンの **設定は** 、クエリ入力とクエリ結果の両方に適用されます。

  ![セキュリティ/コンプライアンス センターの新しいメッセージ追跡のカスタム&範囲](../../media/ed4c8d50-9ea5-4694-93f9-ee3ab6660b4f.png)

  10 日以下の場合、結果は概要レポートとしてすぐに **利用** できます。 10 日を少し超える時間範囲を指定した場合、ダウンロード可能な CSV ファイル **(拡張** 概要レポートまたは拡張レポート) としてのみ利用可能な結果が遅延します。

  さまざまなレポートの種類の詳細については、この記事の「レポートの種類の [選択」](#choose-report-type) セクションを参照してください。

  > [!NOTE]
  > 拡張概要レポートと拡張レポートは、アーカイブされたメッセージ 追跡データを使用して準備され、レポートをダウンロードできるまで最大数時間かかる場合があります。 同時にレポート要求を送信した他の管理者の数によっては、キューに入っている要求の処理が開始される前に遅延が発生する場合もあります。

- スライダー ビューにクエリ **を保存** すると、相対時間範囲 (今日から 3 日など) が保存されます。 カスタム ビューにクエリを保存すると、絶対日付/時刻範囲が保存されます (たとえば、2018-05-06 13:00 ~ 2018-05-08 18:00)。

### <a name="more-search-options"></a>その他の検索オプション

#### <a name="delivery-status"></a>配信状態

既定値の [すべて] **を選択** したままにするか、次のいずれかの値を選択して結果をフィルター処理できます。

- **配信**: メッセージは意図した宛先に正常に配信されました。

- **保留中**: メッセージの配信が試行または再試行されています。

- **展開:** 配布グループの受信者が、グループの個々のメンバーに配信される前に展開されました。

- **Failed**: メッセージが配信されません。

- **検疫済** み : メッセージが検疫されました (スパム、バルク メール、またはフィッシングとして)。 詳細については [、「EOP での検疫済み電子メール メッセージ」を参照してください](quarantine-email-messages.md)。

- **スパムとしてフィルター** 処理 : メッセージはスパムとして識別され、拒否またはブロックされました (検疫されていない)。

- **状態の取得:** メッセージは Microsoft 365 によって最近受信されましたが、他の状態データはまだ利用できません。 数分後に確認してください。

> [!NOTE]
> [保留中 **]、[****検疫済み**]、および [スパムとしてフィルター処理] の値は、10 日未満の検索でのみ使用できます。  また、実際の配信状態と報告された配信状態の間に 5 ~ 10 分の遅延が発生する場合があります。

#### <a name="message-id"></a>メッセージ ID

これは、メッセージ ヘッダーの **Message-ID:** ヘッダー フィールドにあるインターネット メッセージ ID (クライアント ID とも呼ばれる) です。 ユーザーは、特定のメッセージを調査するためにこの値を提供できます。

この値は、メッセージの有効期間全体にわたって不変です。 Microsoft 365 または Exchange で作成されたメッセージの場合、値の形式は、角かっこ ( ) `<GUID@ServerFQDN>` を含みます \< \> 。 たとえば、`<d9683b4c-127b-413a-ae2e-fa7dfb32c69d@DM3NAM06BG401.Eop-nam06.prod.protection.outlook.com>` などです。 他のメッセージング システムでは、異なる構文または値を使用する場合があります。 この値は一意の値と想定されますが、すべての電子メール システムが厳密にこの要件に従うとは言えなっています。 **Message-ID:** ヘッダー フィールドが存在しない場合、または外部ソースからの受信メッセージに対して空白の場合は、任意の値が割り当てられます。

メッセージ ID を **使用して結果** をフィルター処理する場合は、必ず完全な文字列 (任意の角かっこを含む) を含める必要があります。

#### <a name="direction"></a>Direction

既定値の [すべて]を選択のままにするか、受信 **(組織内** の受信者に送信されるメッセージ) または送信 **(組織内** のユーザーから送信されたメッセージ) を選択して結果をフィルター処理できます。

#### <a name="original-client-ip-address"></a>元のクライアント IP アドレス

クライアント IP アドレスで結果を報告し、大量のスパムやマルウェアを送信しているハッキングされたコンピューターを調査できます。 メッセージは複数の送信者から送信されたと思える場合でも、同じコンピューターがすべてのメッセージを生成している可能性があります。

> [!NOTE]
> クライアント IP アドレス情報は 10 日間のみ利用可能で、拡張概要レポートまたは拡張レポート(ダウンロード可能な CSV ファイル) でのみ使用できます。

### <a name="choose-report-type"></a>レポートの種類を選択する

使用可能なレポートの種類は次のとおりです。

- **概要**: 時間範囲が 10 日未満で、追加のフィルター オプションが必要ない場合に使用できます。 検索結果は、[検索] をクリックした直後に **表示されます**。 レポートは最大 20,000 件の結果を返します。

- **拡張概要** または拡張 **:** これらのレポートは、ダウンロード可能な CSV ファイルとしてのみ使用できます。時間の範囲に関係なく、次の 1 つ以上のフィルターオプションが必要 **です**。  送信者または受信者に対してワイルドカードを使用できます \* (@contoso.com など)。 拡張概要レポートは、最大 5,0000 件の結果を返します。 拡張レポートは、最大 1000 件の結果を返します。

> [!NOTE]
> 
> - 拡張概要レポートと拡張レポートは、アーカイブされたメッセージ トレース データを使用して準備され、レポートをダウンロードできるまで最大で数時間かかる場合があります。 同時にレポート要求を送信した他の管理者の数によっては、キューに入っている要求の処理が開始される前に遅延が発生する場合もあります。
> 
> - 任意の日付/時刻範囲に対して拡張概要レポートまたは拡張レポートを選択することもできますが、通常、アーカイブされたデータの最後の 4 時間は、この 2 種類のレポートではまだ利用できません。

[次へ] をクリックすると、選択したフィルター オプション、レポートの一意の (編集可能な) タイトル、およびメッセージの追跡が完了するときに通知を受け取る電子メール アドレス (編集可能で、組織の受け入れドメインの 1 つにある必要があります) を一覧表示する概要ページが表示されます。 [ **レポートの準備] を** クリックしてメッセージ追跡を送信します。 メインの [ **メッセージの追跡** ] ページで、[ダウンロード可能なレポート] セクションでレポートの状態 **を確認** できます。

さまざまなレポートの種類で返される情報の詳細については、次のセクションを参照してください。

## <a name="message-trace-results"></a>メッセージ追跡の結果

レポートの種類によって返される情報のレベルは異なります。 さまざまなレポートで利用できる情報については、次のセクションで説明します。

### <a name="summary-report-output"></a>概要レポートの出力

メッセージ追跡を実行すると、結果が一覧表示され、降順の日付/時刻 (最新の日付/時刻) で並べ替えされます。

![セキュリティ/コンプライアンス センターでのメッセージ追跡の概要&結果](../../media/0664bafe-0b03-477b-b571-0b046ac8c977.png)

概要レポートには、次の情報が含まれます。

- **日付**: 構成済みの UTC タイム ゾーンを使用して、サービスがメッセージを受信した日時。

- **Sender**: 送信者の電子メール アドレス (*エイリアス* @ *ドメイン*)。

- **Recipient**: 受信者または受信者の電子メール アドレス。 複数の受信者に送信されるメッセージの場合、受信者ごとに 1 行が表示されます。 受信者が配布グループ、動的配布グループ、またはメールが有効なセキュリティ グループである場合、グループは最初の受信者であり、グループの各メンバーは別の行になります。

- **件名**: メッセージの **Subject:** フィールドの最初の 256 文字。

- **Status**: これらの値については、「配信状態 [」セクションで説明](#delivery-status) されています。

既定では、最初の 250 件の結果が読み込まれ、すぐに利用できます。 下にスクロールすると、次の結果のバッチが読み込まれると、少し一時停止します。 スクロールする代わりに、[すべて読み込む] をクリックすると、すべての結果を最大 10,000 まで読み込む必要があります。

列見出しをクリックすると、その列の値を昇順または降順で並べ替えることができます。

[結果の **フィルター処理] をクリック** すると、1 つ以上の列で結果をフィルター処理できます。

1 つ以上の行を選択した後に結果をエクスポートするには、[結果のエクスポート] をクリックし、[すべての結果をエクスポートする]、読み込まれた結果をエクスポートする、**または選択した** エクスポートを選択 **します**。

#### <a name="find-related-records-for-this-message"></a>このメッセージの関連レコードを検索する

関連するメッセージ レコードは、同じメッセージ ID を共有したレコードです。 2 人のユーザー間で 1 つのメッセージを送信しても、複数のレコードが生成される可能性があります。 メッセージが配布グループの展開、転送、メール フロー ルール (トランスポート ルールとも呼ばれる) の影響を受ける場合、レコードの数が増えます。

行のチェック ボックスをオンにした後、表示される [関連するレコードの検索]ボタンをクリックするか、[その他のオプション]を選択して、メッセージに関連するレコードを検索できます。 ![ ](../../media/1ea52bbf-9d00-48ce-9362-307f7f6fb7fe.png) \> 

メッセージ ID の詳細については、この記事の「メッセージ ID」セクションを参照してください。

#### <a name="message-trace-details"></a>メッセージ追跡の詳細

概要レポートの出力では、次のいずれかの方法を使用して、メッセージに関する詳細を表示できます。

- 行を選択します (チェック ボックスを除く行の任意の場所をクリックします)。

- 行のチェック ボックスをオンにし、[その他のオプション] **をクリックします** ![ 。メッセージ ](../../media/1ea52bbf-9d00-48ce-9362-307f7f6fb7fe.png) \> **の詳細を表示します**。

   ![概要レポートのメッセージ追跡結果の行をダブルクリックした後の詳細は、セキュリティ/コンプライアンス センター&結果](../../media/e50ee7cd-810a-4c06-8b58-e56ffd7028d1.png)

メッセージ追跡の詳細には、概要レポートには表示されない次の追加情報が含まれます。

- **メッセージ イベント**: このセクションには、サービスがメッセージに対して実行するアクションを分類するのに役立つ分類が含まれます。 **発生する可能性がある、より興味深** いイベントの一部を次に示します。

  - **Receive**: サービスがメッセージを受信しました。

  - **送信**: サービスによってメッセージが送信されました。

  - **Fail**: メッセージの配信に失敗しました。

  - **配信**: メッセージがメールボックスに配信されました。

  - **Expand**: メッセージが展開された配布グループに送信されました。

  - **転送**: コンテンツ変換、メッセージ受信者の制限、またはエージェントのために、受信者が分岐メッセージに移動されました。

  - **Defer**: メッセージ配信が延期され、後で再試行される可能性があります。

  - **解決済** み : メッセージは、Active Directory の検索に基づいて新しい受信者アドレスにリダイレクトされました。 このイベントが発生した場合、メッセージ トレースの別の行に、メッセージの最終配信状態と併せて、元の受信者のアドレスが表示されます。

  > [!NOTE]
  > 
  > - 問題のあるメッセージが正常に配信されると、メッセージトレースに複数の **イベント** エントリが生成されます。
  > 
  > - この一覧は、完全な機能を提供することを意図したのではありません。 その他のイベントの詳細については、メッセージ追跡ログ [のイベントの種類を参照してください](https://docs.microsoft.com/Exchange/mail-flow/transport-logs/message-tracking#event-types-in-the-message-tracking-log)。 このリンクは、Exchange Server (オンプレミスの Exchange) トピックです。

- **詳細:** このセクションには、次の詳細が含まれます。

  - **メッセージ ID**: この値については、この記事の「 [メッセージ ID」](#message-id) セクションで説明しました。 たとえば、`<d9683b4c-127b-413a-ae2e-fa7dfb32c69d@DM3NAM06BG401.Eop-nam06.prod.protection.outlook.com>` などです。

  - **メッセージ サイズ**   添付ファイルを含むキロバイト (KB) 単位のメッセージのサイズ。

  - **[IP から**]: メッセージを送信したコンピューターの IP アドレスです。 Exchange Online から送信された送信メッセージの場合、この値は空白です。

  - **TO IP**: サービスがメッセージを配信しようとした IP アドレス。 メッセージに複数の受信者がある場合は、これらの受信者が表示されます。 Exchange Online に送信された受信メッセージの場合、この値は空白です。

### <a name="enhanced-summary-reports"></a>拡張概要レポート

利用可能な (完了した) 拡張概要レポートは、メッセージ追跡の開始時点の [ダウンロード可能なレポート] セクションで確認できます。 レポートでは、次の情報を確認できます。

- **origin_timestamp**: 構成済みの UTC タイム ゾーンを使用して、サービスがメッセージを最初に受信した <sup>*</sup> 日時です。

- **sender_address**: 送信者の電子メール アドレス (*エイリアス* @ *ドメイン*)。

- **Recipient_status**: 受信者へのメッセージの配信の状態。 メッセージが複数の受信者に送信された場合は、次の形式で、すべての受信者とそれぞれの対応する状態が表示されます \<*email address*\> ## \<*status*\> 。 例:

  - **##Receive送信は** 、メッセージがサービスによって受信され、目的の送信先に送信されたという意味です。

  - **##Receive失敗は** 、サービスがメッセージを受信したが、目的の送信先への配信が失敗した場合を意味します。

  - **##Receiveは、メッセージ** がサービスによって受信され、受信者のメールボックスに配信されたという意味です。

- **message_subject**: メッセージの [件名] フィールドの最初の 256 **文字** 。

- **total_bytes**: 添付ファイルを含むメッセージのサイズ (バイト単位)。

- **message_id**: この値については、この記事の「 [メッセージ ID」](#message-id) セクションで説明しました。 たとえば、`<d9683b4c-127b-413a-ae2e-fa7dfb32c69d@DM3NAM06BG401.Eop-nam06.prod.protection.outlook.com>` などです。

- **network_message_id**: メッセージのすべてのコピーで保持される一意のメッセージ ID 値です。メッセージの分岐または配布グループの展開によって作成される可能性があります。 値の例は次のようになります `1341ac7b13fb42ab4d4408cf7f55890f` 。

- **original_client_ip**: 送信者のクライアントの IP アドレス。

- **方向**: メッセージが組織に受信 (1) 送信されたかどうか、または組織から送信された (2) かどうかを示します。

- **connector_id**: 送信元コネクタまたは宛先コネクタの名前。 Exchange Online のコネクタの詳細については、「Configure [mail flow using connectors in Office 365](https://docs.microsoft.com/Exchange/mail-flow-best-practices/use-connectors-to-configure-mail-flow/use-connectors-to-configure-mail-flow)」を参照してください。

- **delivery_priority**: メッセージが高、低、または標準の優先度 <sup>*</sup> で **送信されたかどうか**。  

<sup>*</sup> これらのプロパティは、拡張サマリー レポートでのみ使用できます。

### <a name="extended-reports"></a>拡張レポート

利用可能な (完了した) 拡張レポートは、メッセージ追跡の開始時 **の** [ダウンロード可能なレポート] セクションで確認できます。 拡張概要レポートの事実上すべての情報は、拡張レポートで使用できます (ただし、origin_timestamp **および****delivery_priority)。** 次の追加情報は、拡張レポートでのみ使用できます。

- **client_ip**: メッセージを送信した電子メール サーバーまたはメッセージング クライアントの IP アドレス。

- **client_hostname**: メッセージを送信した電子メール サーバーまたはメッセージング クライアントのホスト名または FQDN。

- **server_ip**: 送信元または送信先サーバーの IP アドレス。

- **server_hostname**: 送信先サーバーのホスト名または FQDN。

- **source_context**: ソース フィールドに関連付けられている追加 **の情報** 。 例:

  - `Protocol Filter Agent`

  - `3489061114359050000`

- **source**: イベントを担当する Exchange Online コンポーネント。 例:

  - `AGENT`

  - `MAILBOXRULE`

  - `SMTP`

- **event_id**: これらは、このメッセージ **の関連** レコードの検索に関するセクションで説明されている [Message イベント値に対応](#find-related-records-for-this-message) します。

- **internal_message_id**: 現在メッセージを処理している Exchange Online サーバーによって割り当てられたメッセージ識別子。

- **recipient_address**: メッセージの受信者の電子メール アドレス。 複数の電子メール アドレスがある場合は、セミコロン (;) で区切られます。

- **recipient_count**: メッセージ内の受信者の総数です。

- **related_recipient_address**: メッセージに関連付けられている他の受信者の電子メール アドレスを表示するために、イベントと `EXPAND` `REDIRECT` `RESOLVE` 一緒に使用されます。

- **reference**: このフィールドには、特定の種類のイベントに関する追加情報が含まれる。 例:

  - **DSN**: このイベントの後に DSN が生成された場合に、関連付けられた配信状態通知 (DSN、配信前レポート、NDR、またはバウンス メッセージとも呼ばれる) の **message_id** 値であるレポート リンクを格納します。 これが DSN メッセージの場合、このフィールドには DSN **message_id** 元のメッセージの値が含まれる。

  - **EXPAND**: 関連するメッセージ **related_recipient_address** 値を格納します。

  - **RECEIVE**: メッセージが他の **message_id** (受信トレイ ルールなど) によって生成された場合、関連するメッセージの値を含む場合があります。

  - **SEND**: DSN メッセージの **internal_message_id** 値を格納します。

  - **TRANSFER**: フォーク **されているinternal_message_id** の値を格納します (たとえば、コンテンツ変換、メッセージ受信者の制限、エージェント別)。

  - **MAILBOXRULE**: 受信 **internal_message_id** 送信メッセージを生成する原因となる受信メッセージの値を格納します。

    他の種類のイベントの場合、通常、このフィールドは空白です。

- **return_path**: メッセージを送信した **MAIL FROM** コマンドで指定された電子メール アドレスを返します。 このフィールドは空にすることはできませんが、null の送信者アドレス値を表す値を持つ場合があります `<>` 。

- **message_info**: メッセージに関する追加情報。 例:

  - イベントのメッセージの配信日時 `DELIVER` `SEND` (UTC)。 配信日時は、メッセージが最初に Exchange Online 組織に入った時刻です。 UTC の日付と時刻は、ISO 8601 の日付と時刻の形式で表されます。ここで、= 年、= 月、= 日は、時刻コンポーネントの開始を示し `yyyy-mm-ddThh:mm:ss.fffZ` `yyyy` `mm` `dd` `T` `hh` 、= 時、 `mm` 分 `ss` 、= 秒 `fff` 、= `Z` `Zulu` 秒の小数部を示し、UTC を示すもう 1 つの方法です。

  - 認証エラー。 たとえば、認証エラーが発生した際に使用された認証の値と種類 `11a` が表示される場合があります。

- **tenant_id**: Exchange Online 組織を表す GUID 値 (例 `39238e87-b5ab-4ef6-a559-af54c6b07b42` : )。

- **original_server_ip**: 元のサーバーの IP アドレス。

- **custom_data**: 特定のイベントの種類に関連するデータが格納されています。 詳細については、以下のセクションを参照してください。

#### <a name="custom_data-values"></a>custom_data値

イベント **custom_data** フィールドは、さまざまな Exchange Online エージェントがメッセージ処理の詳細をログ `AGENTINFO` に記録するために使用します。 次のセクションでは、より興味深いエージェントの一部について説明します。

#### <a name="spam-filter-agent"></a>スパム フィルター エージェント

最初 **custom_data** 値はスパム フィルター `S:SFA` エージェントからの値です。 主な詳細については、次の表で説明します。

****

|値|説明|
|---|---|
|`SFV=NSPM`|メッセージがスパムではないとしてマークされ、意図された受信者に送信されました。|
|`SFV=SPM`|メッセージはスパム対策フィルター (コンテンツ フィルターとも呼ばれる) によってスパムとしてマークされました。|
|`SFV=BLK`|ブロックする差出人から発信されたメッセージであるため、フィルター処理が省略され、メッセージはブロックされました。|
|`SFV=SKS`|メッセージはスパム対策フィルターによって処理される前にスパムとしてマークされました。 これには、メッセージを自動的にスパムメールとしてマークし、他のすべてのフィルター処理を省略するトランスポート ルールに一致するメッセージが含まれます。|
|`SCL=<number>`|さまざまな SCL の値とその意味の詳細については、「[Spam Confidence Level](spam-confidence-levels.md)」を参照してください。|
|`PCL=<number>`|メッセージの Phishing Confidence Level (PCL) 値。これらの値は、「[Spam Confidence Level](spam-confidence-levels.md)」に記載されている SCL 値と同様に解釈できます。  |
|`DI=SB`|メッセージの送信者はブロックされました。|
|`DI=SQ`|メッセージは検疫されました。|
|`DI=SD`|メッセージは削除されました。|
|`DI=SJ`|メッセージは受信者の迷惑メール フォルダーに送信されました。|
|`DI=SN`|メッセージは通常の送信用の配信プールを通じて送信されました。|
|`DI=SO`|メッセージがより危険度の高い配信プールを経由してルーティングされました。 詳細については、「[送信メッセージにおける危険度の高い配信プール](high-risk-delivery-pool-for-outbound-messages.md)」を参照してください。|
|`SFS=[a]|SFS=[b]`|これはスパム ルールが一致したことを示します。|
|`IPV=CAL`|このメッセージの IP アドレスは接続フィルターの IP 許可一覧に指定されているため、スパム フィルターの通過を許可されました。|
|`H=<EHLOstring>`|接続メール サーバーの HELO または EHLO 文字列。|
|`PTR=<ReverseDNS>`|送信元の IP アドレスの PTR レコード (逆引き DNS アドレスともいう) です。|
|

次のような **custom_data** フィルター処理されたメッセージの値を取得する例を示します。

`S:SFA=SUM|SFV=SPM|IPV=CAL|SRV=BULK|SFS=470454002|SFS=349001|SCL=9|SCORE=-1|LIST=0|DI=SN|RD=ftmail.inc.com|H=ftmail.inc.com|CIP=98.129.140.74|SFP=1501|ASF=1|CTRY=US|CLTCTRY=|LANG=en|LAT=287|LAT=260|LAT=18;`

#### <a name="malware-filter-agent"></a>マルウェア フィルター エージェント

最初 **custom_data** 値は `S:AMA` マルウェア フィルター エージェントからの値です。 主な詳細については、次の表で説明します。

****

|値|説明|
|---|---|
|`AMA=SUM|v=1|` または `AMA=EV|v=1`|このメッセージは、マルウェアが含まれていると判断されました。 `SUM` は、マルウェアが任意の数のエンジンによって検出された可能性を示します。 `EV` は、マルウェアが特定のエンジンによって検出されたかどうかを示します。 エンジンでマルウェアが検出された場合は、後続のアクションをトリガーします。|
|`Action=r`|メッセージは置き換えられました。|
|`Action=p`|メッセージはバイパスされました。|
|`Action=d`|メッセージは延期されました。|
|`Action=s`|メッセージは削除されました。|
|`Action=st`|メッセージはバイパスされました。|
|`Action=sy`|メッセージはバイパスされました。|
|`Action=ni`|メッセージは拒否されました。|
|`Action=ne`|メッセージは拒否されました。|
|`Action=b`|メッセージはブロックされました。|
|`Name=<malware>`|検出されたマルウェアの名前。|
|`File=<filename>`|マルウェアを含むファイルの名前。|
|

マルウェアを **custom_data** 含むメッセージの値の例は次のようになります。

`S:AMA=SUM|v=1|action=b|error=|atch=1;S:AMA=EV|engine=M|v=1|sig=1.155.974.0|name=DOS/Test_File|file=filename;S:AMA=EV|engine=A|v=1|sig=201707282038|name=Test_File|file=filename`

#### <a name="transport-rule-agent"></a>トランスポート ルール エージェント

最初 **custom_data** の値は、メール フロー ルール (トランスポート ルールとも呼ばれる) のトランスポート ルール `S:TRA` エージェントからの値です。 主な詳細については、次の表で説明します。

****

|値|説明|
|---|---|
|`ETR|ruleId=<guid>`|一致したルールの ID。|
|`St=<datetime>`|ルールの一致が発生した日時 (UTC)。|
|`Action=<ActionDefinition>`|適用されたアクション。 使用可能なアクションの一覧については [、「Exchange Online のメール フロー ルールアクション」を参照してください](https://docs.microsoft.com/exchange/security-and-compliance/mail-flow-rules/mail-flow-rule-actions)。|
|`Mode=<Mode>`|ルールのモード。 有効な値は次のとおりです。<ul><li>**[強制**]: ルールのすべてのアクションが適用されます。</li><li>**ポリシー ヒントを使用したテスト:** ポリシー ヒントアクションは送信されますが、他の強制アクションは実行されません。</li><li>**ポリシー ヒントなしの** テスト : アクションはログ ファイルに一覧表示されますが、送信者には通知されません。強制アクションは実行されません。</li></ul>|
|

メール フロー **custom_data** 条件に一致するメッセージの値の例は次のようになります。

`S:TRA=ETR|ruleId=19a25eb2-3e43-4896-ad9e-47b6c359779d|st=7/17/2017 12:31:25 AM|action=ApplyHtmlDisclaimer|sev=1|mode=Enforce`
