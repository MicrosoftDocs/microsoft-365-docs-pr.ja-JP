---
title: メール フロー ルールを使用して実行可能な添付ファイルを含むメッセージをブロックする
f1.keywords:
- NOCSH
ms.author: chrisda
author: chrisda
manager: dansimp
ms.date: ''
audience: ITPro
ms.topic: how-to
localization_priority: Normal
ms.assetid: c4fb4a86-b772-49d0-8773-e8ee897e175d
ms.custom:
- seo-marvel-apr2020
description: 管理者は、実行可能な添付ファイルを含むメッセージをブロックするメール フロー ルール (トランスポート ルール) を作成する方法について学習できます。
ms.technology: mdo
ms.prod: m365-security
ms.openlocfilehash: 012557b2e0e34cdafd33c2d4a8291283dbd5e35c
ms.sourcegitcommit: dcb97fbfdae52960ae62b6faa707a05358193ed5
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/25/2021
ms.locfileid: "51206625"
---
# <a name="use-mail-flow-rules-to-block-messages-with-executable-attachments-in-eop"></a><span data-ttu-id="5709e-103">メール フロー ルールを使用して EOP で実行可能な添付ファイルを含むメッセージをブロックする</span><span class="sxs-lookup"><span data-stu-id="5709e-103">Use mail flow rules to block messages with executable attachments in EOP</span></span>

[!INCLUDE [Microsoft 365 Defender rebranding](../includes/microsoft-defender-for-office.md)]

<span data-ttu-id="5709e-104">**適用対象**</span><span class="sxs-lookup"><span data-stu-id="5709e-104">**Applies to**</span></span>
- [<span data-ttu-id="5709e-105">Exchange Online Protection</span><span class="sxs-lookup"><span data-stu-id="5709e-105">Exchange Online Protection</span></span>](exchange-online-protection-overview.md)
- [<span data-ttu-id="5709e-106">Microsoft Defender for Office 365 プラン 1 およびプラン 2</span><span class="sxs-lookup"><span data-stu-id="5709e-106">Microsoft Defender for Office 365 plan 1 and plan 2</span></span>](defender-for-office-365.md)
- [<span data-ttu-id="5709e-107">Microsoft 365 Defender</span><span class="sxs-lookup"><span data-stu-id="5709e-107">Microsoft 365 Defender</span></span>](../defender/microsoft-365-defender.md)

<span data-ttu-id="5709e-108">Microsoft 365 Exchange Online またはスタンドアロン Exchange Online Protection (EOP) 組織に Exchange Online メールボックスがない組織では、EOP はマルウェア対策ポリシーを使用して、実行可能な添付ファイルを含むメッセージを含む有害なメッセージをブロックします。</span><span class="sxs-lookup"><span data-stu-id="5709e-108">In Microsoft 365 organizations with mailboxes in Exchange Online or standalone Exchange Online Protection (EOP) organizations without Exchange Online mailboxes, EOP uses anti-malware policies to block harmful messages, including messages with executable attachments.</span></span> <span data-ttu-id="5709e-109">詳細については [、「EOP でのマルウェア対策保護」を参照してください](anti-malware-protection.md)。</span><span class="sxs-lookup"><span data-stu-id="5709e-109">For more information, see [Anti-malware protection in EOP](anti-malware-protection.md).</span></span>

<span data-ttu-id="5709e-110">保護をさらに強化するために、メール フロー ルール (トランスポート ルールとも呼ばれる) を使用して、この記事で説明するように実行可能な添付ファイルを含むメッセージを識別およびブロックできます。</span><span class="sxs-lookup"><span data-stu-id="5709e-110">To further enhance protection, you can use mail flow rules (also known as transport rules) to identify and block messages that contain executable attachments as described in this article.</span></span>

<span data-ttu-id="5709e-111">たとえば、マルウェアの発生後に、影響を受けるユーザーが指定した時間の後に添付ファイルの送信に戻って取得できるよう、時間制限付きこのルールを適用できます。</span><span class="sxs-lookup"><span data-stu-id="5709e-111">For example, following a malware outbreak, a company could apply this rule with a time limit so that affected users can get back to sending attachments after a specified length of time.</span></span>

## <a name="what-do-you-need-to-know-before-you-begin"></a><span data-ttu-id="5709e-112">始める前に把握しておくべき情報</span><span class="sxs-lookup"><span data-stu-id="5709e-112">What do you need to know before you begin?</span></span>

- <span data-ttu-id="5709e-113">この記事の手順を実行するには、Exchange OnlineまたはExchange Online Protectionにアクセス許可を割り当てる必要があります。</span><span class="sxs-lookup"><span data-stu-id="5709e-113">You need to be assigned permissions in Exchange Online or Exchange Online Protection before you can do the procedures in this article.</span></span> <span data-ttu-id="5709e-114">具体的には、既定で組織の管理、コンプライアンス管理、レコード管理の役割グループに割り当てられているトランスポート **ルールの役割** が必要です。 </span><span class="sxs-lookup"><span data-stu-id="5709e-114">Specifically, you need the **Transport Rules** role, which is assigned to the **Organization Management**, **Compliance Management**, and **Records Management** role groups by default.</span></span>

  <span data-ttu-id="5709e-115">詳細については、次のトピックをご覧ください。</span><span class="sxs-lookup"><span data-stu-id="5709e-115">For more information, see the following topics:</span></span>

  - [<span data-ttu-id="5709e-116">Exchange Online のアクセス許可</span><span class="sxs-lookup"><span data-stu-id="5709e-116">Permissions in Exchange Online</span></span>](/exchange/permissions-exo/permissions-exo)
  - [<span data-ttu-id="5709e-117">スタンドアロン EOP のアクセス許可</span><span class="sxs-lookup"><span data-stu-id="5709e-117">Permissions in standalone EOP</span></span>](feature-permissions-in-eop.md)
  - [<span data-ttu-id="5709e-118">役割グループ内のメンバーの一覧を変更する EAC を使用する</span><span class="sxs-lookup"><span data-stu-id="5709e-118">Use the EAC modify the list of members in role groups</span></span>](manage-admin-role-group-permissions-in-eop.md#use-the-eac-modify-the-list-of-members-in-role-groups)

- <span data-ttu-id="5709e-119">EAC を開く方法については、「Exchange Onlineの管理[Exchange」を参照Exchange Online。](/Exchange/exchange-admin-center)</span><span class="sxs-lookup"><span data-stu-id="5709e-119">To open the EAC in Exchange Online, see [Exchange admin center in Exchange Online](/Exchange/exchange-admin-center).</span></span> <span data-ttu-id="5709e-120">スタンドアロン EOP で EAC を開く方法については、「スタンドアロン[EOP Exchange管理センター」を参照してください](exchange-admin-center-in-exchange-online-protection-eop.md)。</span><span class="sxs-lookup"><span data-stu-id="5709e-120">To open the EAC in standalone EOP, see [Exchange admin center in standalone EOP](exchange-admin-center-in-exchange-online-protection-eop.md).</span></span>

- <span data-ttu-id="5709e-121">Exchange Online PowerShell へ接続するには、「[Exchange Online PowerShell に接続する](/powershell/exchange/connect-to-exchange-online-powershell)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="5709e-121">To connect to Exchange Online PowerShell, see [Connect to Exchange Online PowerShell](/powershell/exchange/connect-to-exchange-online-powershell).</span></span> <span data-ttu-id="5709e-122">スタンドアロンの EOP PowerShell に接続するには、「[Exchange Online Protection PowerShell への接続](/powershell/exchange/connect-to-exchange-online-protection-powershell)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="5709e-122">To connect to standalone EOP PowerShell, see [Connect to Exchange Online Protection PowerShell](/powershell/exchange/connect-to-exchange-online-protection-powershell).</span></span>

- <span data-ttu-id="5709e-123">EOP とスタンドアロン EOP のメール フロー ルールExchange Online詳細については、次のトピックを参照してください。</span><span class="sxs-lookup"><span data-stu-id="5709e-123">For more information about mail flow rules in Exchange Online and standalone EOP, see the following topics:</span></span>

  - [<span data-ttu-id="5709e-124">Exchange Online のメール フロー ルール (トランスポート ルール)</span><span class="sxs-lookup"><span data-stu-id="5709e-124">Mail flow rules (transport rules) in Exchange Online</span></span>](/Exchange/security-and-compliance/mail-flow-rules/mail-flow-rules)

  - [<span data-ttu-id="5709e-125">Exchange Online のメール フロー ルールでの条件と例外 (述語)</span><span class="sxs-lookup"><span data-stu-id="5709e-125">Mail flow rule conditions and exceptions (predicates) in Exchange Online</span></span>](/Exchange/security-and-compliance/mail-flow-rules/conditions-and-exceptions)

  - [<span data-ttu-id="5709e-126">Exchange Online でのメール フロー ルールの処理</span><span class="sxs-lookup"><span data-stu-id="5709e-126">Mail flow rule actions in Exchange Online</span></span>](/Exchange/security-and-compliance/mail-flow-rules/mail-flow-rule-actions)

## <a name="use-the-eac-to-create-a-rule-that-blocks-messages-with-executable-attachments"></a><span data-ttu-id="5709e-127">EAC を使用して、実行可能な添付ファイルを含むメッセージをブロックするルールを作成する</span><span class="sxs-lookup"><span data-stu-id="5709e-127">Use the EAC to create a rule that blocks messages with executable attachments</span></span>

1. <span data-ttu-id="5709e-128">EAC で、 **[メール フロー]** \> **[ルール]** に移動します。</span><span class="sxs-lookup"><span data-stu-id="5709e-128">In the EAC, go to **Mail flow** \> **Rules**.</span></span>

2. <span data-ttu-id="5709e-129">[追加 **] アイコン** ![ をクリックし ](../../media/ITPro-EAC-AddIcon.png) 、[新しいルール **の作成] を選択します**。</span><span class="sxs-lookup"><span data-stu-id="5709e-129">Click **Add** ![Add icon](../../media/ITPro-EAC-AddIcon.png) and then select **Create a new rule**.</span></span>

3. <span data-ttu-id="5709e-130">**[新しいルール]** のページが開いたら、以下の設定を行ってください:</span><span class="sxs-lookup"><span data-stu-id="5709e-130">In the **New rule** page that opens, configure the following settings:</span></span>

   - <span data-ttu-id="5709e-131">**名前**: ルールの一意でわかりやすい名前を入力します。</span><span class="sxs-lookup"><span data-stu-id="5709e-131">**Name**: Enter a unique, descriptive name for the rule.</span></span>

   - <span data-ttu-id="5709e-132">[**その他のオプション**] をクリックします。</span><span class="sxs-lookup"><span data-stu-id="5709e-132">Click **More Options**.</span></span>

   - <span data-ttu-id="5709e-133">**[任意の添付ファイルに実行可能** な **コンテンツがある] を** \> **選択する場合は、このルールを適用します**。</span><span class="sxs-lookup"><span data-stu-id="5709e-133">**Apply this rule if**: Select **Any attachment** \> **has executable content**.</span></span>

   - <span data-ttu-id="5709e-134">**[メッセージをブロック** する] **を選択し** 、必要なアクションを選択します。</span><span class="sxs-lookup"><span data-stu-id="5709e-134">**Do the following**: Select **Block the message** and then choose the action you want:</span></span>

     - <span data-ttu-id="5709e-135">**メッセージを拒否して** 説明を含める :表示される [拒否理由の指定] ダイアログで、配信不可レポート (NDR またはバウンス メッセージとも呼ばれる) に表示するテキストを入力します。</span><span class="sxs-lookup"><span data-stu-id="5709e-135">**reject the message and include an explanation**: In the **Specify reject reason** dialog that appears, enter the text you want to appear in the non-delivery report (also known as an NDR or bounce message).</span></span> <span data-ttu-id="5709e-136">5.7.1 で使用される既定拡張状態コードです。</span><span class="sxs-lookup"><span data-stu-id="5709e-136">The default enhanced status code that's used is 5.7.1.</span></span>

     - <span data-ttu-id="5709e-137">**拡張状態コード**: が表示される [拡張状態コードの入力] ダイアログで、NDR に表示する拡張状態コードを入力します。</span><span class="sxs-lookup"><span data-stu-id="5709e-137">**reject the message with the enhanced status code of**:  In the **Enter enhanced status code** dialog that appears, enter the enhanced status code that you want to appear in the NDR.</span></span> <span data-ttu-id="5709e-138">有効な値は 5.7.1 または 5.7.900 ~ 5.7.999 の値です。</span><span class="sxs-lookup"><span data-stu-id="5709e-138">Valid values are 5.7.1 or a value from 5.7.900 to 5.7.999.</span></span> <span data-ttu-id="5709e-139">既定の拒否テキストは、配信が承認されていない、メッセージが拒否されました。</span><span class="sxs-lookup"><span data-stu-id="5709e-139">The default rejection text is: Delivery not authorized, message refused.</span></span>

     - <span data-ttu-id="5709e-140">**誰にも通知せずにメッセージを拒否する**</span><span class="sxs-lookup"><span data-stu-id="5709e-140">**reject the message without notifying anyone**</span></span>

4. <span data-ttu-id="5709e-141">完了したら、**[保存]** をクリックします。</span><span class="sxs-lookup"><span data-stu-id="5709e-141">When you're finished, click **Save**.</span></span> <span data-ttu-id="5709e-142">添付ファイルのブロック ルールが強制されるようにになりました。</span><span class="sxs-lookup"><span data-stu-id="5709e-142">Your attachment blocking rule is now in force.</span></span>

## <a name="use-powershell-to-create-a-rule-that-blocks-messages-with-executable-attachments"></a><span data-ttu-id="5709e-143">PowerShell を使用して、実行可能な添付ファイルを含むメッセージをブロックするルールを作成する</span><span class="sxs-lookup"><span data-stu-id="5709e-143">Use PowerShell to create a rule that blocks messages with executable attachments</span></span>

<span data-ttu-id="5709e-144">次の構文を使用して、実行可能な添付ファイルを含むメッセージをブロックするルールを作成します。</span><span class="sxs-lookup"><span data-stu-id="5709e-144">Use the following syntax to create a rule to blocks messages that contain executable attachments:</span></span>

```powershell
New-TransportRule -Name "<UniqueName>" -AttachmentHasExecutableContent $true [-RejectMessageEnhancedStatusCode <5.7.1 | 5.7.900 to 5.7.999>] [-RejectMessageReasonText "<Text>"] [-DeleteMessage $true]
```

<span data-ttu-id="5709e-145">**注**:</span><span class="sxs-lookup"><span data-stu-id="5709e-145">**Notes**:</span></span>

- <span data-ttu-id="5709e-146">_RejectMessageReasonText_ パラメーターを指定せずに _RejectMessageEnhancedStatusCode_ パラメーターを使用する場合、既定のテキストは「配信が承認されていない、メッセージが拒否されました」です。</span><span class="sxs-lookup"><span data-stu-id="5709e-146">If you use the _RejectMessageEnhancedStatusCode_ parameter without the _RejectMessageReasonText_ parameter, the default text is: Delivery not authorized, message refused.</span></span>

- <span data-ttu-id="5709e-147">_RejectMessageEnhancedStatusCode_ パラメーターを指定せずに _RejectMessageReasonText_ パラメーターを使用する場合、既定のコードは 5.7.1 です。</span><span class="sxs-lookup"><span data-stu-id="5709e-147">If you use the _RejectMessageReasonText_ parameter without the _RejectMessageEnhancedStatusCode_ parameter, the default code is 5.7.1.</span></span>

<span data-ttu-id="5709e-148">この例では、実行可能な添付ファイルを含むメッセージをサイレント モードで削除する[実行可能ファイルの添付ファイルのブロック] という名前の新しいルールを作成します。</span><span class="sxs-lookup"><span data-stu-id="5709e-148">This example creates a new rule named Block Executable Attachments that silently deletes messages that contain executable attachments.</span></span>

```powershell
New-TransportRule -Name "Block Executable Attachments" -AttachmentHasExecutableContent $true -DeleteMessage $true
```

<span data-ttu-id="5709e-149">詳細な構文とパラメーターについては、「[New-TransportRule](/powershell/module/exchange/new-transportrule)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="5709e-149">For detailed syntax and parameter information, see [New-TransportRule](/powershell/module/exchange/new-transportrule).</span></span>

## <a name="how-do-you-know-this-worked"></a><span data-ttu-id="5709e-150">正常な動作を確認する方法</span><span class="sxs-lookup"><span data-stu-id="5709e-150">How do you know this worked?</span></span>

<span data-ttu-id="5709e-151">実行可能な添付ファイルを含むメッセージをブロックするメール フロー ルールが正常に作成されたことを確認するには、次の手順を実行します。</span><span class="sxs-lookup"><span data-stu-id="5709e-151">To verify that you've successfully create a mail flow rule to block messages that contain executable attachments, do any of the following steps:</span></span>

- <span data-ttu-id="5709e-152">EAC で、[メールフロールール] に移動し、[編集] アイコンをクリックして、 \>  \> \>  ![ ](../../media/ITPro-EAC-EditIcon.png) 設定を確認します。</span><span class="sxs-lookup"><span data-stu-id="5709e-152">In the EAC, go to **Mail flow** \> **Rules** \> select the rule \> click **Edit** ![Edit icon](../../media/ITPro-EAC-EditIcon.png), and verify the settings.</span></span>

- <span data-ttu-id="5709e-153">PowerShell で、次のコマンドを実行して設定を確認します。</span><span class="sxs-lookup"><span data-stu-id="5709e-153">In PowerShell, run the following command to verify the settings:</span></span>

  ```powershell
  Get-TransportRule -Identity "<Rule Name>" | Format-List Name,AttachmentHasExecutableContent,RejectMessage*,DeleteMessage
  ```