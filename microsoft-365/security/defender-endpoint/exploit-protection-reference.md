---
title: エクスプロイト保護のリファレンス
keywords: 軽減策、脆弱性、脆弱性、軽減策、エクスプロイト、攻略、emet
description: エクスプロイト保護機能の動作の詳細については、Windows 10
search.product: eADQiWindows 10XVcnh
ms.pagetype: security
ms.prod: m365-security
ms.mktglfcycl: manage
ms.sitesec: library
localization_priority: Normal
audience: ITPro
author: denisebmsft
ms.author: deniseb
ms.date: 01/06/2021
ms.reviewer: cjacks
manager: dansimp
ms.custom: asr
ms.technology: mde
ms.topic: article
ms.openlocfilehash: 7300ed2a4dc2623a8f936006ce7de3a5204712f0
ms.sourcegitcommit: 4fb1226d5875bf5b9b29252596855a6562cea9ae
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 06/08/2021
ms.locfileid: "52844544"
---
# <a name="exploit-protection-reference"></a><span data-ttu-id="279da-104">エクスプロイト保護リファレンス</span><span class="sxs-lookup"><span data-stu-id="279da-104">Exploit Protection Reference</span></span>

[!INCLUDE [Microsoft 365 Defender rebranding](../../includes/microsoft-defender.md)]


<span data-ttu-id="279da-105">**適用対象:**</span><span class="sxs-lookup"><span data-stu-id="279da-105">**Applies to:**</span></span>
- [<span data-ttu-id="279da-106">Microsoft Defender for Endpoint</span><span class="sxs-lookup"><span data-stu-id="279da-106">Microsoft Defender for Endpoint</span></span>](https://go.microsoft.com/fwlink/?linkid=2154037)
- [<span data-ttu-id="279da-107">Microsoft 365 Defender</span><span class="sxs-lookup"><span data-stu-id="279da-107">Microsoft 365 Defender</span></span>](https://go.microsoft.com/fwlink/?linkid=2118804)

><span data-ttu-id="279da-108">Microsoft Defender ATP を試してみたいですか?</span><span class="sxs-lookup"><span data-stu-id="279da-108">Want to experience Microsoft Defender for Endpoint?</span></span> [<span data-ttu-id="279da-109">無料試用版にサインアップしてください。</span><span class="sxs-lookup"><span data-stu-id="279da-109">Sign up for a free trial.</span></span>](https://www.microsoft.com/microsoft-365/windows/microsoft-defender-atp?ocid=docs-wdatp-enablesiem-abovefoldlink)

<span data-ttu-id="279da-110">エクスプロイト保護は、開発者がソフトウェアをコンパイルして配布した後Pro適用できるアプリケーションの高度な保護を提供します。</span><span class="sxs-lookup"><span data-stu-id="279da-110">Exploit protection provides advanced protections for applications that the IT Pro can apply after the developer has compiled and distributed the software.</span></span>

<span data-ttu-id="279da-111">この記事では、エクスプロイト保護ポリシーの構築と適用に役立つ、ポリシー レベルと個別の軽減レベルの両方で、エクスプロイト保護のしくみを理解するのに役立ちます。</span><span class="sxs-lookup"><span data-stu-id="279da-111">This article helps you understand how exploit protection works, both at the policy level and at the individual mitigation level, to help you successfully build and apply Exploit Protection policies.</span></span>

## <a name="how-mitigations-are-applied"></a><span data-ttu-id="279da-112">軽減策の適用方法</span><span class="sxs-lookup"><span data-stu-id="279da-112">How mitigations are applied</span></span>

<span data-ttu-id="279da-113">Exploit Protection の軽減策は、アプリケーションごとに適用されます。</span><span class="sxs-lookup"><span data-stu-id="279da-113">Exploit Protection mitigations are applied per application.</span></span>

<span data-ttu-id="279da-114">軽減策は、保護を構成する各プログラムのレジストリ エントリを介して構成されます。</span><span class="sxs-lookup"><span data-stu-id="279da-114">Mitigations are configured via a registry entry for each program that you configure protections for.</span></span> <span data-ttu-id="279da-115">これらの設定は、各プログラムの **MitigationOptions** レジストリ エントリ **(HKEY_LOCAL_MACHINE \ SOFTWARE \ Microsoft \ Windows NT \ CurrentVersion \ Image File Execution Options \ *ImageFileName* \ MitigationOptions**) に格納されます。</span><span class="sxs-lookup"><span data-stu-id="279da-115">These settings are stored in the **MitigationOptions** registry entry for each program (**HKEY_LOCAL_MACHINE \ SOFTWARE \ Microsoft \ Windows NT \ CurrentVersion \ Image File Execution Options \ *ImageFileName* \ MitigationOptions**).</span></span> <span data-ttu-id="279da-116">これらは、プログラムを再起動すると有効になります。変更してプログラムを再起動するまで有効です。</span><span class="sxs-lookup"><span data-stu-id="279da-116">They take effect when you restart the program and remain effective until you change them and restart the program again.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="279da-117">Image File Execution Options では、ファイル名またはパスのみを指定できます。バージョン番号、アーキテクチャ、その他の差別化要因は指定しません。</span><span class="sxs-lookup"><span data-stu-id="279da-117">Image File Execution Options only allows you to specify a file name or path, and not a version number, architecture, or any other differentiator.</span></span> <span data-ttu-id="279da-118">一意の名前またはパスを持つアプリに軽減策を適用し、そのバージョンとアプリケーションのアーキテクチャをテストしたデバイスにのみ適用してください。</span><span class="sxs-lookup"><span data-stu-id="279da-118">Be careful to target mitigations to apps which have unique names or paths, applying them only on devices where you have tested that version and that architecture of the application.</span></span>

<span data-ttu-id="279da-119">PowerShell、グループ ポリシー、MDM を使用して XML 構成ファイルを使用して悪用防止の軽減策を構成すると、この XML 構成ファイルを処理するときに、個々のレジストリ設定が構成されます。</span><span class="sxs-lookup"><span data-stu-id="279da-119">If you configure exploit protection mitigations using an XML configuration file, either via PowerShell, Group Policy, or MDM, when processing this XML configuration file, individual registry settings will be configured for you.</span></span>

<span data-ttu-id="279da-120">XML ファイルを配布するポリシーが適用されなくなった場合、この XML 構成ファイルによって展開された設定は自動的に削除されません。</span><span class="sxs-lookup"><span data-stu-id="279da-120">When the policy distributing the XML file is no longer enforced, settings deployed by this XML configuration file will not be automatically removed.</span></span> <span data-ttu-id="279da-121">Exploit Protection の設定を削除するには、クリーン なデバイスから XML 構成Windows 10し、この新しい XML ファイルを展開します。</span><span class="sxs-lookup"><span data-stu-id="279da-121">To remove Exploit Protection settings, export the XML configuration from a clean Windows 10 device, and deploy this new XML file.</span></span> <span data-ttu-id="279da-122">または、Microsoft は、エクスプロイト保護の設定をリセットWindows セキュリティベースラインの一部として XML ファイルを提供します。</span><span class="sxs-lookup"><span data-stu-id="279da-122">Alternately, Microsoft provides an XML file as part of the Windows Security Baselines for resetting Exploit Protection settings.</span></span>

<span data-ttu-id="279da-123">PowerShell を使用してエクスプロイト保護設定をリセットするには、次のコマンドを使用できます。</span><span class="sxs-lookup"><span data-stu-id="279da-123">To reset exploit protection settings using PowerShell, you could use the following command:</span></span>

```powershell
Set-ProcessMitigation -PolicyFilePath EP-reset.xml
```
<span data-ttu-id="279da-124">次に示すEP-reset.xmlベースラインとWindows セキュリティします。</span><span class="sxs-lookup"><span data-stu-id="279da-124">Following is the EP-reset.xml distributed with the Windows Security Baselines:</span></span>
```xml
<?xml version="1.0" encoding="UTF-8"?>
<MitigationPolicy>
  <AppConfig Executable="ONEDRIVE.EXE">
    <DEP OverrideDEP="false" />
    <ASLR OverrideRelocateImages="false" />
    <Payload OverrideEnableExportAddressFilter="false" OverrideEnableExportAddressFilterPlus="false" OverrideEnableImportAddressFilter="false" OverrideEnableRopStackPivot="false" OverrideEnableRopCallerCheck="false" OverrideEnableRopSimExec="false" />
    <ImageLoad OverrideBlockRemoteImages="false" />
  </AppConfig>
  <AppConfig Executable="firefox.exe">
    <DEP OverrideDEP="false" />
    <ASLR ForceRelocateImages="true" />
  </AppConfig>
  <AppConfig Executable="fltldr.exe">
    <DEP OverrideDEP="false" />
    <Payload OverrideEnableExportAddressFilter="false" OverrideEnableExportAddressFilterPlus="false" OverrideEnableImportAddressFilter="false" OverrideEnableRopStackPivot="false" OverrideEnableRopCallerCheck="false" OverrideEnableRopSimExec="false" />
    <ImageLoad OverrideBlockRemoteImages="false" />
    <ChildProcess OverrideChildProcess="false" />
  </AppConfig>
  <AppConfig Executable="GROOVE.EXE">
    <DEP OverrideDEP="false" />
    <ASLR ForceRelocateImages="true" />
    <Payload OverrideEnableExportAddressFilter="false" OverrideEnableExportAddressFilterPlus="false" OverrideEnableImportAddressFilter="false" OverrideEnableRopStackPivot="false" OverrideEnableRopCallerCheck="false" OverrideEnableRopSimExec="false" />
    <ImageLoad OverrideBlockRemoteImages="false" />
    <ChildProcess OverrideChildProcess="false" />
  </AppConfig>
  <AppConfig Executable="Acrobat.exe">
    <DEP OverrideDEP="false" />
    <ASLR ForceRelocateImages="true" />
    <Payload OverrideEnableExportAddressFilter="false" OverrideEnableExportAddressFilterPlus="false" OverrideEnableImportAddressFilter="false" OverrideEnableRopStackPivot="false" OverrideEnableRopCallerCheck="false" OverrideEnableRopSimExec="false" />
  </AppConfig>
  <AppConfig Executable="AcroRd32.exe">
    <DEP OverrideDEP="false" />
    <ASLR ForceRelocateImages="true" />
    <Payload OverrideEnableExportAddressFilter="false" OverrideEnableExportAddressFilterPlus="false" OverrideEnableImportAddressFilter="false" OverrideEnableRopStackPivot="false" OverrideEnableRopCallerCheck="false" OverrideEnableRopSimExec="false" />
  </AppConfig>
  <AppConfig Executable="chrome.exe">
    <DEP OverrideDEP="false" />
  </AppConfig>
  <AppConfig Executable="EXCEL.EXE">
    <DEP OverrideDEP="false" />
    <ASLR ForceRelocateImages="true" />
    <Payload OverrideEnableExportAddressFilter="false" OverrideEnableExportAddressFilterPlus="false" OverrideEnableImportAddressFilter="false" OverrideEnableRopStackPivot="false" OverrideEnableRopCallerCheck="false" OverrideEnableRopSimExec="false" />
  </AppConfig>
  <AppConfig Executable="iexplore.exe">
    <DEP OverrideDEP="false" />
    <ASLR ForceRelocateImages="true" />
    <Payload OverrideEnableExportAddressFilter="false" OverrideEnableExportAddressFilterPlus="false" OverrideEnableImportAddressFilter="false" OverrideEnableRopStackPivot="false" OverrideEnableRopCallerCheck="false" OverrideEnableRopSimExec="false" />
  </AppConfig>
  <AppConfig Executable="INFOPATH.EXE">
    <DEP OverrideDEP="false" />
    <ASLR ForceRelocateImages="true" />
    <Payload OverrideEnableExportAddressFilter="false" OverrideEnableExportAddressFilterPlus="false" OverrideEnableImportAddressFilter="false" OverrideEnableRopStackPivot="false" OverrideEnableRopCallerCheck="false" OverrideEnableRopSimExec="false" />
  </AppConfig>
  <AppConfig Executable="java.exe">
    <DEP OverrideDEP="false" />
    <Payload OverrideEnableExportAddressFilter="false" OverrideEnableExportAddressFilterPlus="false" OverrideEnableImportAddressFilter="false" OverrideEnableRopStackPivot="false" OverrideEnableRopCallerCheck="false" OverrideEnableRopSimExec="false" />
  </AppConfig>
  <AppConfig Executable="javaw.exe">
    <DEP OverrideDEP="false" />
    <Payload OverrideEnableExportAddressFilter="false" OverrideEnableExportAddressFilterPlus="false" OverrideEnableImportAddressFilter="false" OverrideEnableRopStackPivot="false" OverrideEnableRopCallerCheck="false" OverrideEnableRopSimExec="false" />
  </AppConfig>
  <AppConfig Executable="javaws.exe">
    <DEP OverrideDEP="false" />
    <Payload OverrideEnableExportAddressFilter="false" OverrideEnableExportAddressFilterPlus="false" OverrideEnableImportAddressFilter="false" OverrideEnableRopStackPivot="false" OverrideEnableRopCallerCheck="false" OverrideEnableRopSimExec="false" />
  </AppConfig>
  <AppConfig Executable="LYNC.EXE">
    <DEP OverrideDEP="false" />
    <ASLR ForceRelocateImages="true" />
    <Payload OverrideEnableExportAddressFilter="false" OverrideEnableExportAddressFilterPlus="false" OverrideEnableImportAddressFilter="false" OverrideEnableRopStackPivot="false" OverrideEnableRopCallerCheck="false" OverrideEnableRopSimExec="false" />
  </AppConfig>
  <AppConfig Executable="MSACCESS.EXE">
    <DEP OverrideDEP="false" />
    <ASLR ForceRelocateImages="true" />
    <Payload OverrideEnableExportAddressFilter="false" OverrideEnableExportAddressFilterPlus="false" OverrideEnableImportAddressFilter="false" OverrideEnableRopStackPivot="false" OverrideEnableRopCallerCheck="false" OverrideEnableRopSimExec="false" />
  </AppConfig>
  <AppConfig Executable="MSPUB.EXE">
    <DEP OverrideDEP="false" />
    <ASLR ForceRelocateImages="true" />
    <Payload OverrideEnableExportAddressFilter="false" OverrideEnableExportAddressFilterPlus="false" OverrideEnableImportAddressFilter="false" OverrideEnableRopStackPivot="false" OverrideEnableRopCallerCheck="false" OverrideEnableRopSimExec="false" />
  </AppConfig>
  <AppConfig Executable="OIS.EXE">
    <DEP OverrideDEP="false" />
    <Payload OverrideEnableExportAddressFilter="false" OverrideEnableExportAddressFilterPlus="false" OverrideEnableImportAddressFilter="false" OverrideEnableRopStackPivot="false" OverrideEnableRopCallerCheck="false" OverrideEnableRopSimExec="false" />
  </AppConfig>
  <AppConfig Executable="OUTLOOK.EXE">
    <DEP OverrideDEP="false" />
    <ASLR ForceRelocateImages="true" />
    <Payload OverrideEnableExportAddressFilter="false" OverrideEnableExportAddressFilterPlus="false" OverrideEnableImportAddressFilter="false" OverrideEnableRopStackPivot="false" OverrideEnableRopCallerCheck="false" OverrideEnableRopSimExec="false" />
  </AppConfig>
  <AppConfig Executable="plugin-container.exe">
    <DEP OverrideDEP="false" />
    <Payload OverrideEnableExportAddressFilter="false" OverrideEnableExportAddressFilterPlus="false" OverrideEnableImportAddressFilter="false" OverrideEnableRopStackPivot="false" OverrideEnableRopCallerCheck="false" OverrideEnableRopSimExec="false" />
  </AppConfig>
  <AppConfig Executable="POWERPNT.EXE">
    <DEP OverrideDEP="false" />
    <ASLR ForceRelocateImages="true" />
    <Payload OverrideEnableExportAddressFilter="false" OverrideEnableExportAddressFilterPlus="false" OverrideEnableImportAddressFilter="false" OverrideEnableRopStackPivot="false" OverrideEnableRopCallerCheck="false" OverrideEnableRopSimExec="false" />
  </AppConfig>
  <AppConfig Executable="PPTVIEW.EXE">
    <DEP OverrideDEP="false" />
    <ASLR ForceRelocateImages="true" />
    <Payload OverrideEnableExportAddressFilter="false" OverrideEnableExportAddressFilterPlus="false" OverrideEnableImportAddressFilter="false" OverrideEnableRopStackPivot="false" OverrideEnableRopCallerCheck="false" OverrideEnableRopSimExec="false" />
  </AppConfig>
  <AppConfig Executable="VISIO.EXE">
    <DEP OverrideDEP="false" />
    <ASLR ForceRelocateImages="true" />
    <Payload OverrideEnableExportAddressFilter="false" OverrideEnableExportAddressFilterPlus="false" OverrideEnableImportAddressFilter="false" OverrideEnableRopStackPivot="false" OverrideEnableRopCallerCheck="false" OverrideEnableRopSimExec="false" />
  </AppConfig>
  <AppConfig Executable="VPREVIEW.EXE">
    <DEP OverrideDEP="false" />
    <ASLR ForceRelocateImages="true" />
    <Payload OverrideEnableExportAddressFilter="false" OverrideEnableExportAddressFilterPlus="false" OverrideEnableImportAddressFilter="false" OverrideEnableRopStackPivot="false" OverrideEnableRopCallerCheck="false" OverrideEnableRopSimExec="false" />
  </AppConfig>
  <AppConfig Executable="WINWORD.EXE">
    <DEP OverrideDEP="false" />
    <ASLR ForceRelocateImages="true" />
    <Payload OverrideEnableExportAddressFilter="false" OverrideEnableExportAddressFilterPlus="false" OverrideEnableImportAddressFilter="false" OverrideEnableRopStackPivot="false" OverrideEnableRopCallerCheck="false" OverrideEnableRopSimExec="false" />
  </AppConfig>
  <AppConfig Executable="wmplayer.exe">
    <DEP OverrideDEP="false" />
    <Payload OverrideEnableExportAddressFilter="false" OverrideEnableExportAddressFilterPlus="false" OverrideEnableImportAddressFilter="false" OverrideEnableRopStackPivot="false" OverrideEnableRopCallerCheck="false" OverrideEnableRopSimExec="false" />
  </AppConfig>
  <AppConfig Executable="wordpad.exe">
    <DEP OverrideDEP="false" />
    <Payload OverrideEnableExportAddressFilter="false" OverrideEnableExportAddressFilterPlus="false" OverrideEnableImportAddressFilter="false" OverrideEnableRopStackPivot="false" OverrideEnableRopCallerCheck="false" OverrideEnableRopSimExec="false" />
  </AppConfig>
</MitigationPolicy>
```

## <a name="mitigation-reference"></a><span data-ttu-id="279da-125">軽減のリファレンス</span><span class="sxs-lookup"><span data-stu-id="279da-125">Mitigation Reference</span></span>

<span data-ttu-id="279da-126">以下のセクションでは、各エクスプロイト保護の軽減策によって提供される保護、軽減策の互換性に関する考慮事項、および使用可能な構成オプションについて詳しく説明します。</span><span class="sxs-lookup"><span data-stu-id="279da-126">The following sections detail the protections provided by each exploit protection mitigation, the compatibility considerations for the mitigation, and the configuration options available.</span></span>

## <a name="arbitrary-code-guard"></a><span data-ttu-id="279da-127">任意のコード ガード</span><span class="sxs-lookup"><span data-stu-id="279da-127">Arbitrary code guard</span></span>

### <a name="description"></a><span data-ttu-id="279da-128">説明</span><span class="sxs-lookup"><span data-stu-id="279da-128">Description</span></span>

<span data-ttu-id="279da-129">任意のコード ガードは、メモリの安全性の脆弱性を通じて、任意のコードをメモリに読み込み、そのコードを実行できる悪意のある攻撃者から保護するのに役立ちます。</span><span class="sxs-lookup"><span data-stu-id="279da-129">Arbitrary code guard helps protect against a malicious attacker loading the code of their choice into memory through a memory safety vulnerability and being able to execute that code.</span></span>

<span data-ttu-id="279da-130">任意のコード ガードは、アプリケーションが動的に生成されたコード (たとえば、exe 自体または dll から読み込まれないコード) を実行から保護します。</span><span class="sxs-lookup"><span data-stu-id="279da-130">Arbitrary code guard protects an application from executing dynamically generated code (code that is not loaded, for example, from the exe itself or a dll).</span></span> <span data-ttu-id="279da-131">任意のコード ガードは、メモリが実行可能ファイルとしてマークされるのを防ぐことによって機能します。</span><span class="sxs-lookup"><span data-stu-id="279da-131">Arbitrary code guard works by preventing memory from being marked as executable.</span></span> <span data-ttu-id="279da-132">アプリケーションがメモリを割り [当てしようとすると](/windows/win32/api/memoryapi/nf-memoryapi-virtualalloc)、保護フラグがチェックされます。</span><span class="sxs-lookup"><span data-stu-id="279da-132">When an application attempts to [allocate memory](/windows/win32/api/memoryapi/nf-memoryapi-virtualalloc), we check the protection flags.</span></span> <span data-ttu-id="279da-133">(メモリは、読み取り、書き込み、および/または実行保護フラグを使用して割り当てできます)。割り当てが実行保護フラグを[](/windows/win32/memory/memory-protection-constants)含もうとすると、メモリ割り当ては失敗し、エラー コード (STATUS_DYNAMIC_CODE_BLOCKED) を返します。</span><span class="sxs-lookup"><span data-stu-id="279da-133">(Memory can be allocated with read, write, and/or execute protection flags.) If the allocation attempts to include the [*execute*](/windows/win32/memory/memory-protection-constants) protection flag, then the memory allocation fails and returns an error code (STATUS_DYNAMIC_CODE_BLOCKED).</span></span> <span data-ttu-id="279da-134">同様に、アプリケーションが既に割[](/windows/win32/api/memoryapi/nf-memoryapi-virtualprotect)り当てられているメモリの保護フラグを変更し、実行保護フラグを[](/windows/win32/memory/memory-protection-constants)含む場合、アクセス許可の変更は失敗し、エラー コード (STATUS_DYNAMIC_CODE_BLOCKED) を返します。</span><span class="sxs-lookup"><span data-stu-id="279da-134">Similarly, if an application attempts to [change the protection flags of memory](/windows/win32/api/memoryapi/nf-memoryapi-virtualprotect) that has already been allocated and includes the [*execute*](/windows/win32/memory/memory-protection-constants) protection flag, then the permission change fails and returns an error code (STATUS_DYNAMIC_CODE_BLOCKED).</span></span>

<span data-ttu-id="279da-135">実行フラグが *設定* されるのを防ぐことで、Windows 10 のデータ実行防止機能は、そのメモリに設定され、そのコードを実行している命令ポインターから保護できます。</span><span class="sxs-lookup"><span data-stu-id="279da-135">By preventing the *execute* flag from being set, the data execution prevention feature of Windows 10 can then protect against the instruction pointer being set to that memory and running that code.</span></span>

### <a name="compatibility-considerations"></a><span data-ttu-id="279da-136">互換性に関する考慮事項</span><span class="sxs-lookup"><span data-stu-id="279da-136">Compatibility considerations</span></span>

<span data-ttu-id="279da-137">任意のコード ガードを使用すると、メモリが実行可能ファイルとして割り当てられるのを防ぎ、Just-in-Time (JIT) コンパイラなどのアプローチとの互換性の問題が発生します。</span><span class="sxs-lookup"><span data-stu-id="279da-137">Arbitrary code guard prevents allocating any memory as executable, which presents a compatibility issue with approaches such as Just-in-Time (JIT) compilers.</span></span> <span data-ttu-id="279da-138">たとえば、最新のほとんどのブラウザーでは、パフォーマンスを最適化するために JavaScript をネイティブ コードにコンパイルします。</span><span class="sxs-lookup"><span data-stu-id="279da-138">Most modern browsers, for example, will compile JavaScript into native code in order to optimize performance.</span></span> <span data-ttu-id="279da-139">この軽減策をサポートするには、JIT コンパイルを保護されたプロセスの外部に移動するために、再検出する必要があります。</span><span class="sxs-lookup"><span data-stu-id="279da-139">In order to support this mitigation, they will need to be rearchitected to move the JIT compilation outside of the protected process.</span></span> <span data-ttu-id="279da-140">スクリプトまたは他の中間言語からコードを動的に生成する他のアプリケーションも、この軽減策と同様に互換性がありません。</span><span class="sxs-lookup"><span data-stu-id="279da-140">Other applications whose design dynamically generates code from scripts or other intermediate languages will be similarly incompatible with this mitigation.</span></span>

### <a name="configuration-options"></a><span data-ttu-id="279da-141">構成オプション</span><span class="sxs-lookup"><span data-stu-id="279da-141">Configuration options</span></span>

<span data-ttu-id="279da-142">**[スレッドのオプトアウトを許可** する] - 個々のスレッドがこの保護をオプトアウトすることを許可する軽減策を構成できます。</span><span class="sxs-lookup"><span data-stu-id="279da-142">**Allow thread opt-out** - You can configure the mitigation to allow an individual thread to opt-out of this protection.</span></span> <span data-ttu-id="279da-143">開発者は、この軽減策を認識してアプリケーションを記述し、このスレッドで動的コードを実行するために *ThreadInformation* パラメーターを **ThreadDynamicCodePolicy** に設定した [**SetThreadInformation**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-setthreadinformation) API を呼び出している必要があります。</span><span class="sxs-lookup"><span data-stu-id="279da-143">The developer must have written the application with awareness of this mitigation, and have called the [**SetThreadInformation**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-setthreadinformation) API with the *ThreadInformation* parameter set to **ThreadDynamicCodePolicy** in order to be allowed to execute dynamic code on this thread.</span></span>

<span data-ttu-id="279da-144">**[監査のみ** ] - アプリケーションに対する潜在的な互換性への影響を測定するために、監査モードでこの軽減策を有効にできます。</span><span class="sxs-lookup"><span data-stu-id="279da-144">**Audit only** - You can enable this mitigation in audit mode in order to measure the potential compatibility impact on an application.</span></span> <span data-ttu-id="279da-145">監査イベントは、イベント ビューアーで表示するか、Defender for Endpoint の Advanced Hunting を [使用して表示できます](/microsoft-365/security/defender/advanced-hunting-overview)。</span><span class="sxs-lookup"><span data-stu-id="279da-145">Audit events can then be viewed either in the event viewer or using Advanced Hunting in [Defender for Endpoint](/microsoft-365/security/defender/advanced-hunting-overview).</span></span>

## <a name="block-low-integrity-images"></a><span data-ttu-id="279da-146">整合性が低いイメージのブロック</span><span class="sxs-lookup"><span data-stu-id="279da-146">Block low integrity images</span></span>

### <a name="description"></a><span data-ttu-id="279da-147">説明</span><span class="sxs-lookup"><span data-stu-id="279da-147">Description</span></span>

<span data-ttu-id="279da-148">低整合性イメージをブロックすると、アプリケーションは、通常、セキュリティで保護されたブラウザーからインターネットからダウンロードされたため、信頼されていないファイルを読み込むのを防ぐ。</span><span class="sxs-lookup"><span data-stu-id="279da-148">Block low integrity images prevents the application from loading files that are untrusted, typically because they have been downloaded from the internet from a sandboxed browser.</span></span>

<span data-ttu-id="279da-149">この軽減策は、イメージに低 IL プロセスへのアクセスを許可するアクセス制御エントリ (ACE) を持ち、信頼ラベル ACE を持つイメージの読み込みをブロックします。</span><span class="sxs-lookup"><span data-stu-id="279da-149">This mitigation will block image loads if the image has an Access Control Entry (ACE) which grants access to Low IL processes and which does not have a trust label ACE.</span></span> <span data-ttu-id="279da-150">メモリ マネージャーによって実装され、ファイルがメモリにマップされるのをブロックします。</span><span class="sxs-lookup"><span data-stu-id="279da-150">It is implemented by the memory manager, which blocks the file from being mapped into memory.</span></span> <span data-ttu-id="279da-151">アプリケーションが低整合性イメージをマップしようとすると、エラーが発生STATUS_ACCESS_DENIEDされます。</span><span class="sxs-lookup"><span data-stu-id="279da-151">If an application attempts to map a low integrity image, it will trigger a STATUS_ACCESS_DENIED error.</span></span> <span data-ttu-id="279da-152">整合性レベルの動作の詳細については [、「Mandatory Integrity Control」を参照してください](/windows/win32/secauthz/mandatory-integrity-control)。</span><span class="sxs-lookup"><span data-stu-id="279da-152">For details on how integrity levels work, see [Mandatory Integrity Control](/windows/win32/secauthz/mandatory-integrity-control).</span></span>

### <a name="compatibility-considerations"></a><span data-ttu-id="279da-153">互換性に関する考慮事項</span><span class="sxs-lookup"><span data-stu-id="279da-153">Compatibility considerations</span></span>

<span data-ttu-id="279da-154">低整合性イメージをブロックすると、アプリケーションはインターネットからダウンロードされたファイルを読み込むのを防ぐ。</span><span class="sxs-lookup"><span data-stu-id="279da-154">Block low integrity images will prevent the application from loading files that were downloaded from the internet.</span></span> <span data-ttu-id="279da-155">アプリケーション ワークフローでダウンロードされたイメージの読み込みが必要な場合は、高信頼プロセスからダウンロードするか、この軽減策を適用するために明示的に再ラベルが付けられている必要があります。</span><span class="sxs-lookup"><span data-stu-id="279da-155">If your application workflow requires loading images that are downloaded, you will want to ensure that they are downloaded from a higher-trust process, or are explicitly relabeled in order to apply this mitigation.</span></span>

### <a name="configuration-options"></a><span data-ttu-id="279da-156">構成オプション</span><span class="sxs-lookup"><span data-stu-id="279da-156">Configuration options</span></span>

<span data-ttu-id="279da-157">**[監査のみ** ] - アプリケーションに対する潜在的な互換性への影響を測定するために、監査モードでこの軽減策を有効にできます。</span><span class="sxs-lookup"><span data-stu-id="279da-157">**Audit Only** - You can enable this mitigation in audit mode in order to measure the potential compatibility impact on an application.</span></span> <span data-ttu-id="279da-158">監査イベントは、イベント ビューアーで表示するか、Microsoft Defender for Endpoint の Advanced Hunting を [使用して表示できます](/microsoft-365/security/defender/advanced-hunting-overview)。</span><span class="sxs-lookup"><span data-stu-id="279da-158">Audit events can then be viewed either in the event viewer or using Advanced Hunting in [Microsoft Defender for Endpoint](/microsoft-365/security/defender/advanced-hunting-overview).</span></span>

## <a name="block-remote-images"></a><span data-ttu-id="279da-159">リモート イメージのブロック</span><span class="sxs-lookup"><span data-stu-id="279da-159">Block remote images</span></span>

### <a name="description"></a><span data-ttu-id="279da-160">説明</span><span class="sxs-lookup"><span data-stu-id="279da-160">Description</span></span>

<span data-ttu-id="279da-161">リモート イメージをブロックすると、アプリケーションが UNC 共有などのリモート デバイスでホストされているファイルを読み込むのを防ぐのに役立ちます。</span><span class="sxs-lookup"><span data-stu-id="279da-161">Blocking remote images helps to prevent the application from loading files that are hosted on a remote device, such as a UNC share.</span></span> <span data-ttu-id="279da-162">リモート イメージをブロックすると、攻撃者が制御する外部デバイス上のメモリにバイナリを読み込むのを防止できます。</span><span class="sxs-lookup"><span data-stu-id="279da-162">Blocking remote images helps protect against loading binaries into memory that are on an external device controlled by the attacker.</span></span>

<span data-ttu-id="279da-163">この軽減策は、イメージがリモート デバイス上に含まれると判断された場合、イメージの読み込みをブロックします。</span><span class="sxs-lookup"><span data-stu-id="279da-163">This mitigation will block image loads if the image is determined to be on a remote device.</span></span> <span data-ttu-id="279da-164">メモリ マネージャーによって実装され、ファイルがメモリにマップされるのをブロックします。</span><span class="sxs-lookup"><span data-stu-id="279da-164">It is implemented by the memory manager, which blocks the file from being mapped into memory.</span></span> <span data-ttu-id="279da-165">アプリケーションがリモート ファイルをマップしようとすると、エラーが発生STATUS_ACCESS_DENIEDされます。</span><span class="sxs-lookup"><span data-stu-id="279da-165">If an application attempts to map a remote file, it will trigger a STATUS_ACCESS_DENIED error.</span></span>

### <a name="compatibility-considerations"></a><span data-ttu-id="279da-166">互換性に関する考慮事項</span><span class="sxs-lookup"><span data-stu-id="279da-166">Compatibility considerations</span></span>

<span data-ttu-id="279da-167">リモート イメージをブロックすると、アプリケーションはリモート デバイスからイメージを読み込むのを防ぐ。</span><span class="sxs-lookup"><span data-stu-id="279da-167">Block remote images will prevent the application from loading images from remote devices.</span></span> <span data-ttu-id="279da-168">アプリケーションがリモート デバイスからファイルまたはプラグインを読み込む場合、この軽減策と互換性がありません。</span><span class="sxs-lookup"><span data-stu-id="279da-168">If your application loads files or plug-ins from remote devices, then it will not be compatible with this mitigation.</span></span>

### <a name="configuration-options"></a><span data-ttu-id="279da-169">構成オプション</span><span class="sxs-lookup"><span data-stu-id="279da-169">Configuration options</span></span>

<span data-ttu-id="279da-170">**[監査のみ** ] - アプリケーションに対する潜在的な互換性への影響を測定するために、監査モードでこの軽減策を有効にできます。</span><span class="sxs-lookup"><span data-stu-id="279da-170">**Audit Only** - You can enable this mitigation in audit mode in order to measure the potential compatibility impact on an application.</span></span> <span data-ttu-id="279da-171">監査イベントは、イベント ビューアーで表示するか、Microsoft Defender for Endpoint の Advanced Hunting を [使用して表示できます](/microsoft-365/security/defender/advanced-hunting-overview)。</span><span class="sxs-lookup"><span data-stu-id="279da-171">Audit events can then be viewed either in the event viewer or using Advanced Hunting in [Microsoft Defender for Endpoint](/microsoft-365/security/defender/advanced-hunting-overview).</span></span>

## <a name="block-untrusted-fonts"></a><span data-ttu-id="279da-172">信頼されていないフォントのブロック</span><span class="sxs-lookup"><span data-stu-id="279da-172">Block untrusted fonts</span></span>

### <a name="description"></a><span data-ttu-id="279da-173">説明</span><span class="sxs-lookup"><span data-stu-id="279da-173">Description</span></span>

<span data-ttu-id="279da-174">信頼されていないフォントをブロックすると、デバイス上でコードを実行できる攻撃者につながるフォント解析の欠陥のリスクが軽減されます。</span><span class="sxs-lookup"><span data-stu-id="279da-174">Block untrusted fonts mitigates the risk of a flaw in font parsing leading to the attacker being able to run code on the device.</span></span> <span data-ttu-id="279da-175">Windows\fonts ディレクトリにインストールされているフォントだけが、GDI による処理のために読み込まれます。</span><span class="sxs-lookup"><span data-stu-id="279da-175">Only fonts that are installed into the windows\fonts directory will be loaded for processing by GDI.</span></span>

<span data-ttu-id="279da-176">この軽減策は、ファイルの場所を検証する GDI 内で実装されます。</span><span class="sxs-lookup"><span data-stu-id="279da-176">This mitigation is implemented within GDI, which validates the location of the file.</span></span> <span data-ttu-id="279da-177">ファイルがシステム フォント ディレクトリに存在しない場合、フォントは解析用に読み込まれなく、その呼び出しは失敗します。</span><span class="sxs-lookup"><span data-stu-id="279da-177">If the file is not in the system fonts directory, the font will not be loaded for parsing and that call will fail.</span></span>

<span data-ttu-id="279da-178">この軽減策は、Windows 10 1607 以降で提供される組み込みの軽減策に加えて、フォント解析をカーネルからユーザー モード アプリ コンテナーに移動します。</span><span class="sxs-lookup"><span data-stu-id="279da-178">This mitigation is in addition to the built-in mitigation provided in Windows 10 1607 and later, which moves font parsing out of the kernel and into a user-mode app container.</span></span> <span data-ttu-id="279da-179">その結果、フォント解析に基づくエクスプロイトは、サンドボックスで分離されたコンテキストで発生し、リスクを大幅に軽減します。</span><span class="sxs-lookup"><span data-stu-id="279da-179">Any exploit based on font parsing, as a result, happens in a sandboxed and isolated context, which reduces the risk significantly.</span></span> <span data-ttu-id="279da-180">この軽減策の詳細については、「0 日間のエクスプロイトの軽減策をWindows 10のセキュリティ強化に関するブログ[」を参照してください](https://www.microsoft.com/security/blog/2017/01/13/hardening-windows-10-with-zero-day-exploit-mitigations/)。</span><span class="sxs-lookup"><span data-stu-id="279da-180">For details on this mitigation, see the blog [Hardening Windows 10 with zero-day exploit mitigations](https://www.microsoft.com/security/blog/2017/01/13/hardening-windows-10-with-zero-day-exploit-mitigations/).</span></span>

### <a name="compatibility-considerations"></a><span data-ttu-id="279da-181">互換性に関する考慮事項</span><span class="sxs-lookup"><span data-stu-id="279da-181">Compatibility considerations</span></span>

<span data-ttu-id="279da-182">システム フォント ディレクトリ外のフォントの最も一般的な使用は [、Web](/typography/fonts/font-faq#web)フォントです。</span><span class="sxs-lookup"><span data-stu-id="279da-182">The most common use of fonts outside of the system fonts directory is with [web fonts](/typography/fonts/font-faq#web).</span></span> <span data-ttu-id="279da-183">最新のブラウザー (Microsoft Edge GDI ではなくDirectWriteを使用し、影響を受け取る必要はありません。</span><span class="sxs-lookup"><span data-stu-id="279da-183">Modern browsers, such as Microsoft Edge, use DirectWrite instead of GDI, and are not impacted.</span></span> <span data-ttu-id="279da-184">ただし、Internet Explorer 11 などの従来のブラウザー (および新しい Microsoft Edge の IE モード) は、特にフォント グリフを使用して UI を表示する Office 365 などのアプリケーションに影響を与える可能性があります。</span><span class="sxs-lookup"><span data-stu-id="279da-184">However, legacy browsers, such as Internet Explorer 11 (and IE mode in the new Microsoft Edge) can be impacted, particularly with applications such as Office 365, which use font glyphs to display UI.</span></span>

### <a name="configuration-options"></a><span data-ttu-id="279da-185">構成オプション</span><span class="sxs-lookup"><span data-stu-id="279da-185">Configuration options</span></span>

<span data-ttu-id="279da-186">**[監査のみ** ] - アプリケーションに対する潜在的な互換性への影響を測定するために、監査モードでこの軽減策を有効にできます。</span><span class="sxs-lookup"><span data-stu-id="279da-186">**Audit Only** - You can enable this mitigation in audit mode in order to measure the potential compatibility impact on an application.</span></span> <span data-ttu-id="279da-187">監査イベントは、イベント ビューアーで表示するか、Microsoft Defender for Endpoint の Advanced Hunting を [使用して表示できます](/microsoft-365/security/defender/advanced-hunting-overview)。</span><span class="sxs-lookup"><span data-stu-id="279da-187">Audit events can then be viewed either in the event viewer or using Advanced Hunting in [Microsoft Defender for Endpoint](/microsoft-365/security/defender/advanced-hunting-overview).</span></span>

## <a name="code-integrity-guard"></a><span data-ttu-id="279da-188">コードの整合性ガード</span><span class="sxs-lookup"><span data-stu-id="279da-188">Code integrity guard</span></span>

### <a name="description"></a><span data-ttu-id="279da-189">説明</span><span class="sxs-lookup"><span data-stu-id="279da-189">Description</span></span>

<span data-ttu-id="279da-190">コード整合性ガードを使用すると、プロセスに読み込まれるすべてのバイナリが Microsoft によってデジタル署名されます。</span><span class="sxs-lookup"><span data-stu-id="279da-190">Code integrity guard ensures that all binaries loaded into a process are digitally signed by Microsoft.</span></span> <span data-ttu-id="279da-191">コード整合性ガードには[、WHQL](/windows-hardware/drivers/install/whql-release-signature) (Windows品質ラボ) の署名が含まれています。この署名を使用すると、WHQL で承認されたドライバーをプロセス内で実行できます。</span><span class="sxs-lookup"><span data-stu-id="279da-191">Code integrity guard includes [WHQL](/windows-hardware/drivers/install/whql-release-signature) (Windows Hardware Quality Labs) signatures, which will allow WHQL-approved drivers to run within the process.</span></span>

<span data-ttu-id="279da-192">この軽減策はメモリ マネージャー内で実装され、バイナリがメモリにマップされるのをブロックします。</span><span class="sxs-lookup"><span data-stu-id="279da-192">This mitigation is implemented within the memory manager, which blocks the binary from being mapped into memory.</span></span> <span data-ttu-id="279da-193">Microsoft によって署名されていないバイナリを読み込む場合、メモリ管理はエラー メッセージをSTATUS_INVALID_IMAGE_HASH。</span><span class="sxs-lookup"><span data-stu-id="279da-193">If you attempt to load a binary that is not signed by Microsoft, the memory manger will return the error STATUS_INVALID_IMAGE_HASH.</span></span> <span data-ttu-id="279da-194">メモリ マネージャー レベルでブロックすると、プロセスによって読み込まれるバイナリと、プロセスに挿入されたバイナリの両方が防止されます。</span><span class="sxs-lookup"><span data-stu-id="279da-194">By blocking at the memory manager level, this prevents both binaries loaded by the process and binaries injected into the process.</span></span>

### <a name="compatibility-considerations"></a><span data-ttu-id="279da-195">互換性に関する考慮事項</span><span class="sxs-lookup"><span data-stu-id="279da-195">Compatibility considerations</span></span>

<span data-ttu-id="279da-196">この軽減策は、特に Microsoft によって署名されていないバイナリをブロックします。</span><span class="sxs-lookup"><span data-stu-id="279da-196">This mitigation specifically blocks any binary that is not signed by Microsoft.</span></span> <span data-ttu-id="279da-197">そのため、ソフトウェアが Microsoft Store によって配布 (およびデジタル署名) され、Microsoft Store によって署名されたイメージの読み込みを許可するオプションが選択されていない限り、ほとんどのサードパーティ ソフトウェアと互換性がありません。</span><span class="sxs-lookup"><span data-stu-id="279da-197">As such, it will be incompatible with most third-party software, unless that software is distributed by (and digitally signed by) the Microsoft Store, and the option to allow loading of images signed by the Microsoft Store is selected.</span></span>

### <a name="configuration-options"></a><span data-ttu-id="279da-198">構成オプション</span><span class="sxs-lookup"><span data-stu-id="279da-198">Configuration options</span></span>

<span data-ttu-id="279da-199">**Microsoft Store** によって署名されたイメージの読み込みも許可する - Microsoft Store によって配布されるアプリケーションは、Microsoft Store によってデジタル署名され、この構成を追加すると、ストア認定プロセスを通過したバイナリをアプリケーションによって読み込まれます。</span><span class="sxs-lookup"><span data-stu-id="279da-199">**Also allow loading of images signed by Microsoft Store** - Applications that are distributed by the Microsoft Store will be digitally signed by the Microsoft Store, and adding this configuration will allow binaries that have gone through the store certification process to be loaded by the application.</span></span>

<span data-ttu-id="279da-200">**[監査のみ** ] - アプリケーションに対する潜在的な互換性への影響を測定するために、監査モードでこの軽減策を有効にできます。</span><span class="sxs-lookup"><span data-stu-id="279da-200">**Audit Only** - You can enable this mitigation in audit mode in order to measure the potential compatibility impact on an application.</span></span> <span data-ttu-id="279da-201">監査イベントは、イベント ビューアーで表示するか、Microsoft Defender for Endpoint の Advanced Hunting を [使用して表示できます](/microsoft-365/security/defender/advanced-hunting-overview)。</span><span class="sxs-lookup"><span data-stu-id="279da-201">Audit events can then be viewed either in the event viewer or using Advanced Hunting in [Microsoft Defender for Endpoint](/microsoft-365/security/defender/advanced-hunting-overview).</span></span>

## <a name="control-flow-guard-cfg"></a><span data-ttu-id="279da-202">制御フロー ガード (CFG)</span><span class="sxs-lookup"><span data-stu-id="279da-202">Control flow guard (CFG)</span></span>

### <a name="description"></a><span data-ttu-id="279da-203">説明</span><span class="sxs-lookup"><span data-stu-id="279da-203">Description</span></span>

<span data-ttu-id="279da-204">コントロール フロー ガード (CFG) は、間接的な関数呼び出しを保護することで、メモリ破損の脆弱性を使用する攻撃者のリスクを軽減します。</span><span class="sxs-lookup"><span data-stu-id="279da-204">Control flow guard (CFG) mitigates the risk of attackers using memory corruption vulnerabilities by protecting indirect function calls.</span></span> <span data-ttu-id="279da-205">たとえば、攻撃者はバッファー オーバーフローの脆弱性を利用して、関数ポインターを含むメモリを上書きし、その関数ポインターを任意の実行可能コード (プログラムに挿入されている可能性があります) へのポインターに置き換える可能性があります。</span><span class="sxs-lookup"><span data-stu-id="279da-205">For example, an attacker may user a buffer overflow vulnerability to overwrite memory containing a function pointer, and replace that function pointer with a pointer to executable code of their choice (which may also have been injected into the program).</span></span>

<span data-ttu-id="279da-206">この軽減策は、コンパイル時に別のチェックを挿入することで提供されます。</span><span class="sxs-lookup"><span data-stu-id="279da-206">This mitigation is provided by injecting another check at compile time.</span></span> <span data-ttu-id="279da-207">各間接関数呼び出しの前に、ターゲットが呼び出される前に有効な呼び出し先を確認する別の命令が追加されます。</span><span class="sxs-lookup"><span data-stu-id="279da-207">Before each indirect function call, another instructions are added which verify that the target is a valid call target before it is called.</span></span> <span data-ttu-id="279da-208">ターゲットが有効な呼び出し先でない場合、アプリケーションは終了します。</span><span class="sxs-lookup"><span data-stu-id="279da-208">If the target is not a valid call target, then the application is terminated.</span></span> <span data-ttu-id="279da-209">そのため、この軽減策を利用できるのは、CFG サポートを使用してコンパイルされたアプリケーションのみです。</span><span class="sxs-lookup"><span data-stu-id="279da-209">As such, only applications that are compiled with CFG support can benefit from this mitigation.</span></span>

<span data-ttu-id="279da-210">有効なターゲットのチェックは、カーネルによってWindowsされます。</span><span class="sxs-lookup"><span data-stu-id="279da-210">The check for a valid target is provided by the Windows kernel.</span></span> <span data-ttu-id="279da-211">実行可能ファイルが読み込まれると、間接呼び出しターゲットのメタデータが読み込み時に抽出され、有効な呼び出し先としてマークされます。</span><span class="sxs-lookup"><span data-stu-id="279da-211">When executable files are loaded, the metadata for indirect call targets is extracted at load time and marked as valid call targets.</span></span> <span data-ttu-id="279da-212">さらに、メモリを割り当て、実行可能ファイル (生成されたコードなど) としてマークすると、これらのメモリの場所も有効な呼び出し先としてマークされ、JIT コンパイルなどのメカニズムをサポートします。</span><span class="sxs-lookup"><span data-stu-id="279da-212">Additionally, when memory is allocated and marked as executable (such as for generated code), these memory locations are also marked as valid call targets, to support mechanisms such as JIT compilation.</span></span>

### <a name="compatibility-considerations"></a><span data-ttu-id="279da-213">互換性に関する考慮事項</span><span class="sxs-lookup"><span data-stu-id="279da-213">Compatibility considerations</span></span>

<span data-ttu-id="279da-214">アプリケーションは CFG をサポートするためにコンパイルする必要があるから、アプリケーションとの互換性を暗黙的に宣言します。</span><span class="sxs-lookup"><span data-stu-id="279da-214">Since applications must be compiled to support CFG, they implicitly declare their compatibility with it.</span></span> <span data-ttu-id="279da-215">したがって、ほとんどのアプリケーションは、この軽減策を有効にした場合に動作する必要があります。</span><span class="sxs-lookup"><span data-stu-id="279da-215">Most applications, therefore, should work with this mitigation enabled.</span></span> <span data-ttu-id="279da-216">これらのチェックはバイナリにコンパイルされますので、適用できる構成は、カーネル内のチェックを無効にWindowsです。</span><span class="sxs-lookup"><span data-stu-id="279da-216">Because these checks are compiled into the binary, the configuration you can apply is merely to disable checks within the Windows kernel.</span></span> <span data-ttu-id="279da-217">つまり、軽減策は既定でオンになっていますが、後でアプリケーション開発者がテストで検出しなかった互換性の問題が発生したと判断した場合は、常に "はい" を返す Windows カーネルを構成できます。これはまれなはずです。</span><span class="sxs-lookup"><span data-stu-id="279da-217">In other words, the mitigation is on by default, but you can configure the Windows kernel to always return "yes" if you later determine that there is a compatibility issue that the application developer did not discover in their testing, which should be rare.</span></span>

### <a name="configuration-options"></a><span data-ttu-id="279da-218">構成オプション</span><span class="sxs-lookup"><span data-stu-id="279da-218">Configuration options</span></span>

<span data-ttu-id="279da-219">厳密 **な CFG** を使用する - 厳密なモードでは、プロセスに読み込まれるすべてのバイナリを Control Flow Guard 用にコンパイルする必要があります (または、リソース dll など、実行可能コードが含まれません)。</span><span class="sxs-lookup"><span data-stu-id="279da-219">**Use strict CFG** - In strict mode, all binaries loaded into the process must be compiled for Control Flow Guard (or have no executable code in them - such as resource dlls) in order to be loaded.</span></span>

> [!Note]
> <span data-ttu-id="279da-220">**コントロール フロー ガードには** 監査モードはありません。</span><span class="sxs-lookup"><span data-stu-id="279da-220">**Control flow guard** has no audit mode.</span></span> <span data-ttu-id="279da-221">バイナリは、この軽減策が有効になっているとコンパイルされます。</span><span class="sxs-lookup"><span data-stu-id="279da-221">Binaries are compiled with this mitigation enabled.</span></span>

## <a name="data-execution-prevention-dep"></a><span data-ttu-id="279da-222">データ実行防止 (DEP)</span><span class="sxs-lookup"><span data-stu-id="279da-222">Data Execution Prevention (DEP)</span></span>

### <a name="description"></a><span data-ttu-id="279da-223">説明</span><span class="sxs-lookup"><span data-stu-id="279da-223">Description</span></span>

<span data-ttu-id="279da-224">データ実行防止 (DEP) は、実行可能ファイルとして明示的に割り当てられていないメモリが実行されるのを防ぐ。</span><span class="sxs-lookup"><span data-stu-id="279da-224">Data execution prevention (DEP) prevents memory that was not explicitly allocated as executable from being executed.</span></span> <span data-ttu-id="279da-225">DEP は、バッファー オーバーフローなどの悪意のあるコードをプロセスに挿入し、そのコードを実行する攻撃者から保護するのに役立ちます。</span><span class="sxs-lookup"><span data-stu-id="279da-225">DEP helps protect against an attacker injecting malicious code into the process, such as through a buffer overflow, and then executing that code.</span></span>

<span data-ttu-id="279da-226">命令ポインターを実行可能ファイルとしてマークされていないメモリ アドレスに設定しようとすると、プロセッサは例外 (一般保護違反) をスローし、アプリケーションがクラッシュします。</span><span class="sxs-lookup"><span data-stu-id="279da-226">If you attempt to set the instruction pointer to a memory address not marked as executable, the processor will throw an exception (general-protection violation), causing the application to crash.</span></span>

### <a name="compatibility-considerations"></a><span data-ttu-id="279da-227">互換性に関する考慮事項</span><span class="sxs-lookup"><span data-stu-id="279da-227">Compatibility considerations</span></span>

<span data-ttu-id="279da-228">すべての x64、ARM、ARM-64 の実行可能ファイルには既定で DEP が有効になっているので、無効にすることはできません。</span><span class="sxs-lookup"><span data-stu-id="279da-228">All x64, ARM, and ARM-64 executables have DEP enabled by default, and it cannot be disabled.</span></span> <span data-ttu-id="279da-229">アプリケーションは DEP なしで実行されたことがないので、互換性が前提となります。</span><span class="sxs-lookup"><span data-stu-id="279da-229">Since an application will have never been executed without DEP, compatibility is assumed.</span></span>

<span data-ttu-id="279da-230">すべての x86 (32 ビット) バイナリでは、既定で DEP が有効になっていますが、プロセスごとに DEP を無効にできます。</span><span class="sxs-lookup"><span data-stu-id="279da-230">All x86 (32-bit) binaries have DEP enabled by default, but DEP can be disabled per process.</span></span> <span data-ttu-id="279da-231">一部の古いレガシ アプリケーション (通常は XP SP2 より前に開発Windowsアプリケーション) は、DEP と互換性がない場合があります。</span><span class="sxs-lookup"><span data-stu-id="279da-231">Some old legacy applications, typically applications developed prior to Windows XP SP2, might not be compatible with DEP.</span></span> <span data-ttu-id="279da-232">このようなアプリケーションは、通常、コードを動的に生成する (JIT コンパイルなど)、またはコードを動的に生成する古いライブラリ (ATL の古いバージョンなど) へのリンクを生成します。</span><span class="sxs-lookup"><span data-stu-id="279da-232">Such applications typically generate code dynamically (for example, JIT compiling) or link to older libraries (such as older versions of ATL) which dynamically generate code.</span></span>

### <a name="configuration-options"></a><span data-ttu-id="279da-233">構成オプション</span><span class="sxs-lookup"><span data-stu-id="279da-233">Configuration options</span></span>

<span data-ttu-id="279da-234">**ATL Thunk エミュレーションを有効** にする - この構成オプションは、ATL Thunk エミュレーションを無効にします。</span><span class="sxs-lookup"><span data-stu-id="279da-234">**Enable ATL Thunk emulation** - This configuration option disables ATL Thunk emulation.</span></span> <span data-ttu-id="279da-235">ATL (ActiveX テンプレート ライブラリ) は、可能な限り小さく、高速に設計されています。</span><span class="sxs-lookup"><span data-stu-id="279da-235">ATL, the ActiveX Template Library, is designed to be as small and fast as possible.</span></span> <span data-ttu-id="279da-236">バイナリ サイズを小さくするには、サンクと呼ばれる手法 *を使用します*。</span><span class="sxs-lookup"><span data-stu-id="279da-236">In order to reduce binary size, it would use a technique called *thunking*.</span></span> <span data-ttu-id="279da-237">サンクは通常、32 ビットと 16 ビットの間のアプリケーションを操作するために考え出されますが、ここでは ATL に 16 ビット コンポーネントはありません。</span><span class="sxs-lookup"><span data-stu-id="279da-237">Thunking is typically thought of for interacting between 32-bit and 16-bit applications, but there are no 16-bit components to ATL here.</span></span> <span data-ttu-id="279da-238">代わりに、バイナリ サイズを最適化するために、ATL は、ワードアラインされていない (小さいバイナリを作成する) コンピューター コードをメモリに格納し、そのコードを直接呼び出します。</span><span class="sxs-lookup"><span data-stu-id="279da-238">Rather, in order to optimize for binary size, ATL will store machine code in memory that is not word-aligned (creating a smaller binary), and then invoke that code directly.</span></span> <span data-ttu-id="279da-239">Visual Studio 7.1 以前 (Visual Studio 2003) でコンパイルされた ATL コンポーネントは、このメモリを実行可能ファイルとして割り当てない - サンク エミュレーションは、その互換性の問題を解決します。</span><span class="sxs-lookup"><span data-stu-id="279da-239">ATL components compiled with Visual Studio 7.1 or earlier (Visual Studio 2003) do not allocate this memory as executable - thunk emulation resolves that compatibility issue.</span></span> <span data-ttu-id="279da-240">バイナリ拡張モデル (Internet Explorer 11 など) を持つアプリケーションでは、ATL Thunk エミュレーションを有効にする必要があります。</span><span class="sxs-lookup"><span data-stu-id="279da-240">Applications that have a binary extension model (such as Internet Explorer 11) will often need to have ATL Thunk emulation enabled.</span></span>

## <a name="disable-extension-points"></a><span data-ttu-id="279da-241">拡張ポイントの無効化</span><span class="sxs-lookup"><span data-stu-id="279da-241">Disable extension points</span></span>

### <a name="description"></a><span data-ttu-id="279da-242">説明</span><span class="sxs-lookup"><span data-stu-id="279da-242">Description</span></span>

<span data-ttu-id="279da-243">この軽減策は、アプリケーションのさまざまな拡張ポイントを無効にします。これは、悪意のあるコンテンツの永続性を確立したり、特権を昇格したりするために使用される可能性があります。</span><span class="sxs-lookup"><span data-stu-id="279da-243">This mitigation disables various extension points for an application, which might be used to establish persistence or elevate privileges of malicious content.</span></span>

<span data-ttu-id="279da-244">保持されるデータには以下が含まれます。</span><span class="sxs-lookup"><span data-stu-id="279da-244">This includes:</span></span>

- <span data-ttu-id="279da-245">**AppInit DLL** - プロセスが開始されるたびに、システムは指定した DLL を新しく開始したプロセスのコンテキストに読み込んでから、そのエントリ ポイント関数を呼び出します。</span><span class="sxs-lookup"><span data-stu-id="279da-245">**AppInit DLLs** - Whenever a process starts, the system will load the specified DLL into to context of the newly started process before calling its entry point function.</span></span> <span data-ttu-id="279da-246">[AppInit DLL の詳細については、こちらを参照してください](/windows/win32/winmsg/about-window-classes#application-global-classes)。</span><span class="sxs-lookup"><span data-stu-id="279da-246">[Details on AppInit DLLs can be found here](/windows/win32/winmsg/about-window-classes#application-global-classes).</span></span> <span data-ttu-id="279da-247">この軽減策が適用されると、AppInit DLL は読み込まれません。</span><span class="sxs-lookup"><span data-stu-id="279da-247">With this mitigation applied, AppInit DLLs are not loaded.</span></span> <span data-ttu-id="279da-248">7 からWindows AppInit DLL は、ここで説明するようにデジタル署名[する必要があります](/windows/win32/win7appqual/appinit-dlls-in-windows-7-and-windows-server-2008-r2)。</span><span class="sxs-lookup"><span data-stu-id="279da-248">Beginning with Windows 7, AppInit DLLs need to be digitally signed, [as described here](/windows/win32/win7appqual/appinit-dlls-in-windows-7-and-windows-server-2008-r2).</span></span> <span data-ttu-id="279da-249">さらに、ここで説明Windows 8、SecureBoot が有効になっている場合、AppInit DLL は[読み込まれません](/windows/win32/dlls/secure-boot-and-appinit-dlls)。</span><span class="sxs-lookup"><span data-stu-id="279da-249">Additionally, beginning with Windows 8, AppInit DLLs will not be loaded if SecureBoot is enabled, [as described here](/windows/win32/dlls/secure-boot-and-appinit-dlls).</span></span>
- <span data-ttu-id="279da-250">**従来の IMEs** - 入力メソッド エディター (IME) を使用すると、ユーザーはキーボードで表す文字よりも多くの文字を持つ言語でテキストを入力できます。</span><span class="sxs-lookup"><span data-stu-id="279da-250">**Legacy IMEs** - An Input Method Editor (IME) allows a user to type text in a language that has more characters than can be represented on a keyboard.</span></span> <span data-ttu-id="279da-251">サード パーティは IMEs を作成できます。</span><span class="sxs-lookup"><span data-stu-id="279da-251">Third parties are able to create IMEs.</span></span> <span data-ttu-id="279da-252">悪意のある IME は、この入力キャプチャから資格情報や他の機密情報を取得する可能性があります。</span><span class="sxs-lookup"><span data-stu-id="279da-252">A malicious IME might obtain credentials or other sensitive information from this input capture.</span></span> <span data-ttu-id="279da-253">従来の IMEs と呼ばれる一部の IMEs は、UWP アプリではなく、Windows デスクトップ アプリでのみ動作します。</span><span class="sxs-lookup"><span data-stu-id="279da-253">Some IMEs, referred to as Legacy IMEs, will only work on Windows Desktop apps, and not UWP apps.</span></span> <span data-ttu-id="279da-254">この軽減策により、この従来の IME が指定したデスクトップ アプリに読み込Windows防ぐことも可能です。</span><span class="sxs-lookup"><span data-stu-id="279da-254">This mitigation will also prevent this legacy IME from loading into the specified Windows Desktop app.</span></span>
- <span data-ttu-id="279da-255">**Windowsフック**- アプリケーションは [SetWinEventHook API](/windows/win32/api/winuser/nf-winuser-setwineventhook)を呼び出して、発生するイベントへの関心を登録できます。</span><span class="sxs-lookup"><span data-stu-id="279da-255">**Windows Event Hooks** - An application can call the [SetWinEventHook API](/windows/win32/api/winuser/nf-winuser-setwineventhook) to register interest in an event taking place.</span></span> <span data-ttu-id="279da-256">DLL が指定され、プロセスに挿入できます。</span><span class="sxs-lookup"><span data-stu-id="279da-256">A DLL is specified and can be injected into the process.</span></span> <span data-ttu-id="279da-257">この軽減策は、挿入された DLL を介してインプロセスを実行するのではなく、登録プロセスにフックを強制的に投稿します。</span><span class="sxs-lookup"><span data-stu-id="279da-257">This mitigation forces the hook to be posted to the registering process rather than running in-process through an injected DLL.</span></span>

### <a name="compatibility-considerations"></a><span data-ttu-id="279da-258">互換性に関する考慮事項</span><span class="sxs-lookup"><span data-stu-id="279da-258">Compatibility considerations</span></span>

<span data-ttu-id="279da-259">これらの拡張ポイントの大部分は比較的頻繁に使用されないので、互換性への影響は通常、特に個々のアプリケーション レベルで小さくても問題はありません。</span><span class="sxs-lookup"><span data-stu-id="279da-259">Most of these extension points are relatively infrequently used, so compatibility impact is typically small, particularly at an individual application level.</span></span> <span data-ttu-id="279da-260">1 つの考慮事項は、ユーザーが保護されたアプリケーションで動作しないサードパーティの従来の IMEs を使用している場合です。</span><span class="sxs-lookup"><span data-stu-id="279da-260">The one consideration is if users are using third-party Legacy IMEs that will not work with the protected application.</span></span>

### <a name="configuration-options"></a><span data-ttu-id="279da-261">構成オプション</span><span class="sxs-lookup"><span data-stu-id="279da-261">Configuration options</span></span>

<span data-ttu-id="279da-262">この軽減策の構成オプションはありません。</span><span class="sxs-lookup"><span data-stu-id="279da-262">There are no configuration options for this mitigation.</span></span>

> [!Note]
> <span data-ttu-id="279da-263">**拡張機能ポイントを無効に** した場合、監査モードはありません。</span><span class="sxs-lookup"><span data-stu-id="279da-263">**Disable extension points** has no audit mode.</span></span>

## <a name="disable-win32k-system-calls"></a><span data-ttu-id="279da-264">Win32k システム コールの無効化</span><span class="sxs-lookup"><span data-stu-id="279da-264">Disable Win32k system calls</span></span>

### <a name="description"></a><span data-ttu-id="279da-265">説明</span><span class="sxs-lookup"><span data-stu-id="279da-265">Description</span></span>

<span data-ttu-id="279da-266">Win32k.sysは、攻撃者に広範な攻撃の表面を提供します。</span><span class="sxs-lookup"><span data-stu-id="279da-266">Win32k.sys provides a broad attack surface for an attacker.</span></span> <span data-ttu-id="279da-267">カーネル モード コンポーネントとして、サンドボックス化されたアプリケーションのエスケープ ベクトルとして頻繁に対象とされます。</span><span class="sxs-lookup"><span data-stu-id="279da-267">As a kernel-mode component, it is frequently targeted as an escape vector for applications that are sandboxed.</span></span> <span data-ttu-id="279da-268">この軽減策は、スレッドwin32k.sys自体を GUI スレッドに変換し、Win32k 関数を呼び出すアクセス権を与えられるのをブロックすることで、ユーザーに対する呼び出しを防止します。</span><span class="sxs-lookup"><span data-stu-id="279da-268">This mitigation prevents calls into win32k.sys by blocking a thread from converting itself into a GUI thread, which is then given access to invoke Win32k functions.</span></span> <span data-ttu-id="279da-269">スレッドは、作成時には GUI 以外ですが、最初の呼び出しで win32k.sys または [IsGuiThread](/windows/win32/api/winuser/nf-winuser-isguithread)への API 呼び出しで変換されます。</span><span class="sxs-lookup"><span data-stu-id="279da-269">A thread is non-GUI when created, but converted on first call to win32k.sys, or through an API call to [IsGuiThread](/windows/win32/api/winuser/nf-winuser-isguithread).</span></span>

### <a name="compatibility-considerations"></a><span data-ttu-id="279da-270">互換性に関する考慮事項</span><span class="sxs-lookup"><span data-stu-id="279da-270">Compatibility considerations</span></span>

<span data-ttu-id="279da-271">この軽減策は、専用の非 UI プロセスであるプロセス用に設計されています。</span><span class="sxs-lookup"><span data-stu-id="279da-271">This mitigation is designed for processes that are dedicated non-UI processes.</span></span> <span data-ttu-id="279da-272">たとえば、多くの最新のブラウザーでは、プロセス分離を使用し、UI 以外のプロセスを組み込む必要があります。</span><span class="sxs-lookup"><span data-stu-id="279da-272">For example, many modern browsers will use process isolation and incorporate non-UI processes.</span></span> <span data-ttu-id="279da-273">1 つのプロセスを使用して GUI を表示するアプリケーションは、この軽減策の影響を受け取る可能性があります。</span><span class="sxs-lookup"><span data-stu-id="279da-273">Any application that displays a GUI using a single process will be impacted by this mitigation.</span></span>

### <a name="configuration-options"></a><span data-ttu-id="279da-274">構成オプション</span><span class="sxs-lookup"><span data-stu-id="279da-274">Configuration options</span></span>

<span data-ttu-id="279da-275">**[監査のみ** ] - アプリケーションに対する潜在的な互換性への影響を測定するために、監査モードでこの軽減策を有効にできます。</span><span class="sxs-lookup"><span data-stu-id="279da-275">**Audit Only** - You can enable this mitigation in audit mode in order to measure the potential compatibility impact on an application.</span></span> <span data-ttu-id="279da-276">監査イベントは、イベント ビューアーで表示するか、Microsoft Defender for Endpoint の Advanced Hunting を [使用して表示できます](/microsoft-365/security/defender/advanced-hunting-overview)。</span><span class="sxs-lookup"><span data-stu-id="279da-276">Audit events can then be viewed either in the event viewer or using Advanced Hunting in [Microsoft Defender for Endpoint](/microsoft-365/security/defender/advanced-hunting-overview).</span></span>

## <a name="do-not-allow-child-processes"></a><span data-ttu-id="279da-277">子プロセスを許可しない</span><span class="sxs-lookup"><span data-stu-id="279da-277">Do not allow child processes</span></span>

### <a name="description"></a><span data-ttu-id="279da-278">説明</span><span class="sxs-lookup"><span data-stu-id="279da-278">Description</span></span>

<span data-ttu-id="279da-279">この軽減策により、アプリケーションは新しい子アプリケーションを作成できます。</span><span class="sxs-lookup"><span data-stu-id="279da-279">This mitigation prevents an application from creating new child applications.</span></span> <span data-ttu-id="279da-280">敵対者が使用する一般的な手法は、悪意のある入力 ("土地から離れ" 攻撃) を使用してデバイス上で信頼できるプロセスを開始する方法です。多くの場合、デバイス上で別のアプリケーションを起動する必要があります。</span><span class="sxs-lookup"><span data-stu-id="279da-280">A common technique used by adversaries is to initiate a trusted process on the device with malicious input (a "living off the land" attack), which often requires launching another application on the device.</span></span> <span data-ttu-id="279da-281">アプリケーションが子プロセスを起動する正当な理由がない場合、この軽減策は、その潜在的な攻撃ベクトルを軽減します。</span><span class="sxs-lookup"><span data-stu-id="279da-281">If there are no legitimate reasons why an application would launch a child process, this mitigation mitigates that potential attack vector.</span></span> <span data-ttu-id="279da-282">この軽減策は、プロセス トークンにプロパティを設定することで適用されます。これは、エラー メッセージが表示された子プロセスのトークンを作成STATUS_CHILD_PROCESS_BLOCKED。</span><span class="sxs-lookup"><span data-stu-id="279da-282">The mitigation is applied by setting a property on the process token, which blocks creating a token for the child process with the error message STATUS_CHILD_PROCESS_BLOCKED.</span></span>

### <a name="compatibility-considerations"></a><span data-ttu-id="279da-283">互換性に関する考慮事項</span><span class="sxs-lookup"><span data-stu-id="279da-283">Compatibility considerations</span></span>

<span data-ttu-id="279da-284">ブラウザーや外部ブラウザーを起動するハイパーリンクのサポート、コンピューター上で他のユーティリティを起動するハイパーリンクなど、何らかの理由でアプリケーションが子アプリケーションを起動した場合、この機能は、この軽減策が適用された時点で壊れます。</span><span class="sxs-lookup"><span data-stu-id="279da-284">If your application launches child applications for any reason, such as supporting hyperlinks that launch a browser or an external browser, or which launch other utilities on the computer, this functionality will be broken with this mitigation applied.</span></span>

### <a name="configuration-options"></a><span data-ttu-id="279da-285">構成オプション</span><span class="sxs-lookup"><span data-stu-id="279da-285">Configuration options</span></span>

<span data-ttu-id="279da-286">**[監査のみ** ] - アプリケーションに対する潜在的な互換性への影響を測定するために、監査モードでこの軽減策を有効にできます。</span><span class="sxs-lookup"><span data-stu-id="279da-286">**Audit Only** - You can enable this mitigation in audit mode in order to measure the potential compatibility impact on an application.</span></span> <span data-ttu-id="279da-287">監査イベントは、イベント ビューアーで表示するか、Microsoft Defender for Endpoint の Advanced Hunting を [使用して表示できます](/microsoft-365/security/defender/advanced-hunting-overview)。</span><span class="sxs-lookup"><span data-stu-id="279da-287">Audit events can then be viewed either in the event viewer or using Advanced Hunting in [Microsoft Defender for Endpoint](/microsoft-365/security/defender/advanced-hunting-overview).</span></span>

## <a name="export-address-filtering"></a><span data-ttu-id="279da-288">アドレス フィルターのエクスポート</span><span class="sxs-lookup"><span data-stu-id="279da-288">Export address filtering</span></span>

### <a name="description"></a><span data-ttu-id="279da-289">説明</span><span class="sxs-lookup"><span data-stu-id="279da-289">Description</span></span>

<span data-ttu-id="279da-290">エクスポート アドレス フィルター (EAF) は、読み込まれたすべてのモジュールのエクスポート アドレス テーブルを見て、攻撃に役立つ API を含むモジュールを検索する悪意のあるコードのリスクを軽減します。</span><span class="sxs-lookup"><span data-stu-id="279da-290">Export address filtering (EAF) mitigates the risk of malicious code looking at the export address table of all loaded modules to find modules that contain useful APIs for their attack.</span></span> <span data-ttu-id="279da-291">これは、シェルコードで使用される一般的な方法です。</span><span class="sxs-lookup"><span data-stu-id="279da-291">This is a common tactic used by shellcode.</span></span> <span data-ttu-id="279da-292">このような攻撃のリスクを軽減するために、この軽減策は一般的に攻撃される 3 つのモジュールを保護します。</span><span class="sxs-lookup"><span data-stu-id="279da-292">In order to mitigate the risk of such an attack, this mitigation protects three commonly attacked modules:</span></span>

- <span data-ttu-id="279da-293">ntdll.dll</span><span class="sxs-lookup"><span data-stu-id="279da-293">ntdll.dll</span></span>
- <span data-ttu-id="279da-294">kernelbase.dll</span><span class="sxs-lookup"><span data-stu-id="279da-294">kernelbase.dll</span></span>
- <span data-ttu-id="279da-295">kernel32.dll</span><span class="sxs-lookup"><span data-stu-id="279da-295">kernel32.dll</span></span>

<span data-ttu-id="279da-296">この軽減策は、[エクスポート アドレス テーブルをポイントするエクスポート ディレクトリ内のメモリ ページ [を保護します](/windows/win32/debug/pe-format#export-address-table)。</span><span class="sxs-lookup"><span data-stu-id="279da-296">The mitigation protects the memory page in the [export directory that points to the [export address table](/windows/win32/debug/pe-format#export-address-table).</span></span> <span data-ttu-id="279da-297">このメモリ ページには [、PAGE_GUARD保護](/windows/win32/memory/creating-guard-pages) が適用されます。</span><span class="sxs-lookup"><span data-stu-id="279da-297">This memory page will have the [PAGE_GUARD](/windows/win32/memory/creating-guard-pages) protection applied to it.</span></span> <span data-ttu-id="279da-298">他のユーザーがこのメモリにアクセスしようとすると、そのメモリがSTATUS_GUARD_PAGE_VIOLATION。</span><span class="sxs-lookup"><span data-stu-id="279da-298">When someone tries to access this memory, it will generate a STATUS_GUARD_PAGE_VIOLATION.</span></span> <span data-ttu-id="279da-299">この軽減策は、この例外を処理し、アクセス命令が検証に合格しない場合、プロセスは終了します。</span><span class="sxs-lookup"><span data-stu-id="279da-299">The mitigation handles this exception, and if the accessing instruction doesn't pass validation, the process will be terminated.</span></span>

### <a name="compatibility-considerations"></a><span data-ttu-id="279da-300">互換性に関する考慮事項</span><span class="sxs-lookup"><span data-stu-id="279da-300">Compatibility considerations</span></span>

<span data-ttu-id="279da-301">この軽減策は、デバッガー、サンドボックス アプリケーション、DRM を使用するアプリケーション、デバッグ対策テクノロジを実装するアプリケーションなどのアプリケーションの主な問題です。</span><span class="sxs-lookup"><span data-stu-id="279da-301">This mitigation is primarily an issue for applications such as debuggers, sandboxed applications, applications using DRM, or applications that implement anti-debugging technology.</span></span>

### <a name="configuration-options"></a><span data-ttu-id="279da-302">構成オプション</span><span class="sxs-lookup"><span data-stu-id="279da-302">Configuration options</span></span>

<span data-ttu-id="279da-303">**悪用によって一般的に** 悪用されるモジュールのアクセスを検証する - このオプションは、EAF+とも呼ばれる、他の一般的に攻撃されるモジュールの保護を追加します。</span><span class="sxs-lookup"><span data-stu-id="279da-303">**Validate access for modules that are commonly abused by exploits** - This option, also known as EAF+, adds protections for other commonly attacked modules:</span></span>

- `mshtml.dll`
- `flash*.ocx`
- `jscript*.ocx`
- `vbscript.dll`
- `vgx.dll`
- `mozjs.dll`
- `xul.dll`
- `acrord32.dll`
- `acrofx32.dll`
- `acroform.api`

<span data-ttu-id="279da-304">さらに、EAF+ を有効にすると、この軽減策は、PE ファイル内の [DOS](/windows/win32/debug/pe-format#ms-dos-stub-image-only)ヘッダーの最初の 2 バイトである "MZ" ヘッダーを含むページに PAGE_GUARD 保護を追加します。これは、シェルコードがメモリに関心を持つ可能性のあるモジュールを識別するために検索できる既知のメモリ コンテンツのもう 1 つの側面です。</span><span class="sxs-lookup"><span data-stu-id="279da-304">Additionally, by enabling EAF+, this mitigation adds the PAGE_GUARD protection to the page containing the "MZ" header, the first two bytes of the [DOS header in a PE file](/windows/win32/debug/pe-format#ms-dos-stub-image-only), which is another aspect of known memory content which shellcode can look for to identify modules potentially of interest in memory.</span></span>

<span data-ttu-id="279da-305">**[監査のみ** ] - アプリケーションに対する潜在的な互換性への影響を測定するために、監査モードでこの軽減策を有効にできます。</span><span class="sxs-lookup"><span data-stu-id="279da-305">**Audit Only** - You can enable this mitigation in audit mode in order to measure the potential compatibility impact on an application.</span></span> <span data-ttu-id="279da-306">監査イベントは、イベント ビューアーで表示するか、Microsoft Defender for Endpoint の Advanced Hunting を [使用して表示できます](/microsoft-365/security/defender/advanced-hunting-overview)。</span><span class="sxs-lookup"><span data-stu-id="279da-306">Audit events can then be viewed either in the event viewer or using Advanced Hunting in [Microsoft Defender for Endpoint](/microsoft-365/security/defender/advanced-hunting-overview).</span></span>

## <a name="force-randomization-for-images-mandatory-aslr"></a><span data-ttu-id="279da-307">イメージのランダム化の強制 (必須 ASLR)</span><span class="sxs-lookup"><span data-stu-id="279da-307">Force randomization for images (Mandatory ASLR)</span></span>

### <a name="description"></a><span data-ttu-id="279da-308">説明</span><span class="sxs-lookup"><span data-stu-id="279da-308">Description</span></span>

<span data-ttu-id="279da-309">アドレス空間レイアウトランダム化 (ASLR) は、プロセス メモリに既に存在し、既に実行可能としてマークされているコードを実行するために、システムのメモリ レイアウトに関する知識を使用する攻撃者のリスクを軽減します。</span><span class="sxs-lookup"><span data-stu-id="279da-309">Address Space Layout Randomization (ASLR) mitigates the risk of an attacker using their knowledge of the memory layout of the system in order to execute code that is already present in process memory and already marked as executable.</span></span> <span data-ttu-id="279da-310">これにより、攻撃者が return-to-libc 攻撃などの手法を使用して、攻撃者がコンテキストを設定し、戻りアドレスを変更して、敵の目的に合ったコンテキストで既存のコードを実行するリスクを軽減できます。</span><span class="sxs-lookup"><span data-stu-id="279da-310">This can mitigate the risk of an attacker using techniques such as return-to-libc attacks, where the adversary sets the context and then modifies the return address to execute existing code with context that suits the adversary's purpose.</span></span>

<span data-ttu-id="279da-311">必須の ASLR では、プロセス内のすべての DLL の再ベースが強制されます。</span><span class="sxs-lookup"><span data-stu-id="279da-311">Mandatory ASLR forces a rebase of all DLLs within the process.</span></span> <span data-ttu-id="279da-312">開発者は [、/DYNAMICBASE](/cpp/build/reference/dynamicbase-use-address-space-layout-randomization?view=vs-2019&preserve-view=true) リンカー オプションを使用して ASLR を有効にできます。この軽減効果も同じです。</span><span class="sxs-lookup"><span data-stu-id="279da-312">A developer can enable ASLR using the [/DYNAMICBASE](/cpp/build/reference/dynamicbase-use-address-space-layout-randomization?view=vs-2019&preserve-view=true) linker option, and this mitigation has the same effect.</span></span>

<span data-ttu-id="279da-313">メモリ マネージャーがイメージ内でプロセスにマッピングしている場合、必須 ASLR は ASLR にオプトインしていない DLL と EXEs を強制的にリベースします。</span><span class="sxs-lookup"><span data-stu-id="279da-313">When the memory manager is mapping in the image into the process, Mandatory ASLR will forcibly rebase DLLs and EXEs that have not opted in to ASLR.</span></span> <span data-ttu-id="279da-314">ただし、このリバスはエントロピーを持たず、メモリ内の予測可能な場所に配置できます。</span><span class="sxs-lookup"><span data-stu-id="279da-314">Note, however, that this rebasing has no entropy, and can therefore be placed at a predictable location in memory.</span></span> <span data-ttu-id="279da-315">バイナリの再ベースおよびランダム化された場所の場合、この軽減策は、ランダム化メモリ割り当 [て (ボトムアップ ASLR)](#randomize-memory-allocations-bottom-up-aslr)とペアにする必要があります。</span><span class="sxs-lookup"><span data-stu-id="279da-315">For rebased and randomized location of binaries, this mitigation should be paired with [Randomize memory allocations (Bottom-up ASLR)](#randomize-memory-allocations-bottom-up-aslr).</span></span>

### <a name="compatibility-considerations"></a><span data-ttu-id="279da-316">互換性に関する考慮事項</span><span class="sxs-lookup"><span data-stu-id="279da-316">Compatibility considerations</span></span>

<span data-ttu-id="279da-317">ASLR のこの互換性への影響は、通常、バイナリ ファイルの基本アドレスを前提にしたコンパイラを使用して構築された古いアプリケーションや、基本再配置情報を削除した古いアプリケーションに制限されます。</span><span class="sxs-lookup"><span data-stu-id="279da-317">This compatibility impact of ASLR is typically constrained to older applications that were built using compilers that made assumptions about the base address of a binary file or have stripped out base relocation information.</span></span> <span data-ttu-id="279da-318">これにより、実行フローがメモリ内の実際の場所ではなく、予想される場所にジャンプしようとすると、予測できないエラーが発生する可能性があります。</span><span class="sxs-lookup"><span data-stu-id="279da-318">This can lead to unpredictable errors as the execution flow attempts to jump to the expected, rather than the actual, location in memory.</span></span>

### <a name="configuration-options"></a><span data-ttu-id="279da-319">構成オプション</span><span class="sxs-lookup"><span data-stu-id="279da-319">Configuration options</span></span>

<span data-ttu-id="279da-320">**削除された画像を許可しない** - このオプションは、再配置情報が削除されたイメージの読み込みをブロックします。</span><span class="sxs-lookup"><span data-stu-id="279da-320">**Do not allow stripped images** - This option blocks the loading of images that have had relocation information stripped.</span></span> <span data-ttu-id="279da-321">Windows PE ファイル形式には絶対アドレスが含まれます。また、コンパイラは [基本再配置テーブルを生成し、ローダーは、すべての相対メモリ参照とそのオフセットを検索するために使用できます。バイナリが優先ベース アドレスで読み込めない場合は更新できます。</span><span class="sxs-lookup"><span data-stu-id="279da-321">The Windows PE file format contains absolute addresses, and the compiler also generates a [base relocation table that the loader can use to find all relative memory references and their offset, so they can be updated if the binary does not load at its preferred base address.</span></span> <span data-ttu-id="279da-322">一部の古いアプリケーションでは、実稼働ビルドでこの情報を削除するため、これらのバイナリを再ベース化することはできません。</span><span class="sxs-lookup"><span data-stu-id="279da-322">Some older applications strip out this information in production builds, and therefore these binaries cannot be rebased.</span></span> <span data-ttu-id="279da-323">この軽減策は、このようなバイナリが読み込まれるのをブロックします (優先する基本アドレスで読み込む代わりに)。</span><span class="sxs-lookup"><span data-stu-id="279da-323">This mitigation blocks such binaries from being loaded (instead of allowing them to load at their preferred base address).</span></span>

> [!Note]
> <span data-ttu-id="279da-324">**イメージの強制的なランダム化 (必須 ASLR) には** 監査モードはありません。</span><span class="sxs-lookup"><span data-stu-id="279da-324">**Force randomization for images (Mandatory ASLR)** has no audit mode.</span></span>

## <a name="import-address-filtering-iaf"></a><span data-ttu-id="279da-325">インポート アドレス フィルター (IAF)</span><span class="sxs-lookup"><span data-stu-id="279da-325">Import address filtering (IAF)</span></span>

### <a name="description"></a><span data-ttu-id="279da-326">説明</span><span class="sxs-lookup"><span data-stu-id="279da-326">Description</span></span>

<span data-ttu-id="279da-327">インポート アドレス フィルター (IAF) の軽減は、インポート アドレス テーブル (IAT) を変更して、その関数が呼び出された際に攻撃者が選択した任意のコードにリダイレクトすることで、アプリケーションの制御フローを変更する敵のリスクを軽減するのに役立ちます。</span><span class="sxs-lookup"><span data-stu-id="279da-327">The import address filtering (IAF) mitigation helps mitigate the risk of an adversary changing the control flow of an application by modifying the import address table (IAT) to redirect to arbitrary code of the attacker's choice when that function is called.</span></span> <span data-ttu-id="279da-328">攻撃者は、このアプローチを使用して制御をハイジャックしたり、機密性の高い API への呼び出しを傍受、検査、ブロックしたりする可能性があります。</span><span class="sxs-lookup"><span data-stu-id="279da-328">An attacker could use this approach to hijack control, or to intercept, inspect, and potentially block calls to sensitive APIs.</span></span>

<span data-ttu-id="279da-329">すべての保護された API のメモリ ページには、PAGE_GUARD [保護が](/windows/win32/memory/creating-guard-pages) 適用されます。</span><span class="sxs-lookup"><span data-stu-id="279da-329">The memory pages for all protected APIs will have the [PAGE_GUARD](/windows/win32/memory/creating-guard-pages) protection applied to them.</span></span> <span data-ttu-id="279da-330">他のユーザーがこのメモリにアクセスしようとすると、そのメモリがSTATUS_GUARD_PAGE_VIOLATION。</span><span class="sxs-lookup"><span data-stu-id="279da-330">When someone tries to access this memory, it will generate a STATUS_GUARD_PAGE_VIOLATION.</span></span> <span data-ttu-id="279da-331">この軽減策は、この例外を処理し、アクセス命令が検証に合格しない場合、プロセスは終了します。</span><span class="sxs-lookup"><span data-stu-id="279da-331">The mitigation handles this exception, and if the accessing instruction doesn't pass validation, the process will be terminated.</span></span>

<span data-ttu-id="279da-332">この軽減策は、次の API Windows保護します。</span><span class="sxs-lookup"><span data-stu-id="279da-332">This mitigation protects the following Windows APIs:</span></span>

- `GetProcAddress`
- `GetProcAddressForCaller`
- `LoadLibraryA`
- `LoadLibraryExA`
- `LoadLibraryW`
- `LoadLibraryExW`
- `LdrGetProcedureAddress`
- `LdrGetProcedureAddressEx`
- `LdrGetProcedureAddressForCaller`
- `LdrLoadDll`
- `VirtualProtect`
- `VirtualProtectEx`
- `VirtualAlloc`
- `VirtualAllocEx`
- `NtAllocateVirtualMemory`
- `NtProtectVirtualMemory`
- `CreateProcessA`
- `CreateProcessW`
- `WinExec`
- `CreateProcessAsUserA`
- `CreateProcessAsUserW`
- `GetModuleHandleA`
- `GetModuleHandleW`
- `RtlDecodePointer`
- `DecodePointer`

### <a name="compatibility-considerations"></a><span data-ttu-id="279da-333">互換性に関する考慮事項</span><span class="sxs-lookup"><span data-stu-id="279da-333">Compatibility considerations</span></span>

<span data-ttu-id="279da-334">API インターセプトを実行する正当なアプリケーションは、この軽減策によって検出され、一部のアプリケーションがクラッシュする可能性があります。</span><span class="sxs-lookup"><span data-stu-id="279da-334">Legitimate applications that perform API interception may be detected by this mitigation and cause some applications to crash.</span></span> <span data-ttu-id="279da-335">たとえば、セキュリティ ソフトウェアとアプリケーションの互換性 shim が含まれます。</span><span class="sxs-lookup"><span data-stu-id="279da-335">Examples include security software and application compatibility shims.</span></span>

### <a name="configuration-options"></a><span data-ttu-id="279da-336">構成オプション</span><span class="sxs-lookup"><span data-stu-id="279da-336">Configuration options</span></span>

<span data-ttu-id="279da-337">**[監査のみ** ] - アプリケーションに対する潜在的な互換性への影響を測定するために、監査モードでこの軽減策を有効にできます。</span><span class="sxs-lookup"><span data-stu-id="279da-337">**Audit Only** - You can enable this mitigation in audit mode in order to measure the potential compatibility impact on an application.</span></span> <span data-ttu-id="279da-338">監査イベントは、イベント ビューアーで表示するか、Microsoft Defender for Endpoint の Advanced Hunting を [使用して表示できます](/microsoft-365/security/defender/advanced-hunting-overview)。</span><span class="sxs-lookup"><span data-stu-id="279da-338">Audit events can then be viewed either in the event viewer or using Advanced Hunting in [Microsoft Defender for Endpoint](/microsoft-365/security/defender/advanced-hunting-overview).</span></span>

## <a name="randomize-memory-allocations-bottom-up-aslr"></a><span data-ttu-id="279da-339">メモリ割り当てをランダム化する (ボトムアップ ASLR)</span><span class="sxs-lookup"><span data-stu-id="279da-339">Randomize memory allocations (Bottom-up ASLR)</span></span>

### <a name="description"></a><span data-ttu-id="279da-340">説明</span><span class="sxs-lookup"><span data-stu-id="279da-340">Description</span></span>

<span data-ttu-id="279da-341">メモリ割り当てをランダム化 (ボトムアップ ASLR) を使用すると、再配置にエントロピーが追加されるため、場所はランダム化されるため、予測が難しになります。</span><span class="sxs-lookup"><span data-stu-id="279da-341">Randomize memory allocations (Bottom-up ASLR) adds entropy to relocations, so their location is randomized and therefore less predictable.</span></span> <span data-ttu-id="279da-342">この軽減策を有効にするためには、必須の ASLR が必要です。</span><span class="sxs-lookup"><span data-stu-id="279da-342">This mitigation requires Mandatory ASLR to take effect.</span></span>

<span data-ttu-id="279da-343">32 ビット アドレス空間のサイズは、追加できるエントロピーに実用的な制約を与えるので、64 ビット アプリケーションでは、攻撃者がメモリ内の場所を推測するのが難しくなります。</span><span class="sxs-lookup"><span data-stu-id="279da-343">The size of the 32-bit address space places practical constraints on the entropy that can be added, and therefore 64-bit applications make it more difficult for an attacker to guess a location in memory.</span></span>

### <a name="compatibility-considerations"></a><span data-ttu-id="279da-344">互換性に関する考慮事項</span><span class="sxs-lookup"><span data-stu-id="279da-344">Compatibility considerations</span></span>

<span data-ttu-id="279da-345">必須 ASLR (リベース) と互換性のあるほとんどのアプリケーションは、ボトムアップ ASLR の他のエントロピーにも対応しています。</span><span class="sxs-lookup"><span data-stu-id="279da-345">Most applications that are compatible with Mandatory ASLR (rebasing) are also compatible with the other entropy of Bottom-up ASLR.</span></span> <span data-ttu-id="279da-346">一部のアプリケーションでは、ローカル ポインターを 32 ビット変数 (4 GB 以下のベース アドレスを必要とします) に保存する場合にポインター切り捨ての問題が発生する可能性があります。そのため、高エントロピー オプション (無効にできる) と互換性がありません。</span><span class="sxs-lookup"><span data-stu-id="279da-346">Some applications may have pointer-truncation issues if they are saving local pointers in 32-bit variables (expecting a base address below 4 GB), and thus will be incompatible with the high entropy option (which can be disabled).</span></span>

### <a name="configuration-options"></a><span data-ttu-id="279da-347">構成オプション</span><span class="sxs-lookup"><span data-stu-id="279da-347">Configuration options</span></span>

<span data-ttu-id="279da-348">高エントロピーを使用しない **-** このオプションは、64 ビット アプリケーションのボトムアップ割り当てに 24 ビットのエントロピー (分散 1 TB) を追加する、高エントロピー ASLR の使用を無効にします。</span><span class="sxs-lookup"><span data-stu-id="279da-348">**Don't use high entropy** - this option disables the use of high-entropy ASLR, which adds 24 bits of entropy (1 TB of variance) into the bottom-up allocation for 64-bit applications.</span></span>

> [!Note]
> <span data-ttu-id="279da-349">**メモリ割り当てのランダム化 (ボトムアップ ASLR) には** 監査モードはありません。</span><span class="sxs-lookup"><span data-stu-id="279da-349">**Randomize memory allocations (Bottom-up ASLR)** has no audit mode.</span></span>

## <a name="simulate-execution-simexec"></a><span data-ttu-id="279da-350">実行のシミュレート (SimExec)</span><span class="sxs-lookup"><span data-stu-id="279da-350">Simulate execution (SimExec)</span></span>

### <a name="description"></a><span data-ttu-id="279da-351">説明</span><span class="sxs-lookup"><span data-stu-id="279da-351">Description</span></span>

<span data-ttu-id="279da-352">シミュレーション実行 (SimExec) は、32 ビット アプリケーションの軽減策です。</span><span class="sxs-lookup"><span data-stu-id="279da-352">Simulate execution (SimExec) is a mitigation for 32-bit applications only.</span></span> <span data-ttu-id="279da-353">これにより、機密性の高い API への呼び出しが正当な呼び出し元関数に戻る検証に役立ちます。</span><span class="sxs-lookup"><span data-stu-id="279da-353">This helps validate that calls to sensitive APIs will return to legitimate caller functions.</span></span> <span data-ttu-id="279da-354">これは、機密性の高い API への呼び出しを傍受し、呼び出し元に返す RET 命令を探すエンコードされたアセンブリ言語命令を実行して、それらの API の実行をシミュレートすることで行います。</span><span class="sxs-lookup"><span data-stu-id="279da-354">It does this by intercepting calls into sensitive APIs, and then simulating the execution of those APIs by walking through the encoded assembly language instructions looking for the RET instruction, which should return to the caller.</span></span> <span data-ttu-id="279da-355">次に、その関数を検査し、メモリ内を後方に移動して、前の CALL 命令を見つけて、関数と CALL 命令が一致するかどうか、および RET が傍受されていないかどうかを判断します。</span><span class="sxs-lookup"><span data-stu-id="279da-355">It then inspects that function and walks backwards in memory to find the preceding CALL instruction to determine whether the function and CALL instruction match, and that the RET hasn't been intercepted.</span></span>

<span data-ttu-id="279da-356">この軽減策によって傍受される API は次のとおりです。</span><span class="sxs-lookup"><span data-stu-id="279da-356">The APIs intercepted by this mitigation are:</span></span>

- `LoadLibraryA`
- `LoadLibraryW`
- `LoadLibraryExA`
- `LoadLibraryExW`
- `LdrLoadDll`
- `VirtualAlloc`
- `VirtualAllocEx`
- `NtAllocateVirtualMemory`
- `VirtualProtect`
- `VirtualProtectEx`
- `NtProtectVirtualMemory`
- `HeapCreate`
- `RtlCreateHeap`
- `CreateProcessA`
- `CreateProcessW`
- `CreateProcessInternalA`
- `CreateProcessInternalW`
- `NtCreateUserProcess`
- `NtCreateProcess`
- `NtCreateProcessEx`
- `CreateRemoteThread`
- `CreateRemoteThreadEx`
- `NtCreateThreadEx`
- `WriteProcessMemory`
- `NtWriteVirtualMemory`
- `WinExec`
- `CreateFileMappingA`
- `CreateFileMappingW`
- `CreateFileMappingNumaW`
- `NtCreateSection`
- `MapViewOfFile`
- `MapViewOfFileEx`
- `MapViewOfFileFromApp`
- `LdrGetProcedureAddressForCaller`

<span data-ttu-id="279da-357">ROP ガジェットが検出されると、プロセスは終了します。</span><span class="sxs-lookup"><span data-stu-id="279da-357">If a ROP gadget is detected, the process is terminated.</span></span>

### <a name="compatibility-considerations"></a><span data-ttu-id="279da-358">互換性に関する考慮事項</span><span class="sxs-lookup"><span data-stu-id="279da-358">Compatibility considerations</span></span>

<span data-ttu-id="279da-359">API 傍受、特にセキュリティ ソフトウェアを実行するアプリケーションは、この軽減策との互換性の問題を引き起こす可能性があります。</span><span class="sxs-lookup"><span data-stu-id="279da-359">Applications that perform API interception, particularly security software, can cause compatibility problems with this mitigation.</span></span>

<span data-ttu-id="279da-360">この軽減策は、任意のコード ガードの軽減策と互換性がありません。</span><span class="sxs-lookup"><span data-stu-id="279da-360">This mitigation is incompatible with the Arbitrary Code Guard mitigation.</span></span>

### <a name="configuration-options"></a><span data-ttu-id="279da-361">構成オプション</span><span class="sxs-lookup"><span data-stu-id="279da-361">Configuration options</span></span>

<span data-ttu-id="279da-362">**[監査のみ** ] - アプリケーションに対する潜在的な互換性への影響を測定するために、監査モードでこの軽減策を有効にできます。</span><span class="sxs-lookup"><span data-stu-id="279da-362">**Audit Only** - You can enable this mitigation in audit mode in order to measure the potential compatibility impact on an application.</span></span> <span data-ttu-id="279da-363">監査イベントは、イベント ビューアーで表示するか、Microsoft Defender for Endpoint の Advanced Hunting を [使用して表示できます](/microsoft-365/security/defender/advanced-hunting-overview)。</span><span class="sxs-lookup"><span data-stu-id="279da-363">Audit events can then be viewed either in the event viewer or using Advanced Hunting in [Microsoft Defender for Endpoint](/microsoft-365/security/defender/advanced-hunting-overview).</span></span>

## <a name="validate-api-invocation-callercheck"></a><span data-ttu-id="279da-364">API 呼び出しの検証 (CallerCheck)</span><span class="sxs-lookup"><span data-stu-id="279da-364">Validate API invocation (CallerCheck)</span></span>

### <a name="description"></a><span data-ttu-id="279da-365">説明</span><span class="sxs-lookup"><span data-stu-id="279da-365">Description</span></span>

<span data-ttu-id="279da-366">検証 API 呼び出し (CallerCheck) は、有効な呼び出し元から機密性の高い API が呼び出されたのを検証する、戻り値指向プログラミング (ROP) 手法の軽減策です。</span><span class="sxs-lookup"><span data-stu-id="279da-366">Validate API invocation (CallerCheck) is a mitigation for return-oriented programming (ROP) techniques that validates that sensitive APIs were called from a valid caller.</span></span> <span data-ttu-id="279da-367">この軽減策は、渡された戻りアドレスを検査し、ヒューリスティックに逆アセンブルして、戻り値アドレスの上に呼び出しを見つけて、呼び出し先が関数に渡されたパラメーターと一致するかどうかを判断します。</span><span class="sxs-lookup"><span data-stu-id="279da-367">This mitigation inspects the passed return address, and then heuristically disassembles backwards to find a call above the return address to determine if the call target matches the parameter passed into the function.</span></span>

<span data-ttu-id="279da-368">この軽減策によって傍受される API は次のとおりです。</span><span class="sxs-lookup"><span data-stu-id="279da-368">The APIs intercepted by this mitigation are:</span></span>

- `LoadLibraryA`
- `LoadLibraryW`
- `LoadLibraryExA`
- `LoadLibraryExW`
- `LdrLoadDll`
- `VirtualAlloc`
- `VirtualAllocEx`
- `NtAllocateVirtualMemory`
- `VirtualProtect`
- `VirtualProtectEx`
- `NtProtectVirtualMemory`
- `HeapCreate`
- `RtlCreateHeap`
- `CreateProcessA`
- `CreateProcessW`
- `CreateProcessInternalA`
- `CreateProcessInternalW`
- `NtCreateUserProcess`
- `NtCreateProcess`
- `NtCreateProcessEx`
- `CreateRemoteThread`
- `CreateRemoteThreadEx`
- `NtCreateThreadEx`
- `WriteProcessMemory`
- `NtWriteVirtualMemory`
- `WinExec`
- `CreateFileMappingA`
- `CreateFileMappingW`
- `CreateFileMappingNumaW`
- `NtCreateSection`
- `MapViewOfFile`
- `MapViewOfFileEx`
- `MapViewOfFileFromApp`
- `LdrGetProcedureAddressForCaller`

<span data-ttu-id="279da-369">ROP ガジェットが検出されると、プロセスは終了します。</span><span class="sxs-lookup"><span data-stu-id="279da-369">If a ROP gadget is detected, the process is terminated.</span></span>

### <a name="compatibility-considerations"></a><span data-ttu-id="279da-370">互換性に関する考慮事項</span><span class="sxs-lookup"><span data-stu-id="279da-370">Compatibility considerations</span></span>

<span data-ttu-id="279da-371">API 傍受、特にセキュリティ ソフトウェアを実行するアプリケーションは、この軽減策との互換性の問題を引き起こす可能性があります。</span><span class="sxs-lookup"><span data-stu-id="279da-371">Applications that perform API interception, particularly security software, can cause compatibility problems with this mitigation.</span></span>

<span data-ttu-id="279da-372">この軽減策は、任意のコード ガードの軽減策と互換性がありません。</span><span class="sxs-lookup"><span data-stu-id="279da-372">This mitigation is incompatible with the Arbitrary Code Guard mitigation.</span></span>

### <a name="configuration-options"></a><span data-ttu-id="279da-373">構成オプション</span><span class="sxs-lookup"><span data-stu-id="279da-373">Configuration options</span></span>

<span data-ttu-id="279da-374">**[監査のみ** ] - アプリケーションに対する潜在的な互換性への影響を測定するために、監査モードでこの軽減策を有効にできます。</span><span class="sxs-lookup"><span data-stu-id="279da-374">**Audit Only** - You can enable this mitigation in audit mode in order to measure the potential compatibility impact on an application.</span></span> <span data-ttu-id="279da-375">監査イベントは、イベント ビューアーで表示するか、Microsoft Defender for Endpoint の Advanced Hunting を [使用して表示できます](/microsoft-365/security/defender/advanced-hunting-overview)。</span><span class="sxs-lookup"><span data-stu-id="279da-375">Audit events can then be viewed either in the event viewer or using Advanced Hunting in [Microsoft Defender for Endpoint](/microsoft-365/security/defender/advanced-hunting-overview).</span></span>

## <a name="validate-exception-chains-sehop"></a><span data-ttu-id="279da-376">例外チェーンの検証 (SEHOP)</span><span class="sxs-lookup"><span data-stu-id="279da-376">Validate exception chains (SEHOP)</span></span>

### <a name="description"></a><span data-ttu-id="279da-377">説明</span><span class="sxs-lookup"><span data-stu-id="279da-377">Description</span></span>

<span data-ttu-id="279da-378">例外チェーン (SEHOP) の検証は、構造化例外ハンドラー *(SEH)* 上書き悪用手法に対する軽減策です。</span><span class="sxs-lookup"><span data-stu-id="279da-378">Validate exception chains (SEHOP) is a mitigation against the *Structured Exception Handler (SEH) overwrite* exploitation technique.</span></span> <span data-ttu-id="279da-379">[構造化例外処理とは](/windows/win32/debug/structured-exception-handling) 、アプリケーションが特定の例外の処理を要求できるプロセスです。</span><span class="sxs-lookup"><span data-stu-id="279da-379">[Structured exception handling](/windows/win32/debug/structured-exception-handling) is the process by which an application can ask to handle a particular exception.</span></span> <span data-ttu-id="279da-380">例外ハンドラーは一緒にチェーン処理され、ある例外ハンドラーが特定の例外を処理しない場合は、処理を決定するまでチェーン内の次の例外ハンドラーに渡されます。</span><span class="sxs-lookup"><span data-stu-id="279da-380">Exception handlers are chained together, so that if one exception handler chooses not to handle a particular exception, it can be passed on to the next exception handler in the chain until one decides to handle it.</span></span> <span data-ttu-id="279da-381">ハンドラーの一覧は動的なので、スタックに格納されます。</span><span class="sxs-lookup"><span data-stu-id="279da-381">Because the list of handler is dynamic, it is stored on the stack.</span></span> <span data-ttu-id="279da-382">攻撃者はスタック オーバーフローの脆弱性を使用して、例外ハンドラーを攻撃者が選択したコードへのポインターで上書きできます。</span><span class="sxs-lookup"><span data-stu-id="279da-382">An attacker can use a stack overflow vulnerability to then overwrite the exception handler with a pointer to the code of the attacker's choice.</span></span>

<span data-ttu-id="279da-383">この軽減策は、各 SEH エントリに例外ハンドラーへのポインターと、例外チェーン内の次のハンドラーへのポインターの両方が含まれる SEH の設計に依存します。</span><span class="sxs-lookup"><span data-stu-id="279da-383">This mitigation relies on the design of SEH, where each SEH entry contains both a pointer to the exception handler, as well as a pointer to the next handler in the exception chain.</span></span> <span data-ttu-id="279da-384">この軽減策は、例外ディスパッチャーによって呼び出され、例外が呼び出されると SEH チェーンが検証されます。</span><span class="sxs-lookup"><span data-stu-id="279da-384">This mitigation is called by the exception dispatcher, which validates the SEH chain when an exception is invoked.</span></span> <span data-ttu-id="279da-385">次の情報が確認されます。</span><span class="sxs-lookup"><span data-stu-id="279da-385">It verifies that:</span></span>

- <span data-ttu-id="279da-386">すべての例外チェーン レコードがスタック境界内にある</span><span class="sxs-lookup"><span data-stu-id="279da-386">All exception chain records are within the stack boundaries</span></span>
- <span data-ttu-id="279da-387">すべての例外レコードが揃っています</span><span class="sxs-lookup"><span data-stu-id="279da-387">All exception records are aligned</span></span>
- <span data-ttu-id="279da-388">スタックを指している例外ハンドラー ポインターはありません</span><span class="sxs-lookup"><span data-stu-id="279da-388">No exception handler pointers are pointing to the stack</span></span>
- <span data-ttu-id="279da-389">下位ポインターはありません</span><span class="sxs-lookup"><span data-stu-id="279da-389">There are no backward pointers</span></span>
- <span data-ttu-id="279da-390">例外チェーンは、既知の最終的な例外ハンドラーで終了します。</span><span class="sxs-lookup"><span data-stu-id="279da-390">The exception chain ends at a known final exception handler</span></span>

<span data-ttu-id="279da-391">これらの検証が失敗した場合、例外処理は中止され、例外は処理されません。</span><span class="sxs-lookup"><span data-stu-id="279da-391">If these validations fail, then exception handling is aborted, and the exception will not be handled.</span></span>

### <a name="compatibility-considerations"></a><span data-ttu-id="279da-392">互換性に関する考慮事項</span><span class="sxs-lookup"><span data-stu-id="279da-392">Compatibility considerations</span></span>

<span data-ttu-id="279da-393">SEHOP との互換性の問題は比較的まれです。</span><span class="sxs-lookup"><span data-stu-id="279da-393">Compatibility issues with SEHOP are relatively rare.</span></span> <span data-ttu-id="279da-394">アプリケーションが例外チェーンの破損に依存する場合はまれです。</span><span class="sxs-lookup"><span data-stu-id="279da-394">It's uncommon for an application to take a dependency on corrupting the exception chain.</span></span> <span data-ttu-id="279da-395">ただし、一部のアプリケーションはタイミングの微妙な変化の影響を受け、アプリケーションの潜在的なマルチスレッド バグを明らかにする競争状態として現れる可能性があります。</span><span class="sxs-lookup"><span data-stu-id="279da-395">However, some applications are impacted by the subtle changes in timing, which may manifest as a race condition that reveals a latent multi-threading bug in the application.</span></span>

### <a name="configuration-options"></a><span data-ttu-id="279da-396">構成オプション</span><span class="sxs-lookup"><span data-stu-id="279da-396">Configuration options</span></span>

> [!Note]
> <span data-ttu-id="279da-397">**例外チェーン (SEHOP) に** 監査モードがないのを検証します。</span><span class="sxs-lookup"><span data-stu-id="279da-397">**Validate exception chains (SEHOP)** has no audit mode.</span></span>

## <a name="validate-handle-usage"></a><span data-ttu-id="279da-398">ハンドルの使用状態の検証</span><span class="sxs-lookup"><span data-stu-id="279da-398">Validate handle usage</span></span>

### <a name="description"></a><span data-ttu-id="279da-399">説明</span><span class="sxs-lookup"><span data-stu-id="279da-399">Description</span></span>

<span data-ttu-id="279da-400">*ハンドルの使用状況の検証* は、既存のハンドルを使用して保護されたオブジェクトにアクセスする攻撃者から保護するのに役立つ軽減策です。</span><span class="sxs-lookup"><span data-stu-id="279da-400">*Validate handle usage* is a mitigation that helps protect against an attacker using an existing handle to access a protected object.</span></span> <span data-ttu-id="279da-401">ハンドル [は](/windows/win32/sysinfo/handles-and-objects) 、保護されたオブジェクトへの参照です。</span><span class="sxs-lookup"><span data-stu-id="279da-401">A [handle](/windows/win32/sysinfo/handles-and-objects) is a reference to a protected object.</span></span> <span data-ttu-id="279da-402">アプリケーション コードが無効なハンドルを参照している場合、攻撃者が以前に記録したハンドルを使用しようとしている可能性があります (ただし、どのアプリケーション参照カウントが認識されません)。</span><span class="sxs-lookup"><span data-stu-id="279da-402">If application code is referencing an invalid handle, that could indicate that an adversary is attempting to use a handle it has previously recorded (but which application reference counting wouldn't be aware of).</span></span> <span data-ttu-id="279da-403">アプリケーションが null を返すのではなく、無効なオブジェクトを使用しようとすると、アプリケーションは例外を発生します (STATUS_INVALID_HANDLE)。</span><span class="sxs-lookup"><span data-stu-id="279da-403">If the application attempts to use an invalid object, instead of simply returning null, the application will raise an exception (STATUS_INVALID_HANDLE).</span></span>

<span data-ttu-id="279da-404">この軽減策は、ストア アプリケーションにWindows適用されます。</span><span class="sxs-lookup"><span data-stu-id="279da-404">This mitigation is automatically applied to Windows Store applications.</span></span>

### <a name="compatibility-considerations"></a><span data-ttu-id="279da-405">互換性に関する考慮事項</span><span class="sxs-lookup"><span data-stu-id="279da-405">Compatibility considerations</span></span>

<span data-ttu-id="279da-406">ハンドル参照を正確に追跡していないアプリケーション、および例外ハンドラーでこれらの操作をラップしていないアプリケーションは、この軽減策の影響を受け得る可能性があります。</span><span class="sxs-lookup"><span data-stu-id="279da-406">Applications that were not accurately tracking handle references, and which were not wrapping these operations in exception handlers, will potentially be impacted by this mitigation.</span></span>

### <a name="configuration-options"></a><span data-ttu-id="279da-407">構成オプション</span><span class="sxs-lookup"><span data-stu-id="279da-407">Configuration options</span></span>

> [!Note]
> <span data-ttu-id="279da-408">**ハンドルの使用状況を検証** する監査モードはありません。</span><span class="sxs-lookup"><span data-stu-id="279da-408">**Validate handle usage** has no audit mode.</span></span>

## <a name="validate-heap-integrity"></a><span data-ttu-id="279da-409">ヒープの整合性の検証</span><span class="sxs-lookup"><span data-stu-id="279da-409">Validate heap integrity</span></span>

### <a name="description"></a><span data-ttu-id="279da-410">説明</span><span class="sxs-lookup"><span data-stu-id="279da-410">Description</span></span>

<span data-ttu-id="279da-411">ヒープ *整合性の検証の* 軽減は、ヒープの破損が検出された場合にアプリケーションを終了することで、Windows でのヒープ軽減の保護レベルを向上します。</span><span class="sxs-lookup"><span data-stu-id="279da-411">The *validate heap integrity* mitigation increases the protection level of heap mitigations in Windows, by causing the application to terminate if a heap corruption is detected.</span></span> <span data-ttu-id="279da-412">軽減策には、次のものが含まれます。</span><span class="sxs-lookup"><span data-stu-id="279da-412">The mitigations include:</span></span>

- <span data-ttu-id="279da-413">HEAP ハンドルが解放されるのを防ぐ</span><span class="sxs-lookup"><span data-stu-id="279da-413">Preventing a HEAP handle from being freed</span></span>
- <span data-ttu-id="279da-414">ヒープ割り当ての拡張ブロック ヘッダーに対して別の検証を実行する</span><span class="sxs-lookup"><span data-stu-id="279da-414">Performing another validation on extended block headers for heap allocations</span></span>
- <span data-ttu-id="279da-415">ヒープ割り当てが既に使用済みとしてフラグが設定されていないか確認する</span><span class="sxs-lookup"><span data-stu-id="279da-415">Verifying that heap allocations are not already flagged as in-use</span></span>
- <span data-ttu-id="279da-416">最小サイズを超えて大きな割り当て、ヒープ セグメント、およびサブセグメントにガード ページを追加する</span><span class="sxs-lookup"><span data-stu-id="279da-416">Adding guard pages to large allocations, heap segments, and subsegments above a minimum size</span></span>

### <a name="compatibility-considerations"></a><span data-ttu-id="279da-417">互換性に関する考慮事項</span><span class="sxs-lookup"><span data-stu-id="279da-417">Compatibility considerations</span></span>

<span data-ttu-id="279da-418">この軽減策は、64 ビット アプリケーションおよび Vista 以降を対象とする 32 ビット アプリケーションWindows既に適用されています。</span><span class="sxs-lookup"><span data-stu-id="279da-418">This mitigation is already applied by default for 64-bit applications and for 32-bit applications targeting Windows Vista or later.</span></span> <span data-ttu-id="279da-419">XP 以前のWindowsアプリケーションは最も危険にさらされています。互換性の問題はまれです。</span><span class="sxs-lookup"><span data-stu-id="279da-419">Legacy applications from Windows XP or earlier are most at-risk, though compatibility issues are rare.</span></span>

### <a name="configuration-options"></a><span data-ttu-id="279da-420">構成オプション</span><span class="sxs-lookup"><span data-stu-id="279da-420">Configuration options</span></span>

> [!Note]
> <span data-ttu-id="279da-421">**ヒープ整合性の検証には監査** モードはありません。</span><span class="sxs-lookup"><span data-stu-id="279da-421">**Validate heap integrity** has no audit mode.</span></span>

## <a name="validate-image-dependency-integrity"></a><span data-ttu-id="279da-422">軽減策の依存関係の整合性の検証</span><span class="sxs-lookup"><span data-stu-id="279da-422">Validate image dependency integrity</span></span>

### <a name="description"></a><span data-ttu-id="279da-423">説明</span><span class="sxs-lookup"><span data-stu-id="279da-423">Description</span></span>

<span data-ttu-id="279da-424">検証 *イメージの依存関係の軽減* は、バイナリによって静的にリンクされている dll のコードを置き換える攻撃から保護するのにWindowsします。</span><span class="sxs-lookup"><span data-stu-id="279da-424">The *validate image dependency* mitigation helps protect against attacks that attempt to substitute code for dlls that are statically linked by Windows binaries.</span></span> <span data-ttu-id="279da-425">DLL の植え付け手法は、ローダーの検索メカニズムを悪用して悪意のあるコードを挿入します。これは、悪意のあるコードを昇格されたコンテキストで実行するために使用できます。</span><span class="sxs-lookup"><span data-stu-id="279da-425">The technique of DLL planting abuses the loader's search mechanism to inject malicious code, which can be used to get malicious code running in an elevated context.</span></span> <span data-ttu-id="279da-426">ローダーが Windows 署名されたバイナリを読み込み、そのバイナリが依存する dll を読み込む場合、これらのバイナリは、Windows バイナリとしてデジタル署名も行うかどうか確認されます。</span><span class="sxs-lookup"><span data-stu-id="279da-426">When the loader is loading a Windows signed binary, and then loads up any dlls that the binary depends on, these binaries will be verified to ensure that they are also digitally signed as a Windows binary.</span></span> <span data-ttu-id="279da-427">署名チェックに失敗した場合、dll は読み込まれないため、例外がスローされ、エラーの状態がSTATUS_INVALID_IMAGE_HASH。</span><span class="sxs-lookup"><span data-stu-id="279da-427">If they fail the signature check, the dll will not be loaded, and will throw an exception, returning a status of STATUS_INVALID_IMAGE_HASH.</span></span>

### <a name="compatibility-considerations"></a><span data-ttu-id="279da-428">互換性に関する考慮事項</span><span class="sxs-lookup"><span data-stu-id="279da-428">Compatibility considerations</span></span>

<span data-ttu-id="279da-429">互換性の問題は一般的ではありません。</span><span class="sxs-lookup"><span data-stu-id="279da-429">Compatibility issues are uncommon.</span></span> <span data-ttu-id="279da-430">Windows バイナリをローカルのプライベート バージョンに置き換えるのに依存するアプリケーションは影響を受け、マルチスレッド アプリケーションで微妙なタイミング バグが発生するリスクも少なからない。</span><span class="sxs-lookup"><span data-stu-id="279da-430">Applications that depend on replacing Windows binaries with local private versions will be impacted, and there is also a small risk of revealing subtle timing bugs in multi-threaded applications.</span></span>

### <a name="configuration-options"></a><span data-ttu-id="279da-431">構成オプション</span><span class="sxs-lookup"><span data-stu-id="279da-431">Configuration options</span></span>

<span data-ttu-id="279da-432">**[監査のみ** ] - アプリケーションに対する潜在的な互換性への影響を測定するために、監査モードでこの軽減策を有効にできます。</span><span class="sxs-lookup"><span data-stu-id="279da-432">**Audit Only** - You can enable this mitigation in audit mode in order to measure the potential compatibility impact on an application.</span></span> <span data-ttu-id="279da-433">監査イベントは、イベント ビューアーで表示するか、Microsoft Defender for Endpoint の Advanced Hunting を [使用して表示できます](/microsoft-365/security/defender/advanced-hunting-overview)。</span><span class="sxs-lookup"><span data-stu-id="279da-433">Audit events can then be viewed either in the event viewer or using Advanced Hunting in [Microsoft Defender for Endpoint](/microsoft-365/security/defender/advanced-hunting-overview).</span></span>

## <a name="validate-stack-integrity-stackpivot"></a><span data-ttu-id="279da-434">スタックの整合性の検証 (StackPivot)</span><span class="sxs-lookup"><span data-stu-id="279da-434">Validate stack integrity (StackPivot)</span></span>

### <a name="description"></a><span data-ttu-id="279da-435">説明</span><span class="sxs-lookup"><span data-stu-id="279da-435">Description</span></span>

<span data-ttu-id="279da-436">スタック整合性の検証 *(StackPivot)* の軽減は、スタック ピボット攻撃(攻撃者がヒープ メモリ内に偽のスタックを作成する ROP 攻撃)から保護し、実行のフローを制御する偽のスタックにアプリケーションを戻すのに役立ちます。</span><span class="sxs-lookup"><span data-stu-id="279da-436">The *validate stack integrity (StackPivot)* mitigation helps protect against the Stack Pivot attack, a ROP attack where an attacker creates a fake stack in heap memory, and then tricks the application into returning into the fake stack that controls the flow of execution.</span></span>

<span data-ttu-id="279da-437">この軽減策は、多Windows API を傍受し、スタック ポインターの値を検査します。</span><span class="sxs-lookup"><span data-stu-id="279da-437">This mitigation intercepts many Windows APIs, and inspects the value of the stack pointer.</span></span> <span data-ttu-id="279da-438">スタック ポインターのアドレスがスタックの下部と上の間に入らない場合は、イベントが記録され、監査モードではない場合、プロセスは終了します。</span><span class="sxs-lookup"><span data-stu-id="279da-438">If the address of the stack pointer does not fall between the bottom and the top of the stack, then an event is recorded and, if not in audit mode, the process will be terminated.</span></span>

<span data-ttu-id="279da-439">この軽減策によって傍受される API は次のとおりです。</span><span class="sxs-lookup"><span data-stu-id="279da-439">The APIs intercepted by this mitigation are:</span></span>

- `LoadLibraryA`
- `LoadLibraryW`
- `LoadLibraryExA`
- `LoadLibraryExW`
- `LdrLoadDll`
- `VirtualAlloc`
- `VirtualAllocEx`
- `NtAllocateVirtualMemory`
- `VirtualProtect`
- `VirtualProtectEx`
- `NtProtectVirtualMemory`
- `HeapCreate`
- `RtlCreateHeap`
- `CreateProcessA`
- `CreateProcessW`
- `CreateProcessInternalA`
- `CreateProcessInternalW`
- `NtCreateUserProcess`
- `NtCreateProcess`
- `NtCreateProcessEx`
- `CreateRemoteThread`
- `CreateRemoteThreadEx`
- `NtCreateThreadEx`
- `WriteProcessMemory`
- `NtWriteVirtualMemory`
- `WinExec`
- `CreateFileMappingA`
- `CreateFileMappingW`
- `CreateFileMappingNumaW`
- `NtCreateSection`
- `MapViewOfFile`
- `MapViewOfFileEx`
- `MapViewOfFileFromApp`
- `LdrGetProcedureAddressForCaller`

### <a name="compatibility-considerations"></a><span data-ttu-id="279da-440">互換性に関する考慮事項</span><span class="sxs-lookup"><span data-stu-id="279da-440">Compatibility considerations</span></span>

<span data-ttu-id="279da-441">偽のスタックを使用しているアプリケーションは影響を受け、マルチスレッド アプリケーションで微妙なタイミング バグを明らかにするリスクも小さい。</span><span class="sxs-lookup"><span data-stu-id="279da-441">Applications that are using fake stacks will be impacted, and there is also a small risk of revealing subtle timing bugs in multi-threaded applications.</span></span>
<span data-ttu-id="279da-442">API 傍受、特にセキュリティ ソフトウェアを実行するアプリケーションは、この軽減策との互換性の問題を引き起こす可能性があります。</span><span class="sxs-lookup"><span data-stu-id="279da-442">Applications that perform API interception, particularly security software, can cause compatibility problems with this mitigation.</span></span>

<span data-ttu-id="279da-443">この軽減策は、任意のコード ガードの軽減策と互換性がありません。</span><span class="sxs-lookup"><span data-stu-id="279da-443">This mitigation is incompatible with the Arbitrary Code Guard mitigation.</span></span>

### <a name="configuration-options"></a><span data-ttu-id="279da-444">構成オプション</span><span class="sxs-lookup"><span data-stu-id="279da-444">Configuration options</span></span>

<span data-ttu-id="279da-445">**[監査のみ** ] - アプリケーションに対する潜在的な互換性への影響を測定するために、監査モードでこの軽減策を有効にできます。</span><span class="sxs-lookup"><span data-stu-id="279da-445">**Audit Only** - You can enable this mitigation in audit mode in order to measure the potential compatibility impact on an application.</span></span> <span data-ttu-id="279da-446">監査イベントは、イベント ビューアーで表示するか、Microsoft Defender for Endpoint の Advanced Hunting を [使用して表示できます](/microsoft-365/security/defender/advanced-hunting-overview)。</span><span class="sxs-lookup"><span data-stu-id="279da-446">Audit events can then be viewed either in the event viewer or using Advanced Hunting in [Microsoft Defender for Endpoint](/microsoft-365/security/defender/advanced-hunting-overview).</span></span>
