---
title: Microsoft 365 の検索でのテナントの分離
ms.author: robmazz
author: robmazz
manager: laurawi
audience: ITPro
ms.topic: article
ms.service: O365-seccomp
localization_priority: Normal
search.appverid:
- MET150
ms.collection:
- Strat_O365_IP
- M365-security-compliance
f1.keywords:
- NOCSH
description: この記事では、テナントの分離がテナント データを分離する方法について説明します。Microsoft 365します。
ms.custom: seo-marvel-apr2020
ms.openlocfilehash: 3416afdeceaa7000b516ec89b4a2a1e59d8708d0
ms.sourcegitcommit: 27addd4dac07926528b788215d2dcd0e46301eb1
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 07/16/2021
ms.locfileid: "53464086"
---
# <a name="tenant-isolation-in-microsoft-365-search"></a>Microsoft 365 の検索でのテナントの分離

SharePointオンライン検索では、共有データ構造の効率とテナント間の情報漏洩に対する保護のバランスを取るテナント分離モデルを使用します。 このモデルでは、検索機能が次の機能から回避されます。

- 他のテナントのドキュメントを含むクエリ結果を返す
- 熟練したユーザーが他のテナントに関する情報を受け取る可能性があるクエリ結果に十分な情報を公開する
- 別のテナントからのスキーマまたは設定の表示
- テナント間での分析処理情報の混在や、テナント間のストアの結果の間違い
- 別のテナントからの辞書エントリの使用

テナント データの種類ごとに、コード内で 1 つ以上の保護層を使用して、情報の偶発的な漏洩を防止します。 最も重要なデータは、単一の欠陥が実際の情報漏洩や知覚情報漏洩を生じさせるのを防ぐ保護の層が最も多い。

## <a name="tenant-separation-for-the-search-index"></a>検索インデックスのテナントの分離

検索インデックスは、インデックス コンポーネントをホストするサーバーのディスクに格納され、テナントはインデックス ファイルを共有します。 テナントのインデックス付きドキュメントは、そのテナントのクエリにのみ表示されます。 3 つの独立したメカニズムが情報漏洩を防止します。

- テナント ID のフィルター処理
- テナント ID 用語のプレフィックス
- ACL チェック

3 つのメカニズムはすべて、Search が間違ったテナントにドキュメントを返すのに失敗する必要があります。

## <a name="tenant-id-filtering-and-tenant-id-term-prefixing"></a>テナント ID フィルターとテナント ID 用語プレフィックス

検索では、フルテキスト インデックスにインデックスが付くすべての用語にテナント ID が付くプレフィックスが付けされます。 たとえば *、"foo"* という用語が *"123"* の ID を持つテナントに対してインデックスが作成されている場合、フルテキスト インデックスのエントリは *"123foo" になります*。

すべてのクエリは、テナント ID フィルターと呼ばれるプロセスを使用してテナント ID を含めるに変換されます。 たとえば、クエリ *"foo"* は "<*guid*>。*foo* AND *tenantID*:<*guid*>"。ここで、<*guid*>クエリを実行するテナントを表します。 このクエリ変換は各インデックス ノード内で行われますが、クエリもコンテンツ処理も影響しません。 テナント ID がすべてのクエリに追加されるので、他のテナントの用語の頻度は、1 つのテナントで最適な一致ランクを見て推測することはできません。

テナント ID の用語プレフィックスは、フルテキスト インデックスでのみ発生します。 フィールド検索 *("title:foo"* など) は、用語の先頭にテナント ID が付かない合成検索インデックスに移動します。 代わりに、フィールド検索の先頭にフィールド名が付きます。 たとえば、クエリ "*title:foo*" は "*fields.title:foo AND fields.tenantID*:<*guid*>" に変換されます。 用語の頻度は合成検索インデックスのヒット数のランク付けには影響しないので、用語のプレフィックスによってテナントを分離する必要はありません。 *"title:foo"* のようなフィールド検索の場合、テナントコンテンツの分離は、クエリ変換によるテナント ID フィルタリングによって異なります。

## <a name="document-access-control-list-checks"></a>ドキュメント アクセス制御リストのチェック

検索は、検索インデックスに保存される ACL を介してドキュメントへのアクセスを制御します。 すべてのアイテムは、特別な ACL フィールド内の用語のセットでインデックスが作成されます。 ACL フィールドには、ドキュメントを表示できるグループまたはユーザーごとに 1 つの用語が含まれる。 すべてのクエリは、認証されたユーザーが属するグループごとに 1 つのアクセス制御エントリ (ACE) 用語の一覧で拡張されます。

たとえば、"<*guid"*>。*foo AND tenantID*:<*guid*>" は次<*guid*>。*foo AND tenantID*:<*guid* >  *AND* (*docACL:* < *ace1* >  *OR docACL*:<*ace2* >  *OR docACL*:<*ace3* >  *..*)"

ユーザーとグループの識別子とそれ以降の ACL は一意であるため、一部のユーザーにのみ表示されるドキュメントのテナント間のセキュリティレベルが強化されます。 テナント内の通常のユーザーにアクセスを許可する特別な "外部ユーザーを除くすべてのユーザー" ACE も同様です。 ただし、"Everyone" の ACEs は、すべてのテナントで同じので、パブリック ドキュメントのテナント分離はテナント ID フィルターによって異なります。 拒否の ACL もサポートされています。 クエリ拡張では、拒否 ACE との一致がある場合に結果からドキュメントを削除する句を追加します。

検索Exchange Online、インデックスは、オンラインの場合と同様に、テナント ID (サブスクリプション ID) ではなく、個々のユーザーのメールボックスのメールボックス ID にSharePointされます。 パーティショニングメカニズムは、SharePointと同じですが、ACL フィルターはありません。
